(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7283],{64335:function(zr,N,S){"use strict";var ce=S(67294),E=(0,ce.createContext)({});N.Z=E},21349:function(zr,N,S){"use strict";var ce=S(84305),E=S(69224),d=S(53645),me=S.n(d),te=S(67294),ue=S(94184),oe=S.n(ue),Ne=S(64335),K=function(mt){var Zt=(0,te.useContext)(Ne.Z),Cr=mt.children,Qt=mt.contentWidth,Xt=mt.className,rr=mt.style,Ut=(0,te.useContext)(E.ZP.ConfigContext),St=Ut.getPrefixCls,Et=mt.prefixCls||St("pro"),yr=Qt||Zt.contentWidth,q="".concat(Et,"-grid-content");return te.createElement("div",{className:oe()(q,Xt,{wide:yr==="Fixed"}),style:rr},te.createElement("div",{className:"".concat(Et,"-grid-content-children")},Cr))};N.Z=K},46343:function(zr,N,S){"use strict";S.d(N,{zj:function(){return Bt},oI:function(){return ea},ni:function(){return ye},gg:function(){return En}});var ce=S(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function E(ar,ge,Te,Ze){function Oe(Lt){return Lt instanceof Te?Lt:new Te(function(nr){nr(Lt)})}return new(Te||(Te=Promise))(function(Lt,nr){function dr(un){try{lr(Ze.next(un))}catch(w){nr(w)}}function Or(un){try{lr(Ze.throw(un))}catch(w){nr(w)}}function lr(un){un.done?Lt(un.value):Oe(un.value).then(dr,Or)}lr((Ze=Ze.apply(ar,ge||[])).next())})}function d(ar,ge){var Te={label:0,sent:function(){if(Lt[0]&1)throw Lt[1];return Lt[1]},trys:[],ops:[]},Ze,Oe,Lt,nr;return nr={next:dr(0),throw:dr(1),return:dr(2)},typeof Symbol=="function"&&(nr[Symbol.iterator]=function(){return this}),nr;function dr(lr){return function(un){return Or([lr,un])}}function Or(lr){if(Ze)throw new TypeError("Generator is already executing.");for(;Te;)try{if(Ze=1,Oe&&(Lt=lr[0]&2?Oe.return:lr[0]?Oe.throw||((Lt=Oe.return)&&Lt.call(Oe),0):Oe.next)&&!(Lt=Lt.call(Oe,lr[1])).done)return Lt;switch(Oe=0,Lt&&(lr=[lr[0]&2,Lt.value]),lr[0]){case 0:case 1:Lt=lr;break;case 4:return Te.label++,{value:lr[1],done:!1};case 5:Te.label++,Oe=lr[1],lr=[0];continue;case 7:lr=Te.ops.pop(),Te.trys.pop();continue;default:if(Lt=Te.trys,!(Lt=Lt.length>0&&Lt[Lt.length-1])&&(lr[0]===6||lr[0]===2)){Te=0;continue}if(lr[0]===3&&(!Lt||lr[1]>Lt[0]&&lr[1]<Lt[3])){Te.label=lr[1];break}if(lr[0]===6&&Te.label<Lt[1]){Te.label=Lt[1],Lt=lr;break}if(Lt&&Te.label<Lt[2]){Te.label=Lt[2],Te.ops.push(lr);break}Lt[2]&&Te.ops.pop(),Te.trys.pop();continue}lr=ge.call(ar,Te)}catch(un){lr=[6,un],Oe=0}finally{Ze=Lt=0}if(lr[0]&5)throw lr[1];return{value:lr[0]?lr[1]:void 0,done:!0}}}function me(ar,ge){var Te=typeof Symbol=="function"&&ar[Symbol.iterator];if(!Te)return ar;var Ze=Te.call(ar),Oe,Lt=[],nr;try{for(;(ge===void 0||ge-- >0)&&!(Oe=Ze.next()).done;)Lt.push(Oe.value)}catch(dr){nr={error:dr}}finally{try{Oe&&!Oe.done&&(Te=Ze.return)&&Te.call(Ze)}finally{if(nr)throw nr.error}}return Lt}function te(){for(var ar=[],ge=0;ge<arguments.length;ge++)ar=ar.concat(me(arguments[ge]));return ar}function ue(ar){return ar&&ar.__esModule&&Object.prototype.hasOwnProperty.call(ar,"default")?ar.default:ar}function oe(ar,ge){return ge={exports:{}},ar(ge,ge.exports),ge.exports}var Ne=oe(function(ar,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.default=Te;function Te(Ze){return Ze&&typeof Ze.length=="number"&&Ze.length>=0&&Ze.length%1==0}ar.exports=ge.default});ue(Ne);var K=oe(function(ar,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.default=function(Te){return function(){for(var Ze=[],Oe=arguments.length;Oe--;)Ze[Oe]=arguments[Oe];var Lt=Ze.pop();return Te.call(this,Ze,Lt)}},ar.exports=ge.default});ue(K);var Qe=oe(function(ar,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.fallback=Oe,ge.wrap=Lt;var Te=ge.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,Ze=ge.hasNextTick=typeof ce=="object"&&typeof ce.nextTick=="function";function Oe(dr){setTimeout(dr,0)}function Lt(dr){return function(Or){for(var lr=[],un=arguments.length-1;un-- >0;)lr[un]=arguments[un+1];return dr(function(){return Or.apply(void 0,lr)})}}var nr;Te?nr=setImmediate:Ze?nr=ce.nextTick:nr=Oe,ge.default=Lt(nr)});ue(Qe);var mt=Qe.fallback,Zt=Qe.wrap,Cr=Qe.hasSetImmediate,Qt=Qe.hasNextTick,Xt=oe(function(ar,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.default=Lt;var Te=Oe(K),Ze=Oe(Qe);function Oe(Or){return Or&&Or.__esModule?Or:{default:Or}}function Lt(Or){return(0,rr.isAsync)(Or)?function(){for(var lr=[],un=arguments.length;un--;)lr[un]=arguments[un];var w=lr.pop(),H=Or.apply(this,lr);return nr(H,w)}:(0,Te.default)(function(lr,un){var w;try{w=Or.apply(this,lr)}catch(H){return un(H)}if(w&&typeof w.then=="function")return nr(w,un);un(null,w)})}function nr(Or,lr){return Or.then(function(un){dr(lr,null,un)},function(un){dr(lr,un&&un.message?un:new Error(un))})}function dr(Or,lr,un){try{Or(lr,un)}catch(w){(0,Ze.default)(function(H){throw H},w)}}ar.exports=ge.default});ue(Xt);var rr=oe(function(ar,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.isAsyncIterable=ge.isAsyncGenerator=ge.isAsync=void 0;var Te=Ze(Xt);function Ze(Or){return Or&&Or.__esModule?Or:{default:Or}}function Oe(Or){return Or[Symbol.toStringTag]==="AsyncFunction"}function Lt(Or){return Or[Symbol.toStringTag]==="AsyncGenerator"}function nr(Or){return typeof Or[Symbol.asyncIterator]=="function"}function dr(Or){if(typeof Or!="function")throw new Error("expected a function");return Oe(Or)?(0,Te.default)(Or):Or}ge.default=dr,ge.isAsync=Oe,ge.isAsyncGenerator=Lt,ge.isAsyncIterable=nr});ue(rr);var Ut=rr.isAsyncIterable,St=rr.isAsyncGenerator,Et=rr.isAsync,yr=oe(function(ar,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.default=Te;function Te(Ze,Oe){if(Oe===void 0&&(Oe=Ze.length),!Oe)throw new Error("arity is undefined");function Lt(){for(var nr=this,dr=[],Or=arguments.length;Or--;)dr[Or]=arguments[Or];return typeof dr[Oe-1]=="function"?Ze.apply(this,dr):new Promise(function(lr,un){dr[Oe-1]=function(w){for(var H=[],Ue=arguments.length-1;Ue-- >0;)H[Ue]=arguments[Ue+1];if(w)return un(w);lr(H.length>1?H:H[0])},Ze.apply(nr,dr)})}return Object.defineProperty(Lt,"name",{configurable:!0,value:"awaitable("+Ze.name+")"}),Lt}ar.exports=ge.default});ue(yr);var q=oe(function(ar,ge){Object.defineProperty(ge,"__esModule",{value:!0});var Te=Lt(Ne),Ze=Lt(rr),Oe=Lt(yr);function Lt(nr){return nr&&nr.__esModule?nr:{default:nr}}ge.default=(0,Oe.default)(function(nr,dr,Or){var lr=(0,Te.default)(dr)?[]:{};nr(dr,function(un,w,H){(0,Ze.default)(un)(function(Ue){for(var et,st=[],Ct=arguments.length-1;Ct-- >0;)st[Ct]=arguments[Ct+1];st.length<2&&(et=st,st=et[0]),lr[w]=st,H(Ue)})},function(un){return Or(un,lr)})},3),ar.exports=ge.default});ue(q);var hr=oe(function(ar,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.default=Te;function Te(Ze){function Oe(){for(var Lt=[],nr=arguments.length;nr--;)Lt[nr]=arguments[nr];if(Ze!==null){var dr=Ze;Ze=null,dr.apply(this,Lt)}}return Object.assign(Oe,Ze),Oe}ar.exports=ge.default});ue(hr);var wt=oe(function(ar,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.default=function(Te){return Te[Symbol.iterator]&&Te[Symbol.iterator]()},ar.exports=ge.default});ue(wt);var $e=oe(function(ar,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.default=Or;var Te=Oe(Ne),Ze=Oe(wt);function Oe(lr){return lr&&lr.__esModule?lr:{default:lr}}function Lt(lr){var un=-1,w=lr.length;return function(){return++un<w?{value:lr[un],key:un}:null}}function nr(lr){var un=-1;return function(){var H=lr.next();return H.done?null:(un++,{value:H.value,key:un})}}function dr(lr){var un=lr?Object.keys(lr):[],w=-1,H=un.length;return function(){var et=un[++w];return w<H?{value:lr[et],key:et}:null}}function Or(lr){if((0,Te.default)(lr))return Lt(lr);var un=(0,Ze.default)(lr);return un?nr(un):dr(lr)}ar.exports=ge.default});ue($e);var Ft=oe(function(ar,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.default=Te;function Te(Ze){return function(){for(var Oe=[],Lt=arguments.length;Lt--;)Oe[Lt]=arguments[Lt];if(Ze===null)throw new Error("Callback was already called.");var nr=Ze;Ze=null,nr.apply(this,Oe)}}ar.exports=ge.default});ue(Ft);var Xe=oe(function(ar,ge){Object.defineProperty(ge,"__esModule",{value:!0});var Te={};ge.default=Te,ar.exports=ge.default});ue(Xe);var jt=oe(function(ar,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.default=Oe;var Te=Ze(Xe);function Ze(Lt){return Lt&&Lt.__esModule?Lt:{default:Lt}}function Oe(Lt,nr,dr,Or){var lr=!1,un=!1,w=!1,H=0,Ue=0;function et(){H>=nr||w||lr||(w=!0,Lt.next().then(function($){var Gt=$.value,Tr=$.done;if(!(un||lr)){if(w=!1,Tr){lr=!0,H<=0&&Or(null);return}H++,dr(Gt,Ue,st),Ue++,et()}}).catch(Ct))}function st($,Gt){if(H-=1,!un){if($)return Ct($);if($===!1){lr=!0,un=!0;return}if(Gt===Te.default||lr&&H<=0)return lr=!0,Or(null);et()}}function Ct($){un||(w=!1,lr=!0,Or($))}et()}ar.exports=ge.default});ue(jt);var br=oe(function(ar,ge){Object.defineProperty(ge,"__esModule",{value:!0});var Te=dr(hr),Ze=dr($e),Oe=dr(Ft),Lt=dr(jt),nr=dr(Xe);function dr(Or){return Or&&Or.__esModule?Or:{default:Or}}ge.default=function(Or){return function(lr,un,w){if(w=(0,Te.default)(w),Or<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!lr)return w(null);if((0,rr.isAsyncGenerator)(lr))return(0,Lt.default)(lr,Or,un,w);if((0,rr.isAsyncIterable)(lr))return(0,Lt.default)(lr[Symbol.asyncIterator](),Or,un,w);var H=(0,Ze.default)(lr),Ue=!1,et=!1,st=0,Ct=!1;function $(Tr,Ir){if(!et)if(st-=1,Tr)Ue=!0,w(Tr);else if(Tr===!1)Ue=!0,et=!0;else{if(Ir===nr.default||Ue&&st<=0)return Ue=!0,w(null);Ct||Gt()}}function Gt(){for(Ct=!0;st<Or&&!Ue;){var Tr=H();if(Tr===null){Ue=!0,st<=0&&w(null);return}st+=1,un(Tr.value,Tr.key,(0,Oe.default)($))}Ct=!1}Gt()}},ar.exports=ge.default});ue(br);var sr=oe(function(ar,ge){Object.defineProperty(ge,"__esModule",{value:!0});var Te=Lt(br),Ze=Lt(rr),Oe=Lt(yr);function Lt(dr){return dr&&dr.__esModule?dr:{default:dr}}function nr(dr,Or,lr,un){return(0,Te.default)(Or)(dr,(0,Ze.default)(lr),un)}ge.default=(0,Oe.default)(nr,4),ar.exports=ge.default});ue(sr);var j=oe(function(ar,ge){Object.defineProperty(ge,"__esModule",{value:!0});var Te=Oe(sr),Ze=Oe(yr);function Oe(nr){return nr&&nr.__esModule?nr:{default:nr}}function Lt(nr,dr,Or){return(0,Te.default)(nr,1,dr,Or)}ge.default=(0,Ze.default)(Lt,3),ar.exports=ge.default});ue(j);var ie=oe(function(ar,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.default=Lt;var Te=Oe(q),Ze=Oe(j);function Oe(nr){return nr&&nr.__esModule?nr:{default:nr}}function Lt(nr,dr){return(0,Te.default)(Ze.default,nr,dr)}ar.exports=ge.default}),Re=ue(ie),ye=function(){function ar(){for(var ge=arguments,Te=[],Ze=0;Ze<arguments.length;Ze++)Te[Ze]=ge[Ze];this.args=[],this.tasks=[]}return ar.prototype.call=function(){for(var ge=arguments,Te=[],Ze=0;Ze<arguments.length;Ze++)Te[Ze]=ge[Ze];return this.args=Te,Re(this.tasks)},ar.prototype.tap=function(ge,Te){var Ze=this;this.tasks.push(function(Oe){Te.apply(void 0,te(Ze.args)),Oe(null,ge)})},ar}(),_t=oe(function(ar,ge){Object.defineProperty(ge,"__esModule",{value:!0});var Te=lr(Ne),Ze=lr(Xe),Oe=lr(sr),Lt=lr(hr),nr=lr(Ft),dr=lr(rr),Or=lr(yr);function lr(Ue){return Ue&&Ue.__esModule?Ue:{default:Ue}}function un(Ue,et,st){st=(0,Lt.default)(st);var Ct=0,$=0,Gt=Ue.length,Tr=!1;Gt===0&&st(null);function Ir(Ye,ut){Ye===!1&&(Tr=!0),Tr!==!0&&(Ye?st(Ye):(++$===Gt||ut===Ze.default)&&st(null))}for(;Ct<Gt;Ct++)et(Ue[Ct],Ct,(0,nr.default)(Ir))}function w(Ue,et,st){return(0,Oe.default)(Ue,Infinity,et,st)}function H(Ue,et,st){var Ct=(0,Te.default)(Ue)?un:w;return Ct(Ue,(0,dr.default)(et),st)}ge.default=(0,Or.default)(H,3),ar.exports=ge.default});ue(_t);var dt=oe(function(ar,ge){Object.defineProperty(ge,"__esModule",{value:!0}),ge.default=Lt;var Te=Oe(_t),Ze=Oe(q);function Oe(nr){return nr&&nr.__esModule?nr:{default:nr}}function Lt(nr,dr){return(0,Ze.default)(Te.default,nr,dr)}ar.exports=ge.default}),zt=ue(dt),Bt=function(){function ar(){for(var ge=arguments,Te=[],Ze=0;Ze<arguments.length;Ze++)Te[Ze]=ge[Ze];this.tasks=[]}return ar.prototype.promise=function(){for(var ge=arguments,Te=[],Ze=0;Ze<arguments.length;Ze++)Te[Ze]=ge[Ze];return zt(this.tasks)},ar.prototype.tapPromise=function(ge,Te){var Ze=this;this.tasks.push(function(Oe){return E(Ze,void 0,void 0,function(){return d(this,function(Lt){switch(Lt.label){case 0:return[4,Te()];case 1:return Lt.sent(),Oe(null,ge),[2]}})})})},ar}(),Ur=oe(function(ar,ge){Object.defineProperty(ge,"__esModule",{value:!0});var Te=nr(hr),Ze=nr(Ft),Oe=nr(rr),Lt=nr(yr);function nr(Or){return Or&&Or.__esModule?Or:{default:Or}}function dr(Or,lr){if(lr=(0,Te.default)(lr),!Array.isArray(Or))return lr(new Error("First argument to waterfall must be an array of functions"));if(!Or.length)return lr();var un=0;function w(Ue){var et=(0,Oe.default)(Or[un++]);et.apply(void 0,Ue.concat([(0,Ze.default)(H)]))}function H(Ue){for(var et=[],st=arguments.length-1;st-- >0;)et[st]=arguments[st+1];if(Ue!==!1){if(Ue||un===Or.length)return lr.apply(void 0,[Ue].concat(et));w(et)}}w([])}ge.default=(0,Lt.default)(dr),ar.exports=ge.default}),vn=ue(Ur),En=function(){function ar(){for(var ge=arguments,Te=[],Ze=0;Ze<arguments.length;Ze++)Te[Ze]=ge[Ze];this.tasks=[]}return ar.prototype.call=function(){for(var ge=arguments,Te=[],Ze=0;Ze<arguments.length;Ze++)Te[Ze]=ge[Ze];return vn(this.tasks)},ar.prototype.tap=function(ge,Te){this.tasks.length===0?this.tasks.push(function(Ze){var Oe=Te();Ze(Oe?null:!1,Oe)}):this.tasks.push(function(Ze,Oe){var Lt=Te();Oe(Lt?null:!1,ge)})},ar}(),ea=function(){function ar(){for(var ge=arguments,Te=[],Ze=0;Ze<arguments.length;Ze++)Te[Ze]=ge[Ze];this.tasks=[]}return ar.prototype.call=function(){for(var ge=arguments,Te=[],Ze=0;Ze<arguments.length;Ze++)Te[Ze]=ge[Ze];return Re(this.tasks)},ar.prototype.tap=function(ge,Te){this.tasks.push(function(Ze){var Oe=Te();Ze(Oe,ge)})},ar}()},58881:function(zr,N,S){"use strict";S.d(N,{nC:function(){return ce.ZP},Hp:function(){return ce.Hp},e7:function(){return ce.e7},yT:function(){return ce.yT},vK:function(){return d.v},BlendType:function(){return te.h},AttributeType:function(){return ue.GC},ScaleTypes:function(){return ue.vY},StyleScaleType:function(){return ue.ee},MapServiceEvent:function(){return K.I},CoordinateSystem:function(){return Qe.l},CoordinateUniform:function(){return Qe.k},CameraUniform:function(){return Cr.l},SceneEventList:function(){return rr.P},PositionType:function(){return wt.d},gl:function(){return nr.gl}});var ce=S(12250),E=S(69530),d=S(72302),me=S(76915),te=S(77252),ue=S(31251),oe=S(8628),Ne=S.n(oe);S.o(oe,"CameraUniform")&&S.d(N,{CameraUniform:function(){return oe.CameraUniform}}),S.o(oe,"CityBuildingLayer")&&S.d(N,{CityBuildingLayer:function(){return oe.CityBuildingLayer}}),S.o(oe,"CoordinateSystem")&&S.d(N,{CoordinateSystem:function(){return oe.CoordinateSystem}}),S.o(oe,"CoordinateUniform")&&S.d(N,{CoordinateUniform:function(){return oe.CoordinateUniform}}),S.o(oe,"HeatmapLayer")&&S.d(N,{HeatmapLayer:function(){return oe.HeatmapLayer}}),S.o(oe,"ImageLayer")&&S.d(N,{ImageLayer:function(){return oe.ImageLayer}}),S.o(oe,"LineLayer")&&S.d(N,{LineLayer:function(){return oe.LineLayer}}),S.o(oe,"MapServiceEvent")&&S.d(N,{MapServiceEvent:function(){return oe.MapServiceEvent}}),S.o(oe,"Marker")&&S.d(N,{Marker:function(){return oe.Marker}}),S.o(oe,"PointLayer")&&S.d(N,{PointLayer:function(){return oe.PointLayer}}),S.o(oe,"PolygonLayer")&&S.d(N,{PolygonLayer:function(){return oe.PolygonLayer}}),S.o(oe,"Popup")&&S.d(N,{Popup:function(){return oe.Popup}}),S.o(oe,"PositionType")&&S.d(N,{PositionType:function(){return oe.PositionType}}),S.o(oe,"RasterLayer")&&S.d(N,{RasterLayer:function(){return oe.RasterLayer}}),S.o(oe,"Scene")&&S.d(N,{Scene:function(){return oe.Scene}}),S.o(oe,"SceneEventList")&&S.d(N,{SceneEventList:function(){return oe.SceneEventList}}),S.o(oe,"gl")&&S.d(N,{gl:function(){return oe.gl}});var K=S(16606),Qe=S(47282),mt=S(41906),Zt=S.n(mt);S.o(mt,"CameraUniform")&&S.d(N,{CameraUniform:function(){return mt.CameraUniform}}),S.o(mt,"CityBuildingLayer")&&S.d(N,{CityBuildingLayer:function(){return mt.CityBuildingLayer}}),S.o(mt,"HeatmapLayer")&&S.d(N,{HeatmapLayer:function(){return mt.HeatmapLayer}}),S.o(mt,"ImageLayer")&&S.d(N,{ImageLayer:function(){return mt.ImageLayer}}),S.o(mt,"LineLayer")&&S.d(N,{LineLayer:function(){return mt.LineLayer}}),S.o(mt,"Marker")&&S.d(N,{Marker:function(){return mt.Marker}}),S.o(mt,"PointLayer")&&S.d(N,{PointLayer:function(){return mt.PointLayer}}),S.o(mt,"PolygonLayer")&&S.d(N,{PolygonLayer:function(){return mt.PolygonLayer}}),S.o(mt,"Popup")&&S.d(N,{Popup:function(){return mt.Popup}}),S.o(mt,"PositionType")&&S.d(N,{PositionType:function(){return mt.PositionType}}),S.o(mt,"RasterLayer")&&S.d(N,{RasterLayer:function(){return mt.RasterLayer}}),S.o(mt,"Scene")&&S.d(N,{Scene:function(){return mt.Scene}}),S.o(mt,"SceneEventList")&&S.d(N,{SceneEventList:function(){return mt.SceneEventList}}),S.o(mt,"gl")&&S.d(N,{gl:function(){return mt.gl}});var Cr=S(4594),Qt=S(1910),Xt=S.n(Qt);S.o(Qt,"CityBuildingLayer")&&S.d(N,{CityBuildingLayer:function(){return Qt.CityBuildingLayer}}),S.o(Qt,"HeatmapLayer")&&S.d(N,{HeatmapLayer:function(){return Qt.HeatmapLayer}}),S.o(Qt,"ImageLayer")&&S.d(N,{ImageLayer:function(){return Qt.ImageLayer}}),S.o(Qt,"LineLayer")&&S.d(N,{LineLayer:function(){return Qt.LineLayer}}),S.o(Qt,"Marker")&&S.d(N,{Marker:function(){return Qt.Marker}}),S.o(Qt,"PointLayer")&&S.d(N,{PointLayer:function(){return Qt.PointLayer}}),S.o(Qt,"PolygonLayer")&&S.d(N,{PolygonLayer:function(){return Qt.PolygonLayer}}),S.o(Qt,"Popup")&&S.d(N,{Popup:function(){return Qt.Popup}}),S.o(Qt,"PositionType")&&S.d(N,{PositionType:function(){return Qt.PositionType}}),S.o(Qt,"RasterLayer")&&S.d(N,{RasterLayer:function(){return Qt.RasterLayer}}),S.o(Qt,"Scene")&&S.d(N,{Scene:function(){return Qt.Scene}}),S.o(Qt,"SceneEventList")&&S.d(N,{SceneEventList:function(){return Qt.SceneEventList}}),S.o(Qt,"gl")&&S.d(N,{gl:function(){return Qt.gl}});var rr=S(19793),Ut=S(93102),St=S.n(Ut);S.o(Ut,"CityBuildingLayer")&&S.d(N,{CityBuildingLayer:function(){return Ut.CityBuildingLayer}}),S.o(Ut,"HeatmapLayer")&&S.d(N,{HeatmapLayer:function(){return Ut.HeatmapLayer}}),S.o(Ut,"ImageLayer")&&S.d(N,{ImageLayer:function(){return Ut.ImageLayer}}),S.o(Ut,"LineLayer")&&S.d(N,{LineLayer:function(){return Ut.LineLayer}}),S.o(Ut,"Marker")&&S.d(N,{Marker:function(){return Ut.Marker}}),S.o(Ut,"PointLayer")&&S.d(N,{PointLayer:function(){return Ut.PointLayer}}),S.o(Ut,"PolygonLayer")&&S.d(N,{PolygonLayer:function(){return Ut.PolygonLayer}}),S.o(Ut,"Popup")&&S.d(N,{Popup:function(){return Ut.Popup}}),S.o(Ut,"PositionType")&&S.d(N,{PositionType:function(){return Ut.PositionType}}),S.o(Ut,"RasterLayer")&&S.d(N,{RasterLayer:function(){return Ut.RasterLayer}}),S.o(Ut,"Scene")&&S.d(N,{Scene:function(){return Ut.Scene}}),S.o(Ut,"gl")&&S.d(N,{gl:function(){return Ut.gl}});var Et=S(64532),yr=S.n(Et);S.o(Et,"CityBuildingLayer")&&S.d(N,{CityBuildingLayer:function(){return Et.CityBuildingLayer}}),S.o(Et,"HeatmapLayer")&&S.d(N,{HeatmapLayer:function(){return Et.HeatmapLayer}}),S.o(Et,"ImageLayer")&&S.d(N,{ImageLayer:function(){return Et.ImageLayer}}),S.o(Et,"LineLayer")&&S.d(N,{LineLayer:function(){return Et.LineLayer}}),S.o(Et,"Marker")&&S.d(N,{Marker:function(){return Et.Marker}}),S.o(Et,"PointLayer")&&S.d(N,{PointLayer:function(){return Et.PointLayer}}),S.o(Et,"PolygonLayer")&&S.d(N,{PolygonLayer:function(){return Et.PolygonLayer}}),S.o(Et,"Popup")&&S.d(N,{Popup:function(){return Et.Popup}}),S.o(Et,"PositionType")&&S.d(N,{PositionType:function(){return Et.PositionType}}),S.o(Et,"RasterLayer")&&S.d(N,{RasterLayer:function(){return Et.RasterLayer}}),S.o(Et,"Scene")&&S.d(N,{Scene:function(){return Et.Scene}}),S.o(Et,"gl")&&S.d(N,{gl:function(){return Et.gl}});var q=S(2811),hr=S.n(q);S.o(q,"CityBuildingLayer")&&S.d(N,{CityBuildingLayer:function(){return q.CityBuildingLayer}}),S.o(q,"HeatmapLayer")&&S.d(N,{HeatmapLayer:function(){return q.HeatmapLayer}}),S.o(q,"ImageLayer")&&S.d(N,{ImageLayer:function(){return q.ImageLayer}}),S.o(q,"LineLayer")&&S.d(N,{LineLayer:function(){return q.LineLayer}}),S.o(q,"Marker")&&S.d(N,{Marker:function(){return q.Marker}}),S.o(q,"PointLayer")&&S.d(N,{PointLayer:function(){return q.PointLayer}}),S.o(q,"PolygonLayer")&&S.d(N,{PolygonLayer:function(){return q.PolygonLayer}}),S.o(q,"Popup")&&S.d(N,{Popup:function(){return q.Popup}}),S.o(q,"PositionType")&&S.d(N,{PositionType:function(){return q.PositionType}}),S.o(q,"RasterLayer")&&S.d(N,{RasterLayer:function(){return q.RasterLayer}}),S.o(q,"Scene")&&S.d(N,{Scene:function(){return q.Scene}}),S.o(q,"gl")&&S.d(N,{gl:function(){return q.gl}});var wt=S(66690),$e=S(81732),Ft=S.n($e);S.o($e,"CityBuildingLayer")&&S.d(N,{CityBuildingLayer:function(){return $e.CityBuildingLayer}}),S.o($e,"HeatmapLayer")&&S.d(N,{HeatmapLayer:function(){return $e.HeatmapLayer}}),S.o($e,"ImageLayer")&&S.d(N,{ImageLayer:function(){return $e.ImageLayer}}),S.o($e,"LineLayer")&&S.d(N,{LineLayer:function(){return $e.LineLayer}}),S.o($e,"Marker")&&S.d(N,{Marker:function(){return $e.Marker}}),S.o($e,"PointLayer")&&S.d(N,{PointLayer:function(){return $e.PointLayer}}),S.o($e,"PolygonLayer")&&S.d(N,{PolygonLayer:function(){return $e.PolygonLayer}}),S.o($e,"Popup")&&S.d(N,{Popup:function(){return $e.Popup}}),S.o($e,"RasterLayer")&&S.d(N,{RasterLayer:function(){return $e.RasterLayer}}),S.o($e,"Scene")&&S.d(N,{Scene:function(){return $e.Scene}}),S.o($e,"gl")&&S.d(N,{gl:function(){return $e.gl}});var Xe=S(84007),jt=S.n(Xe);S.o(Xe,"CityBuildingLayer")&&S.d(N,{CityBuildingLayer:function(){return Xe.CityBuildingLayer}}),S.o(Xe,"HeatmapLayer")&&S.d(N,{HeatmapLayer:function(){return Xe.HeatmapLayer}}),S.o(Xe,"ImageLayer")&&S.d(N,{ImageLayer:function(){return Xe.ImageLayer}}),S.o(Xe,"LineLayer")&&S.d(N,{LineLayer:function(){return Xe.LineLayer}}),S.o(Xe,"Marker")&&S.d(N,{Marker:function(){return Xe.Marker}}),S.o(Xe,"PointLayer")&&S.d(N,{PointLayer:function(){return Xe.PointLayer}}),S.o(Xe,"PolygonLayer")&&S.d(N,{PolygonLayer:function(){return Xe.PolygonLayer}}),S.o(Xe,"Popup")&&S.d(N,{Popup:function(){return Xe.Popup}}),S.o(Xe,"RasterLayer")&&S.d(N,{RasterLayer:function(){return Xe.RasterLayer}}),S.o(Xe,"Scene")&&S.d(N,{Scene:function(){return Xe.Scene}}),S.o(Xe,"gl")&&S.d(N,{gl:function(){return Xe.gl}});var br=S(89648),sr=S(90919),j=S.n(sr);S.o(sr,"CityBuildingLayer")&&S.d(N,{CityBuildingLayer:function(){return sr.CityBuildingLayer}}),S.o(sr,"HeatmapLayer")&&S.d(N,{HeatmapLayer:function(){return sr.HeatmapLayer}}),S.o(sr,"ImageLayer")&&S.d(N,{ImageLayer:function(){return sr.ImageLayer}}),S.o(sr,"LineLayer")&&S.d(N,{LineLayer:function(){return sr.LineLayer}}),S.o(sr,"Marker")&&S.d(N,{Marker:function(){return sr.Marker}}),S.o(sr,"PointLayer")&&S.d(N,{PointLayer:function(){return sr.PointLayer}}),S.o(sr,"PolygonLayer")&&S.d(N,{PolygonLayer:function(){return sr.PolygonLayer}}),S.o(sr,"Popup")&&S.d(N,{Popup:function(){return sr.Popup}}),S.o(sr,"RasterLayer")&&S.d(N,{RasterLayer:function(){return sr.RasterLayer}}),S.o(sr,"Scene")&&S.d(N,{Scene:function(){return sr.Scene}}),S.o(sr,"gl")&&S.d(N,{gl:function(){return sr.gl}});var ie=S(75925),Re=S.n(ie);S.o(ie,"CityBuildingLayer")&&S.d(N,{CityBuildingLayer:function(){return ie.CityBuildingLayer}}),S.o(ie,"HeatmapLayer")&&S.d(N,{HeatmapLayer:function(){return ie.HeatmapLayer}}),S.o(ie,"ImageLayer")&&S.d(N,{ImageLayer:function(){return ie.ImageLayer}}),S.o(ie,"LineLayer")&&S.d(N,{LineLayer:function(){return ie.LineLayer}}),S.o(ie,"Marker")&&S.d(N,{Marker:function(){return ie.Marker}}),S.o(ie,"PointLayer")&&S.d(N,{PointLayer:function(){return ie.PointLayer}}),S.o(ie,"PolygonLayer")&&S.d(N,{PolygonLayer:function(){return ie.PolygonLayer}}),S.o(ie,"Popup")&&S.d(N,{Popup:function(){return ie.Popup}}),S.o(ie,"RasterLayer")&&S.d(N,{RasterLayer:function(){return ie.RasterLayer}}),S.o(ie,"Scene")&&S.d(N,{Scene:function(){return ie.Scene}}),S.o(ie,"gl")&&S.d(N,{gl:function(){return ie.gl}});var ye=S(85040),_t=S.n(ye);S.o(ye,"CityBuildingLayer")&&S.d(N,{CityBuildingLayer:function(){return ye.CityBuildingLayer}}),S.o(ye,"HeatmapLayer")&&S.d(N,{HeatmapLayer:function(){return ye.HeatmapLayer}}),S.o(ye,"ImageLayer")&&S.d(N,{ImageLayer:function(){return ye.ImageLayer}}),S.o(ye,"LineLayer")&&S.d(N,{LineLayer:function(){return ye.LineLayer}}),S.o(ye,"Marker")&&S.d(N,{Marker:function(){return ye.Marker}}),S.o(ye,"PointLayer")&&S.d(N,{PointLayer:function(){return ye.PointLayer}}),S.o(ye,"PolygonLayer")&&S.d(N,{PolygonLayer:function(){return ye.PolygonLayer}}),S.o(ye,"Popup")&&S.d(N,{Popup:function(){return ye.Popup}}),S.o(ye,"RasterLayer")&&S.d(N,{RasterLayer:function(){return ye.RasterLayer}}),S.o(ye,"Scene")&&S.d(N,{Scene:function(){return ye.Scene}}),S.o(ye,"gl")&&S.d(N,{gl:function(){return ye.gl}});var dt=S(8594),zt=S.n(dt);S.o(dt,"CityBuildingLayer")&&S.d(N,{CityBuildingLayer:function(){return dt.CityBuildingLayer}}),S.o(dt,"HeatmapLayer")&&S.d(N,{HeatmapLayer:function(){return dt.HeatmapLayer}}),S.o(dt,"ImageLayer")&&S.d(N,{ImageLayer:function(){return dt.ImageLayer}}),S.o(dt,"LineLayer")&&S.d(N,{LineLayer:function(){return dt.LineLayer}}),S.o(dt,"Marker")&&S.d(N,{Marker:function(){return dt.Marker}}),S.o(dt,"PointLayer")&&S.d(N,{PointLayer:function(){return dt.PointLayer}}),S.o(dt,"PolygonLayer")&&S.d(N,{PolygonLayer:function(){return dt.PolygonLayer}}),S.o(dt,"Popup")&&S.d(N,{Popup:function(){return dt.Popup}}),S.o(dt,"RasterLayer")&&S.d(N,{RasterLayer:function(){return dt.RasterLayer}}),S.o(dt,"Scene")&&S.d(N,{Scene:function(){return dt.Scene}}),S.o(dt,"gl")&&S.d(N,{gl:function(){return dt.gl}});var Bt=S(67571),Ur=S.n(Bt);S.o(Bt,"CityBuildingLayer")&&S.d(N,{CityBuildingLayer:function(){return Bt.CityBuildingLayer}}),S.o(Bt,"HeatmapLayer")&&S.d(N,{HeatmapLayer:function(){return Bt.HeatmapLayer}}),S.o(Bt,"ImageLayer")&&S.d(N,{ImageLayer:function(){return Bt.ImageLayer}}),S.o(Bt,"LineLayer")&&S.d(N,{LineLayer:function(){return Bt.LineLayer}}),S.o(Bt,"Marker")&&S.d(N,{Marker:function(){return Bt.Marker}}),S.o(Bt,"PointLayer")&&S.d(N,{PointLayer:function(){return Bt.PointLayer}}),S.o(Bt,"PolygonLayer")&&S.d(N,{PolygonLayer:function(){return Bt.PolygonLayer}}),S.o(Bt,"Popup")&&S.d(N,{Popup:function(){return Bt.Popup}}),S.o(Bt,"RasterLayer")&&S.d(N,{RasterLayer:function(){return Bt.RasterLayer}}),S.o(Bt,"Scene")&&S.d(N,{Scene:function(){return Bt.Scene}}),S.o(Bt,"gl")&&S.d(N,{gl:function(){return Bt.gl}});var vn=S(66718),En=S.n(vn);S.o(vn,"CityBuildingLayer")&&S.d(N,{CityBuildingLayer:function(){return vn.CityBuildingLayer}}),S.o(vn,"HeatmapLayer")&&S.d(N,{HeatmapLayer:function(){return vn.HeatmapLayer}}),S.o(vn,"ImageLayer")&&S.d(N,{ImageLayer:function(){return vn.ImageLayer}}),S.o(vn,"LineLayer")&&S.d(N,{LineLayer:function(){return vn.LineLayer}}),S.o(vn,"Marker")&&S.d(N,{Marker:function(){return vn.Marker}}),S.o(vn,"PointLayer")&&S.d(N,{PointLayer:function(){return vn.PointLayer}}),S.o(vn,"PolygonLayer")&&S.d(N,{PolygonLayer:function(){return vn.PolygonLayer}}),S.o(vn,"Popup")&&S.d(N,{Popup:function(){return vn.Popup}}),S.o(vn,"RasterLayer")&&S.d(N,{RasterLayer:function(){return vn.RasterLayer}}),S.o(vn,"Scene")&&S.d(N,{Scene:function(){return vn.Scene}}),S.o(vn,"gl")&&S.d(N,{gl:function(){return vn.gl}});var ea=S(92364),ar=S(78010),ge=S.n(ar);S.o(ar,"CityBuildingLayer")&&S.d(N,{CityBuildingLayer:function(){return ar.CityBuildingLayer}}),S.o(ar,"HeatmapLayer")&&S.d(N,{HeatmapLayer:function(){return ar.HeatmapLayer}}),S.o(ar,"ImageLayer")&&S.d(N,{ImageLayer:function(){return ar.ImageLayer}}),S.o(ar,"LineLayer")&&S.d(N,{LineLayer:function(){return ar.LineLayer}}),S.o(ar,"Marker")&&S.d(N,{Marker:function(){return ar.Marker}}),S.o(ar,"PointLayer")&&S.d(N,{PointLayer:function(){return ar.PointLayer}}),S.o(ar,"PolygonLayer")&&S.d(N,{PolygonLayer:function(){return ar.PolygonLayer}}),S.o(ar,"Popup")&&S.d(N,{Popup:function(){return ar.Popup}}),S.o(ar,"RasterLayer")&&S.d(N,{RasterLayer:function(){return ar.RasterLayer}}),S.o(ar,"Scene")&&S.d(N,{Scene:function(){return ar.Scene}}),S.o(ar,"gl")&&S.d(N,{gl:function(){return ar.gl}});var Te=S(68116),Ze=S.n(Te);S.o(Te,"CityBuildingLayer")&&S.d(N,{CityBuildingLayer:function(){return Te.CityBuildingLayer}}),S.o(Te,"HeatmapLayer")&&S.d(N,{HeatmapLayer:function(){return Te.HeatmapLayer}}),S.o(Te,"ImageLayer")&&S.d(N,{ImageLayer:function(){return Te.ImageLayer}}),S.o(Te,"LineLayer")&&S.d(N,{LineLayer:function(){return Te.LineLayer}}),S.o(Te,"Marker")&&S.d(N,{Marker:function(){return Te.Marker}}),S.o(Te,"PointLayer")&&S.d(N,{PointLayer:function(){return Te.PointLayer}}),S.o(Te,"PolygonLayer")&&S.d(N,{PolygonLayer:function(){return Te.PolygonLayer}}),S.o(Te,"Popup")&&S.d(N,{Popup:function(){return Te.Popup}}),S.o(Te,"RasterLayer")&&S.d(N,{RasterLayer:function(){return Te.RasterLayer}}),S.o(Te,"Scene")&&S.d(N,{Scene:function(){return Te.Scene}}),S.o(Te,"gl")&&S.d(N,{gl:function(){return Te.gl}});var Oe=S(23067),Lt=S.n(Oe);S.o(Oe,"CityBuildingLayer")&&S.d(N,{CityBuildingLayer:function(){return Oe.CityBuildingLayer}}),S.o(Oe,"HeatmapLayer")&&S.d(N,{HeatmapLayer:function(){return Oe.HeatmapLayer}}),S.o(Oe,"ImageLayer")&&S.d(N,{ImageLayer:function(){return Oe.ImageLayer}}),S.o(Oe,"LineLayer")&&S.d(N,{LineLayer:function(){return Oe.LineLayer}}),S.o(Oe,"Marker")&&S.d(N,{Marker:function(){return Oe.Marker}}),S.o(Oe,"PointLayer")&&S.d(N,{PointLayer:function(){return Oe.PointLayer}}),S.o(Oe,"PolygonLayer")&&S.d(N,{PolygonLayer:function(){return Oe.PolygonLayer}}),S.o(Oe,"Popup")&&S.d(N,{Popup:function(){return Oe.Popup}}),S.o(Oe,"RasterLayer")&&S.d(N,{RasterLayer:function(){return Oe.RasterLayer}}),S.o(Oe,"Scene")&&S.d(N,{Scene:function(){return Oe.Scene}}),S.o(Oe,"gl")&&S.d(N,{gl:function(){return Oe.gl}});var nr=S(7648)},12250:function(zr,N,S){"use strict";S.d(N,{e7:function(){return Ci},Hp:function(){return vi},ZP:function(){return xi},yT:function(){return ia}});var ce=S(28660),E=S(26729),d=S.n(E),me=S(86700),te=S(84879),ue=S(72302),oe=S(6610),Ne=S(5991),K=S(96156),Qe=S(6901),mt=S(49296),Zt=S.n(mt);function Cr(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(Q);J&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(Q,ne).enumerable})),O.push.apply(O,F)}return O}function Qt(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?Cr(Object(O),!0).forEach(function(F){(0,K.Z)(Q,F,O[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):Cr(Object(O)).forEach(function(F){Object.defineProperty(Q,F,Object.getOwnPropertyDescriptor(O,F))})}return Q}function Xt(Q,J){var O=typeof Symbol!="undefined"&&Q[Symbol.iterator]||Q["@@iterator"];if(!O){if(Array.isArray(Q)||(O=rr(Q))||J&&Q&&typeof Q.length=="number"){O&&(Q=O);var F=0,ne=function(){};return{s:ne,n:function(){return F>=Q.length?{done:!0}:{done:!1,value:Q[F++]}},e:function(ur){throw ur},f:ne}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var xe=!0,pt=!1,Pt;return{s:function(){O=O.call(Q)},n:function(){var ur=O.next();return xe=ur.done,ur},e:function(ur){pt=!0,Pt=ur},f:function(){try{!xe&&O.return!=null&&O.return()}finally{if(pt)throw Pt}}}}function rr(Q,J){if(!!Q){if(typeof Q=="string")return Ut(Q,J);var O=Object.prototype.toString.call(Q).slice(8,-1);if(O==="Object"&&Q.constructor&&(O=Q.constructor.name),O==="Map"||O==="Set")return Array.from(Q);if(O==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(O))return Ut(Q,J)}}function Ut(Q,J){(J==null||J>Q.length)&&(J=Q.length);for(var O=0,F=new Array(J);O<J;O++)F[O]=Q[O];return F}var St=30;function Et(Q){var J=Q.characterSet,O=Q.getFontWidth,F=Q.fontHeight,ne=Q.buffer,xe=Q.maxCanvasWidth,pt=Q.mapping,Pt=pt===void 0?{}:pt,xt=Q.xOffset,ur=xt===void 0?0:xt,Vr=Q.yOffset,Jn=Vr===void 0?0:Vr,Xn=0,li=ur;Array.from(J).forEach(function(Ri,aa){if(!Pt[Ri]){var pa=O(Ri,aa);li+St>xe&&(li=0,Xn++),Pt[Ri]={x:li,y:Jn+Xn*St,width:St,height:St,advance:pa},li+=St}});var mi=F+ne*2;return{mapping:Pt,xOffset:li,yOffset:Jn+Xn*mi,canvasHeight:hr(Jn+(Xn+1)*mi)}}function yr(Q,J,O){var F=0,ne=0,xe=0,pt=[],Pt={},xt=Xt(Q),ur;try{for(xt.s();!(ur=xt.n()).done;){var Vr=ur.value;if(!Pt[Vr.id]){var Jn=Vr.size;F+Jn+J>O&&(q(Pt,pt,ne),F=0,ne=xe+ne+J,xe=0,pt=[]),pt.push({icon:Vr,xOffset:F}),F=F+Jn+J,xe=Math.max(xe,Jn)}}}catch(li){xt.e(li)}finally{xt.f()}pt.length>0&&q(Pt,pt,ne);var Xn=hr(xe+ne+J);return{mapping:Pt,canvasHeight:Xn}}function q(Q,J,O){var F=Xt(J),ne;try{for(F.s();!(ne=F.n()).done;){var xe=ne.value,pt=xe.icon,Pt=xe.xOffset;Q[pt.id]=Qt(Qt({},pt),{},{x:Pt,y:O,image:pt.image,width:pt.width,height:pt.height})}}catch(xt){F.e(xt)}finally{F.f()}}function hr(Q){return Math.pow(2,Math.ceil(Math.log2(Q)))}var wt,$e;function Ft(Q,J){var O=typeof Symbol!="undefined"&&Q[Symbol.iterator]||Q["@@iterator"];if(!O){if(Array.isArray(Q)||(O=Xe(Q))||J&&Q&&typeof Q.length=="number"){O&&(Q=O);var F=0,ne=function(){};return{s:ne,n:function(){return F>=Q.length?{done:!0}:{done:!1,value:Q[F++]}},e:function(ur){throw ur},f:ne}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var xe=!0,pt=!1,Pt;return{s:function(){O=O.call(Q)},n:function(){var ur=O.next();return xe=ur.done,ur},e:function(ur){pt=!0,Pt=ur},f:function(){try{!xe&&O.return!=null&&O.return()}finally{if(pt)throw Pt}}}}function Xe(Q,J){if(!!Q){if(typeof Q=="string")return jt(Q,J);var O=Object.prototype.toString.call(Q).slice(8,-1);if(O==="Object"&&Q.constructor&&(O=Q.constructor.name),O==="Map"||O==="Set")return Array.from(Q);if(O==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(O))return jt(Q,J)}}function jt(Q,J){(J==null||J>Q.length)&&(J=Q.length);for(var O=0,F=new Array(J);O<J;O++)F[O]=Q[O];return F}function br(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(Q);J&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(Q,ne).enumerable})),O.push.apply(O,F)}return O}function sr(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?br(Object(O),!0).forEach(function(F){(0,K.Z)(Q,F,O[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):br(Object(O)).forEach(function(F){Object.defineProperty(Q,F,Object.getOwnPropertyDescriptor(O,F))})}return Q}var j=ar(),ie="sans-serif",Re="normal",ye=24,_t=3,dt=.25,zt=8,Bt=1024,Ur=1,vn=1,En=3,ea=null;function ar(){for(var Q=[],J=32;J<128;J++)Q.push(String.fromCharCode(J));return Q}function ge(Q,J,O,F){Q.font="".concat(F," ").concat(O,"px ").concat(J),Q.fillStyle="black",Q.textBaseline="middle"}function Te(Q,J){for(var O=0;O<Q.length;O++)J.data[4*O+3]=Q[O]}var Ze=(wt=(0,me.b2)(),wt($e=function(){function Q(){(0,oe.Z)(this,Q),(0,K.Z)(this,"fontAtlas",void 0),(0,K.Z)(this,"iconFontMap",void 0),(0,K.Z)(this,"iconFontGlyphs",{}),(0,K.Z)(this,"fontOptions",void 0),(0,K.Z)(this,"key",void 0),(0,K.Z)(this,"cache",new Qe.z6(En))}return(0,Ne.Z)(Q,[{key:"scale",get:function(){return vn}},{key:"canvas",get:function(){var O=this.cache.get(this.key);return O&&O.data}},{key:"mapping",get:function(){var O=this.cache.get(this.key);return O&&O.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:ie,fontWeight:Re,characterSet:j,fontSize:ye,buffer:_t,sdf:!0,cutoff:dt,radius:zt,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(O){var F=this;O.forEach(function(ne){F.iconFontGlyphs[ne.name]=ne.unicode})}},{key:"addIconFont",value:function(O,F){this.iconFontMap.set(O,F)}},{key:"getIconFontKey",value:function(O){return this.iconFontMap.get(O)||O}},{key:"getGlyph",value:function(O){return this.iconFontGlyphs[O]?String.fromCharCode(parseInt(this.iconFontGlyphs[O],16)):""}},{key:"setFontOptions",value:function(O){this.fontOptions=sr(sr({},this.fontOptions),O),this.key=this.getKey();var F=this.getNewChars(this.key,this.fontOptions.characterSet),ne=this.cache.get(this.key);if(!(ne&&F.length===0)){var xe=this.generateFontAtlas(this.key,F,ne);this.fontAtlas=xe,this.cache.set(this.key,xe)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(O,F,ne){var xe=this.fontOptions,pt=xe.fontFamily,Pt=xe.fontWeight,xt=xe.fontSize,ur=xe.buffer,Vr=xe.sdf,Jn=xe.radius,Xn=xe.cutoff,li=xe.iconfont,mi=ne&&ne.data;mi||(mi=document.createElement("canvas"),mi.width=Bt);var Ri=mi.getContext("2d");ge(Ri,pt,xt,Pt);var aa=Et(sr({getFontWidth:function(Lu){return Ri.measureText(Lu).width},fontHeight:xt*vn,buffer:ur,characterSet:F,maxCanvasWidth:Bt},ne&&{mapping:ne.mapping,xOffset:ne.xOffset,yOffset:ne.yOffset})),pa=aa.mapping,ba=aa.canvasHeight,go=aa.xOffset,Ca=aa.yOffset,Bo=Ri.getImageData(0,0,mi.width,mi.height);if(mi.height=ba,Ri.putImageData(Bo,0,0),ge(Ri,pt,xt,Pt),Vr){var ka=new(Zt())(xt,ur,Jn,Xn,pt,Pt),Zi=Ri.getImageData(0,0,ka.size,ka.size),da=Ft(F),$a;try{for(da.s();!($a=da.n()).done;){var yo=$a.value;if(li){var Pi=String.fromCharCode(parseInt(yo.replace("&#x","").replace(";",""),16)),oo=ka.draw(Pi);Te(oo,Zi)}else Te(ka.draw(yo),Zi);Ri.putImageData(Zi,pa[yo].x,pa[yo].y)}}catch(Bs){da.e(Bs)}finally{da.f()}}else{var Ga=Ft(F),Hs;try{for(Ga.s();!(Hs=Ga.n()).done;){var Nl=Hs.value;Ri.fillText(Nl,pa[Nl].x,pa[Nl].y+xt*Ur)}}catch(Bs){Ga.e(Bs)}finally{Ga.f()}}return{xOffset:go,yOffset:Ca,mapping:pa,data:mi,width:mi.width,height:mi.height}}},{key:"getKey",value:function(){return"key";var O,F,ne,xe,pt,Pt,xt,ur}},{key:"getNewChars",value:function(O,F){var ne=this.cache.get(O);if(!ne)return F;var xe=[],pt=ne.mapping,Pt=new Set(Object.keys(pt)),xt=new Set(F);return xt.forEach(function(ur){Pt.has(ur)||xe.push(ur)}),xe}}]),Q}())||$e),Oe=S(63349),Lt=S(10379),nr=S(46070),dr=S(77608),Or,lr;function un(Q){var J=w();return function(){var F=(0,dr.Z)(Q),ne;if(J){var xe=(0,dr.Z)(this).constructor;ne=Reflect.construct(F,arguments,xe)}else ne=F.apply(this,arguments);return(0,nr.Z)(this,ne)}}function w(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var H=3,Ue=1024,et=64,st=(Or=(0,me.b2)(),Or(lr=function(Q){(0,Lt.Z)(O,Q);var J=un(O);function O(){var F;(0,oe.Z)(this,O);for(var ne=arguments.length,xe=new Array(ne),pt=0;pt<ne;pt++)xe[pt]=arguments[pt];return F=J.call.apply(J,[this].concat(xe)),(0,K.Z)((0,Oe.Z)(F),"canvasHeight",128),(0,K.Z)((0,Oe.Z)(F),"texture",void 0),(0,K.Z)((0,Oe.Z)(F),"canvas",void 0),(0,K.Z)((0,Oe.Z)(F),"iconData",void 0),(0,K.Z)((0,Oe.Z)(F),"iconMap",void 0),(0,K.Z)((0,Oe.Z)(F),"ctx",void 0),(0,K.Z)((0,Oe.Z)(F),"loadingImageCount",0),F}return(0,Ne.Z)(O,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(ne,xe){var pt=this,Pt=new Image;if(this.loadingImageCount++,this.hasImage(ne))throw new Error("Image Id already exists");this.iconData.push({id:ne,size:et}),this.updateIconMap(),this.loadImage(xe).then(function(xt){Pt=xt;var ur=pt.iconData.find(function(Vr){return Vr.id===ne});ur&&(ur.image=Pt,ur.width=Pt.width,ur.height=Pt.height),pt.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(ne){return this.iconMap.hasOwnProperty(ne)}},{key:"removeImage",value:function(ne){this.hasImage(ne)&&(this.iconData=this.iconData.filter(function(xe){return xe.id!==ne}),delete this.iconMap[ne],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var ne=this;this.canvas.width=Ue,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(xe){var pt=ne.iconMap[xe],Pt=pt.x,xt=pt.y,ur=pt.image,Vr=pt.width,Jn=Vr===void 0?64:Vr,Xn=pt.height,li=Xn===void 0?64:Xn,mi=Math.max(Jn,li),Ri=mi/et,aa=li/Ri,pa=Jn/Ri;ur&&ne.ctx.drawImage(ur,Pt+(et-pa)/2,xt+(et-aa)/2,pa,aa)})}},{key:"updateIconMap",value:function(){var ne=yr(this.iconData,H,Ue),xe=ne.mapping,pt=ne.canvasHeight;this.iconMap=xe,this.canvasHeight=pt}},{key:"loadImage",value:function(ne){return new Promise(function(xe,pt){if(ne instanceof HTMLImageElement){xe(ne);return}var Pt=new Image;Pt.crossOrigin="anonymous",Pt.onload=function(){xe(Pt)},Pt.onerror=function(){pt(new Error("Could not load image at "+ne))},Pt.src=ne instanceof File?URL.createObjectURL(ne):ne})}}]),O}(E.EventEmitter))||lr),Ct=S(28481),$=S(85975),Gt,Tr,Ir=(Gt=(0,me.b2)(),Gt(Tr=function(){function Q(){(0,oe.Z)(this,Q),(0,K.Z)(this,"viewport",void 0),(0,K.Z)(this,"overridedViewProjectionMatrix",void 0),(0,K.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,K.Z)(this,"jitteredProjectionMatrix",void 0),(0,K.Z)(this,"viewMatrixInverse",void 0),(0,K.Z)(this,"cameraPosition",void 0)}return(0,Ne.Z)(Q,[{key:"init",value:function(){}},{key:"update",value:function(O){this.viewport=O,this.viewMatrixInverse=$.create(),$.invert(this.viewMatrixInverse,O.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var O=this.viewport.getCenter(),F=(0,Ct.Z)(O,2),ne=F[0],xe=F[1];return[ne,xe]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(O,F){return this.viewport.projectFlat(O,F)}},{key:"setViewProjectionMatrix",value:function(O){this.overridedViewProjectionMatrix=O}},{key:"jitterProjectionMatrix",value:function(O,F){var ne=$.fromTranslation($.create(),[O,F,0]);this.jitteredProjectionMatrix=$.multiply($.create(),ne,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=$.multiply($.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),Q}())||Tr),Ye,ut;function At(Q,J){var O=typeof Symbol!="undefined"&&Q[Symbol.iterator]||Q["@@iterator"];if(!O){if(Array.isArray(Q)||(O=Rt(Q))||J&&Q&&typeof Q.length=="number"){O&&(Q=O);var F=0,ne=function(){};return{s:ne,n:function(){return F>=Q.length?{done:!0}:{done:!1,value:Q[F++]}},e:function(ur){throw ur},f:ne}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var xe=!0,pt=!1,Pt;return{s:function(){O=O.call(Q)},n:function(){var ur=O.next();return xe=ur.done,ur},e:function(ur){pt=!0,Pt=ur},f:function(){try{!xe&&O.return!=null&&O.return()}finally{if(pt)throw Pt}}}}function Rt(Q,J){if(!!Q){if(typeof Q=="string")return xr(Q,J);var O=Object.prototype.toString.call(Q).slice(8,-1);if(O==="Object"&&Q.constructor&&(O=Q.constructor.name),O==="Map"||O==="Set")return Array.from(Q);if(O==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(O))return xr(Q,J)}}function xr(Q,J){(J==null||J>Q.length)&&(J=Q.length);for(var O=0,F=new Array(J);O<J;O++)F[O]=Q[O];return F}var Ar=(Ye=(0,me.b2)(),Ye(ut=function(){function Q(){(0,oe.Z)(this,Q),(0,K.Z)(this,"container",void 0),(0,K.Z)(this,"controlCorners",void 0),(0,K.Z)(this,"controlContainer",void 0),(0,K.Z)(this,"scene",void 0),(0,K.Z)(this,"mapsService",void 0),(0,K.Z)(this,"controls",[]),(0,K.Z)(this,"unAddControls",[])}return(0,Ne.Z)(Q,[{key:"init",value:function(O,F){this.container=O.container,this.scene=F,this.mapsService=F.get(ue.v.IMapService),this.initControlPos()}},{key:"addControl",value:function(O,F){var ne=F.get(ue.v.IMapService);ne.map?(O.addTo(this.scene),this.controls.push(O)):this.unAddControls.push(O)}},{key:"getControlByName",value:function(O){return this.controls.find(function(F){return F.controlOption.name===O})}},{key:"removeControl",value:function(O){var F=this.controls.indexOf(O);return F>-1&&this.controls.splice(F,1),O.remove(),this}},{key:"addControls",value:function(){var O=this;this.unAddControls.forEach(function(F){F.addTo(O.scene),O.controls.push(F)}),this.unAddControls=[]}},{key:"destroy",value:function(){var O=At(this.controls),F;try{for(O.s();!(F=O.n()).done;){var ne=F.value;ne.remove()}}catch(xe){O.e(xe)}finally{O.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var O=this.controlCorners={},F="l7-",ne=this.controlContainer=Qe.SO.create("div",F+"control-container",this.container);function xe(){var pt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],Pt=pt.map(function(xt){return F+xt}).join(" ");O[pt.join("")]=Qe.SO.create("div",Pt,ne)}xe(["top","left"]),xe(["top","right"]),xe(["bottom","left"]),xe(["bottom","right"]),xe(["top","center"]),xe(["right","center"]),xe(["left","center"]),xe(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var O in this.controlCorners)this.controlCorners[O]&&Qe.SO.remove(this.controlCorners[O]);this.controlContainer&&Qe.SO.remove(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),Q}())||ut),Ke,Xr,Yr=(Ke=(0,me.b2)(),Ke(Xr=function(){function Q(){(0,oe.Z)(this,Q),(0,K.Z)(this,"container",void 0),(0,K.Z)(this,"scene",void 0),(0,K.Z)(this,"mapsService",void 0),(0,K.Z)(this,"markers",[]),(0,K.Z)(this,"markerLayers",[]),(0,K.Z)(this,"unAddMarkers",[]),(0,K.Z)(this,"unAddMarkerLayers",[])}return(0,Ne.Z)(Q,[{key:"addMarkerLayer",value:function(O){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(O),O.addTo(this.scene)):this.unAddMarkerLayers.push(O)}},{key:"removeMarkerLayer",value:function(O){O.destroy(),this.markerLayers.indexOf(O);var F=this.markerLayers.indexOf(O);F>-1&&this.markerLayers.splice(F,1)}},{key:"addMarker",value:function(O){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(O),O.addTo(this.scene)):this.unAddMarkers.push(O)}},{key:"addMarkers",value:function(){var O=this;this.unAddMarkers.forEach(function(F){F.addTo(O.scene),O.markers.push(F)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var O=this;this.unAddMarkerLayers.forEach(function(F){O.markerLayers.push(F),F.addTo(O.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(O){O.remove(),this.markers.indexOf(O);var F=this.markers.indexOf(O);F>-1&&this.markers.splice(F,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(O){this.scene=O,this.mapsService=O.get(ue.v.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(O){O.remove()}),this.markers=[],this.markerLayers.forEach(function(O){O.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(O){O.destroy()}}]),Q}())||Xr),wn,cr,Mr=(wn=(0,me.b2)(),wn(cr=function(){function Q(){(0,oe.Z)(this,Q),(0,K.Z)(this,"scene",void 0),(0,K.Z)(this,"popup",void 0),(0,K.Z)(this,"mapsService",void 0),(0,K.Z)(this,"unAddPopup",void 0)}return(0,Ne.Z)(Q,[{key:"removePopup",value:function(O){O.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(O){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(O.addTo(this.scene),this.popup=O):this.unAddPopup=O}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(O){this.scene=O,this.mapsService=O.get(ue.v.IMapService)}}]),Q}())||cr),gt=S(82492),Gn=S.n(gt),Mn={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},kr=Mn,Y,le;function ve(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(Q);J&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(Q,ne).enumerable})),O.push.apply(O,F)}return O}function B(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?ve(Object(O),!0).forEach(function(F){(0,K.Z)(Q,F,O[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):ve(Object(O)).forEach(function(F){Object.defineProperty(Q,F,Object.getOwnPropertyDescriptor(O,F))})}return Q}var ee={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},de={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Ae=(Y=(0,me.b2)(),Y(le=function(){function Q(){(0,oe.Z)(this,Q),(0,K.Z)(this,"sceneConfigCache",{}),(0,K.Z)(this,"layerConfigCache",{})}return(0,Ne.Z)(Q,[{key:"getSceneConfig",value:function(O){return this.sceneConfigCache[O]}},{key:"getSceneWarninfo",value:function(O){return kr[O]}},{key:"setSceneConfig",value:function(O,F){this.sceneConfigCache[O]=B(B({},ee),F)}},{key:"getLayerConfig",value:function(O){return this.layerConfigCache[O]}},{key:"setLayerConfig",value:function(O,F,ne){this.layerConfigCache[F]=B({},Gn()({},this.sceneConfigCache[O],de,ne))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),Q}())||le),ae=S(55770),_e=S(3473),ct=S(98333),Sr=Math.PI/180,Ht=512,Jt=4003e4;function Nr(Q){var J=Q.latitude,O=J===void 0?0:J,F=Q.zoom,ne=F===void 0?0:F,xe=Q.scale,pt=Q.highPrecision,Pt=pt===void 0?!1:pt,xt=Q.flipY,ur=xt===void 0?!1:xt;xe=xe!==void 0?xe:Math.pow(2,ne);var Vr={},Jn=Ht*xe,Xn=Math.cos(O*Sr),li=Jn/360,mi=li/Xn,Ri=Jn/Jt/Xn;if(Vr.pixelsPerMeter=[Ri,-Ri,Ri],Vr.metersPerPixel=[1/Ri,-1/Ri,1/Ri],Vr.pixelsPerDegree=[li,-mi,Ri],Vr.degreesPerPixel=[1/li,-1/mi,1/Ri],Pt){var aa=Sr*Math.tan(O*Sr)/Xn,pa=li*aa/2,ba=Jn/Jt*aa,go=ba/mi*Ri;Vr.pixelsPerDegree2=[0,-pa,ba],Vr.pixelsPerMeter2=[go,0,go],ur&&(Vr.pixelsPerDegree2[1]=-Vr.pixelsPerDegree2[1],Vr.pixelsPerMeter2[1]=-Vr.pixelsPerMeter2[1])}return ur&&(Vr.pixelsPerMeter[1]=-Vr.pixelsPerMeter[1],Vr.metersPerPixel[1]=-Vr.metersPerPixel[1],Vr.pixelsPerDegree[1]=-Vr.pixelsPerDegree[1],Vr.degreesPerPixel[1]=-Vr.degreesPerPixel[1]),Vr}var zn=S(47282),Nn,Kt,In,hn,mn,Bi=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],An=(Nn=(0,me.b2)(),Kt=(0,me.f3)(ue.v.ICameraService),Nn(In=(hn=function(){function Q(){(0,oe.Z)(this,Q),(0,K.Z)(this,"needRefresh",!0),(0,ae.Z)(this,"cameraService",mn,this),(0,K.Z)(this,"coordinateSystem",void 0),(0,K.Z)(this,"viewportCenter",void 0),(0,K.Z)(this,"viewportCenterProjection",void 0),(0,K.Z)(this,"pixelsPerDegree",void 0),(0,K.Z)(this,"pixelsPerDegree2",void 0),(0,K.Z)(this,"pixelsPerMeter",void 0)}return(0,Ne.Z)(Q,[{key:"refresh",value:function(){var O=this.cameraService.getZoom(),F=this.cameraService.getZoomScale(),ne=this.cameraService.getCenter(),xe=Nr({latitude:ne[1],zoom:O}),pt=xe.pixelsPerMeter,Pt=xe.pixelsPerDegree;this.viewportCenter=ne,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=pt,this.pixelsPerDegree=Pt,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===zn.l.LNGLAT||this.coordinateSystem===zn.l.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===zn.l.LNGLAT_OFFSET?this.calculateLnglatOffset(ne,O):this.coordinateSystem===zn.l.P20_OFFSET&&this.calculateLnglatOffset(ne,O,F,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(O){this.coordinateSystem=O}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(O,F,ne,xe){var pt=Nr({latitude:O[1],zoom:F,scale:ne,flipY:xe,highPrecision:!0}),Pt=pt.pixelsPerMeter,xt=pt.pixelsPerDegree,ur=pt.pixelsPerDegree2,Vr=this.cameraService.getViewMatrix(),Jn=this.cameraService.getProjectionMatrix(),Xn=$.multiply([],Jn,Vr),li=this.cameraService.projectFlat([Math.fround(O[0]),Math.fround(O[1])],Math.pow(2,F));this.viewportCenterProjection=ct.fF([],[li[0],li[1],0,1],Xn),Vr=this.cameraService.getViewMatrixUncentered()||Vr,Xn=$.multiply([],Jn,Vr),Xn=$.multiply([],Xn,Bi),this.cameraService.setViewProjectionMatrix(Xn),this.pixelsPerMeter=Pt,this.pixelsPerDegree=xt,this.pixelsPerDegree2=ur}}]),Q}(),mn=(0,_e.Z)(hn.prototype,"cameraService",[Kt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hn))||In),Di=S(50840),ra=S.n(Di),hi=S(89648),na,Hi,Oi,ga,Ra;function Wi(Q){var J=Ni();return function(){var F=(0,dr.Z)(Q),ne;if(J){var xe=(0,dr.Z)(this).constructor;ne=Reflect.construct(F,arguments,xe)}else ne=F.apply(this,arguments);return(0,nr.Z)(this,ne)}}function Ni(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var Xi={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},ro=(na=(0,me.b2)(),Hi=(0,me.f3)(ue.v.IMapService),na(Oi=(ga=function(Q){(0,Lt.Z)(O,Q);var J=Wi(O);function O(){var F;(0,oe.Z)(this,O);for(var ne=arguments.length,xe=new Array(ne),pt=0;pt<ne;pt++)xe[pt]=arguments[pt];return F=J.call.apply(J,[this].concat(xe)),(0,ae.Z)((0,Oe.Z)(F),"mapService",Ra,(0,Oe.Z)(F)),(0,K.Z)((0,Oe.Z)(F),"hammertime",void 0),(0,K.Z)((0,Oe.Z)(F),"lastClickTime",0),(0,K.Z)((0,Oe.Z)(F),"lastClickXY",[-1,-1]),(0,K.Z)((0,Oe.Z)(F),"clickTimer",void 0),(0,K.Z)((0,Oe.Z)(F),"$containter",void 0),(0,K.Z)((0,Oe.Z)(F),"onDrag",function(Pt){var xt=F.interactionEvent(Pt);xt.type=Xi[xt.type],F.emit(hi.s.Drag,xt)}),(0,K.Z)((0,Oe.Z)(F),"onHammer",function(Pt){Pt.srcEvent.stopPropagation();var xt=F.interactionEvent(Pt);F.emit(hi.s.Hover,xt)}),(0,K.Z)((0,Oe.Z)(F),"onTouch",function(Pt){var xt=Pt.touches[0];F.onHover({x:xt.pageX,y:xt.pageY,type:"touch"})}),(0,K.Z)((0,Oe.Z)(F),"onHover",function(Pt){var xt=Pt.clientX,ur=Pt.clientY,Vr=xt,Jn=ur,Xn=Pt.type,li=F.mapService.getMapContainer();if(li){var mi=li.getBoundingClientRect(),Ri=mi.top,aa=mi.left;Vr=Vr-aa-li.clientLeft,Jn=Jn-Ri-li.clientTop}var pa=F.mapService.containerToLngLat([Vr,Jn]);if(Xn==="click"){if("ontouchstart"in document.documentElement)return;F.isDoubleTap(Vr,Jn,pa);return}if(Xn==="touch"){F.isDoubleTap(Vr,Jn,pa);return}Xn!=="click"&&Xn!=="dblclick"&&F.emit(hi.s.Hover,{x:Vr,y:Jn,lngLat:pa,type:Xn,target:Pt})}),F}return(0,Ne.Z)(O,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(hi.s.Hover)}},{key:"triggerHover",value:function(ne){var xe=ne.x,pt=ne.y;this.emit(hi.s.Hover,{x:xe,y:pt})}},{key:"triggerSelect",value:function(ne){this.emit(hi.s.Select,{featureId:ne})}},{key:"triggerActive",value:function(ne){this.emit(hi.s.Active,{featureId:ne})}},{key:"addEventListenerOnMap",value:function(){var ne=this.mapService.getMapContainer();if(ne){var xe=new(ra()).Manager(ne);xe.add(new(ra()).Tap({event:"dblclick",taps:2})),xe.add(new(ra()).Tap({event:"click"})),xe.add(new(ra()).Pan({threshold:0,pointers:0})),xe.add(new(ra()).Press({})),xe.on("dblclick click",this.onHammer),xe.on("panstart panmove panend pancancel",this.onDrag),ne.addEventListener("mousemove",this.onHover),ne.addEventListener("mousedown",this.onHover,!0),ne.addEventListener("mouseup",this.onHover),ne.addEventListener("contextmenu",this.onHover),this.hammertime=xe}}},{key:"removeEventListenerOnMap",value:function(){var ne=this.mapService.getMapContainer();ne&&(ne.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),ne.removeEventListener("mousedown",this.onHover),ne.removeEventListener("mouseup",this.onHover),ne.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(ne){var xe=ne.type,pt=ne.pointerType,Pt,xt;pt==="touch"?(xt=Math.floor(ne.pointers[0].clientY),Pt=Math.floor(ne.pointers[0].clientX)):(xt=Math.floor(ne.srcEvent.y),Pt=Math.floor(ne.srcEvent.x));var ur=this.mapService.getMapContainer();if(ur){var Vr=ur.getBoundingClientRect(),Jn=Vr.top,Xn=Vr.left;Pt-=Xn,xt-=Jn}var li=this.mapService.containerToLngLat([Pt,xt]);return{x:Pt,y:xt,lngLat:li,type:xe,target:ne.srcEvent}}},{key:"isDoubleTap",value:function(ne,xe,pt){var Pt=this,xt=new Date().getTime(),ur="click";xt-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-ne)<10&&Math.abs(this.lastClickXY[1]-xe)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),ur="dblclick",this.emit(hi.s.Hover,{x:ne,y:xe,lngLat:pt,type:ur})):(this.lastClickTime=xt,this.lastClickXY=[ne,xe],this.clickTimer=setTimeout(function(){ur="click",Pt.emit(hi.s.Hover,{x:ne,y:xe,lngLat:pt,type:ur})},400))}}]),O}(d()),Ra=(0,_e.Z)(ga.prototype,"mapService",[Hi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ga))||Oi),Qo=S(92137),za=S(87757),$i=S.n(za),cu=window.document.documentElement.style,Pu=0;function Yi(Q){var J=Q;if(typeof Q=="string"&&(J=document.getElementById(Q)),J){var O=document.createElement("div");return O.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,O.id="l7-scene-".concat(Pu++),O.classList.add("l7-scene"),J.appendChild(O),O}return null}function xo(Q){var J,O,F=!0;return Q==null||(J=Q.target)===null||J===void 0||(O=J.path)===null||O===void 0||O.map(function(ne){if(ne!=null&&ne.classList){var xe;ne==null||(xe=ne.classList)===null||xe===void 0||xe.forEach(function(pt){(pt==="l7-marker"||pt==="l7-popup")&&(F=!1)})}}),F}var Ki=S(7648),Xa,qo,xa,Do,ko,Rs,vo,Xo,Da,co,ss;function Fo(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(Q);J&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(Q,ne).enumerable})),O.push.apply(O,F)}return O}function Se(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?Fo(Object(O),!0).forEach(function(F){(0,K.Z)(Q,F,O[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):Fo(Object(O)).forEach(function(F){Object.defineProperty(Q,F,Object.getOwnPropertyDescriptor(O,F))})}return Q}var ke=(Xa=(0,me.b2)(),qo=(0,me.f3)(ue.v.IRendererService),xa=(0,me.f3)(ue.v.IGlobalConfigService),Do=(0,me.f3)(ue.v.IInteractionService),ko=(0,me.f3)(ue.v.ILayerService),Xa(Rs=(vo=function(){function Q(){var J=this;(0,oe.Z)(this,Q),(0,ae.Z)(this,"rendererService",Xo,this),(0,ae.Z)(this,"configService",Da,this),(0,ae.Z)(this,"interactionService",co,this),(0,ae.Z)(this,"layerService",ss,this),(0,K.Z)(this,"pickingFBO",void 0),(0,K.Z)(this,"width",0),(0,K.Z)(this,"height",0),(0,K.Z)(this,"alreadyInPicking",!1),(0,K.Z)(this,"pickBufferScale",1),(0,K.Z)(this,"pickFromPickingFBO",function(O,F){var ne,xe=F.x,pt=F.y,Pt=F.lngLat,xt=F.type,ur=F.target,Vr=!1,Jn=J.rendererService,Xn=Jn.getViewportSize,li=Jn.readPixels,mi=Jn.getContainer,Ri=mi().getBoundingClientRect(),aa=Ri.width,pa=Ri.height;aa*=Qe.SO.DPR,pa*=Qe.SO.DPR;var ba=O.getLayerConfig(),go=ba.enableHighlight,Ca=ba.enableSelect,Bo=xe*Qe.SO.DPR,ka=pt*Qe.SO.DPR;if(Bo>aa-1*Qe.SO.DPR||Bo<0||ka>pa-1*Qe.SO.DPR||ka<0)return!1;var Zi;if(Zi=li({x:Math.floor(Bo/J.pickBufferScale),y:Math.floor((pa-(pt+1)*Qe.SO.DPR)/J.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:J.pickingFBO}),Zi[0]!==0||Zi[1]!==0||Zi[2]!==0){var da=(0,Qe.W0)(Zi),$a=O.getSource().getFeatureById(da);da!==O.getCurrentPickId()&&xt==="mousemove"&&(xt="mouseenter");var yo={x:xe,y:pt,type:xt,lngLat:Pt,featureId:da,feature:$a,target:ur};$a&&(Vr=!0,O.setCurrentPickId(da),J.triggerHoverOnLayer(O,yo))}else{var Pi={x:xe,y:pt,lngLat:Pt,type:O.getCurrentPickId()!==null&&xt==="mousemove"?"mouseout":"un"+xt,featureId:null,target:ur,feature:null};J.triggerHoverOnLayer(O,Se(Se({},Pi),{},{type:"unpick"})),J.triggerHoverOnLayer(O,Pi),O.setCurrentPickId(null)}if(go&&J.highlightPickedFeature(O,Zi),Ca&&xt==="click"&&((ne=Zi)===null||ne===void 0?void 0:ne.toString())!==[0,0,0,0].toString()){var oo=(0,Qe.W0)(Zi);O.getCurrentSelectedId()===null||oo!==O.getCurrentSelectedId()?(J.selectFeature(O,Zi),O.setCurrentSelectedId(oo)):(J.selectFeature(O,new Uint8Array([0,0,0,0])),O.setCurrentSelectedId(null))}return Vr})}return(0,Ne.Z)(Q,[{key:"init",value:function(O){var F=this.rendererService,ne=F.createTexture2D,xe=F.createFramebuffer,pt=F.getViewportSize,Pt=F.getContainer,xt=Pt().getBoundingClientRect(),ur=xt.width,Vr=xt.height;ur*=Qe.SO.DPR,Vr*=Qe.SO.DPR,this.pickBufferScale=this.configService.getSceneConfig(O).pickBufferScale||1,this.pickingFBO=xe({color:ne({width:Math.round(ur/this.pickBufferScale),height:Math.round(Vr/this.pickBufferScale),wrapS:Ki.gl.CLAMP_TO_EDGE,wrapT:Ki.gl.CLAMP_TO_EDGE})}),this.interactionService.on(hi.s.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var J=(0,Qo.Z)($i().mark(function F(ne,xe,pt){var Pt=this,xt,ur,Vr,Jn;return $i().wrap(function(li){for(;;)switch(li.prev=li.next){case 0:xt=this.rendererService,ur=xt.useFramebuffer,Vr=xt.clear,Jn=xt.getContainer,this.resizePickingFBO(),ur(this.pickingFBO,function(){Vr({framebuffer:Pt.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),ne.hooks.beforePickingEncode.call(),ne.renderModels(),ne.hooks.afterPickingEncode.call();var mi=Pt.pickBox(ne,xe);pt(mi)});case 3:case"end":return li.stop()}},F,this)}));function O(F,ne,xe){return J.apply(this,arguments)}return O}()},{key:"pickBox",value:function(O,F){var ne=this,xe=F.map(function(Pi){var oo=Pi<0?0:Pi;return Math.floor(oo*Qe.SO.DPR/ne.pickBufferScale)}),pt=(0,Ct.Z)(xe,4),Pt=pt[0],xt=pt[1],ur=pt[2],Vr=pt[3],Jn=this.rendererService,Xn=Jn.getViewportSize,li=Jn.readPixels,mi=Jn.getContainer,Ri=mi().getBoundingClientRect(),aa=Ri.width,pa=Ri.height;if(aa*=Qe.SO.DPR,pa*=Qe.SO.DPR,Pt>(aa-1)*Qe.SO.DPR/this.pickBufferScale||ur<0||xt>(pa-1)*Qe.SO.DPR/this.pickBufferScale||Vr<0)return[];var ba,go=Math.min(aa/this.pickBufferScale,ur)-Pt,Ca=Math.min(pa/this.pickBufferScale,Vr)-xt;ba=li({x:Pt,y:Math.floor(pa/this.pickBufferScale-(Vr+1)),width:go,height:Ca,data:new Uint8Array(go*Ca*4),framebuffer:this.pickingFBO});for(var Bo=[],ka={},Zi=0;Zi<ba.length/4;Zi=Zi+1){var da=ba.slice(Zi*4,Zi*4+4),$a=(0,Qe.W0)(da);if($a!==-1&&!ka[$a]){var yo=O.getSource().getFeatureById($a);Bo.push(yo),ka[$a]=!0}}return Bo}},{key:"pickingAllLayer",value:function(){var J=(0,Qo.Z)($i().mark(function F(ne){return $i().wrap(function(pt){for(;;)switch(pt.prev=pt.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.layerService.isMapDragging())){pt.next=2;break}return pt.abrupt("return");case 2:return this.alreadyInPicking=!0,pt.next=5,this.pickingLayers(ne);case 5:this.layerService.renderLayers("picking"),this.alreadyInPicking=!1;case 7:case"end":return pt.stop()}},F,this)}));function O(F){return J.apply(this,arguments)}return O}()},{key:"resizePickingFBO",value:function(){var O=this.rendererService.getContainer,F=O().getBoundingClientRect(),ne=F.width,xe=F.height;ne*=Qe.SO.DPR,xe*=Qe.SO.DPR,(this.width!==ne||this.height!==xe)&&(this.pickingFBO.resize({width:Math.round(ne/this.pickBufferScale),height:Math.round(xe/this.pickBufferScale)}),this.width=ne,this.height=xe)}},{key:"pickingLayers",value:function(){var J=(0,Qo.Z)($i().mark(function F(ne){var xe=this,pt,Pt,xt,ur,Vr;return $i().wrap(function(Xn){for(;;)switch(Xn.prev=Xn.next){case 0:pt=this.rendererService,Pt=pt.getViewportSize,xt=pt.useFramebuffer,ur=pt.clear,Vr=pt.getContainer,this.resizePickingFBO(),xt(this.pickingFBO,function(){var li=xe.layerService.getLayers();li.filter(function(mi){return mi.needPick(ne.type)}).reverse().some(function(mi){ur({framebuffer:xe.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),mi.hooks.beforePickingEncode.call(),mi.renderModels(),mi.hooks.afterPickingEncode.call();var Ri=xe.pickFromPickingFBO(mi,ne);return Ri&&!mi.getLayerConfig().enablePropagation})});case 3:case"end":return Xn.stop()}},F,this)}));function O(F){return J.apply(this,arguments)}return O}()},{key:"triggerHoverOnLayer",value:function(O,F){xo(F)&&O.emit(F.type,F)}},{key:"highlightPickedFeature",value:function(O,F){var ne=(0,Ct.Z)(F,3),xe=ne[0],pt=ne[1],Pt=ne[2];O.hooks.beforeHighlight.call([xe,pt,Pt])}},{key:"selectFeature",value:function(O,F){var ne=(0,Ct.Z)(F,3),xe=ne[0],pt=ne[1],Pt=ne[2];O.hooks.beforeSelect.call([xe,pt,Pt])}}]),Q}(),Xo=(0,_e.Z)(vo.prototype,"rendererService",[qo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Da=(0,_e.Z)(vo.prototype,"configService",[xa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),co=(0,_e.Z)(vo.prototype,"interactionService",[Do],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ss=(0,_e.Z)(vo.prototype,"layerService",[ko],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vo))||Rs),ft=function(){function Q(){var J=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,oe.Z)(this,Q),(0,K.Z)(this,"autoStart",void 0),(0,K.Z)(this,"startTime",0),(0,K.Z)(this,"oldTime",0),(0,K.Z)(this,"running",!1),(0,K.Z)(this,"elapsedTime",0),this.autoStart=J}return(0,Ne.Z)(Q,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var O=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var F=(typeof performance=="undefined"?Date:performance).now();O=(F-this.oldTime)/1e3,this.oldTime=F,this.elapsedTime+=O}return O}}]),Q}(),L,Qr,ai,wi,fo,Ya,ja,us,fu,Mu=(L=(0,me.b2)(),Qr=(0,me.f3)(ue.v.IRendererService),ai=(0,me.f3)(ue.v.IMapService),wi=(0,me.f3)(ue.v.IGlobalConfigService),L(fo=(Ya=function(){function Q(){(0,oe.Z)(this,Q),(0,K.Z)(this,"clock",new ft),(0,K.Z)(this,"alreadyInRendering",!1),(0,K.Z)(this,"layers",[]),(0,K.Z)(this,"layerRenderID",void 0),(0,K.Z)(this,"sceneInited",!1),(0,K.Z)(this,"animateInstanceCount",0),(0,K.Z)(this,"lastRenderType",void 0),(0,K.Z)(this,"lastPickRenderTime",void 0),(0,ae.Z)(this,"renderService",ja,this),(0,ae.Z)(this,"mapService",us,this),(0,ae.Z)(this,"configService",fu,this)}return(0,Ne.Z)(Q,[{key:"add",value:function(O){this.sceneInited&&O.init(),this.layers.push(O)}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(O){O.inited||O.init()})}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(O){return this.layers.find(function(F){return F.id===O})}},{key:"getLayerByName",value:function(O){return this.layers.find(function(F){return F.name===O})}},{key:"remove",value:function(O,F){if(F){var ne=F.layerChildren.indexOf(O);ne>-1&&F.layerChildren.splice(ne,1)}else{var xe=this.layers.indexOf(O);xe>-1&&this.layers.splice(xe,1)}O.emit("remove",null),O.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"renderLayers",value:function(O){if(!this.renderTest(O)||this.alreadyInRendering)return;this.alreadyInRendering=!0,this.clear(),this.updateRenderOrder(),this.layers.filter(function(ne){return ne.inited}).filter(function(ne){return ne.isVisible()}).forEach(function(ne){F(ne.layerChildren),F([ne])}),this.alreadyInRendering=!1;function F(ne){ne.filter(function(xe){return xe.inited}).filter(function(xe){return xe.isVisible()}).forEach(function(xe){xe.hooks.beforeRenderData.call(),xe.hooks.beforeRender.call(),xe.render(),xe.hooks.afterRender.call()})}}},{key:"updateRenderOrder",value:function(){this.layers.sort(function(O,F){return O.zIndex-F.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(O){O.layerChildren&&(O.layerChildren.forEach(function(F){return F.destroy()}),O.layerChildren=[]),O.destroy()}),this.layers=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"isMapDragging",value:function(){return this.mapService.dragging}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=requestAnimationFrame(this.runRender.bind(this))}},{key:"renderTest",value:function(O){var F=new Date().getTime(),ne=F-this.lastPickRenderTime;if(O==="picking"&&(this.lastPickRenderTime=new Date().getTime()),O)switch(O){case"picking":return this.lastRenderType==="mapRender"||this.lastRenderType==="animate"?(this.lastRenderType="picking",ne>48):(this.lastRenderType="picking",!0);case"animate":return this.lastRenderType==="mapRender"?(this.lastRenderType="animate",!1):(this.lastRenderType="animate",!0);case"mapRender":return this.lastRenderType="mapRender",!0;default:return!0}return!0}},{key:"clear",value:function(){var O=(0,Qe.CI)(this.mapService.bgColor);this.renderService.clear({color:O,depth:1,stencil:0,framebuffer:null})}},{key:"stopRender",value:function(){cancelAnimationFrame(this.layerRenderID)}}]),Q}(),ja=(0,_e.Z)(Ya.prototype,"renderService",[Qr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),us=(0,_e.Z)(Ya.prototype,"mapService",[ai],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fu=(0,_e.Z)(Ya.prototype,"configService",[wi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ya))||fo),Yu=S(81253),es=S(85061),ts=S(14293),ls=S.n(ts),ws=function(){function Q(J){var O=this;(0,oe.Z)(this,Q),(0,K.Z)(this,"name",void 0),(0,K.Z)(this,"type",void 0),(0,K.Z)(this,"scale",void 0),(0,K.Z)(this,"descriptor",void 0),(0,K.Z)(this,"featureBufferLayout",[]),(0,K.Z)(this,"needRescale",!1),(0,K.Z)(this,"needRemapping",!1),(0,K.Z)(this,"needRegenerateVertices",!1),(0,K.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,K.Z)(this,"vertexAttribute",void 0),(0,K.Z)(this,"defaultCallback",function(F){if(F.length===0){var ne;return((ne=O.scale)===null||ne===void 0?void 0:ne.defaultValues)||[]}return F.map(function(xe,pt){var Pt,xt=(Pt=O.scale)===null||Pt===void 0?void 0:Pt.scalers[pt].func,ur=xt(xe);return ur})}),this.setProps(J)}return(0,Ne.Z)(Q,[{key:"setProps",value:function(O){Object.assign(this,O)}},{key:"mapping",value:function(O){var F;if((F=this.scale)!==null&&F!==void 0&&F.callback){var ne,xe=(ne=this.scale)===null||ne===void 0?void 0:ne.callback.apply(ne,(0,es.Z)(O));if(!ls()(xe))return[xe]}return this.defaultCallback(O)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),Q}(),cs,Us,$s,As,Ea,Co;function dl(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(Q);J&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(Q,ne).enumerable})),O.push.apply(O,F)}return O}function vl(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?dl(Object(O),!0).forEach(function(F){(0,K.Z)(Q,F,O[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):dl(Object(O)).forEach(function(F){Object.defineProperty(Q,F,Object.getOwnPropertyDescriptor(O,F))})}return Q}function Ku(Q){return new Promise(function(J){return setTimeout(J,Q)})}var Xl=(cs={},(0,K.Z)(cs,Ki.gl.FLOAT,4),(0,K.Z)(cs,Ki.gl.UNSIGNED_BYTE,1),(0,K.Z)(cs,Ki.gl.UNSIGNED_SHORT,2),cs),ml=(Us=(0,me.b2)(),$s=(0,me.f3)(ue.v.IRendererService),Us(As=(Ea=function(){function Q(){(0,oe.Z)(this,Q),(0,K.Z)(this,"attributesAndIndices",void 0),(0,ae.Z)(this,"rendererService",Co,this),(0,K.Z)(this,"attributes",[]),(0,K.Z)(this,"triangulation",void 0),(0,K.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Ne.Z)(Q,[{key:"registerStyleAttribute",value:function(O){var F=this.getLayerStyleAttribute(O.name||"");return F?F.setProps(O):(F=new ws(O),this.attributes.push(F)),F}},{key:"updateStyleAttribute",value:function(O,F,ne){var xe=this.getLayerStyleAttribute(O);xe||(xe=this.registerStyleAttribute(vl(vl({},F),{},{name:O})));var pt=F.scale;pt&&xe&&(xe.scale=pt,xe.needRescale=!0,xe.needRemapping=!0,xe.needRegenerateVertices=!0,ne&&ne.featureRange&&(xe.featureRange=ne.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(O){return this.attributes.find(function(F){return F.name===O})}},{key:"getLayerAttributeScale",value:function(O){var F,ne=this.getLayerStyleAttribute(O),xe=ne==null||(F=ne.scale)===null||F===void 0?void 0:F.scalers;return xe&&xe[0]?xe[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(O,F){var ne=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,xe=arguments.length>3?arguments[3]:void 0,pt=this.attributes.find(function(Ca){return Ca.name===O});if(pt&&pt.descriptor){var Pt=pt.descriptor,xt=Pt.update,ur=Pt.buffer,Vr=Pt.size,Jn=Vr===void 0?0:Vr,Xn=Xl[ur.type||Ki.gl.FLOAT];if(xt){var li=this.featureLayout,mi=li.elements,Ri=li.sizePerElement,aa=mi.slice(ne,xe);if(!aa.length)return;var pa=aa[0].offset,ba=pa*Jn*Xn,go=aa.map(function(Ca,Bo){for(var ka=Ca.featureIdx,Zi=Ca.vertices,da=Ca.normals,$a=Zi.length/Ri,yo=[],Pi=0;Pi<$a;Pi++){var oo=da?da.slice(Pi*3,Pi*3+3):[];yo.push.apply(yo,(0,es.Z)(xt(F[ka],ka,Zi.slice(Pi*Ri,Pi*Ri+Ri),Bo,oo)))}return yo}).reduce(function(Ca,Bo){return Ca.push.apply(Ca,(0,es.Z)(Bo)),Ca},[]);pt.vertexAttribute.updateBuffer({data:go,offset:ba})}}}},{key:"createAttributesAndIndices",value:function(O,F,ne){var xe=this;this.featureLayout={sizePerElement:0,elements:[]},F&&(this.triangulation=F);var pt=this.attributes.map(function(ba){return ba.resetDescriptor(),ba.descriptor}),Pt=0,xt=[],ur=[],Vr=[],Jn=3;O.forEach(function(ba,go){var Ca=xe.triangulation(ba,ne),Bo=Ca.indices,ka=Ca.vertices,Zi=Ca.normals,da=Ca.size;Bo.forEach(function(oo){ur.push(oo+Pt)}),Jn=da;var $a=ka.length/da;xe.featureLayout.sizePerElement=Jn,xe.featureLayout.elements.push({featureIdx:go,vertices:ka,normals:Zi,offset:Pt}),Pt+=$a;for(var yo=function(Ga){var Hs=(Zi==null?void 0:Zi.slice(Ga*3,Ga*3+3))||[],Nl=ka.slice(Ga*da,Ga*da+da);pt.forEach(function(Bs,Lu){if(Bs&&Bs.update){var Ru;(Ru=Bs.buffer.data).push.apply(Ru,(0,es.Z)(Bs.update(ba,go,Nl,Ga,Hs)))}})},Pi=0;Pi<$a;Pi++)yo(Pi)});var Xn=this.rendererService,li=Xn.createAttribute,mi=Xn.createBuffer,Ri=Xn.createElements,aa={};pt.forEach(function(ba,go){if(ba){var Ca=ba.buffer,Bo=ba.update,ka=ba.name,Zi=(0,Yu.Z)(ba,["buffer","update","name"]),da=li(vl({buffer:mi(Ca)},Zi));aa[ba.name||""]=da,xe.attributes[go].vertexAttribute=da}});var pa=Ri({data:ur,type:Ki.gl.UNSIGNED_INT,count:ur.length});return this.attributesAndIndices={attributes:aa,elements:pa},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var O;this.attributes.forEach(function(F){F.vertexAttribute&&F.vertexAttribute.destroy()}),(O=this.attributesAndIndices)===null||O===void 0||O.elements.destroy(),this.attributes=[]}}]),Q}(),Co=(0,_e.Z)(Ea.prototype,"rendererService",[$s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ea))||As),Du=S(46343),Zs=S(67709),gl=S.n(Zs),m,A,z,I,fe,Ie,lt,Dt,Nt,Dr,Wr,ln,Li,Ei,ha,Pa,ya,_i,mo,wo,Js,hu,Qs,ku,Yo,ms,no,Ma,qs,yl,gs,Ol,eu;function tu(Q){var J=mc();return function(){var F=(0,dr.Z)(Q),ne;if(J){var xe=(0,dr.Z)(this).constructor;ne=Reflect.construct(F,arguments,xe)}else ne=F.apply(this,arguments);return(0,nr.Z)(this,ne)}}function mc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var Fu=(m=(0,me.b2)(),A=(0,me.f3)(ue.v.SceneID),z=(0,me.f3)(ue.v.IIconService),I=(0,me.f3)(ue.v.IFontService),fe=(0,me.f3)(ue.v.IControlService),Ie=(0,me.f3)(ue.v.IGlobalConfigService),lt=(0,me.f3)(ue.v.IMapService),Dt=(0,me.f3)(ue.v.ICoordinateSystemService),Nt=(0,me.f3)(ue.v.IRendererService),Dr=(0,me.f3)(ue.v.ILayerService),Wr=(0,me.f3)(ue.v.ICameraService),ln=(0,me.f3)(ue.v.IInteractionService),Li=(0,me.f3)(ue.v.IPickingService),Ei=(0,me.f3)(ue.v.IShaderModuleService),ha=(0,me.f3)(ue.v.IMarkerService),Pa=(0,me.f3)(ue.v.IPopupService),m(ya=(_i=function(Q){(0,Lt.Z)(O,Q);var J=tu(O);function O(){var F;return(0,oe.Z)(this,O),F=J.call(this),(0,K.Z)((0,Oe.Z)(F),"destroyed",!1),(0,K.Z)((0,Oe.Z)(F),"loaded",!1),(0,K.Z)((0,Oe.Z)(F),"loadFont",!1),(0,K.Z)((0,Oe.Z)(F),"fontFamily",""),(0,ae.Z)((0,Oe.Z)(F),"id",mo,(0,Oe.Z)(F)),(0,ae.Z)((0,Oe.Z)(F),"iconService",wo,(0,Oe.Z)(F)),(0,ae.Z)((0,Oe.Z)(F),"fontService",Js,(0,Oe.Z)(F)),(0,ae.Z)((0,Oe.Z)(F),"controlService",hu,(0,Oe.Z)(F)),(0,ae.Z)((0,Oe.Z)(F),"configService",Qs,(0,Oe.Z)(F)),(0,ae.Z)((0,Oe.Z)(F),"map",ku,(0,Oe.Z)(F)),(0,ae.Z)((0,Oe.Z)(F),"coordinateSystemService",Yo,(0,Oe.Z)(F)),(0,ae.Z)((0,Oe.Z)(F),"rendererService",ms,(0,Oe.Z)(F)),(0,ae.Z)((0,Oe.Z)(F),"layerService",no,(0,Oe.Z)(F)),(0,ae.Z)((0,Oe.Z)(F),"cameraService",Ma,(0,Oe.Z)(F)),(0,ae.Z)((0,Oe.Z)(F),"interactionService",qs,(0,Oe.Z)(F)),(0,ae.Z)((0,Oe.Z)(F),"pickingService",yl,(0,Oe.Z)(F)),(0,ae.Z)((0,Oe.Z)(F),"shaderModuleService",gs,(0,Oe.Z)(F)),(0,ae.Z)((0,Oe.Z)(F),"markerService",Ol,(0,Oe.Z)(F)),(0,ae.Z)((0,Oe.Z)(F),"popupService",eu,(0,Oe.Z)(F)),(0,K.Z)((0,Oe.Z)(F),"inited",!1),(0,K.Z)((0,Oe.Z)(F),"initPromise",void 0),(0,K.Z)((0,Oe.Z)(F),"rendering",!1),(0,K.Z)((0,Oe.Z)(F),"$container",void 0),(0,K.Z)((0,Oe.Z)(F),"canvas",void 0),(0,K.Z)((0,Oe.Z)(F),"markerContainer",void 0),(0,K.Z)((0,Oe.Z)(F),"hooks",void 0),(0,K.Z)((0,Oe.Z)(F),"handleWindowResized",function(){F.emit("resize"),F.$container&&(F.initContainer(),Qe.SO.triggerResize(),F.coordinateSystemService.needRefresh=!0,F.render())}),(0,K.Z)((0,Oe.Z)(F),"handleMapCameraChanged",function(ne){F.cameraService.update(ne),F.render("mapRender")}),F.hooks={init:new Du.zj},F}return(0,Ne.Z)(O,[{key:"init",value:function(ne){var xe=this;this.configService.setSceneConfig(this.id,ne),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Qo.Z)($i().mark(function pt(){return $i().wrap(function(xt){for(;;)switch(xt.prev=xt.next){case 0:return xt.next=2,new Promise(function(ur){xe.map.onCameraChanged(function(Vr){xe.cameraService.init(),xe.cameraService.update(Vr),xe.map.version!=="GAODE2.x"&&ur()}),xe.map.version!=="GAODE2.x"?xe.map.init():ur()});case 2:if(!(xe.map.version==="GAODE2.x"&&xe.map.initViewPort)){xt.next=6;break}return xt.next=5,xe.map.init();case 5:xe.map.initViewPort();case 6:xe.map.onCameraChanged(xe.handleMapCameraChanged),xe.map.addMarkerContainer(),xe.markerService.addMarkers(),xe.markerService.addMarkerLayers(),xe.popupService.initPopup(),xe.interactionService.init(),xe.interactionService.on(hi.s.Drag,xe.addSceneEvent.bind(xe));case 13:case"end":return xt.stop()}},pt)}))),this.hooks.init.tapPromise("initRenderer",(0,Qo.Z)($i().mark(function pt(){var Pt;return $i().wrap(function(ur){for(;;)switch(ur.prev=ur.next){case 0:if(Pt=Yi(xe.configService.getSceneConfig(xe.id).id||""),xe.$container=Pt,!Pt){ur.next=11;break}return xe.canvas=Qe.SO.create("canvas","",Pt),xe.setCanvas(),ur.next=7,xe.rendererService.init(xe.canvas,xe.configService.getSceneConfig(xe.id));case 7:gl()(xe.$container,xe.handleWindowResized),window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)").addListener(xe.handleWindowResized),ur.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:xe.pickingService.init(xe.id);case 13:case"end":return ur.stop()}},pt)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(ne){this.layerService.add(ne),this.render()}},{key:"render",value:function(){var F=(0,Qo.Z)($i().mark(function xe(pt){return $i().wrap(function(xt){for(;;)switch(xt.prev=xt.next){case 0:if(!(this.rendering||this.destroyed)){xt.next=2;break}return xt.abrupt("return");case 2:if(this.rendering=!0,this.inited){xt.next=15;break}return xt.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){xt.next=10;break}return xt.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.renderLayers(pt),this.rendering=!1;case 17:case"end":return xt.stop()}},xe,this)}));function ne(xe){return F.apply(this,arguments)}return ne}()},{key:"addFontFace",value:function(ne,xe){this.fontFamily=ne;var pt=document.createElement("style");pt.type="text/css",pt.innerText=`
        @font-face{
            font-family: '`.concat(ne,`';
            src: url('`).concat(xe,`') format('woff2'),
            url('`).concat(xe,`') format('woff'),
            url('`).concat(xe,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(pt),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(ne){var xe,pt=(xe=this.$container)===null||xe===void 0?void 0:xe.getElementsByTagName("canvas")[0];this.render();var Pt=ne==="jpg"?pt==null?void 0:pt.toDataURL("image/jpeg"):pt==null?void 0:pt.toDataURL("image/png");return Pt}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var ne=this.$container.parentElement;ne!==null&&(this.markerContainer=Qe.SO.create("div","l7-marker-container",ne))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var ne,xe;if(!this.inited){this.destroyed=!0;return}this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),(ne=this.$container)===null||ne===void 0||(xe=ne.parentNode)===null||xe===void 0||xe.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,Zs.unbind)(this.$container,this.handleWindowResized),window.matchMedia("screen and (min-resolution: 2dppx)").removeListener(this.handleWindowResized)}},{key:"initContainer",value:function(){var ne,xe,pt=Qe.SO.DPR,Pt=((ne=this.$container)===null||ne===void 0?void 0:ne.clientWidth)||400,xt=((xe=this.$container)===null||xe===void 0?void 0:xe.clientHeight)||300,ur=this.canvas;ur&&(ur.width=Pt*pt,ur.height=xt*pt,ur.style.width="".concat(Pt,"px"),ur.style.height="".concat(xt,"px")),this.rendererService.viewport({x:0,y:0,width:pt*Pt,height:pt*xt})}},{key:"setCanvas",value:function(){var ne,xe,pt=Qe.SO.DPR,Pt=((ne=this.$container)===null||ne===void 0?void 0:ne.clientWidth)||400,xt=((xe=this.$container)===null||xe===void 0?void 0:xe.clientHeight)||300,ur=this.canvas;ur.width=Pt*pt,ur.height=xt*pt,ur.style.width="".concat(Pt,"px"),ur.style.height="".concat(xt,"px")}},{key:"addSceneEvent",value:function(ne){this.emit(ne.type,ne)}}]),O}(E.EventEmitter),mo=(0,_e.Z)(_i.prototype,"id",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wo=(0,_e.Z)(_i.prototype,"iconService",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Js=(0,_e.Z)(_i.prototype,"fontService",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hu=(0,_e.Z)(_i.prototype,"controlService",[fe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qs=(0,_e.Z)(_i.prototype,"configService",[Ie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ku=(0,_e.Z)(_i.prototype,"map",[lt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yo=(0,_e.Z)(_i.prototype,"coordinateSystemService",[Dt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ms=(0,_e.Z)(_i.prototype,"rendererService",[Nt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),no=(0,_e.Z)(_i.prototype,"layerService",[Dr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ma=(0,_e.Z)(_i.prototype,"cameraService",[Wr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qs=(0,_e.Z)(_i.prototype,"interactionService",[ln],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yl=(0,_e.Z)(_i.prototype,"pickingService",[Li],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gs=(0,_e.Z)(_i.prototype,"shaderModuleService",[Ei],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ol=(0,_e.Z)(_i.prototype,"markerService",[ha],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eu=(0,_e.Z)(_i.prototype,"popupService",[Pa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_i))||ya),Ia=S(44908),_l=S.n(Ia);function $c(Q){var J=0;switch(Q){case"vec2":case"ivec2":J=2;break;case"vec3":case"ivec3":J=3;break;case"vec4":case"ivec4":case"mat2":J=4;break;case"mat3":J=9;break;case"mat4":J=16;break;default:}return J}var Bu=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function xl(Q){var J={};return Q=Q.replace(Bu,function(O,F,ne){var xe=ne.split(":"),pt=xe[0].trim(),Pt="";switch(xe.length>1&&(Pt=xe[1].trim()),F){case"bool":Pt=Pt==="true";break;case"float":case"int":Pt=Number(Pt);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":Pt?Pt=Pt.replace("[","").replace("]","").split(",").reduce(function(xt,ur){return xt.push(Number(ur.trim())),xt},[]):Pt=new Array($c(F)).fill(0);break;default:}return J[pt]=Pt,"uniform ".concat(F," ").concat(pt,`;
`)}),{content:Q,uniforms:J}}var Jc,$u;function Yl(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(Q);J&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(Q,ne).enumerable})),O.push.apply(O,F)}return O}function Iu(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?Yl(Object(O),!0).forEach(function(F){(0,K.Z)(Q,F,O[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):Yl(Object(O)).forEach(function(F){Object.defineProperty(Q,F,Object.getOwnPropertyDescriptor(O,F))})}return Q}var Ju="#define PI 3.14159265359",bl=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Sl=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Qu=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,El=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  return filterPickingColor(filterHighlightColor(color));
}
`,qu=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,ru=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Kl=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Nu=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Dc=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 0.0, 0.0, 0.0, // offsets
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0;   // offsets
}`,el=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,Cl=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Ll=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,gc=/precision\s+(high|low|medium)p\s+float/,Rl=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,kc=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,$l=(Jc=(0,me.b2)(),Jc($u=function(){function Q(){(0,oe.Z)(this,Q),(0,K.Z)(this,"moduleCache",{}),(0,K.Z)(this,"rawContentCache",{})}return(0,Ne.Z)(Q,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Ju,fs:Ju}),this.registerModule("decode",{vs:bl,fs:""}),this.registerModule("projection",{vs:Kl,fs:""}),this.registerModule("project",{vs:ru,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Nu}),this.registerModule("lighting",{vs:Qu,fs:""}),this.registerModule("light",{vs:Sl,fs:""}),this.registerModule("picking",{vs:qu,fs:El}),this.registerModule("styleMapping",{vs:Dc,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:el,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:Cl,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Ll,fs:""})}},{key:"registerModule",value:function(O,F){if(!this.rawContentCache[O]){var ne=F.vs,xe=F.fs,pt=F.uniforms,Pt=xl(ne),xt=Pt.content,ur=Pt.uniforms,Vr=xl(xe),Jn=Vr.content,Xn=Vr.uniforms;this.rawContentCache[O]={fs:Jn,uniforms:Iu(Iu(Iu({},ur),Xn),pt),vs:xt}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(O){var F=this;if(this.moduleCache[O])return this.moduleCache[O];var ne=this.rawContentCache[O].vs,xe=this.rawContentCache[O].fs,pt=this.processModule(ne,[],"vs"),Pt=pt.content,xt=pt.includeList,ur=this.processModule(xe,[],"fs"),Vr=ur.content,Jn=ur.includeList,Xn=Vr,li=_l()(xt.concat(Jn).concat(O)).reduce(function(mi,Ri){return Iu(Iu({},mi),F.rawContentCache[Ri].uniforms)},{});return gc.test(Vr)||(Xn=Rl+Vr),this.moduleCache[O]={fs:Xn.trim(),uniforms:li,vs:Pt.trim()},this.moduleCache[O]}},{key:"processModule",value:function(O,F,ne){var xe=this,pt=O.replace(kc,function(Pt,xt){var ur=xt.split(" "),Vr=ur[0].replace(/"/g,"");if(F.indexOf(Vr)>-1)return"";var Jn=xe.rawContentCache[Vr][ne];F.push(Vr);var Xn=xe.processModule(Jn,F,ne),li=Xn.content;return li});return{content:pt,includeList:F}}}]),Q}())||$u),js=S(66213),io=S(92364),bo,zu,Ds,Dl,Jl,_u=(bo=(0,me.b2)(),zu=(0,me.f3)(ue.v.IShaderModuleService),bo(Ds=(Dl=function(){function Q(){(0,oe.Z)(this,Q),(0,ae.Z)(this,"shaderModuleService",Jl,this),(0,K.Z)(this,"rendererService",void 0),(0,K.Z)(this,"cameraService",void 0),(0,K.Z)(this,"mapService",void 0),(0,K.Z)(this,"interactionService",void 0),(0,K.Z)(this,"layerService",void 0),(0,K.Z)(this,"config",void 0)}return(0,Ne.Z)(Q,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return io.G.Normal}},{key:"init",value:function(O,F){this.config=F,this.rendererService=O.getContainer().get(ue.v.IRendererService),this.cameraService=O.getContainer().get(ue.v.ICameraService),this.mapService=O.getContainer().get(ue.v.IMapService),this.interactionService=O.getContainer().get(ue.v.IInteractionService),this.layerService=O.getContainer().get(ue.v.ILayerService)}},{key:"render",value:function(O){}}]),Q}(),Jl=(0,_e.Z)(Dl.prototype,"shaderModuleService",[zu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dl))||Ds),Ql,Uu;function ao(Q){var J=kl();return function(){var F=(0,dr.Z)(Q),ne;if(J){var xe=(0,dr.Z)(this).constructor;ne=Reflect.construct(F,arguments,xe)}else ne=F.apply(this,arguments);return(0,nr.Z)(this,ne)}}function kl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var Vs=(Ql=(0,me.b2)(),Ql(Uu=function(Q){(0,Lt.Z)(O,Q);var J=ao(O);function O(){return(0,oe.Z)(this,O),J.apply(this,arguments)}return(0,Ne.Z)(O,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(ne,xe){(0,js.Z)((0,dr.Z)(O.prototype),"init",this).call(this,ne,xe)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),O}(_u))||Uu),pu,sa,Ai,ys,du;function tl(Q,J){var O=typeof Symbol!="undefined"&&Q[Symbol.iterator]||Q["@@iterator"];if(!O){if(Array.isArray(Q)||(O=rs(Q))||J&&Q&&typeof Q.length=="number"){O&&(Q=O);var F=0,ne=function(){};return{s:ne,n:function(){return F>=Q.length?{done:!0}:{done:!1,value:Q[F++]}},e:function(ur){throw ur},f:ne}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var xe=!0,pt=!1,Pt;return{s:function(){O=O.call(Q)},n:function(){var ur=O.next();return xe=ur.done,ur},e:function(ur){pt=!0,Pt=ur},f:function(){try{!xe&&O.return!=null&&O.return()}finally{if(pt)throw Pt}}}}function rs(Q,J){if(!!Q){if(typeof Q=="string")return Qc(Q,J);var O=Object.prototype.toString.call(Q).slice(8,-1);if(O==="Object"&&Q.constructor&&(O=Q.constructor.name),O==="Map"||O==="Set")return Array.from(Q);if(O==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(O))return Qc(Q,J)}}function Qc(Q,J){(J==null||J>Q.length)&&(J=Q.length);for(var O=0,F=new Array(J);O<J;O++)F[O]=Q[O];return F}var Fc=(pu=(0,me.b2)(),sa=(0,me.f3)(ue.v.IPostProcessor),pu(Ai=(ys=function(){function Q(){(0,oe.Z)(this,Q),(0,K.Z)(this,"passes",[]),(0,ae.Z)(this,"postProcessor",du,this),(0,K.Z)(this,"layer",void 0),(0,K.Z)(this,"renderFlag",void 0),(0,K.Z)(this,"width",0),(0,K.Z)(this,"height",0)}return(0,Ne.Z)(Q,[{key:"setLayer",value:function(O){this.layer=O}},{key:"setRenderFlag",value:function(O){this.renderFlag=O}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var J=(0,Qo.Z)($i().mark(function F(){var ne,xe,pt;return $i().wrap(function(xt){for(;;)switch(xt.prev=xt.next){case 0:ne=tl(this.passes),xt.prev=1,ne.s();case 3:if((xe=ne.n()).done){xt.next=9;break}return pt=xe.value,xt.next=7,pt.render(this.layer);case 7:xt.next=3;break;case 9:xt.next=14;break;case 11:xt.prev=11,xt.t0=xt.catch(1),ne.e(xt.t0);case 14:return xt.prev=14,ne.f(),xt.finish(14);case 17:this.layer.renderModels();case 18:case"end":return xt.stop()}},F,this,[[1,11,14,17]])}));function O(){return J.apply(this,arguments)}return O}()},{key:"resize",value:function(O,F){(this.width!==O||this.height!==F)&&(this.width=O,this.height=F)}},{key:"add",value:function(O,F){O.getType()===io.G.PostProcessing?this.postProcessor.add(O,this.layer,F):(O.init(this.layer,F),this.passes.push(O))}},{key:"insert",value:function(O,F,ne){O.init(this.layer,F),this.passes.splice(ne,0,O)}},{key:"destroy",value:function(){this.passes.length=0}}]),Q}(),du=(0,_e.Z)(ys.prototype,"postProcessor",[sa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ys))||Ai),wl,Fl;function xu(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(Q);J&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(Q,ne).enumerable})),O.push.apply(O,F)}return O}function Ao(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?xu(Object(O),!0).forEach(function(F){(0,K.Z)(Q,F,O[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):xu(Object(O)).forEach(function(F){Object.defineProperty(Q,F,Object.getOwnPropertyDescriptor(O,F))})}return Q}function Zu(Q){var J=Al();return function(){var F=(0,dr.Z)(Q),ne;if(J){var xe=(0,dr.Z)(this).constructor;ne=Reflect.construct(F,arguments,xe)}else ne=F.apply(this,arguments);return(0,nr.Z)(this,ne)}}function Al(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var To=(wl=(0,me.b2)(),wl(Fl=function(Q){(0,Lt.Z)(O,Q);var J=Zu(O);function O(){var F;(0,oe.Z)(this,O);for(var ne=arguments.length,xe=new Array(ne),pt=0;pt<ne;pt++)xe[pt]=arguments[pt];return F=J.call.apply(J,[this].concat(xe)),(0,K.Z)((0,Oe.Z)(F),"pickingFBO",void 0),(0,K.Z)((0,Oe.Z)(F),"layer",void 0),(0,K.Z)((0,Oe.Z)(F),"width",0),(0,K.Z)((0,Oe.Z)(F),"height",0),(0,K.Z)((0,Oe.Z)(F),"alreadyInRendering",!1),(0,K.Z)((0,Oe.Z)(F),"pickFromPickingFBO",function(Pt){var xt=Pt.x,ur=Pt.y,Vr=Pt.lngLat,Jn=Pt.type;if(!(!F.layer.isVisible()||!F.layer.needPick(Jn))){var Xn=F.rendererService,li=Xn.getViewportSize,mi=Xn.readPixels,Ri=Xn.useFramebuffer,aa=li(),pa=aa.width,ba=aa.height,go=F.layer.getLayerConfig(),Ca=go.enableHighlight,Bo=go.enableSelect,ka=xt*Qe.SO.DPR,Zi=ur*Qe.SO.DPR;if(!(ka>pa||ka<0||Zi>ba||Zi<0)){var da;Ri(F.pickingFBO,function(){var $a;if(da=mi({x:Math.round(ka),y:Math.round(ba-(ur+1)*Qe.SO.DPR),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:F.pickingFBO}),da[0]!==0||da[1]!==0||da[2]!==0){var yo=(0,Qe.W0)(da),Pi=F.layer.getSource().getFeatureById(yo),oo={x:xt,y:ur,type:Jn,lngLat:Vr,featureId:yo,feature:Pi};Pi&&(F.layer.setCurrentPickId(yo),F.triggerHoverOnLayer(oo))}else{var Ga={x:xt,y:ur,lngLat:Vr,type:F.layer.getCurrentPickId()===null?"un"+Jn:"mouseout",featureId:null,feature:null};F.triggerHoverOnLayer(Ao(Ao({},Ga),{},{type:"unpick"})),F.triggerHoverOnLayer(Ga),F.layer.setCurrentPickId(null)}Ca&&F.highlightPickedFeature(da),Bo&&Jn==="click"&&(($a=da)===null||$a===void 0?void 0:$a.toString())!==[0,0,0,0].toString()&&F.selectFeature(da)})}}}),F}return(0,Ne.Z)(O,[{key:"getType",value:function(){return io.G.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(ne,xe){(0,js.Z)((0,dr.Z)(O.prototype),"init",this).call(this,ne,xe),this.layer=ne;var pt=this.rendererService,Pt=pt.createTexture2D,xt=pt.createFramebuffer,ur=pt.getViewportSize,Vr=ur(),Jn=Vr.width,Xn=Vr.height;this.pickingFBO=xt({color:Pt({width:Jn,height:Xn,wrapS:Ki.gl.CLAMP_TO_EDGE,wrapT:Ki.gl.CLAMP_TO_EDGE})}),this.interactionService.on(hi.s.Hover,this.pickFromPickingFBO),this.interactionService.on(hi.s.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(hi.s.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(ne){var xe=this;if(!this.alreadyInRendering){var pt=this.rendererService,Pt=pt.getViewportSize,xt=pt.useFramebuffer,ur=pt.clear,Vr=Pt(),Jn=Vr.width,Xn=Vr.height;this.alreadyInRendering=!0,(this.width!==Jn||this.height!==Xn)&&(this.pickingFBO.resize({width:Jn,height:Xn}),this.width=Jn,this.height=Xn),xt(this.pickingFBO,function(){ur({framebuffer:xe.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var li=xe.layer.multiPassRenderer.getRenderFlag();xe.layer.multiPassRenderer.setRenderFlag(!1),ne.hooks.beforePickingEncode.call(),ne.render(),ne.hooks.afterPickingEncode.call(),xe.layer.multiPassRenderer.setRenderFlag(li),xe.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(ne){this.layer.emit(ne.type,ne)}},{key:"highlightPickedFeature",value:function(ne){var xe=(0,Ct.Z)(ne,3),pt=xe[0],Pt=xe[1],xt=xe[2];this.layer.hooks.beforeHighlight.call([pt,Pt,xt]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(ne){var xe=(0,Ct.Z)(ne,3),pt=xe[0],Pt=xe[1],xt=xe[2];this.layer.hooks.beforeSelect.call([pt,Pt,xt]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(ne){var xe=ne.featureId,pt=(0,Qe.Z6)(xe);this.selectFeature(new Uint8Array(pt))}},{key:"highlightFeatureHandle",value:function(ne){var xe=ne.featureId,pt=(0,Qe.Z6)(xe);this.highlightPickedFeature(new Uint8Array(pt))}}]),O}(_u))||Fl),Dn=S(69530),ho,bu;function ju(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(Q);J&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(Q,ne).enumerable})),O.push.apply(O,F)}return O}function Ka(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?ju(Object(O),!0).forEach(function(F){(0,K.Z)(Q,F,O[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):ju(Object(O)).forEach(function(F){Object.defineProperty(Q,F,Object.getOwnPropertyDescriptor(O,F))})}return Q}function ks(Q){var J=yc();return function(){var F=(0,dr.Z)(Q),ne;if(J){var xe=(0,dr.Z)(this).constructor;ne=Reflect.construct(F,arguments,xe)}else ne=F.apply(this,arguments);return(0,nr.Z)(this,ne)}}function yc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var xn=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Ou=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,_c=(ho=(0,me.b2)(),ho(bu=function(Q){(0,Lt.Z)(O,Q);var J=ks(O);function O(){return(0,oe.Z)(this,O),J.apply(this,arguments)}return(0,Ne.Z)(O,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Ou,fs:xn});var ne=this.shaderModuleService.getModule("blur-pass"),xe=ne.vs,pt=ne.fs,Pt=ne.uniforms,xt=this.rendererService.getViewportSize(),ur=xt.width,Vr=xt.height;return{vs:xe,fs:pt,uniforms:Ka(Ka({},Pt),{},{u_ViewportSize:[ur,Vr]})}}},{key:"convertOptionsToUniforms",value:function(ne){var xe={};return ls()(ne.blurRadius)||(xe.u_BlurDir=[ne.blurRadius,0]),xe}}]),O}(Dn.Z))||bu),nu,Za;function _s(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(Q);J&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(Q,ne).enumerable})),O.push.apply(O,F)}return O}function Tl(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?_s(Object(O),!0).forEach(function(F){(0,K.Z)(Q,F,O[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):_s(Object(O)).forEach(function(F){Object.defineProperty(Q,F,Object.getOwnPropertyDescriptor(O,F))})}return Q}function iu(Q){var J=Ts();return function(){var F=(0,dr.Z)(Q),ne;if(J){var xe=(0,dr.Z)(this).constructor;ne=Reflect.construct(F,arguments,xe)}else ne=F.apply(this,arguments);return(0,nr.Z)(this,ne)}}function Ts(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var Su=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,qc=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ql=(nu=(0,me.b2)(),nu(Za=function(Q){(0,Lt.Z)(O,Q);var J=iu(O);function O(){return(0,oe.Z)(this,O),J.apply(this,arguments)}return(0,Ne.Z)(O,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:qc,fs:Su});var ne=this.shaderModuleService.getModule("blur-pass"),xe=ne.vs,pt=ne.fs,Pt=ne.uniforms,xt=this.rendererService.getViewportSize(),ur=xt.width,Vr=xt.height;return{vs:xe,fs:pt,uniforms:Tl(Tl({},Pt),{},{u_ViewportSize:[ur,Vr]})}}},{key:"convertOptionsToUniforms",value:function(ne){var xe={};return ls()(ne.blurRadius)||(xe.u_BlurDir=[0,ne.blurRadius]),xe}}]),O}(Dn.Z))||Za),ec,Po;function Gs(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(Q);J&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(Q,ne).enumerable})),O.push.apply(O,F)}return O}function Mo(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?Gs(Object(O),!0).forEach(function(F){(0,K.Z)(Q,F,O[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):Gs(Object(O)).forEach(function(F){Object.defineProperty(Q,F,Object.getOwnPropertyDescriptor(O,F))})}return Q}function ta(Q){var J=Vu();return function(){var F=(0,dr.Z)(Q),ne;if(J){var xe=(0,dr.Z)(this).constructor;ne=Reflect.construct(F,arguments,xe)}else ne=F.apply(this,arguments);return(0,nr.Z)(this,ne)}}function Vu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var vu=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,Ko=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,rl=(ec=(0,me.b2)(),ec(Po=function(Q){(0,Lt.Z)(O,Q);var J=ta(O);function O(){return(0,oe.Z)(this,O),J.apply(this,arguments)}return(0,Ne.Z)(O,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:Ko,fs:vu});var ne=this.shaderModuleService.getModule("colorhalftone-pass"),xe=ne.vs,pt=ne.fs,Pt=ne.uniforms,xt=this.rendererService.getViewportSize(),ur=xt.width,Vr=xt.height;return{vs:xe,fs:pt,uniforms:Mo(Mo({},Pt),{},{u_ViewportSize:[ur,Vr]})}}}]),O}(Dn.Z))||Po),Eu,bi;function po(Q){var J=Pl();return function(){var F=(0,dr.Z)(Q),ne;if(J){var xe=(0,dr.Z)(this).constructor;ne=Reflect.construct(F,arguments,xe)}else ne=F.apply(this,arguments);return(0,nr.Z)(this,ne)}}function Pl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var jn=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Hn=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,nl=(Eu=(0,me.b2)(),Eu(bi=function(Q){(0,Lt.Z)(O,Q);var J=po(O);function O(){return(0,oe.Z)(this,O),J.apply(this,arguments)}return(0,Ne.Z)(O,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:Hn,fs:jn}),this.shaderModuleService.getModule("copy-pass")}}]),O}(Dn.Z))||bi),ns,fs;function Io(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(Q);J&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(Q,ne).enumerable})),O.push.apply(O,F)}return O}function au(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?Io(Object(O),!0).forEach(function(F){(0,K.Z)(Q,F,O[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):Io(Object(O)).forEach(function(F){Object.defineProperty(Q,F,Object.getOwnPropertyDescriptor(O,F))})}return Q}function Bc(Q){var J=tc();return function(){var F=(0,dr.Z)(Q),ne;if(J){var xe=(0,dr.Z)(this).constructor;ne=Reflect.construct(F,arguments,xe)}else ne=F.apply(this,arguments);return(0,nr.Z)(this,ne)}}function tc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var Gi=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Ui=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ef=(ns=(0,me.b2)(),ns(fs=function(Q){(0,Lt.Z)(O,Q);var J=Bc(O);function O(){return(0,oe.Z)(this,O),J.apply(this,arguments)}return(0,Ne.Z)(O,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Ui,fs:Gi});var ne=this.shaderModuleService.getModule("hexagonalpixelate-pass"),xe=ne.vs,pt=ne.fs,Pt=ne.uniforms,xt=this.rendererService.getViewportSize(),ur=xt.width,Vr=xt.height;return{vs:xe,fs:pt,uniforms:au(au({},Pt),{},{u_ViewportSize:[ur,Vr]})}}}]),O}(Dn.Z))||fs),Ps,Ml;function Ms(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(Q);J&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(Q,ne).enumerable})),O.push.apply(O,F)}return O}function Va(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?Ms(Object(O),!0).forEach(function(F){(0,K.Z)(Q,F,O[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):Ms(Object(O)).forEach(function(F){Object.defineProperty(Q,F,Object.getOwnPropertyDescriptor(O,F))})}return Q}function ou(Q){var J=xs();return function(){var F=(0,dr.Z)(Q),ne;if(J){var xe=(0,dr.Z)(this).constructor;ne=Reflect.construct(F,arguments,xe)}else ne=F.apply(this,arguments);return(0,nr.Z)(this,ne)}}function xs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var Gu=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,il=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Il=(Ps=(0,me.b2)(),Ps(Ml=function(Q){(0,Lt.Z)(O,Q);var J=ou(O);function O(){return(0,oe.Z)(this,O),J.apply(this,arguments)}return(0,Ne.Z)(O,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:il,fs:Gu});var ne=this.shaderModuleService.getModule("ink-pass"),xe=ne.vs,pt=ne.fs,Pt=ne.uniforms,xt=this.rendererService.getViewportSize(),ur=xt.width,Vr=xt.height;return{vs:xe,fs:pt,uniforms:Va(Va({},Pt),{},{u_ViewportSize:[ur,Vr]})}}}]),O}(Dn.Z))||Ml),rc,al;function ol(Q){var J=sl();return function(){var F=(0,dr.Z)(Q),ne;if(J){var xe=(0,dr.Z)(this).constructor;ne=Reflect.construct(F,arguments,xe)}else ne=F.apply(this,arguments);return(0,nr.Z)(this,ne)}}function sl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var Cu=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,Hu=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,xc=(rc=(0,me.b2)(),rc(al=function(Q){(0,Lt.Z)(O,Q);var J=ol(O);function O(){return(0,oe.Z)(this,O),J.apply(this,arguments)}return(0,Ne.Z)(O,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:Hu,fs:Cu}),this.shaderModuleService.getModule("noise-pass")}}]),O}(Dn.Z))||al),wu,Fs;function Nc(Q){var J=nc();return function(){var F=(0,dr.Z)(Q),ne;if(J){var xe=(0,dr.Z)(this).constructor;ne=Reflect.construct(F,arguments,xe)}else ne=F.apply(this,arguments);return(0,nr.Z)(this,ne)}}function nc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var Bl=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ul=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,i=(wu=(0,me.b2)(),wu(Fs=function(Q){(0,Lt.Z)(O,Q);var J=Nc(O);function O(){return(0,oe.Z)(this,O),J.apply(this,arguments)}return(0,Ne.Z)(O,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:Bl,fs:ul}),this.shaderModuleService.getModule("sepia-pass")}}]),O}(Dn.Z))||Fs),u,o,h,y,b,T,D=(u=(0,me.b2)(),o=(0,me.f3)(ue.v.IRendererService),h=(0,me.zY)(),u(y=(b=function(){function Q(){(0,oe.Z)(this,Q),(0,ae.Z)(this,"rendererService",T,this),(0,K.Z)(this,"passes",[]),(0,K.Z)(this,"readFBO",void 0),(0,K.Z)(this,"writeFBO",void 0)}return(0,Ne.Z)(Q,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var J=(0,Qo.Z)($i().mark(function F(ne){var xe,pt;return $i().wrap(function(xt){for(;;)switch(xt.prev=xt.next){case 0:xe=0;case 1:if(!(xe<this.passes.length)){xt.next=10;break}return pt=this.passes[xe],pt.setRenderToScreen(this.isLastEnabledPass(xe)),xt.next=6,pt.render(ne);case 6:xe!==this.passes.length-1&&this.swap();case 7:xe++,xt.next=1;break;case 10:case"end":return xt.stop()}},F,this)}));function O(F){return J.apply(this,arguments)}return O}()},{key:"resize",value:function(O,F){this.readFBO.resize({width:O,height:F}),this.writeFBO.resize({width:O,height:F})}},{key:"add",value:function(O,F,ne){O.init(F,ne),this.passes.push(O)}},{key:"insert",value:function(O,F,ne,xe){O.init(ne,xe),this.passes.splice(F,0,O)}},{key:"getPostProcessingPassByName",value:function(O){return this.passes.find(function(F){return F.getName()===O})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(O){for(var F=O+1;F<this.passes.length;F++)if(this.passes[F].isEnabled())return!1;return!0}},{key:"swap",value:function(){var O=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=O}}]),Q}(),T=(0,_e.Z)(b.prototype,"rendererService",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,_e.Z)(b.prototype,"init",[h],Object.getOwnPropertyDescriptor(b.prototype,"init"),b.prototype),b))||y),V,se;function Ce(Q){var J=we();return function(){var F=(0,dr.Z)(Q),ne;if(J){var xe=(0,dr.Z)(this).constructor;ne=Reflect.construct(F,arguments,xe)}else ne=F.apply(this,arguments);return(0,nr.Z)(this,ne)}}function we(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var Pe=(V=(0,me.b2)(),V(se=function(Q){(0,Lt.Z)(O,Q);var J=Ce(O);function O(){return(0,oe.Z)(this,O),J.apply(this,arguments)}return(0,Ne.Z)(O,[{key:"getType",value:function(){return io.G.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(ne,xe){(0,js.Z)((0,dr.Z)(O.prototype),"init",this).call(this,ne,xe)}},{key:"render",value:function(ne){var xe=this.rendererService,pt=xe.useFramebuffer,Pt=xe.clear;pt(null,function(){Pt({color:[0,0,0,0],depth:1,stencil:0}),ne.multiPassRenderer.setRenderFlag(!1),ne.render(),ne.multiPassRenderer.setRenderFlag(!0)})}}]),O}(_u))||se),He,Ge,nt,ze,it;function bt(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(Q);J&&(F=F.filter(function(ne){return Object.getOwnPropertyDescriptor(Q,ne).enumerable})),O.push.apply(O,F)}return O}function Vt(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?bt(Object(O),!0).forEach(function(F){(0,K.Z)(Q,F,O[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):bt(Object(O)).forEach(function(F){Object.defineProperty(Q,F,Object.getOwnPropertyDescriptor(O,F))})}return Q}function gr(Q){var J=fr();return function(){var F=(0,dr.Z)(Q),ne;if(J){var xe=(0,dr.Z)(this).constructor;ne=Reflect.construct(F,arguments,xe)}else ne=F.apply(this,arguments);return(0,nr.Z)(this,ne)}}function fr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var Er=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,jr=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,fn=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function tn(Q,J){for(var O=0,F=1/J,ne=Q;ne>0;)O=O+F*(ne%J),ne=Math.floor(ne/J),F=F/J;return O}var Zn=1,si=(He=(0,me.b2)(),Ge=(0,me.f3)(ue.v.IShaderModuleService),He(nt=(ze=function(Q){(0,Lt.Z)(O,Q);var J=gr(O);function O(){var F;(0,oe.Z)(this,O);for(var ne=arguments.length,xe=new Array(ne),pt=0;pt<ne;pt++)xe[pt]=arguments[pt];return F=J.call.apply(J,[this].concat(xe)),(0,ae.Z)((0,Oe.Z)(F),"shaderModuleService",it,(0,Oe.Z)(F)),(0,K.Z)((0,Oe.Z)(F),"haltonSequence",[]),(0,K.Z)((0,Oe.Z)(F),"accumulatingId",0),(0,K.Z)((0,Oe.Z)(F),"frame",0),(0,K.Z)((0,Oe.Z)(F),"timer",void 0),(0,K.Z)((0,Oe.Z)(F),"sampleRenderTarget",void 0),(0,K.Z)((0,Oe.Z)(F),"prevRenderTarget",void 0),(0,K.Z)((0,Oe.Z)(F),"outputRenderTarget",void 0),(0,K.Z)((0,Oe.Z)(F),"copyRenderTarget",void 0),(0,K.Z)((0,Oe.Z)(F),"blendModel",void 0),(0,K.Z)((0,Oe.Z)(F),"outputModel",void 0),(0,K.Z)((0,Oe.Z)(F),"copyModel",void 0),F}return(0,Ne.Z)(O,[{key:"getType",value:function(){return io.G.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(ne,xe){(0,js.Z)((0,dr.Z)(O.prototype),"init",this).call(this,ne,xe);var pt=this.rendererService,Pt=pt.createFramebuffer,xt=pt.createTexture2D;this.sampleRenderTarget=Pt({color:xt({width:1,height:1,wrapS:Ki.gl.CLAMP_TO_EDGE,wrapT:Ki.gl.CLAMP_TO_EDGE})}),this.prevRenderTarget=Pt({color:xt({width:1,height:1,wrapS:Ki.gl.CLAMP_TO_EDGE,wrapT:Ki.gl.CLAMP_TO_EDGE})}),this.outputRenderTarget=Pt({color:xt({width:1,height:1,wrapS:Ki.gl.CLAMP_TO_EDGE,wrapT:Ki.gl.CLAMP_TO_EDGE})}),this.copyRenderTarget=Pt({color:xt({width:1,height:1,wrapS:Ki.gl.CLAMP_TO_EDGE,wrapT:Ki.gl.CLAMP_TO_EDGE})});for(var ur=0;ur<30;ur++)this.haltonSequence.push([tn(ur,2),tn(ur,3)]);this.blendModel=this.createTriangleModel("blend-pass",Er),this.outputModel=this.createTriangleModel("copy-pass",jr,{blend:{enable:!0,func:{srcRGB:Ki.gl.ONE,dstRGB:Ki.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:Ki.gl.ONE,dstAlpha:Ki.gl.ONE_MINUS_SRC_ALPHA},equation:{rgb:Ki.gl.FUNC_ADD,alpha:Ki.gl.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",jr)}},{key:"render",value:function(ne){var xe=this,pt=this.rendererService,Pt=pt.clear,xt=pt.getViewportSize,ur=pt.useFramebuffer,Vr=xt(),Jn=Vr.width,Xn=Vr.height;this.sampleRenderTarget.resize({width:Jn,height:Xn}),this.prevRenderTarget.resize({width:Jn,height:Xn}),this.outputRenderTarget.resize({width:Jn,height:Xn}),this.copyRenderTarget.resize({width:Jn,height:Xn}),this.resetFrame(),this.stopAccumulating();var li=ne.multiPassRenderer.getPostProcessor().getReadFBO();ur(li,function(){Pt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:li}),ne.multiPassRenderer.setRenderFlag(!1),ne.render(),ne.multiPassRenderer.setRenderFlag(!0)});var mi=function Ri(aa){!xe.accumulatingId||aa!==xe.accumulatingId||xe.isFinished()||(xe.doRender(ne),requestAnimationFrame(function(){Ri(aa)}))};this.accumulatingId=Zn++,this.timer=window.setTimeout(function(){mi(xe.accumulatingId)},50)}},{key:"doRender",value:function(ne){var xe=this,pt=this.rendererService,Pt=pt.clear,xt=pt.getViewportSize,ur=pt.useFramebuffer,Vr=xt(),Jn=Vr.width,Xn=Vr.height,li=ne.getLayerConfig(),mi=li.jitterScale,Ri=mi===void 0?1:mi,aa=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((aa[0]*2-1)/Jn*Ri,(aa[1]*2-1)/Xn*Ri),ne.multiPassRenderer.setRenderFlag(!1),ne.hooks.beforeRender.call(),ur(this.sampleRenderTarget,function(){Pt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:xe.sampleRenderTarget}),ne.render()}),ne.hooks.afterRender.call(),ne.multiPassRenderer.setRenderFlag(!0);var pa=ne.getLayerConfig();ur(this.outputRenderTarget,function(){xe.blendModel.draw({uniforms:{u_opacity:pa.opacity||1,u_MixRatio:xe.frame===0?1:.9,u_Diffuse1:xe.sampleRenderTarget,u_Diffuse2:xe.frame===0?ne.multiPassRenderer.getPostProcessor().getReadFBO():xe.prevRenderTarget}})}),this.frame===0&&Pt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(ur(this.copyRenderTarget,function(){xe.outputModel.draw({uniforms:{u_Texture:xe.outputRenderTarget}})}),ur(ne.multiPassRenderer.getPostProcessor().getReadFBO(),function(){xe.copyModel.draw({uniforms:{u_Texture:xe.copyRenderTarget}})}),ne.multiPassRenderer.getPostProcessor().render(ne));var ba=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=ba,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(ne,xe,pt){this.shaderModuleService.registerModule(ne,{vs:fn,fs:xe});var Pt=this.shaderModuleService.getModule(ne),xt=Pt.vs,ur=Pt.fs,Vr=Pt.uniforms,Jn=this.rendererService,Xn=Jn.createAttribute,li=Jn.createBuffer,mi=Jn.createModel;return mi(Vt({vs:xt,fs:ur,attributes:{a_Position:Xn({buffer:li({data:[-4,-4,4,-4,0,4],type:Ki.gl.FLOAT}),size:2})},uniforms:Vt({},Vr),depth:{enable:!1},count:3},pt))}}]),O}(_u),it=(0,_e.Z)(ze.prototype,"shaderModuleService",[Ge],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ze))||nt),ui=new me.W2;ui.bind(ue.v.IGlobalConfigService).to(Ae).inSingletonScope(),ui.bind(ue.v.IShaderModuleService).to($l).inSingletonScope(),(0,me.GW)((0,me.b2)(),E.EventEmitter),ui.bind(ue.v.IEventEmitter).to(E.EventEmitter);var dn=(0,te.Z)(ui,!1),ia=function(J){var O=dn.lazyInject(J);return function(F,ne,xe){O.call(this,F,ne),xe&&(xe.initializer=function(){return F[ne]})}},Wn=function(J){var O=dn.lazyMultiInject(J);return function(F,ne,xe){O.call(this,F,ne),xe&&(xe.initializer=function(){return F[ne]})}},xi=ui,ji=0;function vi(){var Q=new me.W2;return Q.parent=ui,Q.bind(ue.v.SceneID).toConstantValue("".concat(ji++)),Q.bind(ue.v.ILayerService).to(Mu).inSingletonScope(),Q.bind(ue.v.ISceneService).to(Fu).inSingletonScope(),Q.bind(ue.v.ICameraService).to(Ir).inSingletonScope(),Q.bind(ue.v.ICoordinateSystemService).to(An).inSingletonScope(),Q.bind(ue.v.IInteractionService).to(ro).inSingletonScope(),Q.bind(ue.v.IPickingService).to(ke).inSingletonScope(),Q.bind(ue.v.IControlService).to(Ar).inSingletonScope(),Q.bind(ue.v.IMarkerService).to(Yr).inSingletonScope(),Q.bind(ue.v.IIconService).to(st).inSingletonScope(),Q.bind(ue.v.IFontService).to(Ze).inSingletonScope(),Q.bind(ue.v.IPopupService).to(Mr).inSingletonScope(),Q.bind(ue.v.INormalPass).to(Vs).whenTargetNamed("clear"),Q.bind(ue.v.INormalPass).to(To).whenTargetNamed("pixelPicking"),Q.bind(ue.v.INormalPass).to(Pe).whenTargetNamed("render"),Q.bind(ue.v.INormalPass).to(si).whenTargetNamed("taa"),Q.bind(ue.v.IFactoryNormalPass).toFactory(function(J){return function(O){return J.container.getNamed(ue.v.INormalPass,O)}}),Q.bind(ue.v.IPostProcessingPass).to(nl).whenTargetNamed("copy"),Q.bind(ue.v.IPostProcessingPass).to(_c).whenTargetNamed("blurH"),Q.bind(ue.v.IPostProcessingPass).to(ql).whenTargetNamed("blurV"),Q.bind(ue.v.IPostProcessingPass).to(xc).whenTargetNamed("noise"),Q.bind(ue.v.IPostProcessingPass).to(i).whenTargetNamed("sepia"),Q.bind(ue.v.IPostProcessingPass).to(rl).whenTargetNamed("colorHalftone"),Q.bind(ue.v.IPostProcessingPass).to(ef).whenTargetNamed("hexagonalPixelate"),Q.bind(ue.v.IPostProcessingPass).to(Il).whenTargetNamed("ink"),Q.bind(ue.v.IFactoryPostProcessingPass).toFactory(function(J){return function(O){var F=J.container.getNamed(ue.v.IPostProcessingPass,O);return F.setName(O),F}}),Q}function Ci(Q){var J=new me.W2;return J.parent=Q,J.bind(ue.v.IStyleAttributeService).to(ml).inSingletonScope(),J.bind(ue.v.IMultiPassRenderer).to(Fc).inSingletonScope(),J.bind(ue.v.IPostProcessor).to(D).inSingletonScope(),J}},2811:function(){},64532:function(){},4594:function(zr,N,S){"use strict";S.d(N,{l:function(){return ce}});var ce={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"}},66690:function(zr,N,S){"use strict";S.d(N,{d:function(){return ce}});var ce;(function(E){E.TOPRIGHT="topright",E.TOPLEFT="topleft",E.BOTTOMRIGHT="bottomright",E.BOTTOMLEFT="bottomleft",E.TOPCENTER="topcenter",E.BOTTOMCENTER="bottomcenter",E.LEFTCENTER="leftcenter",E.RIGHTCENTER="rightcenter"})(ce||(ce={}))},81732:function(){},84007:function(){},1910:function(){},47282:function(zr,N,S){"use strict";S.d(N,{l:function(){return ce},k:function(){return E}});var ce;(function(d){d[d.LNGLAT=1]="LNGLAT",d[d.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",d[d.VECTOR_TILE=3]="VECTOR_TILE",d[d.IDENTITY=4]="IDENTITY",d[d.P20=5]="P20",d[d.P20_OFFSET=6]="P20_OFFSET",d[d.METER_OFFSET=7]="METER_OFFSET",d[d.P20_2=8]="P20_2"})(ce||(ce={}));var E={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"}},89648:function(zr,N,S){"use strict";S.d(N,{s:function(){return ce}});var ce;(function(E){E.Hover="hover",E.Click="click",E.Select="select",E.Active="active",E.Drag="drag"})(ce||(ce={}))},90919:function(){},77252:function(zr,N,S){"use strict";S.d(N,{h:function(){return ce}});var ce;(function(E){E.normal="normal",E.additive="additive",E.subtractive="subtractive",E.min="min",E.max="max",E.none="none"})(ce||(ce={}))},31251:function(zr,N,S){"use strict";S.d(N,{vY:function(){return ce},ee:function(){return E},GC:function(){return d}});var ce;(function(me){me.LINEAR="linear",me.POWER="power",me.LOG="log",me.IDENTITY="identity",me.TIME="time",me.QUANTILE="quantile",me.QUANTIZE="quantize",me.THRESHOLD="threshold",me.CAT="cat"})(ce||(ce={}));var E;(function(me){me.CONSTANT="constant",me.VARIABLE="variable"})(E||(E={}));var d;(function(me){me[me.Attribute=0]="Attribute",me[me.InstancedAttribute=1]="InstancedAttribute",me[me.Uniform=2]="Uniform"})(d||(d={}))},16606:function(zr,N,S){"use strict";S.d(N,{I:function(){return ce}});var ce=["mapload","mapchange"]},75925:function(){},85040:function(){},8594:function(){},67571:function(){},66718:function(){},92364:function(zr,N,S){"use strict";S.d(N,{G:function(){return ce}});var ce;(function(E){E.Normal="normal",E.PostProcessing="post-processing"})(ce||(ce={}))},78010:function(){},41906:function(){},68116:function(){},23067:function(){},7648:function(zr,N,S){"use strict";S.d(N,{gl:function(){return ce}});var ce;(function(E){E[E.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",E[E.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",E[E.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",E[E.POINTS=0]="POINTS",E[E.LINES=1]="LINES",E[E.LINE_LOOP=2]="LINE_LOOP",E[E.LINE_STRIP=3]="LINE_STRIP",E[E.TRIANGLES=4]="TRIANGLES",E[E.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",E[E.TRIANGLE_FAN=6]="TRIANGLE_FAN",E[E.ZERO=0]="ZERO",E[E.ONE=1]="ONE",E[E.SRC_COLOR=768]="SRC_COLOR",E[E.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",E[E.SRC_ALPHA=770]="SRC_ALPHA",E[E.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",E[E.DST_ALPHA=772]="DST_ALPHA",E[E.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",E[E.DST_COLOR=774]="DST_COLOR",E[E.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",E[E.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",E[E.FUNC_ADD=32774]="FUNC_ADD",E[E.BLEND_EQUATION=32777]="BLEND_EQUATION",E[E.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",E[E.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",E[E.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",E[E.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",E[E.MAX_EXT=32776]="MAX_EXT",E[E.MIN_EXT=32775]="MIN_EXT",E[E.BLEND_DST_RGB=32968]="BLEND_DST_RGB",E[E.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",E[E.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",E[E.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",E[E.CONSTANT_COLOR=32769]="CONSTANT_COLOR",E[E.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",E[E.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",E[E.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",E[E.BLEND_COLOR=32773]="BLEND_COLOR",E[E.ARRAY_BUFFER=34962]="ARRAY_BUFFER",E[E.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",E[E.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",E[E.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",E[E.STREAM_DRAW=35040]="STREAM_DRAW",E[E.STATIC_DRAW=35044]="STATIC_DRAW",E[E.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",E[E.BUFFER_SIZE=34660]="BUFFER_SIZE",E[E.BUFFER_USAGE=34661]="BUFFER_USAGE",E[E.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",E[E.FRONT=1028]="FRONT",E[E.BACK=1029]="BACK",E[E.FRONT_AND_BACK=1032]="FRONT_AND_BACK",E[E.CULL_FACE=2884]="CULL_FACE",E[E.BLEND=3042]="BLEND",E[E.DITHER=3024]="DITHER",E[E.STENCIL_TEST=2960]="STENCIL_TEST",E[E.DEPTH_TEST=2929]="DEPTH_TEST",E[E.SCISSOR_TEST=3089]="SCISSOR_TEST",E[E.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",E[E.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",E[E.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",E[E.NO_ERROR=0]="NO_ERROR",E[E.INVALID_ENUM=1280]="INVALID_ENUM",E[E.INVALID_VALUE=1281]="INVALID_VALUE",E[E.INVALID_OPERATION=1282]="INVALID_OPERATION",E[E.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",E[E.CW=2304]="CW",E[E.CCW=2305]="CCW",E[E.LINE_WIDTH=2849]="LINE_WIDTH",E[E.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",E[E.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",E[E.CULL_FACE_MODE=2885]="CULL_FACE_MODE",E[E.FRONT_FACE=2886]="FRONT_FACE",E[E.DEPTH_RANGE=2928]="DEPTH_RANGE",E[E.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",E[E.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",E[E.DEPTH_FUNC=2932]="DEPTH_FUNC",E[E.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",E[E.STENCIL_FUNC=2962]="STENCIL_FUNC",E[E.STENCIL_FAIL=2964]="STENCIL_FAIL",E[E.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",E[E.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",E[E.STENCIL_REF=2967]="STENCIL_REF",E[E.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",E[E.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",E[E.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",E[E.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",E[E.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",E[E.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",E[E.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",E[E.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",E[E.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",E[E.VIEWPORT=2978]="VIEWPORT",E[E.SCISSOR_BOX=3088]="SCISSOR_BOX",E[E.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",E[E.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",E[E.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",E[E.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",E[E.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",E[E.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",E[E.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",E[E.RED_BITS=3410]="RED_BITS",E[E.GREEN_BITS=3411]="GREEN_BITS",E[E.BLUE_BITS=3412]="BLUE_BITS",E[E.ALPHA_BITS=3413]="ALPHA_BITS",E[E.DEPTH_BITS=3414]="DEPTH_BITS",E[E.STENCIL_BITS=3415]="STENCIL_BITS",E[E.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",E[E.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",E[E.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",E[E.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",E[E.SAMPLES=32937]="SAMPLES",E[E.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",E[E.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",E[E.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",E[E.DONT_CARE=4352]="DONT_CARE",E[E.FASTEST=4353]="FASTEST",E[E.NICEST=4354]="NICEST",E[E.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",E[E.BYTE=5120]="BYTE",E[E.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",E[E.SHORT=5122]="SHORT",E[E.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",E[E.INT=5124]="INT",E[E.UNSIGNED_INT=5125]="UNSIGNED_INT",E[E.FLOAT=5126]="FLOAT",E[E.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",E[E.ALPHA=6406]="ALPHA",E[E.RGB=6407]="RGB",E[E.RGBA=6408]="RGBA",E[E.LUMINANCE=6409]="LUMINANCE",E[E.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",E[E.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",E[E.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",E[E.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",E[E.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",E[E.VERTEX_SHADER=35633]="VERTEX_SHADER",E[E.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",E[E.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",E[E.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",E[E.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",E[E.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",E[E.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",E[E.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",E[E.SHADER_TYPE=35663]="SHADER_TYPE",E[E.DELETE_STATUS=35712]="DELETE_STATUS",E[E.LINK_STATUS=35714]="LINK_STATUS",E[E.VALIDATE_STATUS=35715]="VALIDATE_STATUS",E[E.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",E[E.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",E[E.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",E[E.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",E[E.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",E[E.NEVER=512]="NEVER",E[E.LESS=513]="LESS",E[E.EQUAL=514]="EQUAL",E[E.LEQUAL=515]="LEQUAL",E[E.GREATER=516]="GREATER",E[E.NOTEQUAL=517]="NOTEQUAL",E[E.GEQUAL=518]="GEQUAL",E[E.ALWAYS=519]="ALWAYS",E[E.KEEP=7680]="KEEP",E[E.REPLACE=7681]="REPLACE",E[E.INCR=7682]="INCR",E[E.DECR=7683]="DECR",E[E.INVERT=5386]="INVERT",E[E.INCR_WRAP=34055]="INCR_WRAP",E[E.DECR_WRAP=34056]="DECR_WRAP",E[E.VENDOR=7936]="VENDOR",E[E.RENDERER=7937]="RENDERER",E[E.VERSION=7938]="VERSION",E[E.NEAREST=9728]="NEAREST",E[E.LINEAR=9729]="LINEAR",E[E.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",E[E.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",E[E.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",E[E.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",E[E.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",E[E.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",E[E.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",E[E.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",E[E.TEXTURE_2D=3553]="TEXTURE_2D",E[E.TEXTURE=5890]="TEXTURE",E[E.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",E[E.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",E[E.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",E[E.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",E[E.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",E[E.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",E[E.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",E[E.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",E[E.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",E[E.TEXTURE0=33984]="TEXTURE0",E[E.TEXTURE1=33985]="TEXTURE1",E[E.TEXTURE2=33986]="TEXTURE2",E[E.TEXTURE3=33987]="TEXTURE3",E[E.TEXTURE4=33988]="TEXTURE4",E[E.TEXTURE5=33989]="TEXTURE5",E[E.TEXTURE6=33990]="TEXTURE6",E[E.TEXTURE7=33991]="TEXTURE7",E[E.TEXTURE8=33992]="TEXTURE8",E[E.TEXTURE9=33993]="TEXTURE9",E[E.TEXTURE10=33994]="TEXTURE10",E[E.TEXTURE11=33995]="TEXTURE11",E[E.TEXTURE12=33996]="TEXTURE12",E[E.TEXTURE13=33997]="TEXTURE13",E[E.TEXTURE14=33998]="TEXTURE14",E[E.TEXTURE15=33999]="TEXTURE15",E[E.TEXTURE16=34e3]="TEXTURE16",E[E.TEXTURE17=34001]="TEXTURE17",E[E.TEXTURE18=34002]="TEXTURE18",E[E.TEXTURE19=34003]="TEXTURE19",E[E.TEXTURE20=34004]="TEXTURE20",E[E.TEXTURE21=34005]="TEXTURE21",E[E.TEXTURE22=34006]="TEXTURE22",E[E.TEXTURE23=34007]="TEXTURE23",E[E.TEXTURE24=34008]="TEXTURE24",E[E.TEXTURE25=34009]="TEXTURE25",E[E.TEXTURE26=34010]="TEXTURE26",E[E.TEXTURE27=34011]="TEXTURE27",E[E.TEXTURE28=34012]="TEXTURE28",E[E.TEXTURE29=34013]="TEXTURE29",E[E.TEXTURE30=34014]="TEXTURE30",E[E.TEXTURE31=34015]="TEXTURE31",E[E.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",E[E.REPEAT=10497]="REPEAT",E[E.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",E[E.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",E[E.FLOAT_VEC2=35664]="FLOAT_VEC2",E[E.FLOAT_VEC3=35665]="FLOAT_VEC3",E[E.FLOAT_VEC4=35666]="FLOAT_VEC4",E[E.INT_VEC2=35667]="INT_VEC2",E[E.INT_VEC3=35668]="INT_VEC3",E[E.INT_VEC4=35669]="INT_VEC4",E[E.BOOL=35670]="BOOL",E[E.BOOL_VEC2=35671]="BOOL_VEC2",E[E.BOOL_VEC3=35672]="BOOL_VEC3",E[E.BOOL_VEC4=35673]="BOOL_VEC4",E[E.FLOAT_MAT2=35674]="FLOAT_MAT2",E[E.FLOAT_MAT3=35675]="FLOAT_MAT3",E[E.FLOAT_MAT4=35676]="FLOAT_MAT4",E[E.SAMPLER_2D=35678]="SAMPLER_2D",E[E.SAMPLER_CUBE=35680]="SAMPLER_CUBE",E[E.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",E[E.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",E[E.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",E[E.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",E[E.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",E[E.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",E[E.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",E[E.COMPILE_STATUS=35713]="COMPILE_STATUS",E[E.LOW_FLOAT=36336]="LOW_FLOAT",E[E.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",E[E.HIGH_FLOAT=36338]="HIGH_FLOAT",E[E.LOW_INT=36339]="LOW_INT",E[E.MEDIUM_INT=36340]="MEDIUM_INT",E[E.HIGH_INT=36341]="HIGH_INT",E[E.FRAMEBUFFER=36160]="FRAMEBUFFER",E[E.RENDERBUFFER=36161]="RENDERBUFFER",E[E.RGBA4=32854]="RGBA4",E[E.RGB5_A1=32855]="RGB5_A1",E[E.RGB565=36194]="RGB565",E[E.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",E[E.STENCIL_INDEX=6401]="STENCIL_INDEX",E[E.STENCIL_INDEX8=36168]="STENCIL_INDEX8",E[E.DEPTH_STENCIL=34041]="DEPTH_STENCIL",E[E.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",E[E.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",E[E.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",E[E.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",E[E.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",E[E.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",E[E.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",E[E.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",E[E.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",E[E.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",E[E.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",E[E.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",E[E.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",E[E.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",E[E.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",E[E.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",E[E.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",E[E.NONE=0]="NONE",E[E.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",E[E.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",E[E.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",E[E.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",E[E.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",E[E.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",E[E.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",E[E.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",E[E.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",E[E.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",E[E.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",E[E.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",E[E.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",E[E.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(ce||(ce={}))},69530:function(zr,N,S){"use strict";S.d(N,{Z:function(){return Xe}});var ce=S(55770),E=S(6610),d=S(5991),me=S(96156),te=S(3473),ue=S(11700),oe=S.n(ue),Ne=S(14293),K=S.n(Ne),Qe=S(68929),mt=S.n(Qe),Zt=S(86700),Cr=S(28660),Qt=S.n(Cr),Xt=S(7648),rr=S(72302),Ut=S(92364),St,Et,yr,q,hr;function wt(jt,br){var sr=Object.keys(jt);if(Object.getOwnPropertySymbols){var j=Object.getOwnPropertySymbols(jt);br&&(j=j.filter(function(ie){return Object.getOwnPropertyDescriptor(jt,ie).enumerable})),sr.push.apply(sr,j)}return sr}function $e(jt){for(var br=1;br<arguments.length;br++){var sr=arguments[br]!=null?arguments[br]:{};br%2?wt(Object(sr),!0).forEach(function(j){(0,me.Z)(jt,j,sr[j])}):Object.getOwnPropertyDescriptors?Object.defineProperties(jt,Object.getOwnPropertyDescriptors(sr)):wt(Object(sr)).forEach(function(j){Object.defineProperty(jt,j,Object.getOwnPropertyDescriptor(sr,j))})}return jt}var Ft=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Xe=(St=(0,Zt.b2)(),Et=(0,Zt.f3)(rr.v.IShaderModuleService),St(yr=(q=function(){function jt(){(0,E.Z)(this,jt),(0,ce.Z)(this,"shaderModuleService",hr,this),(0,me.Z)(this,"rendererService",void 0),(0,me.Z)(this,"config",void 0),(0,me.Z)(this,"quad",Ft),(0,me.Z)(this,"enabled",!0),(0,me.Z)(this,"renderToScreen",!1),(0,me.Z)(this,"model",void 0),(0,me.Z)(this,"name",void 0),(0,me.Z)(this,"optionsToUpdate",{})}return(0,d.Z)(jt,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(sr){this.name=sr}},{key:"getType",value:function(){return Ut.G.PostProcessing}},{key:"init",value:function(sr,j){this.config=j,this.rendererService=sr.getContainer().get(rr.v.IRendererService);var ie=this.rendererService,Re=ie.createAttribute,ye=ie.createBuffer,_t=ie.createModel,dt=this.setupShaders(),zt=dt.vs,Bt=dt.fs,Ur=dt.uniforms;this.model=_t({vs:zt,fs:Bt,attributes:{a_Position:Re({buffer:ye({data:[-4,-4,4,-4,0,4],type:Xt.gl.FLOAT}),size:2})},uniforms:$e($e({u_Texture:null},Ur),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(sr){var j=this,ie=sr.multiPassRenderer.getPostProcessor(),Re=this.rendererService,ye=Re.useFramebuffer,_t=Re.getViewportSize,dt=Re.clear,zt=_t(),Bt=zt.width,Ur=zt.height;ye(this.renderToScreen?null:ie.getWriteFBO(),function(){dt({framebuffer:ie.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),j.model.draw({uniforms:$e({u_Texture:ie.getReadFBO(),u_ViewportSize:[Bt,Ur]},j.convertOptionsToUniforms(j.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(sr){this.enabled=sr}},{key:"setRenderToScreen",value:function(sr){this.renderToScreen=sr}},{key:"updateOptions",value:function(sr){this.optionsToUpdate=$e($e({},this.optionsToUpdate),sr)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(sr){var j={};return Object.keys(sr).forEach(function(ie){K()(sr[ie])||(j["u_".concat(oe()(mt()(ie)))]=sr[ie])}),j}}]),jt}(),hr=(0,te.Z)(q.prototype,"shaderModuleService",[Et],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q))||yr)},19793:function(zr,N,S){"use strict";S.d(N,{P:function(){return ce}});var ce=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"]},93102:function(){},8628:function(){},72302:function(zr,N,S){"use strict";S.d(N,{v:function(){return ce}});var ce={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")}},76915:function(zr,N,S){"use strict";var ce=S(74691),E=null;function d(Xe){return E.indexOf(Xe)}var me=2,te=4,ue=64,oe=128,Ne=256,K=512,Qe=8192,mt=16384,Zt=32768,Cr=null,Qt=131072,Xt=262144,rr=524288,Ut=1048576,St=2097152,Et=4194304,yr=8388608,q=16777216,hr=null;function wt(Xe,jt){return Xe=_clamp(Math.floor(Xe),0,255),jt=_clamp(Math.floor(jt),0,255),256*Xe+jt}function $e(Xe){var jt=Xe.color,br=Xe.radius,sr=Xe.tileX,j=Xe.tileY,ie=Xe.shape,Re=Xe.opacity,ye=Xe.stroke,_t=Xe.strokeWidth,dt=Xe.strokeOpacity,zt=[],Bt=[],Ur=[],vn=[wt(jt[0],jt[1]),wt(jt[2],jt[3])],En=[wt(ye[0],ye[1]),wt(ye[2],ye[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(ea){var ar=_slicedToArray(ea,2),ge=ar[0],Te=ar[1];zt.push([].concat(vn,[(ge+1)*yr+(Te+1)*St+getShapeIndex(ie)*Qt+br,(sr+512)*rr+(j+512)*ue])),Bt.push([].concat(En,[_t,dt])),Ur.push([Re,0,0,0])}),{packedBuffer:zt,packedBuffer2:Bt,packedBuffer3:Ur}}function Ft(Xe,jt){if(Xe===0&&!jt)return 0;if(Xe===1&&jt)return 4294967295;var br=jt?1:0,sr=Math.floor(Xe*127);return sr*hr+br*q+sr*Qt+br*Cr+sr*K+br*Ne+sr*me+br}},65196:function(zr,N,S){"use strict";S.d(N,{zP:function(){return ey},JE:function(){return eg},ns:function(){return qg}});var ce=S(67294),E=(0,ce.createContext)({});function d(){return(0,ce.useContext)(E)}var me={},te={},ue=function(c){return te[c]},oe=function(c,a){te[c]=a},Ne=function(c){return me[c]},K=function(c,a){me[c]=a},Qe={},mt={},Zt=34,Cr=10,Qt=13;function Xt(n){return new Function("d","return {"+n.map(function(c,a){return JSON.stringify(c)+": d["+a+'] || ""'}).join(",")+"}")}function rr(n,c){var a=Xt(n);return function(s,l){return c(a(s),l,n)}}function Ut(n){var c=Object.create(null),a=[];return n.forEach(function(s){for(var l in s)l in c||a.push(c[l]=l)}),a}function St(n,c){var a=n+"",s=a.length;return s<c?new Array(c-s+1).join(0)+a:a}function Et(n){return n<0?"-"+St(-n,6):n>9999?"+"+St(n,6):St(n,4)}function yr(n){var c=n.getUTCHours(),a=n.getUTCMinutes(),s=n.getUTCSeconds(),l=n.getUTCMilliseconds();return isNaN(n)?"Invalid Date":Et(n.getUTCFullYear(),4)+"-"+St(n.getUTCMonth()+1,2)+"-"+St(n.getUTCDate(),2)+(l?"T"+St(c,2)+":"+St(a,2)+":"+St(s,2)+"."+St(l,3)+"Z":s?"T"+St(c,2)+":"+St(a,2)+":"+St(s,2)+"Z":a||c?"T"+St(c,2)+":"+St(a,2)+"Z":"")}function q(n){var c=new RegExp('["'+n+`
\r]`),a=n.charCodeAt(0);function s(G,pe){var De,rt,Tt=l(G,function(qt,_r){if(De)return De(qt,_r-1);rt=qt,De=pe?rr(qt,pe):Xt(qt)});return Tt.columns=rt||[],Tt}function l(G,pe){var De=[],rt=G.length,Tt=0,qt=0,_r,Hr=rt<=0,cn=!1;G.charCodeAt(rt-1)===Cr&&--rt,G.charCodeAt(rt-1)===Qt&&--rt;function _n(){if(Hr)return mt;if(cn)return cn=!1,Qe;var ti,ni=Tt,Si;if(G.charCodeAt(ni)===Zt){for(;Tt++<rt&&G.charCodeAt(Tt)!==Zt||G.charCodeAt(++Tt)===Zt;);return(ti=Tt)>=rt?Hr=!0:(Si=G.charCodeAt(Tt++))===Cr?cn=!0:Si===Qt&&(cn=!0,G.charCodeAt(Tt)===Cr&&++Tt),G.slice(ni+1,ti-1).replace(/""/g,'"')}for(;Tt<rt;){if((Si=G.charCodeAt(ti=Tt++))===Cr)cn=!0;else if(Si===Qt)cn=!0,G.charCodeAt(Tt)===Cr&&++Tt;else if(Si!==a)continue;return G.slice(ni,ti)}return Hr=!0,G.slice(ni,rt)}for(;(_r=_n())!==mt;){for(var Un=[];_r!==Qe&&_r!==mt;)Un.push(_r),_r=_n();pe&&(Un=pe(Un,qt++))==null||De.push(Un)}return De}function p(G,pe){return G.map(function(De){return pe.map(function(rt){return W(De[rt])}).join(n)})}function _(G,pe){return pe==null&&(pe=Ut(G)),[pe.map(W).join(n)].concat(p(G,pe)).join(`
`)}function C(G,pe){return pe==null&&(pe=Ut(G)),p(G,pe).join(`
`)}function M(G){return G.map(R).join(`
`)}function R(G){return G.map(W).join(n)}function W(G){return G==null?"":G instanceof Date?yr(G):c.test(G+="")?'"'+G.replace(/"/g,'""')+'"':G}return{parse:s,parseRows:l,format:_,formatBody:C,formatRows:M,formatRow:R,formatValue:W}}var hr=q(","),wt=hr.parse,$e=hr.parseRows,Ft=hr.format,Xe=hr.formatBody,jt=hr.formatRows,br=hr.formatRow,sr=hr.formatValue,j=S(96156),ie=S(85061),Re=S(38163),ye=S.n(Re);function _t(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function dt(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?_t(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):_t(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function zt(n,c){var a=c.x,s=c.y,l=c.x1,p=c.y1,_=c.coordinates,C=[];return n.forEach(function(M,R){var W=[];if(a&&s&&(W=[parseFloat(M[a]),parseFloat(M[s])]),a&&s&&l&&p){var G=[parseFloat(M[a]),parseFloat(M[s])],pe=[parseFloat(M[l]),parseFloat(M[p])];W=[G,pe]}if(_){var De="Polygon";Array.isArray(_[0])||(De="Point"),Array.isArray(_[0])&&!Array.isArray(_[0][0])&&(De="LineString");var rt={type:De,coordinates:(0,ie.Z)(M[_])};ye()(rt,!0),W=rt.coordinates}var Tt=dt(dt({},M),{},{_id:R,coordinates:W});C.push(Tt)}),{dataArray:C}}var Bt=[{lng1:100,lat1:30,lng2:130,lat2:30}],Ur={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function vn(n,c){var a=wt(n);return zt(a,c)}var En=S(40271);function ea(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ar(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ge(n){if(n.length>1&&isNumber(n[0])&&isNumber(n[1]))return!0;if(Array.isArray(n[0])&&n[0].length)return ge(n[0]);throw new Error("coordinates must only contain numbers")}function Te(n,c,a){if(!c||!a)throw new Error("type and name required");if(!n||n.type!==c)throw new Error("Invalid input to "+a+": must be a "+c+", given "+n.type)}function Ze(n,c,a){if(!n)throw new Error("No feature passed");if(!a)throw new Error(".featureOf() requires a name");if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+a+", Feature with geometry required");if(!n.geometry||n.geometry.type!==c)throw new Error("Invalid input to "+a+": must be a "+c+", given "+n.geometry.type)}function Oe(n,c,a){if(!n)throw new Error("No featureCollection passed");if(!a)throw new Error(".collectionOf() requires a name");if(!n||n.type!=="FeatureCollection")throw new Error("Invalid input to "+a+", FeatureCollection required");for(var s=0,l=n.features;s<l.length;s++){var p=l[s];if(!p||p.type!=="Feature"||!p.geometry)throw new Error("Invalid input to "+a+", Feature with geometry required");if(!p.geometry||p.geometry.type!==c)throw new Error("Invalid input to "+a+": must be a "+c+", given "+p.geometry.type)}}function Lt(n){return n.type==="Feature"?n.geometry:n}function nr(n,c){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function dr(n,c,a){if(n!==null)for(var s,l,p,_,C,M,R,W=0,G=0,pe,De=n.type,rt=De==="FeatureCollection",Tt=De==="Feature",qt=rt?n.features.length:1,_r=0;_r<qt;_r++){R=rt?n.features[_r].geometry:Tt?n.geometry:n,pe=R?R.type==="GeometryCollection":!1,C=pe?R.geometries.length:1;for(var Hr=0;Hr<C;Hr++){var cn=0,_n=0;if(_=pe?R.geometries[Hr]:R,_!==null){M=_.coordinates;var Un=_.type;switch(W=a&&(Un==="Polygon"||Un==="MultiPolygon")?1:0,Un){case null:break;case"Point":if(c(M,G,_r,cn,_n)===!1)return!1;G++,cn++;break;case"LineString":case"MultiPoint":for(s=0;s<M.length;s++){if(c(M[s],G,_r,cn,_n)===!1)return!1;G++,Un==="MultiPoint"&&cn++}Un==="LineString"&&cn++;break;case"Polygon":case"MultiLineString":for(s=0;s<M.length;s++){for(l=0;l<M[s].length-W;l++){if(c(M[s][l],G,_r,cn,_n)===!1)return!1;G++}Un==="MultiLineString"&&cn++,Un==="Polygon"&&_n++}Un==="Polygon"&&cn++;break;case"MultiPolygon":for(s=0;s<M.length;s++){for(_n=0,l=0;l<M[s].length;l++){for(p=0;p<M[s][l].length-W;p++){if(c(M[s][l][p],G,_r,cn,_n)===!1)return!1;G++}_n++}cn++}break;case"GeometryCollection":for(s=0;s<_.geometries.length;s++)if(dr(_.geometries[s],c,a)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Or(n,c,a,s){var l=a;return dr(n,function(p,_,C,M,R){_===0&&a===void 0?l=p:l=c(l,p,_,C,M,R)},s),l}function lr(n,c){var a;switch(n.type){case"FeatureCollection":for(a=0;a<n.features.length&&c(n.features[a].properties,a)!==!1;a++);break;case"Feature":c(n.properties,0);break}}function un(n,c,a){var s=a;return lr(n,function(l,p){p===0&&a===void 0?s=l:s=c(s,l,p)}),s}function w(n,c){if(n.type==="Feature")c(n,0);else if(n.type==="FeatureCollection")for(var a=0;a<n.features.length&&c(n.features[a],a)!==!1;a++);}function H(n,c,a){var s=a;return w(n,function(l,p){p===0&&a===void 0?s=l:s=c(s,l,p)}),s}function Ue(n){var c=[];return dr(n,function(a){c.push(a)}),c}function et(n,c){var a,s,l,p,_,C,M,R,W,G,pe=0,De=n.type==="FeatureCollection",rt=n.type==="Feature",Tt=De?n.features.length:1;for(a=0;a<Tt;a++){for(C=De?n.features[a].geometry:rt?n.geometry:n,R=De?n.features[a].properties:rt?n.properties:{},W=De?n.features[a].bbox:rt?n.bbox:void 0,G=De?n.features[a].id:rt?n.id:void 0,M=C?C.type==="GeometryCollection":!1,_=M?C.geometries.length:1,l=0;l<_;l++){if(p=M?C.geometries[l]:C,p===null){if(c(null,pe,R,W,G)===!1)return!1;continue}switch(p.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(c(p,pe,R,W,G)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<p.geometries.length;s++)if(c(p.geometries[s],pe,R,W,G)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}pe++}}function st(n,c,a){var s=a;return et(n,function(l,p,_,C,M){p===0&&a===void 0?s=l:s=c(s,l,p,_,C,M)}),s}function Ct(n,c){et(n,function(a,s,l,p,_){var C=a===null?null:a.type;switch(C){case null:case"Point":case"LineString":case"Polygon":return c((0,En.zL)(a,l,{bbox:p,id:_}),s,0)===!1?!1:void 0}var M;switch(C){case"MultiPoint":M="Point";break;case"MultiLineString":M="LineString";break;case"MultiPolygon":M="Polygon";break}for(var R=0;R<a.coordinates.length;R++){var W=a.coordinates[R],G={type:M,coordinates:W};if(c((0,En.zL)(G,l),s,R)===!1)return!1}})}function $(n,c,a){var s=a;return Ct(n,function(l,p,_){p===0&&_===0&&a===void 0?s=l:s=c(s,l,p,_)}),s}function Gt(n,c){Ct(n,function(a,s,l){var p=0;if(!!a.geometry){var _=a.geometry.type;if(!(_==="Point"||_==="MultiPoint")){var C,M=0,R=0,W=0;if(dr(a,function(G,pe,De,rt,Tt){if(C===void 0||s>M||rt>R||Tt>W){C=G,M=s,R=rt,W=Tt,p=0;return}var qt=lineString([C,G],a.properties);if(c(qt,s,l,Tt,p)===!1)return!1;p++,C=G})===!1)return!1}}})}function Tr(n,c,a){var s=a,l=!1;return Gt(n,function(p,_,C,M,R){l===!1&&a===void 0?s=p:s=c(s,p,_,C,M,R),l=!0}),s}function Ir(n,c){if(!n)throw new Error("geojson is required");Ct(n,function(a,s,l){if(a.geometry!==null){var p=a.geometry.type,_=a.geometry.coordinates;switch(p){case"LineString":if(c(a,s,l,0,0)===!1)return!1;break;case"Polygon":for(var C=0;C<_.length;C++)if(c(lineString(_[C],a.properties),s,l,C)===!1)return!1;break}}})}function Ye(n,c,a){var s=a;return Ir(n,function(l,p,_,C){p===0&&a===void 0?s=l:s=c(s,l,p,_,C)}),s}function ut(n,c){if(c=c||{},!isObject(c))throw new Error("options is invalid");var a=c.featureIndex||0,s=c.multiFeatureIndex||0,l=c.geometryIndex||0,p=c.segmentIndex||0,_=c.properties,C;switch(n.type){case"FeatureCollection":a<0&&(a=n.features.length+a),_=_||n.features[a].properties,C=n.features[a].geometry;break;case"Feature":_=_||n.properties,C=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":C=n;break;default:throw new Error("geojson is invalid")}if(C===null)return null;var M=C.coordinates;switch(C.type){case"Point":case"MultiPoint":return null;case"LineString":return p<0&&(p=M.length+p-1),lineString([M[p],M[p+1]],_,c);case"Polygon":return l<0&&(l=M.length+l),p<0&&(p=M[l].length+p-1),lineString([M[l][p],M[l][p+1]],_,c);case"MultiLineString":return s<0&&(s=M.length+s),p<0&&(p=M[s].length+p-1),lineString([M[s][p],M[s][p+1]],_,c);case"MultiPolygon":return s<0&&(s=M.length+s),l<0&&(l=M[s].length+l),p<0&&(p=M[s][l].length-p-1),lineString([M[s][l][p],M[s][l][p+1]],_,c)}throw new Error("geojson is invalid")}function At(n,c){if(c=c||{},!isObject(c))throw new Error("options is invalid");var a=c.featureIndex||0,s=c.multiFeatureIndex||0,l=c.geometryIndex||0,p=c.coordIndex||0,_=c.properties,C;switch(n.type){case"FeatureCollection":a<0&&(a=n.features.length+a),_=_||n.features[a].properties,C=n.features[a].geometry;break;case"Feature":_=_||n.properties,C=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":C=n;break;default:throw new Error("geojson is invalid")}if(C===null)return null;var M=C.coordinates;switch(C.type){case"Point":return point(M,_,c);case"MultiPoint":return s<0&&(s=M.length+s),point(M[s],_,c);case"LineString":return p<0&&(p=M.length+p),point(M[p],_,c);case"Polygon":return l<0&&(l=M.length+l),p<0&&(p=M[l].length+p),point(M[l][p],_,c);case"MultiLineString":return s<0&&(s=M.length+s),p<0&&(p=M[s].length+p),point(M[s][p],_,c);case"MultiPolygon":return s<0&&(s=M.length+s),l<0&&(l=M[s].length+l),p<0&&(p=M[s][l].length-p),point(M[s][l][p],_,c)}throw new Error("geojson is invalid")}function Rt(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function xr(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Rt(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Rt(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Ar(n,c){var a=[],s={};if(n.features=n.features.filter(function(p){var _=p.geometry;return p!=null&&_&&_.type&&_.coordinates&&_.coordinates.length>0}),ye()(n,!0),n.features.length===0)return{dataArray:[],featureKeys:s};var l=0;return Ct(n,function(p,_){var C=ar(p),M=_,R=xr(xr({},p.properties),{},{coordinates:C,_id:M});a.push(R)}),{dataArray:a,featureKeys:s}}var Ke=S(6901);function Xr(n,c){var a=c.extent,s=a===void 0?[121.168,30.2828,121.384,30.4219]:a,l=new Promise(function(_){Yr(n,function(C){_(C)})}),p={images:l,_id:1,dataArray:[{_id:0,coordinates:[[s[0],s[1]],[s[2],s[3]]]}]};return p}function Yr(n,c){var a=n,s=[];if(typeof a=="string")(0,Ke.gJ)({url:a},function(_,C){s.push(C),c(s)});else{var l=a.length,p=0;a.forEach(function(_){(0,Ke.gJ)({url:_},function(C,M){p++,s.push(M),p===l&&c(s)})})}return Xr}function wn(n,c){var a=c.extent,s=c.width,l=c.height,p=c.min,_=c.max,C={_id:1,dataArray:[{_id:1,data:Array.from(n),width:s,height:l,min:p,max:_,coordinates:[[a[0],a[1]],[a[2],a[3]]]}]};return C}var cr=S(6610),Mr=S(5991),gt=S(63349),Gn=S(10379),Mn=S(46070),kr=S(77608),Y=S(30236),le=S.n(Y),ve=S(47037),B=S.n(ve),ee=S(23560),de=S.n(ee),Ae=S(50361),ae=S.n(Ae),_e=S(46343),ct=S(26729),Sr=S(69848),Ht=S.n(Sr);function Jt(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Nr(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Jt(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Jt(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function zn(n,c){var a=c.radius,s=a===void 0?40:a,l=c.maxZoom,p=l===void 0?18:l,_=c.minZoom,C=_===void 0?0:_,M=c.zoom,R=M===void 0?2:M;if(n.pointIndex){var W=n.pointIndex.getClusters(n.extent,Math.floor(R));return n.dataArray=Nn(W),n}var G=new(Ht())({radius:s,minZoom:C,maxZoom:p}),pe={type:"FeatureCollection",features:[]};return pe.features=n.dataArray.map(function(De){return{type:"Feature",geometry:{type:"Point",coordinates:De.coordinates},properties:Nr({},De)}}),G.load(pe.features),G}function Nn(n){return n.map(function(c,a){return Nr({coordinates:c.geometry.coordinates,_id:a+1},c.properties)})}function Kt(n){if(n.length===0)throw new Error("max requires at least one data point");for(var c=n[0],a=1;a<n.length;a++)n[a]>c&&(c=n[a]);return c}function In(n){if(n.length===0)throw new Error("min requires at least one data point");for(var c=n[0],a=1;a<n.length;a++)n[a]<c&&(c=n[a]);return c}function hn(n){if(n.length===0)return 0;for(var c=n[0],a=0,s,l=1;l<n.length;l++)s=c+n[l]*1,Math.abs(c)>=Math.abs(n[l])?a+=c-s+n[l]:a+=n[l]-s+c,c=s;return c+a*1}function mn(n){if(n.length===0)throw new Error("mean requires at least one data point");return hn(n)/n.length}var Bi={min:In,max:Kt,mean:mn,sum:hn};function An(n,c){return n.map(function(a){return a[c]*1})}function Di(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function ra(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Di(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Di(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function hi(n){var c=na();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function na(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function Hi(n,c){if(Array.isArray(c))return c}var Oi=function(n){(0,Gn.Z)(a,n);var c=hi(a);function a(s,l){var p;return(0,cr.Z)(this,a),p=c.call(this),(0,j.Z)((0,gt.Z)(p),"data",void 0),(0,j.Z)((0,gt.Z)(p),"extent",void 0),(0,j.Z)((0,gt.Z)(p),"hooks",{init:new _e.ni}),(0,j.Z)((0,gt.Z)(p),"parser",{type:"geojson"}),(0,j.Z)((0,gt.Z)(p),"transforms",[]),(0,j.Z)((0,gt.Z)(p),"cluster",!1),(0,j.Z)((0,gt.Z)(p),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,j.Z)((0,gt.Z)(p),"mapService",void 0),(0,j.Z)((0,gt.Z)(p),"invalidExtent",!1),(0,j.Z)((0,gt.Z)(p),"originData",void 0),(0,j.Z)((0,gt.Z)(p),"rawData",void 0),(0,j.Z)((0,gt.Z)(p),"cfg",{}),(0,j.Z)((0,gt.Z)(p),"clusterIndex",void 0),p.originData=s,p.initCfg(l),p.hooks.init.tap("parser",function(){p.excuteParser()}),p.hooks.init.tap("cluster",function(){p.initCluster()}),p.hooks.init.tap("transform",function(){p.executeTrans()}),p.init(),p}return(0,Mr.Z)(a,[{key:"setData",value:function(l,p){this.rawData=l,this.originData=l,this.initCfg(p),this.init(),this.emit("update")}},{key:"getClusters",value:function(l){return this.clusterIndex.getClusters(this.caculClusterExtent(2),l)}},{key:"getClustersLeaves",value:function(l){return this.clusterIndex.getLeaves(l,Infinity)}},{key:"updateClusterData",value:function(l){var p=this,_=this.clusterOptions,C=_.method,M=C===void 0?"sum":C,R=_.field,W=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(l));this.clusterOptions.zoom=l,W.forEach(function(G){G.id||(G.properties.point_count=1)}),(R||de()(M))&&(W=W.map(function(G){var pe=G.id;if(pe){var De=p.clusterIndex.getLeaves(pe,Infinity),rt=De.map(function(_r){return _r.properties}),Tt;if(B()(M)&&R){var qt=An(rt,R);Tt=Bi[M](qt)}de()(M)&&(Tt=M(rt)),G.properties.stat=Tt}else G.properties.point_count=1;return G})),this.data=ue("geojson")({type:"FeatureCollection",features:W}),this.executeTrans()}},{key:"getFeatureById",value:function(l){var p=this.parser.type,_=p===void 0?"geojson":p;if(_==="geojson"&&!this.cluster){var C=l<this.originData.features.length?this.originData.features[l]:"null",M=ae()(C);if(this.transforms.length!==0){var R=this.data.dataArray.find(function(W){return W._id===l});M.properties=R}return M}else return l<this.data.dataArray.length?this.data.dataArray[l]:"null"}},{key:"getFeatureId",value:function(l,p){var _=this.data.dataArray.find(function(C){return C[l]===name});return _==null?void 0:_._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(l){var p=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(p=(0,Ke.yA)((0,Ke.ds)(this.extent),l)),p[0].concat(p[1])}},{key:"initCfg",value:function(l){this.cfg=le()(this.cfg,l,Hi);var p=this.cfg;p&&(p.parser&&(this.parser=p.parser),p.transforms&&(this.transforms=p.transforms),this.cluster=p.cluster||!1,p.clusterOptions&&(this.cluster=!0,this.clusterOptions=ra(ra({},this.clusterOptions),p.clusterOptions)))}},{key:"excuteParser",value:function(){var l=this.parser,p=l.type||"geojson";if(p==="imagetile"){this.data={tileurl:this.originData,dataArray:[]};return}var _=ue(p);this.data=_(this.originData,l),this.extent=(0,Ke.We)(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var l=this,p=this.transforms;p.forEach(function(_){var C=_.type,M=Ne(C)(l.data,_);Object.assign(l.data,M)})}},{key:"initCluster",value:function(){if(!!this.cluster){var l=this.clusterOptions||{};this.clusterIndex=zn(this.data,l)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),a}(ct.EventEmitter);function ga(n,c){var a=c.callback;return a&&(n.dataArray=n.dataArray.filter(a)),n}function Ra(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=Wi(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(R){throw R},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,_=!1,C;return{s:function(){a=a.call(n)},n:function(){var R=a.next();return p=R.done,R},e:function(R){_=!0,C=R},f:function(){try{!p&&a.return!=null&&a.return()}finally{if(_)throw C}}}}function Wi(n,c){if(!!n){if(typeof n=="string")return Ni(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ni(n,c)}}function Ni(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}var Xi=6378e3;function ro(n,c){var a=n.dataArray,s=c.size,l=s===void 0?10:s,p=l/(2*Math.PI*Xi)*(256<<20)/2,_=Qo(a,l),C=_.gridHash,M=_.gridOffset,R=Pu(C,M,c);return{yOffset:p,xOffset:p,radius:p,type:"grid",dataArray:R}}function Qo(n,c){var a=Infinity,s=-Infinity,l,p=Ra(n),_;try{for(p.s();!(_=p.n()).done;){var C=_.value;l=C.coordinates[1],Number.isFinite(l)&&(a=l<a?l:a,s=l>s?l:s)}}catch(cn){p.e(cn)}finally{p.f()}var M=(a+s)/2,R=za(c,M);if(R.xOffset<=0||R.yOffset<=0)return{gridHash:{},gridOffset:R};var W={},G=Ra(n),pe;try{for(G.s();!(pe=G.n()).done;){var De=pe.value,rt=De.coordinates[1],Tt=De.coordinates[0];if(Number.isFinite(rt)&&Number.isFinite(Tt)){var qt=Math.floor((rt+90)/R.yOffset),_r=Math.floor((Tt+180)/R.xOffset),Hr="".concat(qt,"-").concat(_r);W[Hr]=W[Hr]||{count:0,points:[]},W[Hr].count+=1,W[Hr].points.push(De)}}}catch(cn){G.e(cn)}finally{G.f()}return{gridHash:W,gridOffset:R}}function za(n,c){var a=$i(n),s=cu(c,n);return{yOffset:a,xOffset:s}}function $i(n){return n/Xi*(180/Math.PI)}function cu(n,c){return c/Xi*(180/Math.PI)/Math.cos(n*Math.PI/180)}function Pu(n,c,a){return Object.keys(n).reduce(function(s,l,p){var _=l.split("-"),C=parseInt(_[0],10),M=parseInt(_[1],10),R={};if(a.field&&a.method){var W=Ke.a5.getColumn(n[l].points,a.field);R[a.method]=Ke.a5.statMap[a.method](W)}return Object.assign(R,{_id:p,coordinates:(0,Ke.Z)([-180+c.xOffset*(M+.5),-90+c.yOffset*(C+.5)]),rawData:n[l].points,count:n[l].count}),s.push(R),s},[])}var Yi=S(28481),xo=Math.PI/3,Ki=[0,xo,2*xo,3*xo,4*xo,5*xo];function Xa(n){return n[0]}function qo(n){return n[1]}function xa(){var n=0,c=0,a=1,s=1,l=Xa,p=qo,_,C,M;function R(G){var pe={},De=[],rt,Tt=G.length;for(rt=0;rt<Tt;++rt)if(!(isNaN(_r=+l.call(null,qt=G[rt],rt,G))||isNaN(Hr=+p.call(null,qt,rt,G)))){var qt,_r,Hr,cn=Math.round(Hr=Hr/M),_n=Math.round(_r=_r/C-(cn&1)/2),Un=Hr-cn;if(Math.abs(Un)*3>1){var ti=_r-_n,ni=_n+(_r<_n?-1:1)/2,Si=cn+(Hr<cn?-1:1),qi=_r-ni,_a=Hr-Si;ti*ti+Un*Un>qi*qi+_a*_a&&(_n=ni+(cn&1?1:-1)/2,cn=Si)}var yi=_n+"-"+cn,Ta=pe[yi];Ta?Ta.push(qt):(De.push(Ta=pe[yi]=[qt]),Ta.x=(_n+(cn&1)/2)*C,Ta.y=cn*M)}return De}function W(G){var pe=0,De=0;return Ki.map(function(rt){var Tt=Math.sin(rt)*G,qt=-Math.cos(rt)*G,_r=Tt-pe,Hr=qt-De;return pe=Tt,De=qt,[_r,Hr]})}return R.hexagon=function(G){return"m"+W(G==null?_:+G).join("l")+"z"},R.centers=function(){for(var G=[],pe=Math.round(c/M),De=Math.round(n/C),rt=pe*M;rt<s+_;rt+=M,++pe)for(var Tt=De*C+(pe&1)*C/2;Tt<a+C/2;Tt+=C)G.push([Tt,rt]);return G},R.mesh=function(){var G=W(_).slice(0,4).join("l");return R.centers().map(function(pe){return"M"+pe+"m"+G}).join("")},R.x=function(G){return arguments.length?(l=G,R):l},R.y=function(G){return arguments.length?(p=G,R):p},R.radius=function(G){return arguments.length?(_=+G,C=_*2*Math.sin(xo),M=_*1.5,R):_},R.size=function(G){return arguments.length?(n=c=0,a=+G[0],s=+G[1],R):[a-n,s-c]},R.extent=function(G){return arguments.length?(n=+G[0][0],c=+G[0][1],a=+G[1][0],s=+G[1][1],R):[[n,c],[a,s]]},R.radius(1)}function Do(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function ko(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Do(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Do(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var Rs=6378e3;function vo(n,c){var a=n.dataArray,s=c.size,l=s===void 0?10:s,p=c.method,_=p===void 0?"sum":p,C=l/(2*Math.PI*Rs)*(256<<20)/2,M=a.map(function(pe){var De=(0,Ke.Z)(pe.coordinates),rt=(0,Yi.Z)(De,2),Tt=rt[0],qt=rt[1];return ko(ko({},pe),{},{coordinates:[Tt,qt]})}),R=xa().radius(C).x(function(pe){return pe.coordinates[0]}).y(function(pe){return pe.coordinates[1]}),W=R(M),G={dataArray:W.map(function(pe,De){var rt;if(c.field&&_){var Tt=Ke.a5.getColumn(pe,c.field);pe[_]=Ke.a5.statMap[_](Tt)}return rt={},(0,j.Z)(rt,c.method,pe[_]),(0,j.Z)(rt,"count",pe.length),(0,j.Z)(rt,"rawData",pe),(0,j.Z)(rt,"coordinates",[pe.x,pe.y]),(0,j.Z)(rt,"_id",De),rt}),radius:C,xOffset:C,yOffset:C,type:"hexagon"};return G}function Xo(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Da(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Xo(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Xo(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function co(n,c){var a=c.sourceField,s=c.targetField,l=c.data,p={};return l.forEach(function(_){p[_[a]]=_}),n.dataArray=n.dataArray.map(function(_){var C=_[s];return Da(Da({},_),p[C])}),n}function ss(n,c){var a=c.callback;return a&&(n.dataArray=n.dataArray.map(a)),n}var Fo=S(4771),Se=Oi;oe("geojson",Ar),oe("image",Xr),oe("csv",vn),oe("json",zt),oe("raster",wn),K("cluster",zn),K("filter",ga),K("join",co),K("map",ss),K("grid",ro),K("hexagon",vo);var ke=Bt,ft=Ur,L=S(58881);function Qr(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function ai(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Qr(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Qr(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function wi(n){var c=fo();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function fo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ya=0,ja=function(n){(0,Gn.Z)(a,n);var c=wi(a);function a(s){var l;return(0,cr.Z)(this,a),l=c.call(this),(0,j.Z)((0,gt.Z)(l),"controlOption",void 0),(0,j.Z)((0,gt.Z)(l),"container",void 0),(0,j.Z)((0,gt.Z)(l),"sceneContainer",void 0),(0,j.Z)((0,gt.Z)(l),"mapsService",void 0),(0,j.Z)((0,gt.Z)(l),"renderService",void 0),(0,j.Z)((0,gt.Z)(l),"layerService",void 0),(0,j.Z)((0,gt.Z)(l),"controlService",void 0),(0,j.Z)((0,gt.Z)(l),"isShow",void 0),l.controlOption=ai(ai({},l.getDefault()),s||{}),l}return(0,Mr.Z)(a,[{key:"getDefault",value:function(){return{position:L.PositionType.TOPRIGHT,name:"".concat(Ya++)}}},{key:"setPosition",value:function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:L.PositionType.BOTTOMRIGHT,p=this.controlService;return p&&p.removeControl(this),this.controlOption.position=l,p&&p.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(l){this.mapsService=l.get(L.vK.IMapService),this.renderService=l.get(L.vK.IRendererService),this.layerService=l.get(L.vK.ILayerService),this.controlService=l.get(L.vK.IControlService),this.sceneContainer=l,this.isShow=!0,this.container=this.onAdd();var p=this.container,_=this.controlOption.position,C=this.controlService.controlCorners[_];return Ke.SO.addClass(p,"l7-control"),_.indexOf("bottom")!==-1?C.insertBefore(p,C.firstChild):C.appendChild(p),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var l=this.container;Ke.SO.addClass(l,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var l=this.container;Ke.SO.removeClass(l,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;Ke.SO.remove(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(l){if(this.mapsService&&l&&l.screenX>0&&l.screenY>0){var p=this.mapsService.getContainer();p!==null&&p.focus()}}}]),a}(ct.EventEmitter);function us(n){var c=fu();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function fu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Mu=function(n){(0,Gn.Z)(a,n);var c=us(a);function a(s){var l;return(0,cr.Z)(this,a),l=c.call(this,s),(0,j.Z)((0,gt.Z)(l),"layerControlInputs",void 0),(0,j.Z)((0,gt.Z)(l),"layers",void 0),(0,j.Z)((0,gt.Z)(l),"lastZIndex",void 0),(0,j.Z)((0,gt.Z)(l),"handlingClick",void 0),(0,j.Z)((0,gt.Z)(l),"layersLink",void 0),(0,j.Z)((0,gt.Z)(l),"baseLayersList",void 0),(0,j.Z)((0,gt.Z)(l),"separator",void 0),(0,j.Z)((0,gt.Z)(l),"overlaysList",void 0),(0,j.Z)((0,gt.Z)(l),"form",void 0),l.layerControlInputs=[],l.layers=[],l.lastZIndex=0,l.handlingClick=!1,l.initLayers(),(0,Ke.Ev)(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,gt.Z)(l)),l}return(0,Mr.Z)(a,[{key:"getDefault",value:function(){return{collapsed:!0,position:L.PositionType.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var l=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(p){p.layer.on("remove",l.onLayerChange),p.layer.on("add",l.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(l,p){return this.addLayer(l,p,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var l=this.renderService.getViewportSize(),p=l.height;Ke.SO.addClass(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var _=p-(this.container.offsetTop+50);return _<this.form.clientHeight?(Ke.SO.addClass(this.form,"l7-control-layers-scrollbar"),this.form.style.height=_+"px"):Ke.SO.removeClass(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return Ke.SO.removeClass(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var l=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(p){p.layer.off("remove",l.onLayerChange),p.layer.off("add",l.onLayerChange)}))}},{key:"initLayout",value:function(){var l="l7-control-layers",p=this.container=Ke.SO.create("div",l),_=this.controlOption.collapsed;p.setAttribute("aria-haspopup","true");var C=this.form=Ke.SO.create("form",l+"-list");_&&(this.mapsService.on("click",this.collapse),p.addEventListener("mouseenter",this.expand),p.addEventListener("mouseleave",this.collapse)),this.layersLink=Ke.SO.create("a",l+"-toggle",p);var M=this.layersLink;M.title="Layers",_||this.expand(),this.baseLayersList=Ke.SO.create("div",l+"-base",C),this.separator=Ke.SO.create("div",l+"-separator",C),this.overlaysList=Ke.SO.create("div",l+"-overlays",C),p.appendChild(C)}},{key:"initLayers",value:function(){var l=this,p=this.controlOption,_=p.baseLayers,C=_===void 0?{}:_,M=p.overlayers,R=M===void 0?{}:M;Object.keys(C).forEach(function(W,G){l.addLayer(C[W],W,!1)}),Object.keys(R).forEach(function(W,G){l.addLayer(R[W],W,!0)})}},{key:"update",value:function(){if(!this.container)return this;Ke.SO.empty(this.baseLayersList),Ke.SO.empty(this.overlaysList),this.layerControlInputs=[];var l,p,_,C,M=0;for(_=0;_<this.layers.length;_++)C=this.layers[_],this.addItem(C),p=p||C.overlay,l=l||!C.overlay,M+=C.overlay?0:1;return this.controlOption.hideSingleBase&&(l=l&&M>1,this.baseLayersList.style.display=l?"":"none"),this.separator.style.display=p&&l?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var l=this.layerControlInputs,p,_,C=this.mapsService.getZoom(),M=l.length-1;M>=0;M--)if(p=l[M],_=this.layerService.getLayer(p.layerId),_&&_.inited){var R=_.getMinZoom(),W=_.getMaxZoom();p.disabled=C<R||C>W}}},{key:"addLayer",value:function(l,p,_){this.mapsService&&(l.on("add",this.onLayerChange),l.on("remove",this.onLayerChange)),this.layers.push({layer:l,name:p,overlay:_});var C=this.controlOption,M=C.sortLayers,R=C.sortFunction,W=C.autoZIndex;M&&this.layers.sort(function(G,pe){return R(G.layer,pe.layer,G.name,pe.name)}),W&&l.setZIndex&&(this.lastZIndex++,l.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(l){this.handlingClick||this.update();var p=this.layerService.getLayer(l.target.layerId),_=p!=null&&p.overlay?l.type==="add"?"overlayadd":"overlayremove":l.type==="add"?"baselayerchange":null;_&&this.emit(_,p)}},{key:"createRadioElement",value:function(l,p){var _='<input type="radio" class="l7-control-layers-selector" name="'+l+'"'+(p?' checked="checked"':"")+"/>",C=document.createElement("div");return C.innerHTML=_,C.firstChild}},{key:"addItem",value:function(l){var p=document.createElement("label"),_=this.layerService.getLayer(l.layer.id),C=_&&_.inited&&l.layer.isVisible(),M;l.overlay?(M=document.createElement("input"),M.type="checkbox",M.className="l7-control-layers-selector",M.defaultChecked=C):M=this.createRadioElement("l7-base-layers",C),this.layerControlInputs.push(M),M.layerId=l.layer.id,M.addEventListener("click",this.onInputClick);var R=document.createElement("span");R.innerHTML=" "+l.name;var W=document.createElement("div");p.appendChild(W),W.appendChild(M),W.appendChild(R);var G=l.overlay?this.overlaysList:this.baseLayersList;return G.appendChild(p),this.checkDisabledLayers(),p}},{key:"onInputClick",value:function(){var l=this.layerControlInputs,p,_,C=[],M=[];this.handlingClick=!0;for(var R=l.length-1;R>=0;R--)p=l[R],_=this.layerService.getLayer(p.layerId),p.checked?C.push(_):p.checked||M.push(_);M.forEach(function(W){W.hide()}),C.forEach(function(W){W.show()}),this.handlingClick=!1}}]),a}(ja);function Yu(n){var c=es();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function es(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ts=function(n){(0,Gn.Z)(a,n);var c=Yu(a);function a(){return(0,cr.Z)(this,a),c.apply(this,arguments)}return(0,Mr.Z)(a,[{key:"getDefault",value:function(){return{position:L.PositionType.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var l="l7-control-logo",p=Ke.SO.create("div",l),_=Ke.SO.create("a","l7-ctrl-logo");return _.target="_blank",_.rel="noopener nofollow",_.href="https://antv.alipay.com/l7",_.setAttribute("aria-label","AntV logo"),_.setAttribute("rel","noopener nofollow"),p.appendChild(_),p}},{key:"onRemove",value:function(){return null}}]),a}(ja);function ls(n){var c=ws();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function ws(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var cs=function(n){(0,Gn.Z)(a,n);var c=ls(a);function a(s){var l;return(0,cr.Z)(this,a),l=c.call(this,s),(0,j.Z)((0,gt.Z)(l),"mScale",void 0),(0,j.Z)((0,gt.Z)(l),"iScale",void 0),(0,Ke.Ev)(["update"],(0,gt.Z)(l)),l}return(0,Mr.Z)(a,[{key:"getDefault",value:function(){return{position:L.PositionType.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var l="l7-control-scale",p=Ke.SO.create("div",l);this.addScales(l+"-line",p);var _=this.controlOption.updateWhenIdle;return this.mapsService.on(_?"moveend":"mapmove",this.update),this.mapsService.on(_?"zoomend":"zoomchange",this.update),this.update(),p}},{key:"onRemove",value:function(){var l=this.controlOption.updateWhenIdle;this.mapsService.off(l?"zoomend":"zoomchange",this.update),this.mapsService.off(l?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var l=this.mapsService,p=this.controlOption.maxWidth,_=l.getSize()[1]/2,C=l.containerToLngLat([0,_]),M=l.containerToLngLat([p,_]),R=(0,Ke.yM)([C.lng,C.lat],[M.lng,M.lat]);this.updateScales(R)}},{key:"updateScales",value:function(l){var p=this.controlOption,_=p.metric,C=p.imperial;_&&l&&this.updateMetric(l),C&&l&&this.updateImperial(l)}},{key:"updateMetric",value:function(l){var p=this.getRoundNum(l),_=p<1e3?p+" m":p/1e3+" km";this.updateScale(this.mScale,_,p/l)}},{key:"updateImperial",value:function(l){var p=l*3.2808399,_,C,M;p>5280?(_=p/5280,C=this.getRoundNum(_),this.updateScale(this.iScale,C+" mi",C/_)):(M=this.getRoundNum(p),this.updateScale(this.iScale,M+" ft",M/p))}},{key:"updateScale",value:function(l,p,_){var C=this.controlOption.maxWidth;l.style.width=Math.round(C*_)+"px",l.innerHTML=p}},{key:"getRoundNum",value:function(l){var p=Math.pow(10,(Math.floor(l)+"").length-1),_=l/p;return _=_>=10?10:_>=5?5:_>=3?3:_>=2?2:1,p*_}},{key:"addScales",value:function(l,p){var _=this.controlOption,C=_.metric,M=_.imperial;C&&(this.mScale=Ke.SO.create("div",l,p)),M&&(this.iScale=Ke.SO.create("div",l,p))}}]),a}(ja);function Us(n){var c=$s();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function $s(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var As=function(n){(0,Gn.Z)(a,n);var c=Us(a);function a(s){var l;return(0,cr.Z)(this,a),l=c.call(this,s),(0,j.Z)((0,gt.Z)(l),"disabled",void 0),(0,j.Z)((0,gt.Z)(l),"zoomInButton",void 0),(0,j.Z)((0,gt.Z)(l),"zoomOutButton",void 0),(0,Ke.Ev)(["updateDisabled","zoomIn","zoomOut"],(0,gt.Z)(l)),l}return(0,Mr.Z)(a,[{key:"getDefault",value:function(){return{position:L.PositionType.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var l="l7-control-zoom",p=Ke.SO.create("div",l+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,l+"-in",p,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,l+"-out",p,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),p}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(l,p,_,C,M){var R=Ke.SO.create("a",_,C);return R.innerHTML=l,R.title=p,R.href="javascript:void(0)",R.addEventListener("click",M),R}},{key:"updateDisabled",value:function(){var l=this.mapsService,p="l7-disabled";Ke.SO.removeClass(this.zoomInButton,p),Ke.SO.removeClass(this.zoomOutButton,p),(this.disabled||l.getZoom()<=l.getMinZoom())&&Ke.SO.addClass(this.zoomOutButton,p),(this.disabled||l.getZoom()>=l.getMaxZoom())&&Ke.SO.addClass(this.zoomInButton,p)}}]),a}(ja);function Ea(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Co(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Ea(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Ea(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function dl(n){var c=vl();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function vl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ku=function(n){(0,Gn.Z)(a,n);var c=dl(a);function a(s){var l;return(0,cr.Z)(this,a),l=c.call(this),(0,j.Z)((0,gt.Z)(l),"markerOption",void 0),(0,j.Z)((0,gt.Z)(l),"defaultMarker",void 0),(0,j.Z)((0,gt.Z)(l),"popup",void 0),(0,j.Z)((0,gt.Z)(l),"mapsService",void 0),(0,j.Z)((0,gt.Z)(l),"sceneSerive",void 0),(0,j.Z)((0,gt.Z)(l),"lngLat",void 0),(0,j.Z)((0,gt.Z)(l),"scene",void 0),(0,j.Z)((0,gt.Z)(l),"added",!1),(0,j.Z)((0,gt.Z)(l),"eventHandle",function(p){l.emit(p.type,{target:p,data:l.markerOption.extData,lngLat:l.lngLat})}),l.markerOption=Co(Co({},l.getDefault()),s),(0,Ke.Ev)(["update","onMove","onUp","addDragHandler","onMapClick"],(0,gt.Z)(l)),l.init(),l}return(0,Mr.Z)(a,[{key:"getDefault",value:function(){return{element:void 0,anchor:Ke.bV.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(l){this.scene=l,this.mapsService=l.get(L.vK.IMapService),this.sceneSerive=l.get(L.vK.ISceneService);var p=this.markerOption,_=p.element,C=p.draggable;return this.mapsService.getMarkerContainer().appendChild(_),this.registerMarkerEvent(_),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var l=this.markerOption.element;return l&&Ke.SO.remove(l),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(l){var p=this;if(!this.added)return this.once("added",function(){p.setElement(l)}),this;var _=this.markerOption.element;return _&&Ke.SO.remove(_),this.markerOption.element=l,this.init(),this.mapsService.getMarkerContainer().appendChild(l),this.registerMarkerEvent(l),this.update(),this}},{key:"openPopup",value:function(){var l=this;if(!this.added)return this.once("added",function(){l.openPopup()}),this;var p=this.popup;return p?(p.isOpen()||p.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var l=this;this.added||this.once("added",function(){l.closePopup()});var p=this.popup;return p&&p.remove(),this}},{key:"setPopup",value:function(l){return this.popup=l,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var l=this.popup;if(l)l.isOpen()?l.remove():l.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(l){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(l){this.markerOption.extData=l}},{key:"update",value:function(){if(!!this.mapsService){var l=this.markerOption,p=l.element,_=l.anchor;this.updatePosition(),Ke.SO.setTransform(p,"".concat(Ke.rQ[_]))}}},{key:"onMapClick",value:function(l){var p=this.markerOption.element;this.popup&&p&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.markerOption,p=l.element,_=l.offsets,C=this.lngLat,M=C.lng,R=C.lat,W=this.mapsService.getBounds(),G=this.mapsService.lngLatToContainer([M,R]);if(p){p.style.display="block";var pe=this.mapsService.getContainer(),De=0,rt=0;if(pe&&(De=pe.scrollWidth,rt=pe.scrollHeight),Math.abs(W[0][0])>180||Math.abs(W[1][0])>180){if(G.x>De){var Tt=this.mapsService.lngLatToContainer([M-360,R]);G.x=Tt.x}if(G.x<0){var qt=this.mapsService.lngLatToContainer([M+360,R]);G.x=qt.x}}(G.x>De||G.x<0||G.y>rt||G.y<0)&&(p.style.display="none"),p.style.left=G.x+_[0]+"px",p.style.top=G.y-_[1]+"px"}}}},{key:"init",value:function(){var l=this,p=this.markerOption.element,_=this.markerOption,C=_.color,M=_.anchor;if(!p){this.defaultMarker=!0,p=Ke.SO.create("div"),this.markerOption.element=p;var R=document.createElementNS("http://www.w3.org/2000/svg","svg");R.setAttributeNS(null,"display","block"),R.setAttributeNS(null,"height","48px"),R.setAttributeNS(null,"width","48px"),R.setAttributeNS(null,"viewBox","0 0 1024 1024");var W=document.createElementNS("http://www.w3.org/2000/svg","path");W.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),W.setAttributeNS(null,"fill",C),R.appendChild(W),p.appendChild(R)}Ke.SO.addClass(p,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(G){var pe,De,rt=((pe=l.markerOption)===null||pe===void 0?void 0:pe.style)&&((De=l.markerOption)===null||De===void 0?void 0:De.style[G]);p&&(p.style[G]=rt)}),p.addEventListener("click",function(G){l.onMapClick(G)}),p.addEventListener("click",this.eventHandle),(0,Ke.zi)(p,M,"marker")}},{key:"registerMarkerEvent",value:function(l){l.addEventListener("mousemove",this.eventHandle),l.addEventListener("click",this.eventHandle),l.addEventListener("mousedown",this.eventHandle),l.addEventListener("mouseup",this.eventHandle),l.addEventListener("dblclick",this.eventHandle),l.addEventListener("contextmenu",this.eventHandle),l.addEventListener("mouseover",this.eventHandle),l.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var l=this.getElement();l.removeEventListener("mousemove",this.eventHandle),l.removeEventListener("click",this.eventHandle),l.removeEventListener("mousedown",this.eventHandle),l.removeEventListener("mouseup",this.eventHandle),l.removeEventListener("dblclick",this.eventHandle),l.removeEventListener("contextmenu",this.eventHandle),l.removeEventListener("mouseover",this.eventHandle),l.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(l){throw new Error("Method not implemented.")}},{key:"onUp",value:function(l){throw new Error("Method not implemented.")}}]),a}(ct.EventEmitter),Xl=S(82492),ml=S.n(Xl);function Du(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Zs(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Du(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Du(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function gl(n){var c=m();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function m(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var A=function(n){(0,Gn.Z)(a,n);var c=gl(a);function a(s){var l,p;return(0,cr.Z)(this,a),p=c.call(this),(0,j.Z)((0,gt.Z)(p),"markers",[]),(0,j.Z)((0,gt.Z)(p),"markerLayerOption",void 0),(0,j.Z)((0,gt.Z)(p),"clusterIndex",void 0),(0,j.Z)((0,gt.Z)(p),"points",[]),(0,j.Z)((0,gt.Z)(p),"clusterMarkers",[]),(0,j.Z)((0,gt.Z)(p),"mapsService",void 0),(0,j.Z)((0,gt.Z)(p),"scene",void 0),(0,j.Z)((0,gt.Z)(p),"zoom",void 0),(0,j.Z)((0,gt.Z)(p),"bbox",void 0),p.markerLayerOption=ml()(p.getDefault(),s),(0,Ke.Ev)(["update"],(0,gt.Z)(p)),p.zoom=((l=p.markerLayerOption.clusterOption)===null||l===void 0?void 0:l.zoom)||-99,p}return(0,Mr.Z)(a,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(l){return this.scene=l,this.mapsService=l.get(L.vK.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(l){var p=this.markerLayerOption.cluster;p&&this.addPoint(l,this.markers.length),this.markers.push(l)}},{key:"removeMarker",value:function(l){this.markers.indexOf(l);var p=this.markers.indexOf(l);p>-1&&this.markers.splice(p,1)}},{key:"hide",value:function(){this.markers.map(function(l){l.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(l){l.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var l=this.markerLayerOption.cluster;return l?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var l=this;this.getMarkers().forEach(function(p){p.addTo(l.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(l){l.remove()}),this.clusterMarkers.forEach(function(l){l.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(l,p){var _=l.getLnglat(),C=_.lng,M=_.lat,R={geometry:{type:"Point",coordinates:[C,M]},properties:Zs(Zs({},l.getExtData()),{},{marker_id:p})};this.points.push(R)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var l=this.markerLayerOption.clusterOption,p=l.radius,_=l.minZoom,C=_===void 0?0:_,M=l.maxZoom;this.clusterIndex=new(Ht())({radius:p,minZoom:C,maxZoom:M}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(l,p){var _=this,C=l[0].concat(l[1]),M=this.clusterIndex.getClusters(C,p);this.clusterMarkers.forEach(function(R){R.remove()}),this.clusterMarkers=[],M.forEach(function(R){var W,G=_.markerLayerOption.clusterOption,pe=G.field,De=G.method;if(R.properties&&(W=R.properties)!==null&&W!==void 0&&W.cluster_id){var rt,Tt=_.getLeaves((rt=R.properties)===null||rt===void 0?void 0:rt.cluster_id);if(R.properties.clusterData=Tt,pe&&De){var qt=Tt==null?void 0:Tt.map(function(Un){var ti=(0,j.Z)({},pe,Un.properties[pe]);return ti}),_r=Ke.a5.getColumn(qt,pe),Hr=Ke.a5.getSatByColumn(De,_r),cn="point_"+De;R.properties[cn]=Hr.toFixed(2)}}var _n=_.clusterMarker(R);_.clusterMarkers.push(_n),_n.addTo(_.scene)})}},{key:"getLeaves",value:function(l){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return l?this.clusterIndex.getLeaves(l,p,_):null}},{key:"clusterMarker",value:function(l){var p=this.markerLayerOption.clusterOption,_=p,C=_.element,M=C===void 0?this.generateElement.bind(this):C,R=new Ku({element:M(l)}).setLnglat({lng:l.geometry.coordinates[0],lat:l.geometry.coordinates[1]});return R}},{key:"normalMarker",value:function(l){var p=l.properties.marker_id;return this.markers[p]}},{key:"update",value:function(){var l=this.mapsService.getZoom(),p=this.mapsService.getBounds();(!this.bbox||Math.abs(l-this.zoom)>=1||!(0,Ke.oO)(this.bbox,p))&&(this.bbox=(0,Ke.yA)(p,.5),this.zoom=Math.floor(l),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(l){var p=Ke.SO.create("div","l7-marker-cluster"),_=Ke.SO.create("div","",p),C=Ke.SO.create("span","",_),M=this.markerLayerOption.clusterOption,R=M.field,W=M.method;l.properties.point_count=l.properties.point_count||1;var G=R&&W?l.properties["point_"+W]||l.properties[R]:l.properties.point_count;return C.textContent=G,p}}]),a}(ct.EventEmitter);function z(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function I(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?z(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):z(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function fe(n){var c=Ie();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function Ie(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var lt=function(n){(0,Gn.Z)(a,n);var c=fe(a);function a(s){var l;return(0,cr.Z)(this,a),l=c.call(this),(0,j.Z)((0,gt.Z)(l),"popupOption",void 0),(0,j.Z)((0,gt.Z)(l),"mapsService",void 0),(0,j.Z)((0,gt.Z)(l),"sceneSerive",void 0),(0,j.Z)((0,gt.Z)(l),"lngLat",void 0),(0,j.Z)((0,gt.Z)(l),"content",void 0),(0,j.Z)((0,gt.Z)(l),"closeButton",void 0),(0,j.Z)((0,gt.Z)(l),"timeoutInstance",void 0),(0,j.Z)((0,gt.Z)(l),"container",void 0),(0,j.Z)((0,gt.Z)(l),"tip",void 0),(0,j.Z)((0,gt.Z)(l),"scene",void 0),l.popupOption=I(I({},l.getdefault()),s),(0,Ke.Ev)(["update","onClickClose","remove"],(0,gt.Z)(l)),l}return(0,Mr.Z)(a,[{key:"addTo",value:function(l){var p=this;return this.mapsService=l.get(L.vK.IMapService),this.sceneSerive=l.get(L.vK.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=l,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){p.mapsService.on("click",p.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(l){var p=window.document.createDocumentFragment(),_=window.document.createElement("body"),C;for(_.innerHTML=l;C=_.firstChild,!!C;)p.appendChild(C);return this.setDOMContent(p)}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(l){return this.setDOMContent(window.document.createTextNode(l))}},{key:"setMaxWidth",value:function(l){return this.popupOption.maxWidth=l,this.update(),this}},{key:"setDOMContent",value:function(l){return this.createContent(),this.content.appendChild(l),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&Ke.SO.remove(this.content),this.content=Ke.SO.create("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Ke.SO.create("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(l,p,_){var C=window.document.createElement(l);return p!==void 0&&(C.className=p),_&&_.appendChild(C),C}},{key:"removeDom",value:function(l){l.parentNode&&l.parentNode.removeChild(l)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Ke.bV.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(l){l.stopPropagation&&l.stopPropagation(),this.remove()}},{key:"update",value:function(){var l=this,p=this.lngLat,_=this.popupOption,C=_.className,M=_.maxWidth,R=_.anchor;if(!(!this.mapsService||!p||!this.content)){var W=this.mapsService.getMarkerContainer();if(!this.container&&W){this.container=this.creatDom("div","l7-popup",W),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),C&&C.split(" ").forEach(function(pe){return l.container.classList.add(pe)});var G=this.popupOption.stopPropagation;G&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(pe){l.container.addEventListener(pe,function(De){De.stopPropagation()})})}M&&this.container.style.maxWidth!==M&&(this.container.style.maxWidth=M),this.updatePosition(),Ke.SO.setTransform(this.container,"".concat(Ke.rQ[R])),(0,Ke.zi)(this.container,R,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.lngLat,p=l.lng,_=l.lat,C=this.popupOption.offsets,M=this.mapsService.lngLatToContainer([p,_]);this.container.style.left=M.x+C[0]+"px",this.container.style.top=M.y-C[1]+"px"}}}]),a}(ct.EventEmitter);function Dt(n,c){var a=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",s=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(a||s)&&(c||(c=document),!!c)){var l=c.head||c.getElementsByTagName("head")[0];if(!l){l=c.createElement("head");var p=c.body||c.getElementsByTagName("body")[0];p?p.parentNode.insertBefore(l,p):c.documentElement.appendChild(l)}var _=c.createElement("style");return _.type="text/css",_.styleSheet?_.styleSheet.cssText=n:_.appendChild(c.createTextNode(n)),l.appendChild(_),_}}Dt(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(255, 255, 255, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var Nt=S(92137),Dr=S(87757),Wr=S.n(Dr),ln=S(86700),Li=S(88307),Ei=S.n(Li),ha=S(28660),Pa=function(){function n(c,a){(0,cr.Z)(this,n),(0,j.Z)(this,"attribute",void 0),(0,j.Z)(this,"buffer",void 0);var s=a.buffer,l=a.offset,p=a.stride,_=a.normalized,C=a.size,M=a.divisor;this.buffer=s,this.attribute={buffer:s.get(),offset:l||0,stride:p||0,normalized:_||!1,divisor:M||0},C&&(this.attribute.size=C)}return(0,Mr.Z)(n,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(a){this.buffer.subData(a)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),n}(),ya,_i,mo,wo,Js,hu,Qs,ku,Yo,ms,no,Ma,qs,yl,gs=(ya={},(0,j.Z)(ya,L.gl.POINTS,"points"),(0,j.Z)(ya,L.gl.LINES,"lines"),(0,j.Z)(ya,L.gl.LINE_LOOP,"line loop"),(0,j.Z)(ya,L.gl.LINE_STRIP,"line strip"),(0,j.Z)(ya,L.gl.TRIANGLES,"triangles"),(0,j.Z)(ya,L.gl.TRIANGLE_FAN,"triangle fan"),(0,j.Z)(ya,L.gl.TRIANGLE_STRIP,"triangle strip"),ya),Ol=(_i={},(0,j.Z)(_i,L.gl.STATIC_DRAW,"static"),(0,j.Z)(_i,L.gl.DYNAMIC_DRAW,"dynamic"),(0,j.Z)(_i,L.gl.STREAM_DRAW,"stream"),_i),eu=(mo={},(0,j.Z)(mo,L.gl.BYTE,"int8"),(0,j.Z)(mo,L.gl.UNSIGNED_INT,"int16"),(0,j.Z)(mo,L.gl.INT,"int32"),(0,j.Z)(mo,L.gl.UNSIGNED_BYTE,"uint8"),(0,j.Z)(mo,L.gl.UNSIGNED_SHORT,"uint16"),(0,j.Z)(mo,L.gl.UNSIGNED_INT,"uint32"),(0,j.Z)(mo,L.gl.FLOAT,"float"),mo),tu=(wo={},(0,j.Z)(wo,L.gl.ALPHA,"alpha"),(0,j.Z)(wo,L.gl.LUMINANCE,"luminance"),(0,j.Z)(wo,L.gl.LUMINANCE_ALPHA,"luminance alpha"),(0,j.Z)(wo,L.gl.RGB,"rgb"),(0,j.Z)(wo,L.gl.RGBA,"rgba"),(0,j.Z)(wo,L.gl.RGBA4,"rgba4"),(0,j.Z)(wo,L.gl.RGB5_A1,"rgb5 a1"),(0,j.Z)(wo,L.gl.RGB565,"rgb565"),(0,j.Z)(wo,L.gl.DEPTH_COMPONENT,"depth"),(0,j.Z)(wo,L.gl.DEPTH_STENCIL,"depth stencil"),wo),mc=(Js={},(0,j.Z)(Js,L.gl.DONT_CARE,"dont care"),(0,j.Z)(Js,L.gl.NICEST,"nice"),(0,j.Z)(Js,L.gl.FASTEST,"fast"),Js),Fu=(hu={},(0,j.Z)(hu,L.gl.NEAREST,"nearest"),(0,j.Z)(hu,L.gl.LINEAR,"linear"),(0,j.Z)(hu,L.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,j.Z)(hu,L.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,j.Z)(hu,L.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,j.Z)(hu,L.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),hu),Ia=(Qs={},(0,j.Z)(Qs,L.gl.REPEAT,"repeat"),(0,j.Z)(Qs,L.gl.CLAMP_TO_EDGE,"clamp"),(0,j.Z)(Qs,L.gl.MIRRORED_REPEAT,"mirror"),Qs),_l=(ku={},(0,j.Z)(ku,L.gl.NONE,"none"),(0,j.Z)(ku,L.gl.BROWSER_DEFAULT_WEBGL,"browser"),ku),$c=(Yo={},(0,j.Z)(Yo,L.gl.NEVER,"never"),(0,j.Z)(Yo,L.gl.ALWAYS,"always"),(0,j.Z)(Yo,L.gl.LESS,"less"),(0,j.Z)(Yo,L.gl.LEQUAL,"lequal"),(0,j.Z)(Yo,L.gl.GREATER,"greater"),(0,j.Z)(Yo,L.gl.GEQUAL,"gequal"),(0,j.Z)(Yo,L.gl.EQUAL,"equal"),(0,j.Z)(Yo,L.gl.NOTEQUAL,"notequal"),Yo),Bu=(ms={},(0,j.Z)(ms,L.gl.FUNC_ADD,"add"),(0,j.Z)(ms,L.gl.MIN_EXT,"min"),(0,j.Z)(ms,L.gl.MAX_EXT,"max"),(0,j.Z)(ms,L.gl.FUNC_SUBTRACT,"subtract"),(0,j.Z)(ms,L.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),ms),xl=(no={},(0,j.Z)(no,L.gl.ZERO,"zero"),(0,j.Z)(no,L.gl.ONE,"one"),(0,j.Z)(no,L.gl.SRC_COLOR,"src color"),(0,j.Z)(no,L.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,j.Z)(no,L.gl.SRC_ALPHA,"src alpha"),(0,j.Z)(no,L.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,j.Z)(no,L.gl.DST_COLOR,"dst color"),(0,j.Z)(no,L.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,j.Z)(no,L.gl.DST_ALPHA,"dst alpha"),(0,j.Z)(no,L.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,j.Z)(no,L.gl.CONSTANT_COLOR,"constant color"),(0,j.Z)(no,L.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,j.Z)(no,L.gl.CONSTANT_ALPHA,"constant alpha"),(0,j.Z)(no,L.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,j.Z)(no,L.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),no),Jc=(Ma={},(0,j.Z)(Ma,L.gl.NEVER,"never"),(0,j.Z)(Ma,L.gl.ALWAYS,"always"),(0,j.Z)(Ma,L.gl.LESS,"less"),(0,j.Z)(Ma,L.gl.LEQUAL,"lequal"),(0,j.Z)(Ma,L.gl.GREATER,"greater"),(0,j.Z)(Ma,L.gl.GEQUAL,"gequal"),(0,j.Z)(Ma,L.gl.EQUAL,"equal"),(0,j.Z)(Ma,L.gl.NOTEQUAL,"notequal"),Ma),$u=(qs={},(0,j.Z)(qs,L.gl.ZERO,"zero"),(0,j.Z)(qs,L.gl.KEEP,"keep"),(0,j.Z)(qs,L.gl.REPLACE,"replace"),(0,j.Z)(qs,L.gl.INVERT,"invert"),(0,j.Z)(qs,L.gl.INCR,"increment"),(0,j.Z)(qs,L.gl.DECR,"decrement"),(0,j.Z)(qs,L.gl.INCR_WRAP,"increment wrap"),(0,j.Z)(qs,L.gl.DECR_WRAP,"decrement wrap"),qs),Yl=(yl={},(0,j.Z)(yl,L.gl.FRONT,"front"),(0,j.Z)(yl,L.gl.BACK,"back"),yl),Iu=function(){function n(c,a){(0,cr.Z)(this,n),(0,j.Z)(this,"buffer",void 0);var s=a.data,l=a.usage,p=a.type;this.buffer=c.buffer({data:s,usage:Ol[l||L.gl.STATIC_DRAW],type:eu[p||L.gl.UNSIGNED_BYTE]})}return(0,Mr.Z)(n,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(a){var s=a.data,l=a.offset;this.buffer.subdata(s,l)}}]),n}(),Ju=function(){function n(c,a){(0,cr.Z)(this,n),(0,j.Z)(this,"elements",void 0);var s=a.data,l=a.usage,p=a.type,_=a.count;this.elements=c.elements({data:s,usage:Ol[l||L.gl.STATIC_DRAW],type:eu[p||L.gl.UNSIGNED_BYTE],count:_})}return(0,Mr.Z)(n,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(a){var s=a.data;this.elements.subdata(s)}},{key:"destroy",value:function(){}}]),n}(),bl=function(){function n(c,a){(0,cr.Z)(this,n),(0,j.Z)(this,"framebuffer",void 0);var s=a.width,l=a.height,p=a.color,_=a.colors,C=a.depth,M=a.stencil,R={width:s,height:l};Array.isArray(_)&&(R.colors=_.map(function(W){return W.get()})),p&&typeof p!="boolean"&&(R.color=p.get()),this.framebuffer=c.framebuffer(R)}return(0,Mr.Z)(n,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(a){var s=a.width,l=a.height;this.framebuffer.resize(s,l)}}]),n}(),Sl=S(90484),Qu=S(36719),El=S.n(Qu),qu=S(68630),ru=S.n(qu);function Kl(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Nu(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Kl(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Kl(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var Dc=function(){function n(c,a){(0,cr.Z)(this,n),(0,j.Z)(this,"reGl",void 0),(0,j.Z)(this,"destroyed",!1),(0,j.Z)(this,"drawCommand",void 0),(0,j.Z)(this,"drawParams",void 0),(0,j.Z)(this,"options",void 0),(0,j.Z)(this,"uniforms",{}),this.reGl=c;var s=a.vs,l=a.fs,p=a.attributes,_=a.uniforms,C=a.primitive,M=a.count,R=a.elements,W=a.depth,G=a.blend,pe=a.stencil,De=a.cull,rt=a.instances,Tt={};this.options=a,_&&(this.uniforms=this.extractUniforms(_),Object.keys(_).forEach(function(Hr){Tt[Hr]=c.prop(Hr)}));var qt={};Object.keys(p).forEach(function(Hr){qt[Hr]=p[Hr].get()});var _r={attributes:qt,frag:l,uniforms:Tt,vert:s,primitive:gs[C===void 0?L.gl.TRIANGLES:C]};rt&&(_r.instances=rt),M&&(_r.count=M),R&&(_r.elements=R.get()),this.initDepthDrawParams({depth:W},_r),this.initBlendDrawParams({blend:G},_r),this.initStencilDrawParams({stencil:pe},_r),this.initCullDrawParams({cull:De},_r),this.drawCommand=c(_r),this.drawParams=_r}return(0,Mr.Z)(n,[{key:"addUniforms",value:function(a){this.uniforms=Nu(Nu({},this.uniforms),this.extractUniforms(a))}},{key:"draw",value:function(a){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var s=Nu(Nu({},this.uniforms),this.extractUniforms(a.uniforms||{})),l={};Object.keys(s).forEach(function(p){var _=(0,Sl.Z)(s[p]);_==="boolean"||_==="number"||Array.isArray(s[p])||s[p].BYTES_PER_ELEMENT?l[p]=s[p]:l[p]=s[p].get()}),this.drawCommand(l)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(a){a.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(a,s){var l=a.depth;l&&(s.depth={enable:l.enable===void 0?!0:!!l.enable,mask:l.mask===void 0?!0:!!l.mask,func:$c[l.func||L.gl.LESS],range:l.range||[0,1]})}},{key:"initBlendDrawParams",value:function(a,s){var l=a.blend;if(l){var p=l.enable,_=l.func,C=l.equation,M=l.color,R=M===void 0?[0,0,0,0]:M;s.blend={enable:!!p,func:{srcRGB:xl[_&&_.srcRGB||L.gl.SRC_ALPHA],srcAlpha:xl[_&&_.srcAlpha||L.gl.SRC_ALPHA],dstRGB:xl[_&&_.dstRGB||L.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:xl[_&&_.dstAlpha||L.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Bu[C&&C.rgb||L.gl.FUNC_ADD],alpha:Bu[C&&C.alpha||L.gl.FUNC_ADD]},color:R}}}},{key:"initStencilDrawParams",value:function(a,s){var l=a.stencil;if(l){var p=l.enable,_=l.mask,C=_===void 0?-1:_,M=l.func,R=M===void 0?{cmp:L.gl.ALWAYS,ref:0,mask:-1}:M,W=l.opFront,G=W===void 0?{fail:L.gl.KEEP,zfail:L.gl.KEEP,zpass:L.gl.KEEP}:W,pe=l.opBack,De=pe===void 0?{fail:L.gl.KEEP,zfail:L.gl.KEEP,zpass:L.gl.KEEP}:pe;s.stencil={enable:!!p,mask:C,func:Nu(Nu({},R),{},{cmp:Jc[R.cmp]}),opFront:{fail:$u[G.fail],zfail:$u[G.zfail],zpass:$u[G.zpass]},opBack:{fail:$u[De.fail],zfail:$u[De.zfail],zpass:$u[De.zpass]}}}}},{key:"initCullDrawParams",value:function(a,s){var l=a.cull;if(l){var p=l.enable,_=l.face,C=_===void 0?L.gl.BACK:_;s.cull={enable:!!p,face:Yl[C]}}}},{key:"extractUniforms",value:function(a){var s=this,l={};return Object.keys(a).forEach(function(p){s.extractUniformsRecursively(p,a[p],l,"")}),l}},{key:"extractUniformsRecursively",value:function(a,s,l,p){var _=this;if(s===null||typeof s=="number"||typeof s=="boolean"||Array.isArray(s)&&typeof s[0]=="number"||El()(s)||s===""||"resize"in s){l["".concat(p&&p+".").concat(a)]=s;return}ru()(s)&&Object.keys(s).forEach(function(C){_.extractUniformsRecursively(C,s[C],l,"".concat(p&&p+".").concat(a))}),Array.isArray(s)&&s.forEach(function(C,M){Object.keys(C).forEach(function(R){_.extractUniformsRecursively(R,C[R],l,"".concat(p&&p+".").concat(a,"[").concat(M,"]"))})})}}]),n}(),el=function(){function n(c,a){(0,cr.Z)(this,n),(0,j.Z)(this,"texture",void 0),(0,j.Z)(this,"width",void 0),(0,j.Z)(this,"height",void 0);var s=a.data,l=a.type,p=l===void 0?L.gl.UNSIGNED_BYTE:l,_=a.width,C=a.height,M=a.flipY,R=M===void 0?!1:M,W=a.format,G=W===void 0?L.gl.RGBA:W,pe=a.mipmap,De=pe===void 0?!1:pe,rt=a.wrapS,Tt=rt===void 0?L.gl.CLAMP_TO_EDGE:rt,qt=a.wrapT,_r=qt===void 0?L.gl.CLAMP_TO_EDGE:qt,Hr=a.aniso,cn=Hr===void 0?0:Hr,_n=a.alignment,Un=_n===void 0?1:_n,ti=a.premultiplyAlpha,ni=ti===void 0?!1:ti,Si=a.mag,qi=Si===void 0?L.gl.NEAREST:Si,_a=a.min,yi=_a===void 0?L.gl.NEAREST:_a,Ta=a.colorSpace,Ua=Ta===void 0?L.gl.BROWSER_DEFAULT_WEBGL:Ta;this.width=_,this.height=C;var lu={width:_,height:C,type:eu[p],format:tu[G],wrapS:Ia[Tt],wrapT:Ia[_r],mag:Fu[qi],min:Fu[yi],alignment:Un,flipY:R,colorSpace:_l[Ua],premultiplyAlpha:ni,aniso:cn};s&&(lu.data=s),typeof De=="number"?lu.mipmap=mc[De]:typeof De=="boolean"&&(lu.mipmap=De),this.texture=c.texture(lu)}return(0,Mr.Z)(n,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(a)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(a){var s=a.width,l=a.height;this.texture.resize(s,l),this.width=s,this.height=l}},{key:"destroy",value:function(){this.texture.destroy()}}]),n}(),Cl,Ll,gc=(Cl=(0,ln.b2)(),Cl(Ll=function(){function n(){var c=this;(0,cr.Z)(this,n),(0,j.Z)(this,"extensionObject",void 0),(0,j.Z)(this,"gl",void 0),(0,j.Z)(this,"$container",void 0),(0,j.Z)(this,"canvas",void 0),(0,j.Z)(this,"width",void 0),(0,j.Z)(this,"height",void 0),(0,j.Z)(this,"isDirty",void 0),(0,j.Z)(this,"createModel",function(a){return new Dc(c.gl,a)}),(0,j.Z)(this,"createAttribute",function(a){return new Pa(c.gl,a)}),(0,j.Z)(this,"createBuffer",function(a){return new Iu(c.gl,a)}),(0,j.Z)(this,"createElements",function(a){return new Ju(c.gl,a)}),(0,j.Z)(this,"createTexture2D",function(a){return new el(c.gl,a)}),(0,j.Z)(this,"createFramebuffer",function(a){return new bl(c.gl,a)}),(0,j.Z)(this,"useFramebuffer",function(a,s){c.gl({framebuffer:a?a.get():null})(s)}),(0,j.Z)(this,"clear",function(a){var s=a.color,l=a.depth,p=a.stencil,_=a.framebuffer,C=_===void 0?null:_,M={color:s,depth:l,stencil:p};M.framebuffer=C===null?C:C.get(),c.gl.clear(M)}),(0,j.Z)(this,"viewport",function(a){var s=a.x,l=a.y,p=a.width,_=a.height;c.gl._gl.viewport(s,l,p,_),c.width=p,c.height=_,c.gl._refresh()}),(0,j.Z)(this,"readPixels",function(a){var s=a.framebuffer,l=a.x,p=a.y,_=a.width,C=a.height,M={x:l,y:p,width:_,height:C};return s&&(M.framebuffer=s.get()),c.gl.read(M)}),(0,j.Z)(this,"getViewportSize",function(){return{width:c.gl._gl.drawingBufferWidth,height:c.gl._gl.drawingBufferHeight}}),(0,j.Z)(this,"getContainer",function(){var a;return(a=c.canvas)===null||a===void 0?void 0:a.parentElement}),(0,j.Z)(this,"getCanvas",function(){return c.canvas}),(0,j.Z)(this,"getGLContext",function(){return c.gl._gl}),(0,j.Z)(this,"destroy",function(){c.gl.destroy()})}return(0,Mr.Z)(n,[{key:"init",value:function(){var c=(0,Nt.Z)(Wr().mark(function s(l,p){var _=this;return Wr().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return this.canvas=l,M.next=3,new Promise(function(R,W){Ei()({canvas:_.canvas,attributes:{alpha:!0,antialias:p.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:p.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(pe,De){(pe||!De)&&W(pe),R(De)}})});case 3:this.gl=M.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return M.stop()}},s,this)}));function a(s,l){return c.apply(this,arguments)}return a}()},{key:"testExtension",value:function(a){return!!this.getGLContext().getExtension(a)}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var a=this.getGLContext();a.disable(a.CULL_FACE)}},{key:"setDirty",value:function(a){this.isDirty=a}},{key:"getDirty",value:function(){return this.isDirty}}]),n}())||Ll);function Rl(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function kc(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Rl(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Rl(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var $l=function(){function n(c){(0,cr.Z)(this,n),(0,j.Z)(this,"sceneService",void 0),(0,j.Z)(this,"mapService",void 0),(0,j.Z)(this,"controlService",void 0),(0,j.Z)(this,"layerService",void 0),(0,j.Z)(this,"iconService",void 0),(0,j.Z)(this,"markerService",void 0),(0,j.Z)(this,"popupService",void 0),(0,j.Z)(this,"fontService",void 0),(0,j.Z)(this,"interactionService",void 0),(0,j.Z)(this,"container",void 0);var a=c.id,s=c.map,l=(0,L.Hp)();this.container=l,s.setContainer(l,a),l.bind(L.vK.IRendererService).to(gc).inSingletonScope(),this.sceneService=l.get(L.vK.ISceneService),this.mapService=l.get(L.vK.IMapService),this.iconService=l.get(L.vK.IIconService),this.fontService=l.get(L.vK.IFontService),this.controlService=l.get(L.vK.IControlService),this.layerService=l.get(L.vK.ILayerService),this.markerService=l.get(L.vK.IMarkerService),this.interactionService=l.get(L.vK.IInteractionService),this.popupService=l.get(L.vK.IPopupService),this.initComponent(a),this.sceneService.init(c),this.initControl()}return(0,Mr.Z)(n,[{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(a){return this.sceneService.exportPng(a)}},{key:"exportMap",value:function(a){return this.sceneService.exportPng(a)}},{key:"registerRenderService",value:function(a){var s=this;if(this.sceneService.loaded){var l=new a(this);l.init()}else this.on("loaded",function(){var p=new a(s);p.init()})}},{key:"map",get:function(){return this.mapService.map}},{key:"setBgColor",value:function(a){this.mapService.setBgColor(a)}},{key:"addLayer",value:function(a){var s=(0,L.e7)(this.container);a.setContainer(s,this.container),this.sceneService.addLayer(a)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(a){return this.layerService.getLayer(a)}},{key:"getLayerByName",value:function(a){return this.layerService.getLayerByName(a)}},{key:"removeLayer",value:function(a,s){this.layerService.remove(a,s)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"addIconFont",value:function(a,s){this.fontService.addIconFont(a,s)}},{key:"addIconFonts",value:function(a){var s=this;a.forEach(function(l){var p=(0,Yi.Z)(l,2),_=p[0],C=p[1];s.fontService.addIconFont(_,C)})}},{key:"addFontFace",value:function(a,s){this.sceneService.addFontFace(a,s)}},{key:"addImage",value:function(a,s){this.iconService.addImage(a,s)}},{key:"hasImage",value:function(a){return this.iconService.hasImage(a)}},{key:"removeImage",value:function(a){this.iconService.removeImage(a)}},{key:"addIconFontGlyphs",value:function(a,s){this.fontService.addIconGlyphs(s)}},{key:"addControl",value:function(a){this.controlService.addControl(a,this.container)}},{key:"removeControl",value:function(a){this.controlService.removeControl(a)}},{key:"getControlByName",value:function(a){return this.controlService.getControlByName(a)}},{key:"addMarker",value:function(a){this.markerService.addMarker(a)}},{key:"addMarkerLayer",value:function(a){this.markerService.addMarkerLayer(a)}},{key:"removeMarkerLayer",value:function(a){this.markerService.removeMarkerLayer(a)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(a){this.popupService.addPopup(a)}},{key:"on",value:function(a,s){L.SceneEventList.indexOf(a)===-1?this.mapService.on(a,s):this.sceneService.on(a,s)}},{key:"once",value:function(a,s){L.SceneEventList.indexOf(a)===-1?this.mapService.once(a,s):this.sceneService.once(a,s)}},{key:"off",value:function(a,s){L.SceneEventList.indexOf(a)===-1?this.mapService.off(a,s):this.sceneService.off(a,s)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(a){return this.mapService.getCenter(a)}},{key:"setCenter",value:function(a,s){return this.mapService.setCenter(a,s)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(a){return this.mapService.setPitch(a)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(a){this.mapService.setRotation(a)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(a){this.mapService.panTo(a)}},{key:"panBy",value:function(a,s){this.mapService.panBy(a,s)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(a){this.mapService.setZoom(a)}},{key:"fitBounds",value:function(a,s){var l=this.sceneService.getSceneConfig(),p=l.fitBoundsOptions,_=l.animate;this.mapService.fitBounds(a,s||kc(kc({},p),{},{animate:_}))}},{key:"setZoomAndCenter",value:function(a,s){this.mapService.setZoomAndCenter(a,s)}},{key:"setMapStyle",value:function(a){this.mapService.setMapStyle(a)}},{key:"setMapStatus",value:function(a){this.mapService.setMapStatus(a)}},{key:"pixelToLngLat",value:function(a){return this.mapService.pixelToLngLat(a)}},{key:"lngLatToPixel",value:function(a){return this.mapService.lngLatToPixel(a)}},{key:"containerToLngLat",value:function(a){return this.mapService.containerToLngLat(a)}},{key:"lngLatToContainer",value:function(a){return this.mapService.lngLatToContainer(a)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(a,s){this.container.bind(L.vK.IPostProcessingPass).to(a).whenTargetNamed(s)}},{key:"initComponent",value:function(a){this.controlService.init({container:Ke.SO.getContainer(a)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var a=this.sceneService.getSceneConfig(),s=a.logoVisible,l=a.logoPosition;s&&this.addControl(new ts({position:l}))}}]),n}(),js=S(81253),io=S(55770),bo=S(3473),zu=S(13218),Ds=S.n(zu),Dl,Jl,_u,Ql,Uu;function ao(n){return n.map(function(c){return typeof c=="string"&&(c=[c,{}]),c})}var kl=(Dl=(0,ln.b2)(),Jl=(0,ln.f3)(L.vK.IGlobalConfigService),Dl(_u=(Ql=function(){function n(){(0,cr.Z)(this,n),(0,io.Z)(this,"configService",Uu,this),(0,j.Z)(this,"enabled",void 0)}return(0,Mr.Z)(n,[{key:"apply",value:function(a,s){var l=this,p=s.rendererService,_=s.postProcessingPassFactory,C=s.normalPassFactory;a.hooks.init.tap("MultiPassRendererPlugin",function(){var M=a.getLayerConfig(),R=M.enableMultiPassRenderer,W=M.passes,G=W===void 0?[]:W;l.enabled=!!R&&a.getLayerConfig().enableMultiPassRenderer!==!1,l.enabled&&(a.multiPassRenderer=l.createMultiPassRenderer(a,G,_,C),a.multiPassRenderer.setRenderFlag(!0))}),a.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(a,s,l,p){var _=a.multiPassRenderer,C=a.getLayerConfig(),M=C.enablePicking,R=C.enableTAA;return M&&_.add(p("pixelPicking")),_}}]),n}(),Uu=(0,bo.Z)(Ql.prototype,"configService",[Jl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ql))||_u),Vs,pu=(Vs={},(0,j.Z)(Vs,L.BlendType.additive,{enable:!0,func:{srcRGB:L.gl.ONE,dstRGB:L.gl.ONE,srcAlpha:1,dstAlpha:1}}),(0,j.Z)(Vs,L.BlendType.none,{enable:!1}),(0,j.Z)(Vs,L.BlendType.normal,{enable:!0,func:{srcRGB:L.gl.SRC_ALPHA,dstRGB:L.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,j.Z)(Vs,L.BlendType.subtractive,{enable:!0,func:{srcRGB:L.gl.ONE,dstRGB:L.gl.ONE,srcAlpha:L.gl.ZERO,dstAlpha:L.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:L.gl.FUNC_SUBTRACT,alpha:L.gl.FUNC_SUBTRACT}}),(0,j.Z)(Vs,L.BlendType.max,{enable:!0,func:{srcRGB:L.gl.ONE,dstRGB:L.gl.ONE},equation:{rgb:L.gl.MAX_EXT}}),(0,j.Z)(Vs,L.BlendType.min,{enable:!0,func:{srcRGB:L.gl.ONE,dstRGB:L.gl.ONE},equation:{rgb:L.gl.MIN_EXT}}),Vs),sa=S(81763),Ai=S.n(sa),ys=S(1469),du=S.n(ys),tl=1024;function rs(n,c,a,s,l){c.updateStyleAttribute(n,a,s,l)}function Qc(n,c){n.opacity&&Fc("opacity",c,n.opacity),n.strokeWidth&&Fc("strokeWidth",c,n.strokeWidth),n.strokeOpacity&&Fc("strokeOpacity",c,n.strokeOpacity),n.stroke&&Fl("stroke",c,n.stroke),n.offsets&&wl("offsets",c,n.offsets),n.textOffset&&wl("textOffset",c,n.textOffset)}function Fc(n,c,a){B()(a)?rs(n,c,a,function(s){return s}):Ai()(a)?rs(n,c,[a],void 0):du()(a)&&a.length===2?B()(a[0])&&de()(a[1])||B()(a[0])&&du()(a[1])&&Ai()(a[1][0])&&Ai()(a[1][1])?rs(n,c,a[0],a[1]):rs(n,c,[1],void 0):rs(n,c,[1],void 0)}function wl(n,c,a){B()(a)?rs(n,c,a,function(s){return s}):du()(a)&&a.length===2&&B()(a[0])&&de()(a[1])?rs(n,c,a[0],a[1]):du()(a)&&a.length===2&&Ai()(a[0])&&Ai()(a[1])?rs(n,c,a,void 0):rs(n,c,[0,0],void 0)}function Fl(n,c,a){B()(a)?rs(n,c,a,void 0):du()(a)&&a.length===2&&(B()(a[0])&&de()(a[1])||B()(a[0])&&du()(a[1])&&a[1].length>0)?rs(n,c,a[0],a[1]):rs(n,c,"#fff",void 0)}var xu,Ao,Zu,Al,To;function Dn(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=ho(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(R){throw R},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,_=!1,C;return{s:function(){a=a.call(n)},n:function(){var R=a.next();return p=R.done,R},e:function(R){_=!0,C=R},f:function(){try{!p&&a.return!=null&&a.return()}finally{if(_)throw C}}}}function ho(n,c){if(!!n){if(typeof n=="string")return bu(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return bu(n,c)}}function bu(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function ju(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Ka(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?ju(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):ju(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function ks(n){var c=yc();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function yc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var xn=0,Ou=(xu=(0,L.yT)(L.vK.IGlobalConfigService),Ao=(0,L.yT)(L.vK.IShaderModuleService),Zu=function(n){(0,Gn.Z)(a,n);var c=ks(a);function a(){var s,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,cr.Z)(this,a),s=c.call(this),(0,j.Z)((0,gt.Z)(s),"id","".concat(xn++)),(0,j.Z)((0,gt.Z)(s),"name","".concat(xn)),(0,j.Z)((0,gt.Z)(s),"type",void 0),(0,j.Z)((0,gt.Z)(s),"visible",!0),(0,j.Z)((0,gt.Z)(s),"zIndex",0),(0,j.Z)((0,gt.Z)(s),"minZoom",void 0),(0,j.Z)((0,gt.Z)(s),"maxZoom",void 0),(0,j.Z)((0,gt.Z)(s),"inited",!1),(0,j.Z)((0,gt.Z)(s),"layerModelNeedUpdate",!1),(0,j.Z)((0,gt.Z)(s),"pickedFeatureID",null),(0,j.Z)((0,gt.Z)(s),"selectedFeatureID",null),(0,j.Z)((0,gt.Z)(s),"styleNeedUpdate",!1),(0,j.Z)((0,gt.Z)(s),"rendering",void 0),(0,j.Z)((0,gt.Z)(s),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,j.Z)((0,gt.Z)(s),"hooks",{init:new _e.oI,afterInit:new _e.oI,beforeRender:new _e.oI,beforeRenderData:new _e.gg,afterRender:new _e.ni,beforePickingEncode:new _e.ni,afterPickingEncode:new _e.ni,beforeHighlight:new _e.ni(["pickedColor"]),afterHighlight:new _e.ni,beforeSelect:new _e.ni(["pickedColor"]),afterSelect:new _e.ni,beforeDestroy:new _e.ni,afterDestroy:new _e.ni}),(0,j.Z)((0,gt.Z)(s),"models",[]),(0,j.Z)((0,gt.Z)(s),"multiPassRenderer",void 0),(0,j.Z)((0,gt.Z)(s),"plugins",void 0),(0,j.Z)((0,gt.Z)(s),"sourceOption",void 0),(0,j.Z)((0,gt.Z)(s),"layerModel",void 0),(0,j.Z)((0,gt.Z)(s),"sceneContainer",void 0),(0,j.Z)((0,gt.Z)(s),"layerChildren",[]),(0,io.Z)((0,gt.Z)(s),"configService",Al,(0,gt.Z)(s)),(0,io.Z)((0,gt.Z)(s),"shaderModuleService",To,(0,gt.Z)(s)),(0,j.Z)((0,gt.Z)(s),"cameraService",void 0),(0,j.Z)((0,gt.Z)(s),"coordinateService",void 0),(0,j.Z)((0,gt.Z)(s),"iconService",void 0),(0,j.Z)((0,gt.Z)(s),"fontService",void 0),(0,j.Z)((0,gt.Z)(s),"pickingService",void 0),(0,j.Z)((0,gt.Z)(s),"rendererService",void 0),(0,j.Z)((0,gt.Z)(s),"layerService",void 0),(0,j.Z)((0,gt.Z)(s),"interactionService",void 0),(0,j.Z)((0,gt.Z)(s),"mapService",void 0),(0,j.Z)((0,gt.Z)(s),"styleAttributeService",void 0),(0,j.Z)((0,gt.Z)(s),"layerSource",void 0),(0,j.Z)((0,gt.Z)(s),"postProcessingPassFactory",void 0),(0,j.Z)((0,gt.Z)(s),"normalPassFactory",void 0),(0,j.Z)((0,gt.Z)(s),"animateOptions",{enable:!1}),(0,j.Z)((0,gt.Z)(s),"container",void 0),(0,j.Z)((0,gt.Z)(s),"encodedData",void 0),(0,j.Z)((0,gt.Z)(s),"configSchema",void 0),(0,j.Z)((0,gt.Z)(s),"currentPickId",null),(0,j.Z)((0,gt.Z)(s),"rawConfig",void 0),(0,j.Z)((0,gt.Z)(s),"needUpdateConfig",void 0),(0,j.Z)((0,gt.Z)(s),"pendingStyleAttributes",[]),(0,j.Z)((0,gt.Z)(s),"scaleOptions",{}),(0,j.Z)((0,gt.Z)(s),"animateStartTime",void 0),(0,j.Z)((0,gt.Z)(s),"aniamateStatus",!1),(0,j.Z)((0,gt.Z)(s),"sourceEvent",function(){s.dataState.dataSourceNeedUpdate=!0;var p=s.getLayerConfig(),_=p.autoFit,C=p.fitBoundsOptions;_&&s.fitBounds(C),s.emit("dataUpdate"),s.reRender()}),s.name=l.name||s.id,s.zIndex=l.zIndex||0,s.rawConfig=l,s}return(0,Mr.Z)(a,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(l){if(!this.inited)this.needUpdateConfig=Ka(Ka({},this.needUpdateConfig),l);else{var p=this.container.get(L.vK.SceneID);Qc(l,this),this.configService.setLayerConfig(p,this.id,Ka(Ka(Ka({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),l)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(l,p){this.container=l,this.sceneContainer=p}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(l){return this.plugins.push(l),this}},{key:"init",value:function(){var l=this,p=this.container.get(L.vK.SceneID),_=this.rawConfig.enableMultiPassRenderer,C=_===void 0?!1:_;this.configService.setLayerConfig(p,this.id,{enableMultiPassRenderer:C}),this.iconService=this.container.get(L.vK.IIconService),this.fontService=this.container.get(L.vK.IFontService),this.rendererService=this.container.get(L.vK.IRendererService),this.layerService=this.container.get(L.vK.ILayerService),this.interactionService=this.container.get(L.vK.IInteractionService),this.pickingService=this.container.get(L.vK.IPickingService),this.mapService=this.container.get(L.vK.IMapService),this.cameraService=this.container.get(L.vK.ICameraService),this.coordinateService=this.container.get(L.vK.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(L.vK.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(L.vK.IFactoryNormalPass),this.styleAttributeService=this.container.get(L.vK.IStyleAttributeService),this.multiPassRenderer=this.container.get(L.vK.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(G){var pe=G.attributeName,De=G.attributeField,rt=G.attributeValues,Tt=G.updateOptions;l.styleAttributeService.updateStyleAttribute(pe,{scale:Ka({field:De},l.splitValuesAndCallbackInAttribute(rt,l.getLayerConfig()[pe]))},Tt)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(L.vK.ILayerPlugin);var M=Dn(this.plugins),R;try{for(M.s();!(R=M.n()).done;){var W=R.value;W.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(G){M.e(G)}finally{M.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Ka(Ka({},this.getDefaultConfig()),this.rawConfig));var l=this.getLayerConfig(),p=l.animateOption;p!=null&&p.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(l,p,_){return this.updateStyleAttribute("color",l,p,_),this}},{key:"texture",value:function(l,p,_){return this.updateStyleAttribute("texture",l,p,_),this}},{key:"rotate",value:function(l,p,_){return this.updateStyleAttribute("rotate",l,p,_),this}},{key:"size",value:function(l,p,_){return this.updateStyleAttribute("size",l,p,_),this}},{key:"filter",value:function(l,p,_){return this.updateStyleAttribute("filter",l,p,_),this}},{key:"shape",value:function(l,p,_){return this.updateStyleAttribute("shape",l,p,_),this}},{key:"label",value:function(l,p,_){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:l,attributeValues:p,updateOptions:_}),this}},{key:"animate",value:function(l){var p={};return Ds()(l)?(p.enable=!0,p=Ka(Ka({},p),l)):p.enable=l,this.updateLayerConfig({animateOption:p}),this}},{key:"source",value:function(l,p){return l!=null&&l.data?(this.setSource(l),this):(this.sourceOption={data:l,options:p},this)}},{key:"setData",value:function(l,p){var _=this;return this.inited?this.layerSource.setData(l,p):this.on("inited",function(){_.layerSource.setData(l,p)}),this}},{key:"style",value:function(l){var p=this,_=l.passes,C=(0,js.Z)(l,["passes"]);return _&&ao(_).forEach(function(M){var R=p.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(M[0]);R&&R.updateOptions(M[1])}),this.rawConfig=Ka(Ka({},this.rawConfig),C),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(l,p){return Ds()(l)?this.scaleOptions=Ka(Ka({},this.scaleOptions),l):this.scaleOptions[l]=p,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"active",value:function(l){var p={};return p.enableHighlight=Ds()(l)?!0:l,Ds()(l)?(p.enableHighlight=!0,l.color&&(p.highlightColor=l.color)):p.enableHighlight=!!l,this.updateLayerConfig(p),this}},{key:"setActive",value:function(l,p){var _=this;if(Ds()(l)){var C=l.x,M=C===void 0?0:C,R=l.y,W=R===void 0?0:R;this.updateLayerConfig({highlightColor:Ds()(p)?p.color:this.getLayerConfig().highlightColor}),this.pick({x:M,y:W})}else this.updateLayerConfig({pickedFeatureID:l,highlightColor:Ds()(p)?p.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call((0,Ke.Z6)(l)).then(function(){setTimeout(function(){_.reRender()},1)})}},{key:"select",value:function(l){var p={};return p.enableSelect=Ds()(l)?!0:l,Ds()(l)?(p.enableSelect=!0,l.color&&(p.selectColor=l.color)):p.enableSelect=!!l,this.updateLayerConfig(p),this}},{key:"setSelect",value:function(l,p){var _=this;if(Ds()(l)){var C=l.x,M=C===void 0?0:C,R=l.y,W=R===void 0?0:R;this.updateLayerConfig({selectColor:Ds()(p)?p.color:this.getLayerConfig().selectColor}),this.pick({x:M,y:W})}else this.updateLayerConfig({pickedFeatureID:l,selectColor:Ds()(p)?p.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call((0,Ke.Z6)(l)).then(function(){setTimeout(function(){_.reRender()},1)})}},{key:"setBlend",value:function(l){this.updateLayerConfig({blend:l}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(l){return this.zIndex=l,this.layerService.updateRenderOrder(),this}},{key:"setCurrentPickId",value:function(l){this.currentPickId=l}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(l){this.selectedFeatureID=l}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var l=this.mapService.getZoom(),p=this.getLayerConfig(),_=p.visible,C=p.minZoom,M=C===void 0?-Infinity:C,R=p.maxZoom,W=R===void 0?Infinity:R;return!!_&&l>=M&&l<=W}},{key:"setMinZoom",value:function(l){return this.updateLayerConfig({minZoom:l}),this}},{key:"getMinZoom",value:function(){var l=this.getLayerConfig(),p=l.minZoom;return p}},{key:"getMaxZoom",value:function(){var l=this.getLayerConfig(),p=l.maxZoom;return p}},{key:"get",value:function(l){var p=this.getLayerConfig();return p[l]}},{key:"setMaxZoom",value:function(l){return this.updateLayerConfig({maxZoom:l}),this}},{key:"fitBounds",value:function(l){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var p=this.getSource(),_=p.extent,C=_.some(function(M){return Math.abs(M)===Infinity});return C?this:(this.mapService.fitBounds([[_[0],_[1]],[_[2],_[3]]],l),this)}},{key:"destroy",value:function(){this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(l){return l.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(l){return l.needRescale||l.needRemapping||l.needRegenerateVertices}).length}},{key:"setSource",value:function(l){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=l,this.inited&&this.layerSource.cluster){var p=this.mapService.getZoom();this.layerSource.updateClusterData(p)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(l){this.encodedData=l}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(l){var p=this.styleAttributeService.getLayerAttributeScale(l);if(p){if(p.ticks){var _=p.ticks().map(function(M){return(0,j.Z)({value:M},l,p(M))});return _}else if(p.invertExtent){var C=p.range().map(function(M){return(0,j.Z)({value:p.invertExtent(M)},l,M)});return C}}else return[]}},{key:"pick",value:function(l){var p=l.x,_=l.y;this.interactionService.triggerHover({x:p,y:_})}},{key:"boxSelect",value:function(l,p){this.pickingService.boxPickLayer(this,l,p)}},{key:"buildLayerModel",value:function(l){var p=l.moduleName,_=l.vertexShader,C=l.fragmentShader,M=l.triangulation,R=l.segmentNumber,W=(0,js.Z)(l,["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"]);this.shaderModuleService.registerModule(p,{vs:_,fs:C});var G=this.shaderModuleService.getModule(p),pe=G.vs,De=G.fs,rt=G.uniforms,Tt=this.rendererService.createModel,qt=this.styleAttributeService.createAttributesAndIndices(this.encodedData,M,R),_r=qt.attributes,Hr=qt.elements;return Tt(Ka({attributes:_r,uniforms:rt,fs:De,vs:pe,elements:Hr,blend:pu[L.BlendType.normal]},W))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(l){var p=this.getLayerConfig(),_=p.enableHighlight,C=_===void 0?!0:_,M=p.enableSelect,R=M===void 0?!0:M,W=this.eventNames().indexOf(l)!==-1||this.eventNames().indexOf("un"+l)!==-1;return(l==="click"||l==="dblclick")&&R&&(W=!0),l==="mousemove"&&(C||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(W=!0),this.isVisible()&&W}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(){var l=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(p){p.draw({uniforms:l.layerModel.getUninforms()})})),this}},{key:"updateStyleAttribute",value:function(l,p,_,C){this.inited?this.styleAttributeService.updateStyleAttribute(l,{scale:Ka({field:p},this.splitValuesAndCallbackInAttribute(_,this.getLayerConfig()[p]))},C):this.pendingStyleAttributes.push({attributeName:l,attributeField:p,attributeValues:_,updateOptions:C})}},{key:"setEarthTime",value:function(l){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&this.layerService.renderLayers()}},{key:"splitValuesAndCallbackInAttribute",value:function(l,p){return{values:de()(l)?void 0:l||p,callback:de()(l)?l:void 0}}}]),a}(ct.EventEmitter),Al=(0,bo.Z)(Zu.prototype,"configService",[xu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),To=(0,bo.Z)(Zu.prototype,"shaderModuleService",[Ao],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zu),_c=S(18446),nu=S.n(_c),Za=S(2650),_s,Tl,iu,Ts,Su;function qc(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=ql(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(R){throw R},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,_=!1,C;return{s:function(){a=a.call(n)},n:function(){var R=a.next();return p=R.done,R},e:function(R){_=!0,C=R},f:function(){try{!p&&a.return!=null&&a.return()}finally{if(_)throw C}}}}function ql(n,c){if(!!n){if(typeof n=="string")return ec(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ec(n,c)}}function ec(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}var Po=(_s=(0,L.yT)(L.vK.IGlobalConfigService),Tl=(0,L.yT)(L.vK.IShaderModuleService),iu=function(){function n(c){(0,cr.Z)(this,n),(0,j.Z)(this,"triangulation",void 0),(0,j.Z)(this,"createTexture2D",void 0),(0,j.Z)(this,"layer",void 0),(0,j.Z)(this,"dataTexture",void 0),(0,j.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,j.Z)(this,"rowCount",void 0),(0,j.Z)(this,"cacheStyleProperties",void 0),(0,j.Z)(this,"cellLength",void 0),(0,j.Z)(this,"cellProperties",void 0),(0,j.Z)(this,"cellTypeLayout",void 0),(0,j.Z)(this,"stylePropertyesExist",void 0),(0,j.Z)(this,"dataTextureTest",void 0),(0,io.Z)(this,"configService",Ts,this),(0,io.Z)(this,"shaderModuleService",Su,this),(0,j.Z)(this,"rendererService",void 0),(0,j.Z)(this,"iconService",void 0),(0,j.Z)(this,"fontService",void 0),(0,j.Z)(this,"styleAttributeService",void 0),(0,j.Z)(this,"mapService",void 0),(0,j.Z)(this,"cameraService",void 0),(0,j.Z)(this,"layerService",void 0),this.layer=c,this.rendererService=c.getContainer().get(L.vK.IRendererService),this.styleAttributeService=c.getContainer().get(L.vK.IStyleAttributeService),this.mapService=c.getContainer().get(L.vK.IMapService),this.iconService=c.getContainer().get(L.vK.IIconService),this.fontService=c.getContainer().get(L.vK.IFontService),this.cameraService=c.getContainer().get(L.vK.ICameraService),this.layerService=c.getContainer().get(L.vK.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var a=this.rendererService.createTexture2D;this.createTexture2D=a,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new ImageData(1,1).data,mag:L.gl.NEAREST,min:L.gl.NEAREST,width:1,height:1}))}return(0,Mr.Z)(n,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,0,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(a){var s=!1;return nu()(a.opacity,this.cacheStyleProperties.opacity)||(s=!0,this.cacheStyleProperties.opacity=a.opacity),nu()(a.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(s=!0,this.cacheStyleProperties.strokeOpacity=a.strokeOpacity),nu()(a.strokeWidth,this.cacheStyleProperties.strokeWidth)||(s=!0,this.cacheStyleProperties.strokeWidth=a.strokeWidth),nu()(a.stroke,this.cacheStyleProperties.stroke)||(s=!0,this.cacheStyleProperties.stroke=a.stroke),nu()(a.offsets,this.cacheStyleProperties.offsets)||(s=!0,this.cacheStyleProperties.offsets=a.offsets),this.dataTexture===void 0&&(s=!0),s}},{key:"judgeStyleAttributes",value:function(a){this.clearLastCalRes(),a.opacity!==void 0&&!Ai()(a.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),a.strokeOpacity!==void 0&&!Ai()(a.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),a.strokeWidth!==void 0&&!Ai()(a.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),a.stroke!==void 0&&!this.isStaticColor(a.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),a.offsets!==void 0&&!this.isOffsetStatic(a.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2)}},{key:"isStaticColor",value:function(a){return B()(a)?!!(0,Za.ZP)(a):!1}},{key:"getStrokeColor",value:function(a){if(this.isStaticColor(a)){var s=(0,Ke.CI)(a);return s[0]=s[0]?s[0]:0,s[1]=s[1]?s[1]:0,s[2]=s[2]?s[2]:0,s[3]=s[3]?s[3]:0,s}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(a){return!!(du()(a)&&a.length===2&&Ai()(a[0])&&Ai()(a[1]))}},{key:"patchMod",value:function(a,s){for(var l=0;l<s;l++)a.push(-1)}},{key:"patchData",value:function(a,s,l){var p=qc(l),_;try{for(p.s();!(_=p.n()).done;){var C=_.value,M=C.attr,R=C.count,W=s[M];W?M==="stroke"?a.push.apply(a,(0,ie.Z)((0,Ke.CI)(W))):M==="offsets"?this.isOffsetStatic(W)?a.push(-W[0],W[1]):a.push(0,0):a.push(Ai()(W)?W:1):this.patchMod(a,R)}}catch(G){p.e(G)}finally{p.f()}}},{key:"calDataFrame",value:function(a,s,l){for(var p=s.length,_=Math.ceil(p*a/this.DATA_TEXTURE_WIDTH),C=_*this.DATA_TEXTURE_WIDTH,M=[],R=0;R<p;R++){var W=s[R];this.patchData(M,W,l)}for(var G=M.length;G<C;G++)M.push(-1);return{data:M,width:this.DATA_TEXTURE_WIDTH,height:_}}},{key:"getBlend",value:function(){var a=this.layer.getLayerConfig(),s=a.blend,l=s===void 0?"normal":s;return pu[L.BlendType[l]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.duration||4,a.interval||.2,a.trailLength||.1]}},{key:"startModelAnimate",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;s.enable&&this.layer.setAnimateStartTime()}}]),n}(),Ts=(0,bo.Z)(iu.prototype,"configService",[_s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Su=(0,bo.Z)(iu.prototype,"shaderModuleService",[Tl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iu),Gs=S(9187),Mo=S.n(Gs),ta=100,Vu=36,vu=40;function Ko(n){return n/180*Math.acos(-1)}function rl(n){var c=Ko(n[0])+Math.PI/2,a=Ko(n[1]),s=ta+Math.random()*.4,l=s*Math.cos(a)*Math.cos(c),p=s*Math.cos(a)*Math.sin(c),_=s*Math.sin(a);return[p,_,l]}function Eu(n,c){var a=mat4.create(),s=mat4.create(),l=vec3.fromValues(0,1,0),p=vec3.fromValues(0,0,0);c=c||{},n=typeof n!="undefined"?n:1;for(var _=typeof c.segments!="undefined"?c.segments:32,C=2+_,M=2*C,R=[],W=[],G=[],pe=[],De=[],rt=[],Tt=0;Tt<=C;Tt++){for(var qt=Tt/C,_r=qt*Math.PI,Hr=0;Hr<=M;Hr++){var cn=Hr/M,_n=cn*Math.PI*2;mat4.identity(s),mat4.rotateZ(s,s,-_r),mat4.identity(a),mat4.rotateY(a,a,_n),vec3.transformMat4(p,l,s),vec3.transformMat4(p,p,a),vec3.scale(p,p,-n),G.push(p.slice()),pe.push.apply(pe,_toConsumableArray(p.slice())),vec3.normalize(p,p),De.push.apply(De,_toConsumableArray(p.slice())),rt.push([cn,1-qt]),pe.push(cn,1-qt)}if(Tt>0)for(var Un=G.length,ti=Un-2*(M+1);ti+M+2<Un;ti++)R.push([ti,ti+1,ti+M+1]),W.push(ti,ti+1,ti+M+1),R.push([ti+M+1,ti+1,ti+M+2]),W.push(ti+M+1,ti+1,ti+M+2)}return{cells:R,positions:G,uvs:rt,positionsArr:pe,indicesArr:W,normalArr:De}}var bi=S(31437),po=bi.create(),Pl=bi.create(),jn=bi.create(),Hn=bi.create(),nl=bi.create();function ns(n,c,a,s,l){bi.add(n,a,s),bi.normalize(n,n),c=bi.fromValues(-n[1],n[0]);var p=bi.fromValues(-a[1],a[0]);return[l/bi.dot(c,p),c]}function fs(n,c){return bi.set(n,-c[1],c[0])}function Io(n,c,a){return bi.sub(n,c,a),bi.normalize(n,n),n}function au(n,c){return n[0]===c[0]&&n[1]===c[1]}function Bc(n){for(var c=new Map,a=0;a<n.length;a++){var s=n[0].toString()+"-"+n[1].toString();c.get(s)?(n.splice(a,1),a++):c.set(s,s)}return n}var tc=function(){function n(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,cr.Z)(this,n),(0,j.Z)(this,"complex",void 0),(0,j.Z)(this,"join",void 0),(0,j.Z)(this,"cap",void 0),(0,j.Z)(this,"miterLimit",void 0),(0,j.Z)(this,"thickness",void 0),(0,j.Z)(this,"normal",void 0),(0,j.Z)(this,"lastFlip",-1),(0,j.Z)(this,"miter",bi.fromValues(0,0)),(0,j.Z)(this,"started",!1),(0,j.Z)(this,"dash",!1),(0,j.Z)(this,"totalDistance",0),this.join=c.join||"miter",this.cap=c.cap||"butt",this.miterLimit=c.miterLimit||10,this.thickness=c.thickness||1,this.dash=c.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,Mr.Z)(n,[{key:"extrude_gaode2",value:function(a,s){var l=this.complex;if(a.length<=1)return l;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var p=a.length,_=l.startIndex,C=1;C<p;C++){var M=a[C-1],R=s[C-1],W=a[C],G=s[C],pe=C<a.length-1?a[C+1]:null,De=C<s.length-1?s[C+1]:null,rt=this.segment_gaode2(l,_,M,W,pe,R,G,De);_+=rt}if(this.dash)for(var Tt=0;Tt<l.positions.length/6;Tt++)l.positions[Tt*6+5]=this.totalDistance;return l.startIndex=l.positions.length/6,l}},{key:"extrude",value:function(a){var s=this.complex;if(a.length<=1)return s;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var l=a.length,p=s.startIndex,_=1;_<l;_++){var C=a[_-1],M=a[_],R=_<a.length-1?a[_+1]:null,W=this.segment(s,p,C,M,R);p+=W}if(this.dash)for(var G=0;G<s.positions.length/6;G++)s.positions[G*6+5]=this.totalDistance;return s.startIndex=s.positions.length/6,s}},{key:"segment_gaode2",value:function(a,s,l,p,_,C,M,R){var W=0,G=a.indices,pe=a.positions,De=a.normals,rt=this.cap==="square",Tt=this.join==="bevel",qt=(0,Ke.Z)([M[0],M[1]]),_r=(0,Ke.Z)([C[0],C[1]]);Io(jn,p,l);var Hr=0;if(this.dash&&(Hr=this.lineSegmentDistance(qt,_r),this.totalDistance+=Hr),this.normal||(this.normal=bi.create(),fs(this.normal,jn)),!this.started)if(this.started=!0,rt){var cn=bi.create(),_n=bi.create();bi.add(cn,this.normal,jn),bi.add(_n,this.normal,jn),De.push(_n[0],_n[1],0),De.push(cn[0],cn[1],0),pe.push(l[0],l[1],0,this.totalDistance-Hr,-this.thickness,0),pe.push(l[0],l[1],0,this.totalDistance-Hr,this.thickness,0)}else this.extrusions(pe,De,l,this.normal,this.thickness,this.totalDistance-Hr);if(G.push(s+0,s+1,s+2),_){au(p,_)&&bi.add(_,p,bi.normalize(_,bi.subtract(_,p,l))),Io(Hn,_,p);var ni=ns(nl,bi.create(),jn,Hn,this.thickness),Si=(0,Yi.Z)(ni,2),qi=Si[0],_a=Si[1],yi=bi.dot(nl,this.normal)<0?-1:1,Ta=Tt;if(!Ta&&this.join==="miter"){var Ua=qi;Ua>this.miterLimit&&(Ta=!0)}Ta?(De.push(this.normal[0],this.normal[1],0),De.push(_a[0],_a[1],0),pe.push(p[0],p[1],0,this.totalDistance,-this.thickness*yi,0),pe.push(p[0],p[1],0,this.totalDistance,this.thickness*yi,0),G.push.apply(G,(0,ie.Z)(this.lastFlip!==-yi?[s,s+2,s+3]:[s+2,s+1,s+3])),G.push(s+2,s+3,s+4),fs(po,Hn),bi.copy(this.normal,po),De.push(this.normal[0],this.normal[1],0),pe.push(p[0],p[1],0,this.totalDistance,-this.thickness*yi,0),W+=3):(this.extrusions(pe,De,p,_a,qi,this.totalDistance),G.push.apply(G,(0,ie.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),yi=-1,bi.copy(this.normal,_a),W+=2),this.lastFlip=yi}else{if(fs(this.normal,jn),rt){var Un=bi.create(),ti=bi.create();bi.sub(ti,jn,this.normal),bi.add(Un,jn,this.normal),De.push(ti[0],ti[1],0),De.push(Un[0],Un[1],0),pe.push(p[0],p[1],0,this.totalDistance,this.thickness,0),pe.push(p[0],p[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(pe,De,p,this.normal,this.thickness,this.totalDistance);G.push.apply(G,(0,ie.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),W+=2}return W}},{key:"segment",value:function(a,s,l,p,_){var C=0,M=a.indices,R=a.positions,W=a.normals,G=this.cap==="square",pe=this.join==="bevel",De=(0,Ke.Z)([p[0],p[1]]),rt=(0,Ke.Z)([l[0],l[1]]);Io(jn,De,rt);var Tt=0;if(this.dash&&(Tt=this.lineSegmentDistance(De,rt),this.totalDistance+=Tt),this.normal||(this.normal=bi.create(),fs(this.normal,jn)),!this.started)if(this.started=!0,G){var qt=bi.create(),_r=bi.create();bi.add(qt,this.normal,jn),bi.add(_r,this.normal,jn),W.push(_r[0],_r[1],0),W.push(qt[0],qt[1],0),R.push(l[0],l[1],0,this.totalDistance-Tt,-this.thickness,0),R.push(l[0],l[1],0,this.totalDistance-Tt,this.thickness,0)}else this.extrusions(R,W,l,this.normal,this.thickness,this.totalDistance-Tt);if(M.push(s+0,s+1,s+2),_){var _n=(0,Ke.Z)([_[0],_[1]]);au(De,_n)&&bi.add(_n,De,bi.normalize(_n,bi.subtract(_n,De,rt))),Io(Hn,_n,De);var Un=ns(nl,bi.create(),jn,Hn,this.thickness),ti=(0,Yi.Z)(Un,2),ni=ti[0],Si=ti[1],qi=bi.dot(nl,this.normal)<0?-1:1,_a=pe;if(!_a&&this.join==="miter"){var yi=ni;yi>this.miterLimit&&(_a=!0)}_a?(W.push(this.normal[0],this.normal[1],0),W.push(Si[0],Si[1],0),R.push(p[0],p[1],0,this.totalDistance,-this.thickness*qi,0),R.push(p[0],p[1],0,this.totalDistance,this.thickness*qi,0),M.push.apply(M,(0,ie.Z)(this.lastFlip!==-qi?[s,s+2,s+3]:[s+2,s+1,s+3])),M.push(s+2,s+3,s+4),fs(po,Hn),bi.copy(this.normal,po),W.push(this.normal[0],this.normal[1],0),R.push(p[0],p[1],0,this.totalDistance,-this.thickness*qi,0),C+=3):(this.extrusions(R,W,p,Si,ni,this.totalDistance),M.push.apply(M,(0,ie.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),qi=-1,bi.copy(this.normal,Si),C+=2),this.lastFlip=qi}else{if(fs(this.normal,jn),G){var Hr=bi.create(),cn=bi.create();bi.sub(cn,jn,this.normal),bi.add(Hr,jn,this.normal),W.push(cn[0],cn[1],0),W.push(Hr[0],Hr[1],0),R.push(p[0],p[1],0,this.totalDistance,this.thickness,0),R.push(p[0],p[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(R,W,p,this.normal,this.thickness,this.totalDistance);M.push.apply(M,(0,ie.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),C+=2}return C}},{key:"extrusions",value:function(a,s,l,p,_,C){s.push(p[0],p[1],0),s.push(p[0],p[1],0),a.push(l[0],l[1],0,C,-_,0),a.push(l[0],l[1],0,C,_,0)}},{key:"lineSegmentDistance",value:function(a,s){var l=s[0]-a[0],p=s[1]-a[1];return Math.sqrt(l*l+p*p)}}]),n}();function Gi(n){if(Ai()(n[0]))return n;if(Ai()(n[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Ai()(n[0][0][0])){var c=n,a=0,s=0,l=0;return c.forEach(function(p){p.forEach(function(_){a+=_[0],s+=_[1],l++})}),[a/l,s/l,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}var Ui=S(77160);function ef(n){var c=n[0][0],a=n[0][n[0].length-1];c[0]===a[0]&&c[1]===a[1]&&(n[0]=n[0].slice(0,n[0].length-1));for(var s=n[0].length,l=Mo().flatten(n),p=l.vertices,_=l.dimensions,C=[],M=[],R=0;R<p.length/_;R++)_===2?C.push(p[R*2],p[R*2+1],1):C.push(p[R*3],p[R*3+1],1);var W=Mo()(l.vertices,l.holes,l.dimensions);M.push.apply(M,(0,ie.Z)(W));for(var G=function(rt){var Tt=l.vertices.slice(rt*_,(rt+1)*_),qt=l.vertices.slice((rt+1)*_,(rt+2)*_);qt.length===0&&(qt=l.vertices.slice(0,_));var _r=C.length/3;C.push(Tt[0],Tt[1],1,qt[0],qt[1],1,Tt[0],Tt[1],0,qt[0],qt[1],0),M.push.apply(M,(0,ie.Z)([0,2,1,2,3,1].map(function(Hr){return Hr+_r})))},pe=0;pe<s;pe++)G(pe);return{positions:C,index:M}}function Ps(n){var c=Mo().flatten(n),a=Mo()(c.vertices,c.holes,c.dimensions);return{positions:c.vertices,index:a}}function Ml(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,a=n[0][0],s=n[0][n[0].length-1];a[0]===s[0]&&a[1]===s[1]&&(n[0]=n[0].slice(0,n[0].length-1));for(var l=n[0].length,p=Mo().flatten(n),_=p.vertices,C=p.dimensions,M=[],R=[],W=[],G=0;G<_.length/C;G++)C===2?M.push(_[G*2],_[G*2+1],1,-1,-1):M.push(_[G*3],_[G*3+1],1,-1,-1),W.push(0,0,1);var pe=Mo()(p.vertices,p.holes,p.dimensions);R.push.apply(R,(0,ie.Z)(pe));for(var De=function(qt){var _r=p.vertices.slice(qt*C,(qt+1)*C),Hr=p.vertices.slice((qt+1)*C,(qt+2)*C);Hr.length===0&&(Hr=p.vertices.slice(0,C));var cn=M.length/5;M.push(_r[0],_r[1],1,0,0,Hr[0],Hr[1],1,.1,0,_r[0],_r[1],0,0,.8,Hr[0],Hr[1],0,.1,.8);var _n=Ms([Hr[0],Hr[1],1],[_r[0],_r[1],0],[_r[0],_r[1],1],c);W.push.apply(W,(0,ie.Z)(_n).concat((0,ie.Z)(_n),(0,ie.Z)(_n),(0,ie.Z)(_n))),R.push.apply(R,(0,ie.Z)([1,2,0,3,2,1].map(function(Un){return Un+cn})))},rt=0;rt<l;rt++)De(rt);return{positions:M,index:R,normals:W}}function Ms(n,c,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=Ui.create(),p=Ui.create(),_=Ui.create();s&&(n=(0,Ke.vP)(n),c=(0,Ke.vP)(c),a=(0,Ke.vP)(a));var C=Ui.fromValues.apply(Ui,(0,ie.Z)(n)),M=Ui.fromValues.apply(Ui,(0,ie.Z)(c)),R=Ui.fromValues.apply(Ui,(0,ie.Z)(a));Ui.sub(l,R,M),Ui.sub(p,C,M),Ui.cross(_,l,p);var W=Ui.create();return Ui.normalize(W,_),W}var Va,ou;(function(n){n.CYLINDER="cylinder",n.SQUARECOLUMN="squareColumn",n.TRIANGLECOLUMN="triangleColumn",n.HEXAGONCOLUMN="hexagonColumn",n.PENTAGONCOLUMN="pentagonColumn"})(ou||(ou={}));var xs;(function(n){n.CIRCLE="circle",n.SQUARE="square",n.TRIANGLE="triangle",n.HEXAGON="hexagon",n.PENTAGON="pentagon"})(xs||(xs={}));function Gu(n){for(var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=Math.PI*2/n,s=[],l=0;l<n;l++)s.push(a*l+c*Math.PI/12);var p=s.map(function(_){var C=Math.sin(_+Math.PI/4),M=Math.cos(_+Math.PI/4);return[C,M,0]});return p}function il(){return Gu(30)}function Il(){return Gu(4)}function rc(){return Gu(3)}function al(){return Gu(6,1)}function ol(){return Gu(5)}var sl=(Va={},(0,j.Z)(Va,xs.CIRCLE,il),(0,j.Z)(Va,xs.HEXAGON,al),(0,j.Z)(Va,xs.TRIANGLE,rc),(0,j.Z)(Va,xs.SQUARE,Il),(0,j.Z)(Va,xs.PENTAGON,ol),(0,j.Z)(Va,ou.CYLINDER,il),(0,j.Z)(Va,ou.HEXAGONCOLUMN,al),(0,j.Z)(Va,ou.TRIANGLECOLUMN,rc),(0,j.Z)(Va,ou.SQUARECOLUMN,Il),(0,j.Z)(Va,ou.PENTAGONCOLUMN,ol),Va),Cu={};function Hu(n){var c=Gi(n.coordinates);return{vertices:[].concat((0,ie.Z)(c),(0,ie.Z)(c),(0,ie.Z)(c),(0,ie.Z)(c)),indices:[0,1,2,2,3,0],size:c.length}}function xc(n){var c=Gi(n.coordinates),a=rl(c);return{vertices:[].concat((0,ie.Z)(a),(0,ie.Z)(a),(0,ie.Z)(a),(0,ie.Z)(a)),indices:[0,1,2,2,3,0],size:a.length}}function wu(n){var c=n.shape,a=h(c,!1),s=a.positions,l=a.index,p=a.normals;return{vertices:s,indices:l,normals:p,size:5}}function Fs(n){var c=Gi(n.coordinates);return{vertices:(0,ie.Z)(c),indices:[0],size:c.length}}function Nc(n){var c=n.coordinates,a=n.originCoordinates,s=n.version,l=new tc({dash:!0,join:"bevel"});if(s==="GAODE2.x"){var p=c;Array.isArray(p[0][0])||(p=[c]);var _=a;Array.isArray(_[0][0])||(_=[a]);for(var C=0;C<p.length;C++){var M=p[C],R=_[C];l.extrude_gaode2(M,R)}}else{var W=c;Array.isArray(W[0][0])||(W=[c]),W.forEach(function(pe){l.extrude(pe)})}var G=l.complex;return{vertices:G.positions,indices:G.indices,normals:G.normals,size:6}}function nc(n){var c=n.coordinates,a=Mo().flatten(c),s=a.vertices,l=a.dimensions,p=a.holes;return{indices:Mo()(s,p,l),vertices:s,size:l}}function Bl(n){var c=n.coordinates,a=Ml(c,!0),s=a.positions,l=a.index,p=a.normals;return{vertices:s,indices:l,normals:p,size:5}}function ul(n){var c=n.shape,a=D(c),s=a.positions,l=a.index;return{vertices:s,indices:l,size:3}}function i(n){var c=n.coordinates,a=[].concat((0,ie.Z)(c[0]),[0,0,1,c[1][0],c[0][1],0,1,1],(0,ie.Z)(c[1]),[0,1,0],(0,ie.Z)(c[0]),[0,0,1],(0,ie.Z)(c[1]),[0,1,0,c[0][0],c[1][1],0,0,0]),s=[0,1,2,3,4,5];return{vertices:a,indices:s,size:5}}function u(n,c){for(var a=c||30,s=n.coordinates,l=[],p=[],_=function(R){l.push(R,1,R,s[0][0],s[0][1],s[1][0],s[1][1],R,-1,R,s[0][0],s[0][1],s[1][0],s[1][1]),R!==a-1&&p.push.apply(p,(0,ie.Z)([0,1,2,1,3,2].map(function(W){return R*2+W})))},C=0;C<a;C++)_(C);return{vertices:l,indices:p,size:7}}function o(n){var c=n.coordinates;c.length===2&&c.push(0);var a=n.size,s=V(-1,1),l=V(1,1),p=V(-1,-1),_=V(1,-1),C=[].concat((0,ie.Z)(c),(0,ie.Z)(s),(0,ie.Z)(c),(0,ie.Z)(p),(0,ie.Z)(c),(0,ie.Z)(_),(0,ie.Z)(c),(0,ie.Z)(l)),M=[0,1,2,3,0,2];return{vertices:C,indices:M,size:5}}function h(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Cu&&Cu[n])return Cu[n];var a=sl[n]?sl[n]():sl.cylinder(),s=Ml([a],c);return Cu[n]=s,s}function y(n,c){for(var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=new Float32Array(n.length/a*3),p,_,C,M=vec3.create(),R=vec3.create(),W=vec3.create(),G=0,pe=c.length;G<pe;G+=3){p=c[G+0]*3,_=c[G+1]*3,C=c[G+2]*3;var De=[n[p],n[p+1]],rt=[n[_],n[_+1]],Tt=[n[C],n[C+1]];s&&(De=lngLatToMeters(De),rt=lngLatToMeters(rt),Tt=lngLatToMeters(Tt));var qt=De,_r=_slicedToArray(qt,2),Hr=_r[0],cn=_r[1],_n=vec3.fromValues(Hr,cn,n[p+2]),Un=rt,ti=_slicedToArray(Un,2),ni=ti[0],Si=ti[1],qi=vec3.fromValues(ni,Si,n[_+2]),_a=Tt,yi=_slicedToArray(_a,2),Ta=yi[0],Ua=yi[1],lu=vec3.fromValues(Ta,Ua,n[C+2]);vec3.sub(M,lu,qi),vec3.sub(R,_n,qi),vec3.cross(W,M,R),l[p]+=M[0],l[p+1]+=M[1],l[p+2]+=M[2],l[_]+=M[0],l[_+1]+=M[1],l[_+2]+=M[2],l[C]+=M[0],l[C+1]+=M[1],l[C+2]+=M[2]}return b(l),l}function b(n){for(var c=0,a=n.length;c<a;c+=3){var s=vec3.fromValues(n[c],n[c+1],n[c+2]),l=vec3.create();vec3.normalize(l,s),n.set(l,c)}}function T(n){var c=n[0][0],a=n[0][n[0].length-1];return c[0]===a[0]&&c[1]===a[1]}function D(n){var c=["cylinder","triangleColumn","hexagonColumn","squareColumn"],a=sl[n]?sl[n]():sl.circle(),s=c.indexOf(n)===-1?Ps([a]):ef([a]);return s}function V(n,c){var a=(n+1)/2,s=(c+1)/2;return[a,s]}function se(){var n=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),c=n.positionsArr,a=n.indicesArr,s=n.normalArr;return{vertices:c,indices:a,size:5,normals:s}}function Ce(){var n=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),c=n.positionsArr,a=n.indicesArr,s=n.normalArr;return{vertices:c,indices:a,size:5,normals:s}}function we(n){var c=Pe();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function Pe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var He=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Ge=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);
   v_texCoord = a_Uv;
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,nt=function(n){(0,Gn.Z)(a,n);var c=we(a);function a(){return(0,cr.Z)(this,a),c.apply(this,arguments)}return(0,Mr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p,C=l.baseColor,M=C===void 0?"rgb(16,16,16)":C,R=l.brightColor,W=R===void 0?"rgb(255,176,38)":R,G=l.windowColor,pe=G===void 0?"rgb(30,60,89)":G,De=l.time,rt=De===void 0?0:De;return{u_opacity:_,u_baseColor:(0,Ke.CI)(M),u_brightColor:(0,Ke.CI)(W),u_windowColor:(0,Ke.CI)(pe),u_time:this.layer.getLayerAnimateTime()||rt}}},{key:"initModels",value:function(){return this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:Ge,fragmentShader:He,triangulation:Bl})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:L.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:L.gl.STATIC_DRAW,data:[],type:L.gl.FLOAT},size:3,update:function(p,_,C,M,R){return R}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:L.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:1,update:function(p,_,C,M){var R=p.size,W=R===void 0?10:R;return Array.isArray(W)?[W[0]]:[W]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:L.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:2,update:function(p,_,C,M){var R=p.size;return[C[3],C[4]]}}})}}]),a}(Po);function ze(n){var c=it();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function it(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var bt=function(n){(0,Gn.Z)(a,n);var c=ze(a);function a(){var s;(0,cr.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,j.Z)((0,gt.Z)(s),"type","PolygonLayer"),s}return(0,Mr.Z)(a,[{key:"buildModels",value:function(){this.layerModel=new nt(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(l){this.updateLayerConfig({time:l})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),a}(Ou);function Vt(n){var c=gr();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function gr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var fr=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,Er=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,jr=function(n){(0,Gn.Z)(a,n);var c=Vt(a);function a(){return(0,cr.Z)(this,a),c.apply(this,arguments)}return(0,Mr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.coverage,C=l.angle;return{u_opacity:p||1,u_coverage:_||.9,u_angle:C||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:fr,fragmentShader:Er,triangulation:ul,depth:{enable:!1},primitive:L.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:L.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:3,update:function(p,_){var C=p.version==="GAODE2.x"?p.originCoordinates:p.coordinates;return[C[0],C[1],0]}}})}}]),a}(Po);function fn(n){var c=tn();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function tn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Zn=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,si=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,ui=function(n){(0,Gn.Z)(a,n);var c=fn(a);function a(){return(0,cr.Z)(this,a),c.apply(this,arguments)}return(0,Mr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.coverage,C=l.angle;return{u_opacity:p||1,u_coverage:_||1,u_angle:C||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:Zn,fragmentShader:si,triangulation:wu,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:L.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:1,update:function(p,_,C,M){var R=p.size;return Array.isArray(R)?[R[0]]:[R]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:L.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:L.gl.STATIC_DRAW,data:[],type:L.gl.FLOAT},size:3,update:function(p,_,C,M,R){return R}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:L.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:3,update:function(p,_){var C=p.version==="GAODE2.x"?p.originCoordinates:p.coordinates;return[C[0],C[1],0]}}})}}]),a}(Po),dn=S(85975);function ia(n,c){for(var a=[],s=[],l=[],p=n+1,_=c+1,C=n/2,M=c/2,R=0;R<_;R++)for(var W=R-M,G=0;G<p;G++){var pe=G-C;s.push(pe/C,-W/M,0),l.push(G/n),l.push(1-R/c)}for(var De=0;De<c;De++)for(var rt=0;rt<n;rt++){var Tt=rt+p*De,qt=rt+p*(De+1),_r=rt+1+p*(De+1),Hr=rt+1+p*De;a.push(Tt,qt,Hr),a.push(qt,_r,Hr)}return{vertices:s,indices:a,uvs:l}}var Wn,xi;function ji(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function vi(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?ji(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):ji(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Ci(n){var c=Q();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function Q(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var J=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,O=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,F=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,ne=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,xe=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 3.0;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,pt=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,Pt=(Wn=(0,ln.b2)(),Wn(xi=function(n){(0,Gn.Z)(a,n);var c=Ci(a);function a(){var s;(0,cr.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,j.Z)((0,gt.Z)(s),"texture",void 0),(0,j.Z)((0,gt.Z)(s),"colorTexture",void 0),(0,j.Z)((0,gt.Z)(s),"heatmapFramerBuffer",void 0),(0,j.Z)((0,gt.Z)(s),"intensityModel",void 0),(0,j.Z)((0,gt.Z)(s),"colorModel",void 0),(0,j.Z)((0,gt.Z)(s),"shapeType",void 0),s}return(0,Mr.Z)(a,[{key:"render",value:function(){var l=this,p=this.rendererService,_=p.clear,C=p.useFramebuffer;C(this.heatmapFramerBuffer,function(){_({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l.heatmapFramerBuffer}),l.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var l,p=this.rendererService,_=p.createFramebuffer,C=p.clear,M=p.getViewportSize,R=p.createTexture2D,W=p.useFramebuffer,G=this.styleAttributeService.getLayerStyleAttribute("shape"),pe=(G==null||(l=G.scale)===null||l===void 0?void 0:l.field)||"heatmap";this.shapeType=pe,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=pe==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var De=this.layer.getLayerConfig(),rt=De.rampColors,Tt=(0,Ke.Cl)(rt),qt=M(),_r=qt.width,Hr=qt.height;return this.heatmapFramerBuffer=_({color:R({width:Math.floor(_r/4),height:Math.floor(Hr/4),wrapS:L.gl.CLAMP_TO_EDGE,wrapT:L.gl.CLAMP_TO_EDGE,min:L.gl.LINEAR,mag:L.gl.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:L.AttributeType.Attribute,descriptor:{name:"a_Dir",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:2,update:function(p,_,C,M){return[C[3],C[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:L.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:1,update:function(p,_,C,M){var R=p.size,W=R===void 0?1:R;return[W]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:xe,fragmentShader:ne,triangulation:o,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:L.gl.ONE,srcAlpha:1,dstRGB:L.gl.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:pt,fs:F});var l=this.shaderModuleService.getModule("heatmapColor"),p=l.vs,_=l.fs,C=l.uniforms,M=this.rendererService,R=M.createAttribute,W=M.createElements,G=M.createBuffer,pe=M.createModel;return pe({vs:p,fs:_,attributes:{a_Position:R({buffer:G({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:L.gl.FLOAT}),size:3}),a_Uv:R({buffer:G({data:[0,1,1,1,0,0,1,0],type:L.gl.FLOAT}),size:2})},uniforms:vi({},C),depth:{enable:!1},blend:this.getBlend(),count:6,elements:W({data:[0,2,1,2,3,1],type:L.gl.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.intensity,C=_===void 0?10:_,M=l.radius,R=M===void 0?5:M;this.intensityModel.draw({uniforms:{u_opacity:p||1,u_radius:R,u_intensity:C}})}},{key:"drawColorMode",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity;this.colorModel.draw({uniforms:{u_opacity:p||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=dn.create();dn.invert(_,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:p||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,ie.Z)(_)}})}},{key:"build3dHeatMap",value:function(){var l=this.rendererService.getViewportSize,p=l(),_=p.width,C=p.height,M=ia(_/4,C/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:O,fs:J});var R=this.shaderModuleService.getModule("heatmap3dColor"),W=R.vs,G=R.fs,pe=R.uniforms,De=this.rendererService,rt=De.createAttribute,Tt=De.createElements,qt=De.createBuffer,_r=De.createModel;return _r({vs:W,fs:G,attributes:{a_Position:rt({buffer:qt({data:M.vertices,type:L.gl.FLOAT}),size:3}),a_Uv:rt({buffer:qt({data:M.uvs,type:L.gl.FLOAT}),size:2})},primitive:L.gl.TRIANGLES,uniforms:vi({},pe),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:L.gl.SRC_ALPHA,srcAlpha:1,dstRGB:L.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:Tt({data:M.indices,type:L.gl.UNSIGNED_INT,count:M.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var l=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var p=this.layer.getLayerConfig(),_=p.rampColors,C=(0,Ke.Cl)(_);this.colorTexture=l({data:new Uint8Array(C.data),width:C.width,height:C.height,wrapS:L.gl.CLAMP_TO_EDGE,wrapT:L.gl.CLAMP_TO_EDGE,min:L.gl.NEAREST,mag:L.gl.NEAREST,flipY:!1})}}]),a}(Po))||xi);function xt(n){var c=ur();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function ur(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Vr=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Jn=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Xn=function(n){(0,Gn.Z)(a,n);var c=xt(a);function a(){return(0,cr.Z)(this,a),c.apply(this,arguments)}return(0,Mr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.coverage,C=l.angle;return{u_opacity:p||1,u_coverage:_||.9,u_angle:C||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:Jn,fragmentShader:Vr,triangulation:ul,depth:{enable:!1},primitive:L.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:L.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:3,update:function(p,_){var C=p.version==="GAODE2.x"?p.originCoordinates:p.coordinates;return[C[0],C[1],0]}}})}}]),a}(Po),li={heatmap:Pt,heatmap3d:Pt,grid:jr,grid3d:ui,hexagon:Xn},mi=li;function Ri(n){var c=aa();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function aa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var pa=function(n){(0,Gn.Z)(a,n);var c=Ri(a);function a(){var s;(0,cr.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,j.Z)((0,gt.Z)(s),"type","HeatMapLayer"),s}return(0,Mr.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new mi[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var l=this,p=this.getModelType();return p==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(_){return _.draw({uniforms:l.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,p=this.styleAttributeService.getLayerStyleAttribute("shape"),_=this.getLayerConfig(),C=_.shape3d,M=this.getSource(),R=M.data.type,W=(p==null||(l=p.scale)===null||l===void 0?void 0:l.field)||"heatmap";return W==="heatmap"||W==="heatmap3d"?"heatmap":R==="hexagon"?(C==null?void 0:C.indexOf(W))===-1?"hexagon":"grid3d":R==="grid"?(C==null?void 0:C.indexOf(W))===-1?"grid":"grid3d":"heatmap"}}]),a}(Ou);function ba(n){var c=go();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function go(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ca=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,Bo=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,ka=function(n){(0,Gn.Z)(a,n);var c=ba(a);function a(){var s;(0,cr.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,j.Z)((0,gt.Z)(s),"texture",void 0),s}return(0,Mr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity;return{u_opacity:p||1,u_texture:this.texture}}},{key:"initModels",value:function(){var l=this,p=this.layer.getSource(),_=this.rendererService.createTexture2D;return this.texture=_({height:0,width:0}),p.data.images.then(function(C){l.texture=_({data:C[0],width:C[0].width,height:C[0].height}),l.layerService.renderLayers()}),[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:Bo,fragmentShader:Ca,triangulation:i,primitive:L.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:L.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:2,update:function(p,_,C,M){return[C[3],C[4]]}}})}}]),a}(Po),Zi={image:ka},da=Zi;function $a(n){var c=yo();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function yo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Pi=function(n){(0,Gn.Z)(a,n);var c=$a(a);function a(){var s;(0,cr.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,j.Z)((0,gt.Z)(s),"type","ImageLayer"),s}return(0,Mr.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new da[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),p={image:{}};return p[l]}},{key:"getModelType",value:function(){return"image"}}]),a}(Ou);function oo(n){var c=Ga();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function Ga(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Hs=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float d_texCount = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float u = 1.0 - fract(arcRadio * d_texCount + animateSpeed);

    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = vec4(1.0 - fract(arcRadio * 20000.0), 0.0, 0.0, 1.0);
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
    // gl_FragColor = filterColor(texture2D(u_texture, uv));
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,Nl=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  if(u_line_type == LineTypeDash) {
      d_distance_ratio = segmentIndex / segmentNumber;

      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Bs={solid:0,dash:1},Lu=function(n){(0,Gn.Z)(a,n);var c=oo(a);function a(){var s;(0,cr.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,j.Z)((0,gt.Z)(s),"texture",void 0),(0,j.Z)((0,gt.Z)(s),"updateTexture",function(){var C=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=C({data:s.iconService.getCanvas(),mag:L.gl.NEAREST,min:L.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,Mr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.sourceColor,C=l.targetColor,M=l.textureBlend,R=M===void 0?"normal":M,W=l.lineType,G=W===void 0?"solid":W,pe=l.dashArray,De=pe===void 0?[10,5]:pe,rt=l.forward,Tt=rt===void 0?!0:rt,qt=l.lineTexture,_r=qt===void 0?!1:qt,Hr=l.iconStep,cn=Hr===void 0?100:Hr,_n=l.segmentNumber,Un=_n===void 0?30:_n,ti=l.thetaOffset,ni=ti===void 0?.314:ti;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var Si=this.layer.getEncodedData(),qi=this.calDataFrame(this.cellLength,Si,this.cellProperties),_a=qi.data,yi=qi.width,Ta=qi.height;this.rowCount=Ta,this.dataTexture=this.cellLength>0&&_a.length>0?this.createTexture2D({flipY:!0,data:_a,format:L.gl.LUMINANCE,type:L.gl.FLOAT,width:yi,height:Ta}):this.createTexture2D({flipY:!0,data:[1],format:L.gl.LUMINANCE,type:L.gl.FLOAT,width:1,height:1})}De.length===2&&De.push(0,0);var Ua=0,lu=[0,0,0,0],zf=[0,0,0,0];return _&&C&&(lu=(0,Ke.CI)(_),zf=(0,Ke.CI)(C),Ua=1),this.rendererService.getDirty()&&this.texture.bind(),{u_thetaOffset:ni,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ai()(p)?p:1,u_textureBlend:R==="normal"?0:1,segmentNumber:Un,u_line_type:Bs[G||"solid"],u_dash_array:De,u_blur:.9,u_lineDir:Tt?1:-1,u_texture:this.texture,u_line_texture:_r?1:0,u_icon_step:cn,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ua,u_sourceColor:lu,u_targetColor:zf}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),p=l.animateOption;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,p;(l=this.texture)===null||l===void 0||l.destroy(),(p=this.dataTexture)===null||p===void 0||p.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var l=this.layer.getLayerConfig(),p=l.segmentNumber,_=p===void 0?30:p;return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:Nl,fragmentShader:Hs,triangulation:u,depth:{enable:!1},blend:this.getBlend(),segmentNumber:_})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:L.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:1,update:function(_,C,M,R){var W=_.size,G=W===void 0?1:W;return Array.isArray(G)?[G[0]]:[G]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:L.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:L.gl.STATIC_DRAW,data:[],type:L.gl.FLOAT},size:4,update:function(_,C,M,R){return[M[3],M[4],M[5],M[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:L.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:2,update:function(_,C,M,R){var W=l.iconService.getIconMap(),G=_.texture,pe=W[G]||{x:0,y:0},De=pe.x,rt=pe.y;return[De,rt]}}})}}]),a}(Po);function Ru(n){var c=zl();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function zl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ll=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float u = fract(arcRadio * count - animateSpeed * count);
 
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,Ul=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,ic={solid:0,dash:1},Wu=function(n){(0,Gn.Z)(a,n);var c=Ru(a);function a(){var s;(0,cr.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,j.Z)((0,gt.Z)(s),"texture",void 0),(0,j.Z)((0,gt.Z)(s),"updateTexture",function(){var C=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=C({data:s.iconService.getCanvas(),mag:L.gl.NEAREST,min:L.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,Mr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.sourceColor,C=l.targetColor,M=l.textureBlend,R=M===void 0?"normal":M,W=l.lineType,G=W===void 0?"solid":W,pe=l.dashArray,De=pe===void 0?[10,5]:pe,rt=l.lineTexture,Tt=rt===void 0?!1:rt,qt=l.iconStep,_r=qt===void 0?100:qt,Hr=l.segmentNumber,cn=Hr===void 0?30:Hr,_n=l.globalArcHeight,Un=_n===void 0?10:_n;De.length===2&&De.push(0,0);var ti=0,ni=[0,0,0,0],Si=[0,0,0,0];if(_&&C&&(ni=(0,Ke.CI)(_),Si=(0,Ke.CI)(C),ti=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var qi=this.layer.getEncodedData(),_a=this.calDataFrame(this.cellLength,qi,this.cellProperties),yi=_a.data,Ta=_a.width,Ua=_a.height;this.rowCount=Ua,this.dataTexture=this.cellLength>0&&yi.length>0?this.createTexture2D({flipY:!0,data:yi,format:L.gl.LUMINANCE,type:L.gl.FLOAT,width:Ta,height:Ua}):this.createTexture2D({flipY:!0,data:[1],format:L.gl.LUMINANCE,type:L.gl.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:ta,u_global_height:Un,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ai()(p)?p:1,u_textureBlend:R==="normal"?0:1,segmentNumber:cn,u_line_type:ic[G]||0,u_dash_array:De,u_texture:this.texture,u_line_texture:Tt?1:0,u_icon_step:_r,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:ti,u_sourceColor:ni,u_targetColor:Si}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),p=l.animateOption;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,p;(l=this.texture)===null||l===void 0||l.destroy(),(p=this.dataTexture)===null||p===void 0||p.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var l=this.layer.getLayerConfig(),p=l.segmentNumber,_=p===void 0?30:p;return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:Ul,fragmentShader:ll,triangulation:u,blend:this.getBlend(),segmentNumber:_})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:L.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:1,update:function(_,C,M,R){var W=_.size,G=W===void 0?1:W;return Array.isArray(G)?[G[0]]:[G]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:L.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:L.gl.STATIC_DRAW,data:[],type:L.gl.FLOAT},size:4,update:function(_,C,M,R){return[M[3],M[4],M[5],M[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:L.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:2,update:function(_,C,M,R){var W=l.iconService.getIconMap(),G=_.texture,pe=W[G]||{x:0,y:0},De=pe.x,rt=pe.y;return[De,rt]}}})}}]),a}(Po);function hs(n){var c=Uf();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function Uf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var yf=`#define LineTypeSolid 0.0
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
  gl_FragColor = filterColor(gl_FragColor);
}`,_f=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,ih=function(n){(0,Gn.Z)(a,n);var c=hs(a);function a(){return(0,cr.Z)(this,a),c.apply(this,arguments)}return(0,Mr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.sourceColor,C=l.targetColor,M=l.forward,R=M===void 0?!0:M,W=l.segmentNumber,G=W===void 0?30:W,pe=l.thetaOffset,De=pe===void 0?.314:pe,rt=0,Tt=[0,0,0,0],qt=[0,0,0,0];return _&&C&&(Tt=(0,Ke.CI)(_),qt=(0,Ke.CI)(C),rt=1),{u_thetaOffset:De,u_opacity:Ai()(p)?p:1,segmentNumber:G,u_blur:.9,u_lineDir:R?1:-1,u_linearColor:rt,u_sourceColor:Tt,u_targetColor:qt}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),p=l.animateOption;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var l=this.layer.getLayerConfig(),p=l.segmentNumber,_=p===void 0?30:p;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:_f,fragmentShader:yf,triangulation:u,depth:{enable:!1},blend:this.getBlend(),segmentNumber:_})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:L.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:1,update:function(p,_,C,M){var R=p.size,W=R===void 0?1:R;return Array.isArray(W)?[W[0]]:[W]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:L.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:L.gl.STATIC_DRAW,data:[],type:L.gl.FLOAT},size:4,update:function(p,_,C,M){return[C[3],C[4],C[5],C[6]]}}})}}]),a}(Po);function ah(n){var c=tf();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function tf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var bc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,pp=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,Zf={solid:0,dash:1},oh=function(n){(0,Gn.Z)(a,n);var c=ah(a);function a(){var s;(0,cr.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,j.Z)((0,gt.Z)(s),"texture",void 0),(0,j.Z)((0,gt.Z)(s),"updateTexture",function(){var C=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=C({data:s.iconService.getCanvas(),mag:L.gl.NEAREST,min:L.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,Mr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.sourceColor,C=l.targetColor,M=l.textureBlend,R=M===void 0?"normal":M,W=l.lineType,G=W===void 0?"solid":W,pe=l.dashArray,De=pe===void 0?[10,5]:pe,rt=l.lineTexture,Tt=rt===void 0?!1:rt,qt=l.iconStep,_r=qt===void 0?100:qt,Hr=l.segmentNumber,cn=Hr===void 0?30:Hr;De.length===2&&De.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var _n=0,Un=[0,0,0,0],ti=[0,0,0,0];if(_&&C&&(Un=(0,Ke.CI)(_),ti=(0,Ke.CI)(C),_n=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var ni=this.layer.getEncodedData(),Si=this.calDataFrame(this.cellLength,ni,this.cellProperties),qi=Si.data,_a=Si.width,yi=Si.height;this.rowCount=yi,this.dataTexture=this.cellLength>0&&qi.length>0?this.createTexture2D({flipY:!0,data:qi,format:L.gl.LUMINANCE,type:L.gl.FLOAT,width:_a,height:yi}):this.createTexture2D({flipY:!0,data:[1],format:L.gl.LUMINANCE,type:L.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ai()(p)?p:1,u_textureBlend:R==="normal"?0:1,segmentNumber:cn,u_line_type:Zf[G]||0,u_dash_array:De,u_texture:this.texture,u_line_texture:Tt?1:0,u_icon_step:_r,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:_n,u_sourceColor:Un,u_targetColor:ti}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),p=l.animateOption;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,p;(l=this.texture)===null||l===void 0||l.destroy(),(p=this.dataTexture)===null||p===void 0||p.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:pp,fragmentShader:bc,triangulation:u,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:L.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:1,update:function(_,C,M,R){var W=_.size,G=W===void 0?1:W;return Array.isArray(G)?[G[0]]:[G]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:L.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:L.gl.STATIC_DRAW,data:[],type:L.gl.FLOAT},size:4,update:function(_,C,M,R){return[M[3],M[4],M[5],M[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:L.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:2,update:function(_,C,M,R){var W=l.iconService.getIconMap(),G=_.texture,pe=W[G]||{x:0,y:0},De=pe.x,rt=pe.y;return[De,rt]}}})}}]),a}(Po);function ac(n){var c=rf();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function rf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var dp=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
// varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying vec4 v_dash_array;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = (vec4(1.0, 0.0, 0.0, 1.0));
 
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // if(v > 0.9) {
    // gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,nf=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    d_distance_ratio = a_Distance / a_Total_Distance;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0, 1.0)); // \u989D\u5916\u9664 8.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      lineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);
    }
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,sh={solid:0,dash:1},Lh=function(n){(0,Gn.Z)(a,n);var c=ac(a);function a(){var s;(0,cr.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,j.Z)((0,gt.Z)(s),"texture",void 0),(0,j.Z)((0,gt.Z)(s),"updateTexture",function(){var C=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=C({data:s.iconService.getCanvas(),mag:L.gl.NEAREST,min:L.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,Mr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.sourceColor,C=l.targetColor,M=l.textureBlend,R=M===void 0?"normal":M,W=l.lineType,G=W===void 0?"solid":W,pe=l.dashArray,De=pe===void 0?[10,5,0,0]:pe,rt=l.lineTexture,Tt=rt===void 0?!1:rt,qt=l.iconStep,_r=qt===void 0?100:qt;De.length===2&&De.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Hr=0,cn=[0,0,0,0],_n=[0,0,0,0];if(_&&C&&(cn=(0,Ke.CI)(_),_n=(0,Ke.CI)(C),Hr=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var Un=this.layer.getEncodedData(),ti=this.calDataFrame(this.cellLength,Un,this.cellProperties),ni=ti.data,Si=ti.width,qi=ti.height;this.rowCount=qi,this.dataTexture=this.cellLength>0&&ni.length>0?this.createTexture2D({flipY:!0,data:ni,format:L.gl.LUMINANCE,type:L.gl.FLOAT,width:Si,height:qi}):this.createTexture2D({flipY:!0,data:[1],format:L.gl.LUMINANCE,type:L.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ai()(p)?p:1,u_textureBlend:R==="normal"?0:1,u_line_type:sh[G],u_dash_array:De,u_texture:this.texture,u_line_texture:Tt?1:0,u_icon_step:_r,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Hr,u_sourceColor:cn,u_targetColor:_n}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),p=l.animateOption;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,p;(l=this.texture)===null||l===void 0||l.destroy(),(p=this.dataTexture)===null||p===void 0||p.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:nf,fragmentShader:dp,triangulation:Nc,primitive:L.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var l=this,p=this.layer.getLayerConfig(),_=p.lineType,C=_===void 0?"solid":_;this.styleAttributeService.registerStyleAttribute({name:"distance",type:L.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:L.gl.STATIC_DRAW,data:[],type:L.gl.FLOAT},size:1,update:function(R,W,G,pe){return[G[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:L.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:L.gl.STATIC_DRAW,data:[],type:L.gl.FLOAT},size:1,update:function(R,W,G,pe){return[G[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:L.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:2,update:function(R,W,G,pe){var De=R.size,rt=De===void 0?1:De;return Array.isArray(rt)?[rt[0],rt[1]]:[rt,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:L.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:L.gl.STATIC_DRAW,data:[],type:L.gl.FLOAT},size:3,update:function(R,W,G,pe,De){return De}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:L.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:L.gl.STATIC_DRAW,data:[],type:L.gl.FLOAT},size:1,update:function(R,W,G,pe){return[G[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:L.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:2,update:function(R,W,G,pe){var De=l.iconService.getIconMap(),rt=R.texture,Tt=De[rt]||{x:0,y:0},qt=Tt.x,_r=Tt.y;return[qt,_r]}}})}},{key:"loadImage",value:function(l){return new Promise(function(p,_){if(l instanceof HTMLImageElement){p(l);return}var C=new Image;C.crossOrigin="anonymous",C.onload=function(){p(C)},C.onerror=function(){_(new Error("Could not load image at "+l))},C.src=l instanceof File?URL.createObjectURL(l):l})}}]),a}(Po),vp={arc:Lu,arcmini:ih,arc3d:Wu,greatcircle:oh,line:Lh},Rh=vp;function mp(n){var c=uh();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function uh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var gp=function(n){(0,Gn.Z)(a,n);var c=mp(a);function a(){var s;(0,cr.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,j.Z)((0,gt.Z)(s),"type","LineLayer"),s}return(0,Mr.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Rh[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),p={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return p[l]}},{key:"getModelType",value:function(){var l,p=this.styleAttributeService.getLayerStyleAttribute("shape"),_=p==null||(l=p.scale)===null||l===void 0?void 0:l.field;return _||"line"}}]),a}(Ou);function af(n){var c=yp();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function yp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var is=`varying vec4 v_color;
uniform float u_opacity: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,jf=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = calc_lighting(pos);
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,lh=function(n){(0,Gn.Z)(a,n);var c=af(a);function a(){return(0,cr.Z)(this,a),c.apply(this,arguments)}return(0,Mr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_})){this.judgeStyleAttributes({opacity:_});var C=this.layer.getEncodedData(),M=this.calDataFrame(this.cellLength,C,this.cellProperties),R=M.data,W=M.width,G=M.height;this.rowCount=G,this.dataTexture=this.cellLength>0&&R.length>0?this.createTexture2D({flipY:!0,data:R,format:L.gl.LUMINANCE,type:L.gl.FLOAT,width:W,height:G}):this.createTexture2D({flipY:!0,data:[1],format:L.gl.LUMINANCE,type:L.gl.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ai()(_)?_:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:jf,fragmentShader:is,triangulation:wu,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){var l=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:L.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:3,update:function(_,C,M,R){var W=_.size;if(W){var G=[];return Array.isArray(W)&&(G=W.length===2?[W[0],W[0],W[1]]:W),Array.isArray(W)||(G=[W,W,W]),G}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:L.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:L.gl.STATIC_DRAW,data:[],type:L.gl.FLOAT},size:3,update:function(_,C,M,R,W){return W}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:L.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:3,update:function(_,C){var M=Gi(_.coordinates);return l?rl([M[0],M[1]]):[M[0],M[1],0]}}})}}]),a}(Po);function Vf(n){var c=Gf();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function Gf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var zc=`#define Animate 0.0

uniform float u_globel;
uniform float u_blur : 0;
// uniform float u_stroke_width : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  // float r = v_radius / (v_radius + u_stroke_width);
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiased_blur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);
  
 
  // float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
  //   antialiased_blur,
  //   0.0,
  //   inner_df
  // );
   float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  gl_FragColor.a = gl_FragColor.a * opacity_t;
  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    gl_FragColor = vec4(gl_FragColor.xyz, intensity);
  }

  gl_FragColor = filterColor(gl_FragColor);

  

}
`,xf=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  float antialiasblur = 1.0 / u_DevicePixelRatio / (newSize + u_stroke_width);

  // construct point coords
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  // vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + u_offsets);
  vec2 offset = project_pixel(extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,of=function(n){(0,Gn.Z)(a,n);var c=Vf(a);function a(){return(0,cr.Z)(this,a),c.apply(this,arguments)}return(0,Mr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p,C=l.strokeOpacity,M=C===void 0?1:C,R=l.strokeWidth,W=R===void 0?0:R,G=l.stroke,pe=G===void 0?"rgba(0,0,0,0)":G,De=l.offsets,rt=De===void 0?[0,0]:De;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_,strokeOpacity:M,strokeWidth:W,stroke:pe,offsets:rt})){this.judgeStyleAttributes({opacity:_,strokeOpacity:M,strokeWidth:W,stroke:pe,offsets:rt});var Tt=this.layer.getEncodedData(),qt=this.calDataFrame(this.cellLength,Tt,this.cellProperties),_r=qt.data,Hr=qt.width,cn=qt.height;this.rowCount=cn,this.dataTexture=this.cellLength>0&&_r.length>0?this.createTexture2D({flipY:!0,data:_r,format:L.gl.LUMINANCE,type:L.gl.FLOAT,width:Hr,height:cn}):this.createTexture2D({flipY:!0,data:[1],format:L.gl.LUMINANCE,type:L.gl.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ai()(_)?_:1,u_stroke_opacity:Ai()(M)?M:1,u_stroke_width:Ai()(W)?W:0,u_stroke_color:this.getStrokeColor(pe),u_offsets:this.isOffsetStatic(rt)?rt:[0,0]}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),p=l.animateOption;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Hu)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var l=this.mapService.version==="GLOBEL";return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:xf,fragmentShader:zc,triangulation:l?xc:Hu,depth:{enable:l},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"animateOption2Array",value:function(l){return[l.enable?0:1,l.speed||1,l.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var l=this,p=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:L.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:3,update:function(C,M,R,W){var G;if(p){var pe=(0,Yi.Z)(R,3),De=pe[0],rt=pe[1],Tt=pe[2],qt=Ui.fromValues(0,0,1),_r=Ui.fromValues(De,0,Tt),Hr=De>=0?Ui.angle(qt,_r):Math.PI*2-Ui.angle(qt,_r),cn=Math.PI*2-Math.asin(rt/100),_n=dn.create();dn.rotateY(_n,_n,Hr),dn.rotateX(_n,_n,cn);var Un=Ui.fromValues(1,1,0);Ui.transformMat4(Un,Un,_n),Ui.normalize(Un,Un);var ti=Ui.fromValues(-1,1,0);Ui.transformMat4(ti,ti,_n),Ui.normalize(ti,ti);var ni=Ui.fromValues(-1,-1,0);Ui.transformMat4(ni,ni,_n),Ui.normalize(ni,ni);var Si=Ui.fromValues(1,-1,0);Ui.transformMat4(Si,Si,_n),Ui.normalize(Si,Si),G=[].concat((0,ie.Z)(Un),(0,ie.Z)(ti),(0,ie.Z)(ni),(0,ie.Z)(Si))}else G=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var qi=W%4*3;return[G[qi],G[qi+1],G[qi+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:L.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:1,update:function(C,M,R,W){var G=C.size,pe=G===void 0?5:G;return Array.isArray(pe)?[pe[0]]:[pe]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:L.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:1,update:function(C,M,R,W){var G=C.shape,pe=G===void 0?2:G,De=l.layer.getLayerConfig().shape2d,rt=De.indexOf(pe);return[rt]}}})}}]),a}(Po);function Sc(n){var c=bf();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function bf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var sf=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,Hf=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Ec=function(n){(0,Gn.Z)(a,n);var c=Sc(a);function a(){var s;(0,cr.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,j.Z)((0,gt.Z)(s),"texture",void 0),s}return(0,Mr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity;return{u_opacity:p||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var l=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){l.updateTexture(),l.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:Hf,fragmentShader:sf,triangulation:Fs,primitive:L.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:L.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:1,update:function(_,C,M,R){var W=_.size;return Array.isArray(W)?[W[0]]:[W]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:L.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:2,update:function(_,C,M,R){var W=l.fontService.mapping,G=_.shape,pe=l.fontService.getGlyph(G),De=W[pe],rt=De.x,Tt=De.y;return[rt,Tt]}}})}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,p=this.fontService.canvas;this.texture=l({data:p,mag:L.gl.LINEAR,min:L.gl.LINEAR,width:p.width,height:p.height})}},{key:"initIconFontGlyphs",value:function(){var l=this,p=this.layer.getLayerConfig(),_=p.fontWeight,C=_===void 0?"normal":_,M=p.fontFamily,R=M===void 0?"sans-serif":M,W=this.layer.getEncodedData(),G=[];W.forEach(function(pe){var De=pe.shape,rt=De===void 0?"":De;rt=rt.toString();var Tt=l.fontService.getGlyph(rt);G.indexOf(Tt)===-1&&G.push(Tt)}),this.fontService.setFontOptions({characterSet:G,fontWeight:C,fontFamily:R,fontSize:48})}}]),a}(Po);function ch(n){var c=uf();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function uf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Wf=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,lf=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Cc=function(n){(0,Gn.Z)(a,n);var c=ch(a);function a(){var s;(0,cr.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,j.Z)((0,gt.Z)(s),"texture",void 0),(0,j.Z)((0,gt.Z)(s),"updateTexture",function(){var C=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.renderLayers();return}s.texture=C({data:s.iconService.getCanvas(),mag:L.gl.LINEAR,min:L.gl.LINEAR,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,Mr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.offsets,C=_===void 0?[0,0]:_;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,offsets:C})){this.judgeStyleAttributes({opacity:p,offsets:C});var M=this.layer.getEncodedData(),R=this.calDataFrame(this.cellLength,M,this.cellProperties),W=R.data,G=R.width,pe=R.height;this.rowCount=pe,this.dataTexture=this.cellLength>0&&W.length>0?this.createTexture2D({flipY:!0,data:W,format:L.gl.LUMINANCE,type:L.gl.FLOAT,width:G,height:pe}):this.createTexture2D({flipY:!0,data:[1],format:L.gl.LUMINANCE,type:L.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Ai()(p)?p:1,u_offsets:this.isOffsetStatic(C)?C:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,p;(l=this.texture)===null||l===void 0||l.destroy(),(p=this.dataTexture)===null||p===void 0||p.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:lf,fragmentShader:Wf,triangulation:Fs,primitive:L.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:L.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:1,update:function(_,C,M,R){var W=_.size,G=W===void 0?5:W;return Array.isArray(G)?[G[0]]:[G]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:L.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:2,update:function(_,C,M,R){var W=l.iconService.getIconMap(),G=_.shape,pe=W[G]||{x:0,y:0},De=pe.x,rt=pe.y;return[De,rt]}}})}}]),a}(Po);function Au(n){var c=Sf();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function Sf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ef=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Cf=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function fh(n){var c=n.coordinates;return{vertices:(0,ie.Z)(c),indices:[0],size:c.length}}var Uc=function(n){(0,Gn.Z)(a,n);var c=Au(a);function a(){return(0,cr.Z)(this,a),c.apply(this,arguments)}return(0,Mr.Z)(a,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p,C=l.offsets,M=C===void 0?[0,0]:C;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_,offsets:M})){this.judgeStyleAttributes({opacity:_,offsets:M});var R=this.layer.getEncodedData(),W=this.calDataFrame(this.cellLength,R,this.cellProperties),G=W.data,pe=W.width,De=W.height;this.rowCount=De,this.dataTexture=this.cellLength>0&&G.length>0?this.createTexture2D({flipY:!0,data:G,format:L.gl.LUMINANCE,type:L.gl.FLOAT,width:pe,height:De}):this.createTexture2D({flipY:!0,data:[1],format:L.gl.LUMINANCE,type:L.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ai()(_)?_:1,u_offsets:this.isOffsetStatic(M)?M:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:Cf,fragmentShader:Ef,triangulation:fh,depth:{enable:!1},primitive:L.gl.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:L.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:1,update:function(p,_,C,M){var R=p.size,W=R===void 0?1:R;return Array.isArray(W)?[W[0]]:[W]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:L.BlendType.additive}}}]),a}(Po),mu=S(98333);function Dh(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=hh(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(R){throw R},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,_=!1,C;return{s:function(){a=a.call(n)},n:function(){var R=a.next();return p=R.done,R},e:function(R){_=!0,C=R},f:function(){try{!p&&a.return!=null&&a.return()}finally{if(_)throw C}}}}function hh(n,c){if(!!n){if(typeof n=="string")return ph(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ph(n,c)}}function ph(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}var kh=function(){function n(c,a,s){(0,cr.Z)(this,n),(0,j.Z)(this,"boxCells",[]),(0,j.Z)(this,"xCellCount",void 0),(0,j.Z)(this,"yCellCount",void 0),(0,j.Z)(this,"boxKeys",void 0),(0,j.Z)(this,"bboxes",void 0),(0,j.Z)(this,"width",void 0),(0,j.Z)(this,"height",void 0),(0,j.Z)(this,"xScale",void 0),(0,j.Z)(this,"yScale",void 0),(0,j.Z)(this,"boxUid",void 0);var l=this.boxCells;this.xCellCount=Math.ceil(c/s),this.yCellCount=Math.ceil(a/s);for(var p=0;p<this.xCellCount*this.yCellCount;p++)l.push([]);this.boxKeys=[],this.bboxes=[],this.width=c,this.height=a,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/a,this.boxUid=0}return(0,Mr.Z)(n,[{key:"insert",value:function(a,s,l,p,_){this.forEachCell(s,l,p,_,this.insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_)}},{key:"query",value:function(a,s,l,p,_){return this.queryHitTest(a,s,l,p,!1,_)}},{key:"hitTest",value:function(a,s,l,p,_){return this.queryHitTest(a,s,l,p,!0,_)}},{key:"insertBoxCell",value:function(a,s,l,p,_,C){this.boxCells[_].push(C)}},{key:"queryHitTest",value:function(a,s,l,p,_,C){if(l<0||a>this.width||p<0||s>this.height)return _?!1:[];var M=[];if(a<=0&&s<=0&&this.width<=l&&this.height<=p){if(_)return!0;for(var R=0;R<this.boxKeys.length;R++)M.push({key:this.boxKeys[R],x1:this.bboxes[R*4],y1:this.bboxes[R*4+1],x2:this.bboxes[R*4+2],y2:this.bboxes[R*4+3]});return C?M.filter(C):M}var W={hitTest:_,seenUids:{box:{},circle:{}}};return this.forEachCell(a,s,l,p,this.queryCell,M,W,C),_?M.length>0:M}},{key:"queryCell",value:function(a,s,l,p,_,C,M,R){var W=M.seenUids,G=this.boxCells[_];if(G!==null){var pe=this.bboxes,De=Dh(G),rt;try{for(De.s();!(rt=De.n()).done;){var Tt=rt.value;if(!W.box[Tt]){W.box[Tt]=!0;var qt=Tt*4;if(a<=pe[qt+2]&&s<=pe[qt+3]&&l>=pe[qt+0]&&p>=pe[qt+1]&&(!R||R(this.boxKeys[Tt]))){if(M.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[Tt],x1:pe[qt],y1:pe[qt+1],x2:pe[qt+2],y2:pe[qt+3]})}}}}catch(_r){De.e(_r)}finally{De.f()}}return!1}},{key:"forEachCell",value:function(a,s,l,p,_,C,M,R){for(var W=this.convertToXCellCoord(a),G=this.convertToYCellCoord(s),pe=this.convertToXCellCoord(l),De=this.convertToYCellCoord(p),rt=W;rt<=pe;rt++)for(var Tt=G;Tt<=De;Tt++){var qt=this.xCellCount*Tt+rt;if(_.call(this,a,s,l,p,qt,C,M,R))return}}},{key:"convertToXCellCoord",value:function(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}},{key:"convertToYCellCoord",value:function(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}}]),n}(),_p=kh,wc=function(){function n(c,a){(0,cr.Z)(this,n),(0,j.Z)(this,"width",void 0),(0,j.Z)(this,"height",void 0),(0,j.Z)(this,"grid",void 0),(0,j.Z)(this,"viewportPadding",100),(0,j.Z)(this,"screenRightBoundary",void 0),(0,j.Z)(this,"screenBottomBoundary",void 0),(0,j.Z)(this,"gridRightBoundary",void 0),(0,j.Z)(this,"gridBottomBoundary",void 0),this.width=c,this.height=a,this.viewportPadding=Math.max(c,a),this.grid=new _p(c+this.viewportPadding,a+this.viewportPadding,25),this.screenRightBoundary=c+this.viewportPadding,this.screenBottomBoundary=a+this.viewportPadding,this.gridRightBoundary=c+2*this.viewportPadding,this.gridBottomBoundary=a+2*this.viewportPadding}return(0,Mr.Z)(n,[{key:"placeCollisionBox",value:function(a){var s=a.x1+a.anchorPointX+this.viewportPadding,l=a.y1+a.anchorPointY+this.viewportPadding,p=a.x2+a.anchorPointX+this.viewportPadding,_=a.y2+a.anchorPointY+this.viewportPadding;return!this.isInsideGrid(s,l,p,_)||this.grid.hitTest(s,l,p,_)?{box:[]}:{box:[s,l,p,_]}}},{key:"insertCollisionBox",value:function(a,s){var l={featureIndex:s};this.grid.insert(l,a[0],a[1],a[2],a[3])}},{key:"project",value:function(a,s,l){var p=mu.al(s,l,0,1),_=mu.Ue(),C=dn.fromValues.apply(dn,(0,ie.Z)(a));return mu.fF(_,p,C),{x:(_[0]/_[3]+1)/2*this.width+this.viewportPadding,y:(-_[1]/_[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(a,s,l,p){return l>=0&&a<this.gridRightBoundary&&p>=0&&s<this.gridBottomBoundary}}]),n}();function Ac(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=Fh(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(R){throw R},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,_=!1,C;return{s:function(){a=a.call(n)},n:function(){var R=a.next();return p=R.done,R},e:function(R){_=!0,C=R},f:function(){try{!p&&a.return!=null&&a.return()}finally{if(_)throw C}}}}function Fh(n,c){if(!!n){if(typeof n=="string")return wf(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return wf(n,c)}}function wf(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function cf(n){var c=.5,a=.5;switch(n){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0;break;default:c=.5}switch(n){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0;break;default:a=.5}return{horizontalAlign:c,verticalAlign:a}}function Xu(n,c,a,s,l){if(!!l){var p=n[s],_=p.glyph;if(_)for(var C=c[_].advance*p.scale,M=(n[s].x+C)*l,R=a;R<=s;R++)n[R].x-=M}}function Bh(n,c,a,s,l,p,_){var C=(c-a)*l,M=(-s*_+.5)*p,R=Ac(n),W;try{for(R.s();!(W=R.n()).done;){var G=W.value;G.x+=C,G.y+=M}}catch(pe){R.e(pe)}finally{R.f()}}function Zl(n,c,a,s,l,p,_){var C=-8,M=0,R=C,W=0,G=n.positionedGlyphs,pe=p==="right"?1:p==="left"?0:.5,De=G.length;a.forEach(function(Hr){if(Hr.split("").forEach(function(_n){var Un=c[_n],ti=0;Un&&(G.push({glyph:_n,x:M,y:R+ti,vertical:!1,scale:1,metrics:Un}),M+=Un.advance+_)}),G.length!==De){var cn=M-_;W=Math.max(cn,W),Xu(G,c,De,G.length-1,pe)}M=0,R+=s});var rt=cf(l),Tt=rt.horizontalAlign,qt=rt.verticalAlign;Bh(G,pe,Tt,qt,W,s,a.length);var _r=R-C;n.top+=-qt*_r,n.bottom=n.top+_r,n.left+=-Tt*W,n.right=n.left+W}function Nh(n,c,a,s,l,p,_){var C=-8,M=0,R=C,W=0,G=n.positionedGlyphs,pe=p==="right"?1:p==="left"?0:.5,De=G.length;a.forEach(function(Hr){var cn=c[Hr],_n=0;if(cn&&(G.push({glyph:Hr,x:M,y:R+_n,vertical:!1,scale:1,metrics:cn}),M+=cn.advance+_),G.length!==De){var Un=M-_;W=Math.max(Un,W),Xu(G,c,De,G.length-1,pe)}M=0,R+=s});var rt=cf(l),Tt=rt.horizontalAlign,qt=rt.verticalAlign;Bh(G,pe,Tt,qt,W,s,a.length);var _r=R-C;n.top+=-qt*_r,n.bottom=n.top+_r,n.left+=-Tt*W,n.right=n.left+W}function jl(n,c,a,s,l,p){var _=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],C=arguments.length>7?arguments[7]:void 0,M=n.split(`
`),R=[],W={positionedGlyphs:R,top:_[1],bottom:_[1],left:_[0],right:_[0],lineCount:M.length,text:n};return C?Nh(W,c,M,a,s,l,p):Zl(W,c,M,a,s,l,p),R.length?W:!1}function oc(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],a=arguments.length>2?arguments[2]:void 0,s=n.positionedGlyphs,l=s===void 0?[]:s,p=[],_=Ac(l),C;try{for(_.s();!(C=_.n()).done;){var M=C.value,R=M.metrics,W=4,G=R.advance*M.scale/2,pe=a?[M.x+G,M.y]:[0,0],De=a?[0,0]:[M.x+G+c[0],M.y+c[1]],rt=(0-W)*M.scale-G+De[0],Tt=(0-W)*M.scale+De[1],qt=rt+R.width*M.scale,_r=Tt+R.height*M.scale,Hr={x:rt,y:Tt},cn={x:qt,y:Tt},_n={x:rt,y:_r},Un={x:qt,y:_r};p.push({tl:Hr,tr:cn,bl:_n,br:Un,tex:R,glyphOffset:pe})}}catch(ti){_.e(ti)}finally{_.f()}return p}function zh(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=dh(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(R){throw R},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,_=!1,C;return{s:function(){a=a.call(n)},n:function(){var R=a.next();return p=R.done,R},e:function(R){_=!0,C=R},f:function(){try{!p&&a.return!=null&&a.return()}finally{if(_)throw C}}}}function dh(n,c){if(!!n){if(typeof n=="string")return Af(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Af(n,c)}}function Af(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function Uh(n){var c=bs();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function bs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Zo=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,as=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function gu(n){var c=this,a=n.id,s=[],l=[];if(!c.glyphInfoMap||!c.glyphInfoMap[a])return{vertices:[],indices:[],size:7};var p=c.glyphInfoMap[a].centroid,_=p.length===2?[p[0],p[1],0]:p;return c.glyphInfoMap[a].glyphQuads.forEach(function(C,M){s.push.apply(s,(0,ie.Z)(_).concat([C.tex.x,C.tex.y+C.tex.height,C.tl.x,C.tl.y],(0,ie.Z)(_),[C.tex.x+C.tex.width,C.tex.y+C.tex.height,C.tr.x,C.tr.y],(0,ie.Z)(_),[C.tex.x+C.tex.width,C.tex.y,C.br.x,C.br.y],(0,ie.Z)(_),[C.tex.x,C.tex.y,C.bl.x,C.bl.y])),l.push(0+M*4,1+M*4,2+M*4,2+M*4,3+M*4,0+M*4)}),{vertices:s,indices:l,size:7}}var Xf=function(n){(0,Gn.Z)(a,n);var c=Uh(a);function a(){var s;(0,cr.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,j.Z)((0,gt.Z)(s),"glyphInfo",void 0),(0,j.Z)((0,gt.Z)(s),"glyphInfoMap",{}),(0,j.Z)((0,gt.Z)(s),"texture",void 0),(0,j.Z)((0,gt.Z)(s),"currentZoom",-1),(0,j.Z)((0,gt.Z)(s),"extent",void 0),(0,j.Z)((0,gt.Z)(s),"textureHeight",0),(0,j.Z)((0,gt.Z)(s),"textCount",0),(0,j.Z)((0,gt.Z)(s),"preTextStyle",{}),(0,j.Z)((0,gt.Z)(s),"buildModels",function(){return s.initGlyph(),s.updateTexture(),s.filterGlyphs(),s.reBuildModel(),[s.layer.buildLayerModel({moduleName:"pointText",vertexShader:as,fragmentShader:Zo,triangulation:gu.bind((0,gt.Z)(s)),depth:{enable:!1},blend:s.getBlend()})]}),s}return(0,Mr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p,C=l.stroke,M=C===void 0?"#fff":C,R=l.strokeWidth,W=R===void 0?0:R,G=l.textAnchor,pe=G===void 0?"center":G,De=l.textAllowOverlap,rt=De===void 0?!1:De,Tt=l.halo,qt=Tt===void 0?.5:Tt,_r=l.gamma,Hr=_r===void 0?2:_r,cn=this.fontService,_n=cn.canvas,Un=cn.mapping;if(Object.keys(Un).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Un).length),this.preTextStyle={textAnchor:pe,textAllowOverlap:rt},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_,strokeWidth:W,stroke:M})){this.judgeStyleAttributes({opacity:_,strokeWidth:W,stroke:M});var ti=this.layer.getEncodedData(),ni=this.calDataFrame(this.cellLength,ti,this.cellProperties),Si=ni.data,qi=ni.width,_a=ni.height;this.rowCount=_a,this.dataTexture=this.cellLength>0&&Si.length>0?this.createTexture2D({flipY:!0,data:Si,format:L.gl.LUMINANCE,type:L.gl.FLOAT,width:qi,height:_a}):this.createTexture2D({flipY:!0,data:[1],format:L.gl.LUMINANCE,type:L.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ai()(_)?_:1,u_stroke_width:Ai()(W)?W:0,u_stroke_color:this.getStrokeColor(M),u_sdf_map:this.texture,u_halo_blur:qt,u_gamma_scale:Hr,u_sdf_map_size:[_n.width,_n.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var l=this.layer.getLayerConfig(),p=l.textAnchor,_=p===void 0?"center":p,C=l.textAllowOverlap,M=C===void 0?!0:C;return this.preTextStyle={textAnchor:_,textAllowOverlap:M},this.buildModels()}},{key:"needUpdate",value:function(){var l=this.layer.getLayerConfig(),p=l.textAllowOverlap,_=p===void 0?!1:p,C=this.mapService.getZoom(),M=this.mapService.getBounds(),R=(0,Ke.oO)(this.extent,M);return!_&&(Math.abs(this.currentZoom-C)>1||!R)||_!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:L.AttributeType.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:1,update:function(p,_,C,M){var R=p.rotate,W=R===void 0?0:R;return Array.isArray(W)?[W[0]]:[W]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:L.AttributeType.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:L.gl.STATIC_DRAW,data:[],type:L.gl.FLOAT},size:2,update:function(p,_,C,M){return[C[5],C[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:L.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:1,update:function(p,_,C,M){var R=p.size,W=R===void 0?12:R;return Array.isArray(W)?[W[0]]:[W]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:L.AttributeType.Attribute,descriptor:{name:"a_tex",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:2,update:function(p,_,C,M){return[C[3],C[4]]}}})}},{key:"textExtent",value:function(){var l=this.mapService.getBounds();return(0,Ke.yA)(l,.5)}},{key:"initTextFont",value:function(){var l=this.layer.getLayerConfig(),p=l.fontWeight,_=p===void 0?"400":p,C=l.fontFamily,M=C===void 0?"sans-serif":C,R=this.layer.getEncodedData(),W=[];R.forEach(function(G){var pe=G.shape,De=pe===void 0?"":pe;De=De.toString();var rt=zh(De),Tt;try{for(rt.s();!(Tt=rt.n()).done;){var qt=Tt.value;W.indexOf(qt)===-1&&W.push(qt)}}catch(_r){rt.e(_r)}finally{rt.f()}}),this.fontService.setFontOptions({characterSet:W,fontWeight:_,fontFamily:M,iconfont:!1})}},{key:"initIconFontTex",value:function(){var l=this.layer.getLayerConfig(),p=l.fontWeight,_=p===void 0?"400":p,C=l.fontFamily,M=C===void 0?"sans-serif":C,R=this.layer.getEncodedData(),W=[];R.forEach(function(G){var pe=G.shape,De=pe===void 0?"":pe;De=De.toString(),W.indexOf(De)===-1&&W.push(De)}),this.fontService.setFontOptions({characterSet:W,fontWeight:_,fontFamily:M,iconfont:!0})}},{key:"generateGlyphLayout",value:function(l){var p=this,_=this.fontService.mapping,C=this.layer.getLayerConfig(),M=C.spacing,R=M===void 0?2:M,W=C.textAnchor,G=W===void 0?"center":W,pe=this.layer.getEncodedData();this.glyphInfo=pe.map(function(De){var rt=De.shape,Tt=rt===void 0?"":rt,qt=De.id,_r=De.size,Hr=_r===void 0?1:_r,cn=De.textOffset,_n=cn===void 0?[0,0]:cn,Un=jl(Tt.toString(),_,Hr,G,"center",R,_n,l),ti=oc(Un,_n,!1);return De.shaping=Un,De.glyphQuads=ti,De.centroid=Gi(De.coordinates),De.originCentroid=De.version==="GAODE2.x"?Gi(De.originCoordinates):De.originCentroid=De.centroid,p.glyphInfoMap[qt]={shaping:Un,glyphQuads:ti,centroid:Gi(De.coordinates)},De})}},{key:"filterGlyphs",value:function(){var l=this,p=this.layer.getLayerConfig(),_=p.padding,C=_===void 0?[4,4]:_,M=p.textAllowOverlap,R=M===void 0?!1:M;if(!R){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var W=this.rendererService.getViewportSize(),G=W.width,pe=W.height,De=new wc(G,pe),rt=this.glyphInfo.filter(function(Tt){var qt=Tt.shaping,_r=Tt.id,Hr=_r===void 0?0:_r,cn=Tt.version==="GAODE2.x"?Tt.originCentroid:Tt.centroid,_n=Tt.size,Un=_n/24,ti=l.mapService.lngLatToContainer(cn),ni=De.placeCollisionBox({x1:qt.left*Un-C[0],x2:qt.right*Un+C[0],y1:qt.top*Un-C[1],y2:qt.bottom*Un+C[1],anchorPointX:ti.x,anchorPointY:ti.y}),Si=ni.box;return Si&&Si.length?(De.insertCollisionBox(Si,Hr),!0):!1});rt.forEach(function(Tt){l.glyphInfoMap[Tt.id]=Tt})}}},{key:"initGlyph",value:function(){var l=this.layer.getLayerConfig(),p=l.iconfont,_=p===void 0?!1:p;_?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(_)}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,p=this.fontService.canvas;this.textureHeight=p.height,this.texture&&this.texture.destroy(),this.texture=l({data:p,mag:L.gl.LINEAR,min:L.gl.LINEAR,width:p.width,height:p.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:as,fragmentShader:Zo,triangulation:gu.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),a}(Po),xp={fill:of,image:Cc,normal:Uc,extrude:lh,text:Xf,icon:Ec},Zh=xp;function bp(n){var c=Sp();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function Sp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var jh=function(n){(0,Gn.Z)(a,n);var c=bp(a);function a(){var s;(0,cr.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,j.Z)((0,gt.Z)(s),"type","PointLayer"),s}return(0,Mr.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Zh[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),p={normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return p[l]}},{key:"getModelType",value:function(){var l=this.getEncodedData(),p=this.getLayerConfig(),_=p.shape2d,C=p.shape3d,M=this.iconService.getIconMap(),R=l.find(function(G){return G.hasOwnProperty("shape")});if(R){var W=R.shape;return W==="dot"?"normal":(_==null?void 0:_.indexOf(W))!==-1?"fill":(C==null?void 0:C.indexOf(W))!==-1?"extrude":M.hasOwnProperty(W)?"image":this.fontService.getGlyph(W)!==""?"icon":"text"}else return"normal"}}]),a}(Ou);function Vh(n){var c=Ep();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function Ep(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Cp=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Tf=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,Gh=function(n){(0,Gn.Z)(a,n);var c=Vh(a);function a(){return(0,cr.Z)(this,a),c.apply(this,arguments)}return(0,Mr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_})){this.judgeStyleAttributes({opacity:_});var C=this.layer.getEncodedData(),M=this.calDataFrame(this.cellLength,C,this.cellProperties),R=M.data,W=M.width,G=M.height;this.rowCount=G,this.dataTexture=this.cellLength>0&&R.length>0?this.createTexture2D({flipY:!0,data:R,format:L.gl.LUMINANCE,type:L.gl.FLOAT,width:W,height:G}):this.createTexture2D({flipY:!0,data:[1],format:L.gl.LUMINANCE,type:L.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ai()(_)?_:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:Tf,fragmentShader:Cp,triangulation:Bl})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:L.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:L.gl.STATIC_DRAW,data:[],type:L.gl.FLOAT},size:3,update:function(p,_,C,M,R){return R}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:L.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:1,update:function(p,_,C,M){var R=p.size,W=R===void 0?10:R;return Array.isArray(W)?[W[0]]:[W]}}})}}]),a}(Po);function vh(n){var c=Pf();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function Pf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ja=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Hh=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,sc=function(n){(0,Gn.Z)(a,n);var c=vh(a);function a(){return(0,cr.Z)(this,a),c.apply(this,arguments)}return(0,Mr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_})){this.judgeStyleAttributes({opacity:_});var C=this.layer.getEncodedData(),M=this.calDataFrame(this.cellLength,C,this.cellProperties),R=M.data,W=M.width,G=M.height;this.rowCount=G,this.dataTexture=this.cellLength>0&&R.length>0?this.createTexture2D({flipY:!0,data:R,format:L.gl.LUMINANCE,type:L.gl.FLOAT,width:W,height:G}):this.createTexture2D({flipY:!0,data:[1],format:L.gl.LUMINANCE,type:L.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ai()(_)?_:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:Hh,fragmentShader:Ja,triangulation:nc,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){}}]),a}(Po),Zc={fill:sc,line:Lh,extrude:Gh,text:Xf,point_fill:of,point_image:Cc,point_normal:Uc,point_extrude:lh},Wh=Zc;function U(n){var c=Me();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function Me(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Je=function(n){(0,Gn.Z)(a,n);var c=U(a);function a(){var s;(0,cr.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,j.Z)((0,gt.Z)(s),"type","PolygonLayer"),s}return(0,Mr.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Wh[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,p=this.styleAttributeService.getLayerStyleAttribute("shape"),_=p==null||(l=p.scale)===null||l===void 0?void 0:l.field;return _==="fill"?"fill":_==="extrude"?"extrude":_==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var l=this.getEncodedData(),p=this.getLayerConfig(),_=p.shape2d,C=p.shape3d,M=this.iconService.getIconMap(),R=l.find(function(G){return G.hasOwnProperty("shape")});if(R){var W=R.shape;return W==="dot"?"point_normal":(_==null?void 0:_.indexOf(W))!==-1?"point_fill":(C==null?void 0:C.indexOf(W))!==-1?"point_extrude":M.hasOwnProperty(W)?"point_image":"text"}else return"fill"}}]),a}(Ou);function ir(n){var c=Fr();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function Fr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var er=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,Pr=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Zr=function(n){(0,Gn.Z)(a,n);var c=ir(a);function a(){var s;(0,cr.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,j.Z)((0,gt.Z)(s),"texture",void 0),(0,j.Z)((0,gt.Z)(s),"colorTexture",void 0),s}return(0,Mr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p,C=l.clampLow,M=C===void 0?!0:C,R=l.clampHigh,W=R===void 0?!0:R,G=l.noDataValue,pe=G===void 0?-9999999:G,De=l.domain,rt=De===void 0?[0,1]:De;return this.updateColorTexure(),{u_opacity:_||1,u_texture:this.texture,u_domain:rt,u_clampLow:M,u_clampHigh:typeof W!="undefined"?W:M,u_noDataValue:pe,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var l=this.layer.getSource(),p=this.rendererService.createTexture2D,_=l.data.dataArray[0];this.texture=p({data:_.data,width:_.width,height:_.height,format:L.gl.LUMINANCE,type:L.gl.FLOAT});var C=this.layer.getLayerConfig(),M=C.rampColors,R=(0,Ke.Cl)(M);return this.colorTexture=p({data:R.data,width:R.width,height:R.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:Pr,fragmentShader:er,triangulation:i,primitive:L.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:L.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:2,update:function(p,_,C,M){return[C[3],C[4]]}}})}},{key:"updateColorTexure",value:function(){var l=this.rendererService.createTexture2D,p=this.layer.getLayerConfig(),_=p.rampColors,C=(0,Ke.Cl)(_);this.colorTexture=l({data:C.data,width:C.width,height:C.height,flipY:!1})}}]),a}(Po),Kr={raster:Zr,raster3d:Zr},qr=Kr;function en(n){var c=an();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function an(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var bn=function(n){(0,Gn.Z)(a,n);var c=en(a);function a(){var s;(0,cr.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,j.Z)((0,gt.Z)(s),"type","RasterLayer"),s}return(0,Mr.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new qr[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),p={raster:{},raster3d:{}};return p[l]}},{key:"getModelType",value:function(){return"raster"}}]),a}(Ou),$r,nn,Ot,vr,Jr,Tn,Lr,Pn,on;function ci(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Rr(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?ci(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):ci(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var wr=($r=(0,ln.b2)(),nn=(0,ln.f3)(L.vK.IGlobalConfigService),Ot=(0,ln.f3)(L.vK.IMapService),vr=(0,ln.f3)(L.vK.IFontService),$r(Jr=(Tn=function(){function n(){(0,cr.Z)(this,n),(0,io.Z)(this,"configService",Lr,this),(0,io.Z)(this,"mapService",Pn,this),(0,io.Z)(this,"fontService",on,this)}return(0,Mr.Z)(n,[{key:"apply",value:function(a,s){var l=this,p=s.styleAttributeService;a.hooks.init.tap("DataMappingPlugin",function(){l.generateMaping(a,{styleAttributeService:p})}),a.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return a.dataState.dataMappingNeedUpdate=!1,l.generateMaping(a,{styleAttributeService:p}),!0}),a.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!a.layerModelNeedUpdate){var _=p.getLayerStyleAttributes()||[],C=p.getLayerStyleAttribute("filter"),M=a.getSource().data.dataArray,R=_.filter(function(G){return G.needRemapping}),W=M;C!=null&&C.needRemapping&&C!==null&&C!==void 0&&C.scale&&(W=M.filter(function(G){return l.applyAttributeMapping(C,G)[0]})),R.length&&(C!=null&&C.needRemapping?(a.setEncodedData(l.mapping(_,W)),C.needRemapping=!1):a.setEncodedData(l.mapping(R,W,a.getEncodedData())),a.emit("remapping",null))}})}},{key:"generateMaping",value:function(a,s){var l=this,p=s.styleAttributeService,_=p.getLayerStyleAttributes()||[],C=p.getLayerStyleAttribute("filter"),M=a.getSource().data.dataArray,R=M;C!=null&&C.scale&&(R=M.filter(function(W){return l.applyAttributeMapping(C,W)[0]})),a.setEncodedData(this.mapping(_,R))}},{key:"mapping",value:function(a,s,l){var p=this,_=s.map(function(C,M){var R=l?l[M]:{},W=Rr({id:C._id,coordinates:C.coordinates},R);return a.filter(function(G){return G.scale!==void 0}).forEach(function(G){var pe=p.applyAttributeMapping(G,C);G.needRemapping=!1,G.name==="color"&&(pe=pe.map(function(De){return(0,Ke.CI)(De)})),W[G.name]=Array.isArray(pe)&&pe.length===1?pe[0]:pe,G.name==="shape"&&(W.shape=p.fontService.getIconFontKey(W[G.name]))}),W});return _.length>0&&this.mapService.version==="GAODE2.x"&&(typeof _[0].coordinates[0]=="number"?_.filter(function(C){return!C.originCoordinates}).map(function(C){C.version="GAODE2.x",C.originCoordinates=ae()(C.coordinates),C.coordinates=p.mapService.lngLatToCoord(C.coordinates)}):_.filter(function(C){return!C.originCoordinates}).map(function(C){C.version="GAODE2.x",C.originCoordinates=ae()(C.coordinates),C.coordinates=p.mapService.lngLatToCoords(C.coordinates)})),_}},{key:"applyAttributeMapping",value:function(a,s){var l;if(!a.scale)return[];var p=(a==null||(l=a.scale)===null||l===void 0?void 0:l.scalers)||[],_=[];return p.forEach(function(C){var M,R=C.field;(s.hasOwnProperty(R)||((M=a.scale)===null||M===void 0?void 0:M.type)==="variable")&&_.push(s[R])}),a.mapping?a.mapping(_):[]}}]),n}(),Lr=(0,bo.Z)(Tn.prototype,"configService",[nn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pn=(0,bo.Z)(Tn.prototype,"mapService",[Ot],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),on=(0,bo.Z)(Tn.prototype,"fontService",[vr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tn))||Jr),Qn,Sn,rn=(Qn=(0,ln.b2)(),Qn(Sn=function(){function n(){(0,cr.Z)(this,n),(0,j.Z)(this,"mapService",void 0)}return(0,Mr.Z)(n,[{key:"apply",value:function(a){var s=this;this.mapService=a.getContainer().get(L.vK.IMapService),a.hooks.init.tap("DataSourcePlugin",function(){var l=a.getSource();if(!l){var p=a.sourceOption||{data:ke,options:ft},_=p.data,C=p.options;a.setSource(new Se(_,C))}s.updateClusterData(a)}),a.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var l=s.updateClusterData(a),p=a.dataState.dataSourceNeedUpdate;return a.dataState.dataSourceNeedUpdate=!1,l||p})}},{key:"updateClusterData",value:function(a){var s=a.getSource(),l=s.cluster,p=s.clusterOptions,_=p.zoom,C=_===void 0?0:_,M=p.maxZoom,R=M===void 0?16:M,W=this.mapService.getZoom()-1,G=a.dataState.dataSourceNeedUpdate;return l&&(G||Math.abs(C-W)>1)&&R>C?(s.updateClusterData(Math.floor(W)),!0):!1}}]),n}())||Sn),On=S(44908),Ln=S.n(On),Vi=S(14293),ki=S.n(Vi);function kn(n,c){return n<c?-1:n>c?1:n>=c?0:NaN}function Fn(n){return n.length===1&&(n=Ti(n)),{left:function(c,a,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var p=s+l>>>1;n(c[p],a)<0?s=p+1:l=p}return s},right:function(c,a,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var p=s+l>>>1;n(c[p],a)>0?l=p:s=p+1}return s}}}function Ti(n){return function(c,a){return kn(n(c),a)}}var zi=Fn(kn),va=zi.right,jo=zi.left,Vo=null;function la(n,c){var a=n.length,s=-1,l,p,_;if(c==null){for(;++s<a;)if((l=n[s])!=null&&l>=l)for(p=_=l;++s<a;)(l=n[s])!=null&&(p>l&&(p=l),_<l&&(_=l))}else for(;++s<a;)if((l=c(n[s],s,n))!=null&&l>=l)for(p=_=l;++s<a;)(l=c(n[s],s,n))!=null&&(p>l&&(p=l),_<l&&(_=l));return[p,_]}var Ss=Array.prototype,_o=Ss.slice,Is=Ss.map,Go=Math.sqrt(50),os=Math.sqrt(10),ps=Math.sqrt(2);function Os(n,c,a){var s,l=-1,p,_,C;if(c=+c,n=+n,a=+a,n===c&&a>0)return[n];if((s=c<n)&&(p=n,n=c,c=p),(C=$o(n,c,a))===0||!isFinite(C))return[];if(C>0)for(n=Math.ceil(n/C),c=Math.floor(c/C),_=new Array(p=Math.ceil(c-n+1));++l<p;)_[l]=(n+l)*C;else for(n=Math.floor(n*C),c=Math.ceil(c*C),_=new Array(p=Math.ceil(n-c+1));++l<p;)_[l]=(n-l)/C;return s&&_.reverse(),_}function $o(n,c,a){var s=(c-n)/Math.max(0,a),l=Math.floor(Math.log(s)/Math.LN10),p=s/Math.pow(10,l);return l>=0?(p>=Go?10:p>=os?5:p>=ps?2:1)*Math.pow(10,l):-Math.pow(10,-l)/(p>=Go?10:p>=os?5:p>=ps?2:1)}function Ji(n,c,a){var s=Math.abs(c-n)/Math.max(0,a),l=Math.pow(10,Math.floor(Math.log(s)/Math.LN10)),p=s/l;return p>=Go?l*=10:p>=os?l*=5:p>=ps&&(l*=2),c<n?-l:l}function Es(){var n=identity,c=extent,a=sturges;function s(l){var p,_=l.length,C,M=new Array(_);for(p=0;p<_;++p)M[p]=n(l[p],p,l);var R=c(M),W=R[0],G=R[1],pe=a(M,W,G);Array.isArray(pe)||(pe=tickStep(W,G,pe),pe=range(Math.ceil(W/pe)*pe,G,pe));for(var De=pe.length;pe[0]<=W;)pe.shift(),--De;for(;pe[De-1]>G;)pe.pop(),--De;var rt=new Array(De+1),Tt;for(p=0;p<=De;++p)Tt=rt[p]=[],Tt.x0=p>0?pe[p-1]:W,Tt.x1=p<De?pe[p]:G;for(p=0;p<_;++p)C=M[p],W<=C&&C<=G&&rt[bisect(pe,C,0,De)].push(l[p]);return rt}return s.value=function(l){return arguments.length?(n=typeof l=="function"?l:constant(l),s):n},s.domain=function(l){return arguments.length?(c=typeof l=="function"?l:constant([l[0],l[1]]),s):c},s.thresholds=function(l){return arguments.length?(a=typeof l=="function"?l:Array.isArray(l)?constant(slice.call(l)):constant(l),s):a},s}function Fa(n,c,a){return n=map.call(n,number).sort(ascending),Math.ceil((a-c)/(2*(quantile(n,.75)-quantile(n,.25))*Math.pow(n.length,-1/3)))}function Oo(n,c){return n<c?-1:n>c?1:n>=c?0:NaN}function Mi(n){return n.length===1&&(n=ca(n)),{left:function(c,a,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var p=s+l>>>1;n(c[p],a)<0?s=p+1:l=p}return s},right:function(c,a,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var p=s+l>>>1;n(c[p],a)>0?l=p:s=p+1}return s}}}function ca(n){return function(c,a){return Oo(n(c),a)}}var Ha=Mi(Oo),Lo=Ha.right,Vl=Ha.left,je=Lo,or=Array.prototype,$t=or.slice,Yn=or.map,ua=Math.sqrt(50),Fe=Math.sqrt(10),Ee=Math.sqrt(2);function at(n,c,a){var s,l=-1,p,_,C;if(c=+c,n=+n,a=+a,n===c&&a>0)return[n];if((s=c<n)&&(p=n,n=c,c=p),(C=Mt(n,c,a))===0||!isFinite(C))return[];if(C>0)for(n=Math.ceil(n/C),c=Math.floor(c/C),_=new Array(p=Math.ceil(c-n+1));++l<p;)_[l]=(n+l)*C;else for(n=Math.floor(n*C),c=Math.ceil(c*C),_=new Array(p=Math.ceil(n-c+1));++l<p;)_[l]=(n-l)/C;return s&&_.reverse(),_}function Mt(n,c,a){var s=(c-n)/Math.max(0,a),l=Math.floor(Math.log(s)/Math.LN10),p=s/Math.pow(10,l);return l>=0?(p>=ua?10:p>=Fe?5:p>=Ee?2:1)*Math.pow(10,l):-Math.pow(10,-l)/(p>=ua?10:p>=Fe?5:p>=Ee?2:1)}function tr(n,c,a){var s=Math.abs(c-n)/Math.max(0,a),l=Math.pow(10,Math.floor(Math.log(s)/Math.LN10)),p=s/l;return p>=ua?l*=10:p>=Fe?l*=5:p>=Ee&&(l*=2),c<n?-l:l}function yt(){var n=identity,c=extent,a=sturges;function s(l){var p,_=l.length,C,M=new Array(_);for(p=0;p<_;++p)M[p]=n(l[p],p,l);var R=c(M),W=R[0],G=R[1],pe=a(M,W,G);Array.isArray(pe)||(pe=tickStep(W,G,pe),pe=range(Math.ceil(W/pe)*pe,G,pe));for(var De=pe.length;pe[0]<=W;)pe.shift(),--De;for(;pe[De-1]>G;)pe.pop(),--De;var rt=new Array(De+1),Tt;for(p=0;p<=De;++p)Tt=rt[p]=[],Tt.x0=p>0?pe[p-1]:W,Tt.x1=p<De?pe[p]:G;for(p=0;p<_;++p)C=M[p],W<=C&&C<=G&&rt[bisect(pe,C,0,De)].push(l[p]);return rt}return s.value=function(l){return arguments.length?(n=typeof l=="function"?l:constant(l),s):n},s.domain=function(l){return arguments.length?(c=typeof l=="function"?l:constant([l[0],l[1]]),s):c},s.thresholds=function(l){return arguments.length?(a=typeof l=="function"?l:Array.isArray(l)?constant(slice.call(l)):constant(l),s):a},s}function ht(n,c,a){return n=map.call(n,number).sort(ascending),Math.ceil((a-c)/(2*(quantile(n,.75)-quantile(n,.25))*Math.pow(n.length,-1/3)))}function ot(n){return n===null?NaN:+n}function Le(n,c,a){if(a==null&&(a=ot),!!(s=n.length)){if((c=+c)<=0||s<2)return+a(n[0],0,n);if(c>=1)return+a(n[s-1],s-1,n);var s,l=(s-1)*c,p=Math.floor(l),_=+a(n[p],p,n),C=+a(n[p+1],p+1,n);return _+(C-_)*(l-p)}}var qe="$";function Be(){}Be.prototype=kt.prototype={constructor:Be,has:function(n){return qe+n in this},get:function(n){return this[qe+n]},set:function(n,c){return this[qe+n]=c,this},remove:function(n){var c=qe+n;return c in this&&delete this[c]},clear:function(){for(var n in this)n[0]===qe&&delete this[n]},keys:function(){var n=[];for(var c in this)c[0]===qe&&n.push(c.slice(1));return n},values:function(){var n=[];for(var c in this)c[0]===qe&&n.push(this[c]);return n},entries:function(){var n=[];for(var c in this)c[0]===qe&&n.push({key:c.slice(1),value:this[c]});return n},size:function(){var n=0;for(var c in this)c[0]===qe&&++n;return n},empty:function(){for(var n in this)if(n[0]===qe)return!1;return!0},each:function(n){for(var c in this)c[0]===qe&&n(this[c],c.slice(1),this)}};function kt(n,c){var a=new Be;if(n instanceof Be)n.each(function(C,M){a.set(M,C)});else if(Array.isArray(n)){var s=-1,l=n.length,p;if(c==null)for(;++s<l;)a.set(s,n[s]);else for(;++s<l;)a.set(c(p=n[s],s,n),p)}else if(n)for(var _ in n)a.set(_,n[_]);return a}var Yt=kt;function Gr(){var n=[],c=[],a,s,l;function p(C,M,R,W){if(M>=n.length)return a!=null&&C.sort(a),s!=null?s(C):C;for(var G=-1,pe=C.length,De=n[M++],rt,Tt,qt=map(),_r,Hr=R();++G<pe;)(_r=qt.get(rt=De(Tt=C[G])+""))?_r.push(Tt):qt.set(rt,[Tt]);return qt.each(function(cn,_n){W(Hr,_n,p(cn,M,R,W))}),Hr}function _(C,M){if(++M>n.length)return C;var R,W=c[M-1];return s!=null&&M>=n.length?R=C.entries():(R=[],C.each(function(G,pe){R.push({key:pe,values:_(G,M)})})),W!=null?R.sort(function(G,pe){return W(G.key,pe.key)}):R}return l={object:function(C){return p(C,0,gn,yn)},map:function(C){return p(C,0,Bn,pn)},entries:function(C){return _(p(C,0,Bn,pn),0)},key:function(C){return n.push(C),l},sortKeys:function(C){return c[n.length-1]=C,l},sortValues:function(C){return a=C,l},rollup:function(C){return s=C,l}}}function gn(){return{}}function yn(n,c,a){n[c]=a}function Bn(){return map()}function pn(n,c,a){n.set(c,a)}function qn(){}var Rn=Yt.prototype;qn.prototype=ri.prototype={constructor:qn,has:Rn.has,add:function(n){return n+="",this[qe+n]=n,this},remove:Rn.remove,clear:Rn.clear,values:Rn.keys,size:Rn.size,empty:Rn.empty,each:Rn.each};function ri(n,c){var a=new qn;if(n instanceof qn)n.each(function(p){a.add(p)});else if(n){var s=-1,l=n.length;if(c==null)for(;++s<l;)a.add(n[s]);else for(;++s<l;)a.add(c(n[s],s,n))}return a}var ii=null,ei=Array.prototype,pi=ei.map,Oa=ei.slice;function so(n,c){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(c).domain(n);break}return this}function uc(n,c){switch(arguments.length){case 0:break;case 1:this.interpolator(n);break;default:this.interpolator(c).domain(n);break}return this}var Qa={name:"implicit"};function wa(){var n=Yt(),c=[],a=[],s=Qa;function l(p){var _=p+"",C=n.get(_);if(!C){if(s!==Qa)return s;n.set(_,C=c.push(p))}return a[(C-1)%a.length]}return l.domain=function(p){if(!arguments.length)return c.slice();c=[],n=Yt();for(var _=-1,C=p.length,M,R;++_<C;)n.has(R=(M=p[_])+"")||n.set(R,c.push(M));return l},l.range=function(p){return arguments.length?(a=Oa.call(p),l):a.slice()},l.unknown=function(p){return arguments.length?(s=p,l):s},l.copy=function(){return wa(c,a).unknown(s)},so.apply(l,arguments),l}function Ws(){var n=ordinal().unknown(void 0),c=n.domain,a=n.range,s=[0,1],l,p,_=!1,C=0,M=0,R=.5;delete n.unknown;function W(){var G=c().length,pe=s[1]<s[0],De=s[pe-0],rt=s[1-pe];l=(rt-De)/Math.max(1,G-C+M*2),_&&(l=Math.floor(l)),De+=(rt-De-l*(G-C))*R,p=l*(1-C),_&&(De=Math.round(De),p=Math.round(p));var Tt=sequence(G).map(function(qt){return De+l*qt});return a(pe?Tt.reverse():Tt)}return n.domain=function(G){return arguments.length?(c(G),W()):c()},n.range=function(G){return arguments.length?(s=[+G[0],+G[1]],W()):s.slice()},n.rangeRound=function(G){return s=[+G[0],+G[1]],_=!0,W()},n.bandwidth=function(){return p},n.step=function(){return l},n.round=function(G){return arguments.length?(_=!!G,W()):_},n.padding=function(G){return arguments.length?(C=Math.min(1,M=+G),W()):C},n.paddingInner=function(G){return arguments.length?(C=Math.min(1,G),W()):C},n.paddingOuter=function(G){return arguments.length?(M=+G,W()):M},n.align=function(G){return arguments.length?(R=Math.max(0,Math.min(1,G)),W()):R},n.copy=function(){return Ws(c(),s).round(_).paddingInner(C).paddingOuter(M).align(R)},initRange.apply(W(),arguments)}function cl(n){var c=n.copy;return n.padding=n.paddingOuter,delete n.paddingInner,delete n.paddingOuter,n.copy=function(){return cl(c())},n}function fl(){return cl(Ws.apply(null,arguments).paddingInner(1))}var mh=S(26257),hl=S(73626);function Yf(n,c){return n=+n,c=+c,function(a){return Math.round(n*(1-a)+c*a)}}function Mf(n){return function(){return n}}function jc(n){return+n}var wp=[0,1];function qa(n){return n}function If(n,c){return(c-=n=+n)?function(a){return(a-n)/c}:Mf(isNaN(c)?NaN:.5)}function Tc(n){var c=n[0],a=n[n.length-1],s;return c>a&&(s=c,c=a,a=s),function(l){return Math.max(c,Math.min(a,l))}}function Xh(n,c,a){var s=n[0],l=n[1],p=c[0],_=c[1];return l<s?(s=If(l,s),p=a(_,p)):(s=If(s,l),p=a(p,_)),function(C){return p(s(C))}}function Yh(n,c,a){var s=Math.min(n.length,c.length)-1,l=new Array(s),p=new Array(s),_=-1;for(n[s]<n[0]&&(n=n.slice().reverse(),c=c.slice().reverse());++_<s;)l[_]=If(n[_],n[_+1]),p[_]=a(c[_],c[_+1]);return function(C){var M=je(n,C,1,s)-1;return p[M](l[M](C))}}function Kf(n,c){return c.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function ff(){var n=wp,c=wp,a=mh.Z,s,l,p,_=qa,C,M,R;function W(){return C=Math.min(n.length,c.length)>2?Yh:Xh,M=R=null,G}function G(pe){return isNaN(pe=+pe)?p:(M||(M=C(n.map(s),c,a)))(s(_(pe)))}return G.invert=function(pe){return _(l((R||(R=C(c,n.map(s),hl.Z)))(pe)))},G.domain=function(pe){return arguments.length?(n=pi.call(pe,jc),_===qa||(_=Tc(n)),W()):n.slice()},G.range=function(pe){return arguments.length?(c=Oa.call(pe),W()):c.slice()},G.rangeRound=function(pe){return c=Oa.call(pe),a=Yf,W()},G.clamp=function(pe){return arguments.length?(_=pe?Tc(n):qa,G):_!==qa},G.interpolate=function(pe){return arguments.length?(a=pe,W()):a},G.unknown=function(pe){return arguments.length?(p=pe,G):p},function(pe,De){return s=pe,l=De,W()}}function Pc(n,c){return ff()(n,c)}var Kp=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function gh(n){if(!(c=Kp.exec(n)))throw new Error("invalid format: "+n);var c;return new Ap({fill:c[1],align:c[2],sign:c[3],symbol:c[4],zero:c[5],width:c[6],comma:c[7],precision:c[8]&&c[8].slice(1),trim:c[9],type:c[10]})}gh.prototype=Ap.prototype;function Ap(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}Ap.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Ns(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function lc(n,c){if((a=(n=c?n.toExponential(c-1):n.toExponential()).indexOf("e"))<0)return null;var a,s=n.slice(0,a);return[s.length>1?s[0]+s.slice(2):s,+n.slice(a+1)]}function Of(n){return n=lc(Math.abs(n)),n?n[1]:NaN}function e(n,c){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Of(c)/3)))*3-Of(Math.abs(n)))}function t(n,c){return function(a,s){for(var l=a.length,p=[],_=0,C=n[0],M=0;l>0&&C>0&&(M+C+1>s&&(C=Math.max(1,s-M)),p.push(a.substring(l-=C,l+C)),!((M+=C+1)>s));)C=n[_=(_+1)%n.length];return p.reverse().join(c)}}function r(n){return function(c){return c.replace(/[0-9]/g,function(a){return n[+a]})}}function f(n){e:for(var c=n.length,a=1,s=-1,l;a<c;++a)switch(n[a]){case".":s=l=a;break;case"0":s===0&&(s=a),l=a;break;default:if(!+n[a])break e;s>0&&(s=0);break}return s>0?n.slice(0,s)+n.slice(l+1):n}var v;function g(n,c){var a=lc(n,c);if(!a)return n+"";var s=a[0],l=a[1],p=l-(v=Math.max(-8,Math.min(8,Math.floor(l/3)))*3)+1,_=s.length;return p===_?s:p>_?s+new Array(p-_+1).join("0"):p>0?s.slice(0,p)+"."+s.slice(p):"0."+new Array(1-p).join("0")+lc(n,Math.max(0,c+p-1))[0]}function x(n,c){var a=lc(n,c);if(!a)return n+"";var s=a[0],l=a[1];return l<0?"0."+new Array(-l).join("0")+s:s.length>l+1?s.slice(0,l+1)+"."+s.slice(l+1):s+new Array(l-s.length+2).join("0")}var P={"%":function(n,c){return(n*100).toFixed(c)},b:function(n){return Math.round(n).toString(2)},c:function(n){return n+""},d:Ns,e:function(n,c){return n.toExponential(c)},f:function(n,c){return n.toFixed(c)},g:function(n,c){return n.toPrecision(c)},o:function(n){return Math.round(n).toString(8)},p:function(n,c){return x(n*100,c)},r:x,s:g,X:function(n){return Math.round(n).toString(16).toUpperCase()},x:function(n){return Math.round(n).toString(16)}};function k(n){return n}var Z=Array.prototype.map,X=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function re(n){var c=n.grouping===void 0||n.thousands===void 0?k:t(Z.call(n.grouping,Number),n.thousands+""),a=n.currency===void 0?"":n.currency[0]+"",s=n.currency===void 0?"":n.currency[1]+"",l=n.decimal===void 0?".":n.decimal+"",p=n.numerals===void 0?k:r(Z.call(n.numerals,String)),_=n.percent===void 0?"%":n.percent+"",C=n.minus===void 0?"-":n.minus+"",M=n.nan===void 0?"NaN":n.nan+"";function R(G){G=gh(G);var pe=G.fill,De=G.align,rt=G.sign,Tt=G.symbol,qt=G.zero,_r=G.width,Hr=G.comma,cn=G.precision,_n=G.trim,Un=G.type;Un==="n"?(Hr=!0,Un="g"):P[Un]||(cn===void 0&&(cn=12),_n=!0,Un="g"),(qt||pe==="0"&&De==="=")&&(qt=!0,pe="0",De="=");var ti=Tt==="$"?a:Tt==="#"&&/[boxX]/.test(Un)?"0"+Un.toLowerCase():"",ni=Tt==="$"?s:/[%p]/.test(Un)?_:"",Si=P[Un],qi=/[defgprs%]/.test(Un);cn=cn===void 0?6:/[gprs]/.test(Un)?Math.max(1,Math.min(21,cn)):Math.max(0,Math.min(20,cn));function _a(yi){var Ta=ti,Ua=ni,lu,zf,cp;if(Un==="c")Ua=Si(yi)+Ua,yi="";else{yi=+yi;var fp=yi<0||1/yi<0;if(yi=isNaN(yi)?M:Si(Math.abs(yi),cn),_n&&(yi=f(yi)),fp&&+yi==0&&rt!=="+"&&(fp=!1),Ta=(fp?rt==="("?rt:C:rt==="-"||rt==="("?"":rt)+Ta,Ua=(Un==="s"?X[8+v/3]:"")+Ua+(fp&&rt==="("?")":""),qi){for(lu=-1,zf=yi.length;++lu<zf;)if(cp=yi.charCodeAt(lu),48>cp||cp>57){Ua=(cp===46?l+yi.slice(lu+1):yi.slice(lu))+Ua,yi=yi.slice(0,lu);break}}}Hr&&!qt&&(yi=c(yi,Infinity));var hp=Ta.length+yi.length+Ua.length,Kc=hp<_r?new Array(_r-hp+1).join(pe):"";switch(Hr&&qt&&(yi=c(Kc+yi,Kc.length?_r-Ua.length:Infinity),Kc=""),De){case"<":yi=Ta+yi+Ua+Kc;break;case"=":yi=Ta+Kc+yi+Ua;break;case"^":yi=Kc.slice(0,hp=Kc.length>>1)+Ta+yi+Ua+Kc.slice(hp);break;default:yi=Kc+Ta+yi+Ua;break}return p(yi)}return _a.toString=function(){return G+""},_a}function W(G,pe){var De=R((G=gh(G),G.type="f",G)),rt=Math.max(-8,Math.min(8,Math.floor(Of(pe)/3)))*3,Tt=Math.pow(10,-rt),qt=X[8+rt/3];return function(_r){return De(Tt*_r)+qt}}return{format:R,formatPrefix:W}}var he,be,Ve;We({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function We(n){return he=re(n),be=he.format,Ve=he.formatPrefix,he}function vt(n,c){return n=Math.abs(n),c=Math.abs(c)-n,Math.max(0,Of(c)-Of(n))+1}function tt(n){return Math.max(0,-Of(Math.abs(n)))}function It(n,c,a,s){var l=tr(n,c,a),p;switch(s=gh(s==null?",f":s),s.type){case"s":{var _=Math.max(Math.abs(n),Math.abs(c));return s.precision==null&&!isNaN(p=e(l,_))&&(s.precision=p),Ve(s,_)}case"":case"e":case"g":case"p":case"r":{s.precision==null&&!isNaN(p=vt(l,Math.max(Math.abs(n),Math.abs(c))))&&(s.precision=p-(s.type==="e"));break}case"f":case"%":{s.precision==null&&!isNaN(p=tt(l))&&(s.precision=p-(s.type==="%")*2);break}}return be(s)}function Wt(n){var c=n.domain;return n.ticks=function(a){var s=c();return at(s[0],s[s.length-1],a==null?10:a)},n.tickFormat=function(a,s){var l=c();return It(l[0],l[l.length-1],a==null?10:a,s)},n.nice=function(a){a==null&&(a=10);var s=c(),l=0,p=s.length-1,_=s[l],C=s[p],M;return C<_&&(M=_,_=C,C=M,M=l,l=p,p=M),M=Mt(_,C,a),M>0?(_=Math.floor(_/M)*M,C=Math.ceil(C/M)*M,M=Mt(_,C,a)):M<0&&(_=Math.ceil(_*M)/M,C=Math.floor(C*M)/M,M=Mt(_,C,a)),M>0?(s[l]=Math.floor(_/M)*M,s[p]=Math.ceil(C/M)*M,c(s)):M<0&&(s[l]=Math.ceil(_*M)/M,s[p]=Math.floor(C*M)/M,c(s)),n},n}function pr(){var n=Pc(qa,qa);return n.copy=function(){return Kf(n,pr())},so.apply(n,arguments),Wt(n)}function mr(n){var c;function a(s){return isNaN(s=+s)?c:s}return a.invert=a,a.domain=a.range=function(s){return arguments.length?(n=pi.call(s,jc),a):n.slice()},a.unknown=function(s){return arguments.length?(c=s,a):c},a.copy=function(){return mr(n).unknown(c)},n=arguments.length?pi.call(n,jc):[0,1],Wt(a)}function Br(n,c){n=n.slice();var a=0,s=n.length-1,l=n[a],p=n[s],_;return p<l&&(_=a,a=s,s=_,_=l,l=p,p=_),n[a]=c.floor(l),n[s]=c.ceil(p),n}function sn(n){return Math.log(n)}function Cn(n){return Math.exp(n)}function fi(n){return-Math.log(-n)}function Vn(n){return-Math.exp(-n)}function di(n){return isFinite(n)?+("1e"+n):n<0?0:n}function Kn(n){return n===10?di:n===Math.E?Math.exp:function(c){return Math.pow(n,c)}}function oa(n){return n===Math.E?Math.log:n===10&&Math.log10||n===2&&Math.log2||(n=Math.log(n),function(c){return Math.log(c)/n})}function Ii(n){return function(c){return-n(-c)}}function oi(n){var c=n(sn,Cn),a=c.domain,s=10,l,p;function _(){return l=oa(s),p=Kn(s),a()[0]<0?(l=Ii(l),p=Ii(p),n(fi,Vn)):n(sn,Cn),c}return c.base=function(C){return arguments.length?(s=+C,_()):s},c.domain=function(C){return arguments.length?(a(C),_()):a()},c.ticks=function(C){var M=a(),R=M[0],W=M[M.length-1],G;(G=W<R)&&(pe=R,R=W,W=pe);var pe=l(R),De=l(W),rt,Tt,qt,_r=C==null?10:+C,Hr=[];if(!(s%1)&&De-pe<_r){if(pe=Math.round(pe)-1,De=Math.round(De)+1,R>0){for(;pe<De;++pe)for(Tt=1,rt=p(pe);Tt<s;++Tt)if(qt=rt*Tt,!(qt<R)){if(qt>W)break;Hr.push(qt)}}else for(;pe<De;++pe)for(Tt=s-1,rt=p(pe);Tt>=1;--Tt)if(qt=rt*Tt,!(qt<R)){if(qt>W)break;Hr.push(qt)}}else Hr=at(pe,De,Math.min(De-pe,_r)).map(p);return G?Hr.reverse():Hr},c.tickFormat=function(C,M){if(M==null&&(M=s===10?".0e":","),typeof M!="function"&&(M=be(M)),C===Infinity)return M;C==null&&(C=10);var R=Math.max(1,s*C/c.ticks().length);return function(W){var G=W/p(Math.round(l(W)));return G*s<s-.5&&(G*=s),G<=R?M(W):""}},c.nice=function(){return a(Br(a(),{floor:function(C){return p(Math.floor(l(C)))},ceil:function(C){return p(Math.ceil(l(C)))}}))},c}function fa(){var n=oi(ff()).domain([1,10]);return n.copy=function(){return Kf(n,fa()).base(n.base())},so.apply(n,arguments),n}function Qi(n){return function(c){return Math.sign(c)*Math.log1p(Math.abs(c/n))}}function Sa(n){return function(c){return Math.sign(c)*Math.expm1(Math.abs(c))*n}}function gi(n){var c=1,a=n(Qi(c),Sa(c));return a.constant=function(s){return arguments.length?n(Qi(c=+s),Sa(c)):c},linearish(a)}function Ba(){var n=gi(transformer());return n.copy=function(){return copy(n,Ba()).constant(n.constant())},initRange.apply(n,arguments)}function So(n){return function(c){return c<0?-Math.pow(-c,n):Math.pow(c,n)}}function Jo(n){return n<0?-Math.sqrt(-n):Math.sqrt(n)}function Ho(n){return n<0?-n*n:n*n}function Ro(n){var c=n(qa,qa),a=1;function s(){return a===1?n(qa,qa):a===.5?n(Jo,Ho):n(So(a),So(1/a))}return c.exponent=function(l){return arguments.length?(a=+l,s()):a},Wt(c)}function No(){var n=Ro(ff());return n.copy=function(){return Kf(n,No()).exponent(n.exponent())},so.apply(n,arguments),n}function zs(){return No.apply(null,arguments).exponent(.5)}function Cs(){var n=[],c=[],a=[],s;function l(){var _=0,C=Math.max(1,c.length);for(a=new Array(C-1);++_<C;)a[_-1]=Le(n,_/C);return p}function p(_){return isNaN(_=+_)?s:c[je(a,_)]}return p.invertExtent=function(_){var C=c.indexOf(_);return C<0?[NaN,NaN]:[C>0?a[C-1]:n[0],C<a.length?a[C]:n[n.length-1]]},p.domain=function(_){if(!arguments.length)return n.slice();n=[];for(var C=0,M=_.length,R;C<M;++C)R=_[C],R!=null&&!isNaN(R=+R)&&n.push(R);return n.sort(Oo),l()},p.range=function(_){return arguments.length?(c=Oa.call(_),l()):c.slice()},p.unknown=function(_){return arguments.length?(s=_,p):s},p.quantiles=function(){return a.slice()},p.copy=function(){return Cs().domain(n).range(c).unknown(s)},so.apply(p,arguments)}function su(){var n=0,c=1,a=1,s=[.5],l=[0,1],p;function _(M){return M<=M?l[je(s,M,0,a)]:p}function C(){var M=-1;for(s=new Array(a);++M<a;)s[M]=((M+1)*c-(M-a)*n)/(a+1);return _}return _.domain=function(M){return arguments.length?(n=+M[0],c=+M[1],C()):[n,c]},_.range=function(M){return arguments.length?(a=(l=Oa.call(M)).length-1,C()):l.slice()},_.invertExtent=function(M){var R=l.indexOf(M);return R<0?[NaN,NaN]:R<1?[n,s[0]]:R>=a?[s[a-1],c]:[s[R-1],s[R]]},_.unknown=function(M){return arguments.length&&(p=M),_},_.thresholds=function(){return s.slice()},_.copy=function(){return su().domain([n,c]).range(l).unknown(p)},so.apply(Wt(_),arguments)}function Ls(){var n=[.5],c=[0,1],a,s=1;function l(p){return p<=p?c[je(n,p,0,s)]:a}return l.domain=function(p){return arguments.length?(n=Oa.call(p),s=Math.min(n.length,c.length-1),l):n.slice()},l.range=function(p){return arguments.length?(c=Oa.call(p),s=Math.min(n.length,c.length-1),l):c.slice()},l.invertExtent=function(p){var _=c.indexOf(p);return[n[_-1],n[_]]},l.unknown=function(p){return arguments.length?(a=p,l):a},l.copy=function(){return Ls().domain(n).range(c).unknown(a)},so.apply(l,arguments)}var Xs=new Date,Wo=new Date;function Wa(n,c,a,s){function l(p){return n(p=arguments.length===0?new Date:new Date(+p)),p}return l.floor=function(p){return n(p=new Date(+p)),p},l.ceil=function(p){return n(p=new Date(p-1)),c(p,1),n(p),p},l.round=function(p){var _=l(p),C=l.ceil(p);return p-_<C-p?_:C},l.offset=function(p,_){return c(p=new Date(+p),_==null?1:Math.floor(_)),p},l.range=function(p,_,C){var M=[],R;if(p=l.ceil(p),C=C==null?1:Math.floor(C),!(p<_)||!(C>0))return M;do M.push(R=new Date(+p)),c(p,C),n(p);while(R<p&&p<_);return M},l.filter=function(p){return Wa(function(_){if(_>=_)for(;n(_),!p(_);)_.setTime(_-1)},function(_,C){if(_>=_)if(C<0)for(;++C<=0;)for(;c(_,-1),!p(_););else for(;--C>=0;)for(;c(_,1),!p(_););})},a&&(l.count=function(p,_){return Xs.setTime(+p),Wo.setTime(+_),n(Xs),n(Wo),Math.floor(a(Xs,Wo))},l.every=function(p){return p=Math.floor(p),!isFinite(p)||!(p>0)?null:p>1?l.filter(s?function(_){return s(_)%p==0}:function(_){return l.count(0,_)%p==0}):l}),l}var ma=Wa(function(n){n.setMonth(0,1),n.setHours(0,0,0,0)},function(n,c){n.setFullYear(n.getFullYear()+c)},function(n,c){return c.getFullYear()-n.getFullYear()},function(n){return n.getFullYear()});ma.every=function(n){return!isFinite(n=Math.floor(n))||!(n>0)?null:Wa(function(c){c.setFullYear(Math.floor(c.getFullYear()/n)*n),c.setMonth(0,1),c.setHours(0,0,0,0)},function(c,a){c.setFullYear(c.getFullYear()+a*n)})};var Na=ma,eo=ma.range,Aa=Wa(function(n){n.setDate(1),n.setHours(0,0,0,0)},function(n,c){n.setMonth(n.getMonth()+c)},function(n,c){return c.getMonth()-n.getMonth()+(c.getFullYear()-n.getFullYear())*12},function(n){return n.getMonth()}),Tu=Aa,yu=Aa.range,uo=1e3,zo=6e4,Ys=36e5,La=864e5,cc=6048e5;function Ks(n){return Wa(function(c){c.setDate(c.getDate()-(c.getDay()+7-n)%7),c.setHours(0,0,0,0)},function(c,a){c.setDate(c.getDate()+a*7)},function(c,a){return(a-c-(a.getTimezoneOffset()-c.getTimezoneOffset())*zo)/cc})}var Gl=Ks(0),Uo=Ks(1),Mc=Ks(2),Hl=Ks(3),fc=Ks(4),Lf=Ks(5),$f=Ks(6),hf=Gl.range,yh=Uo.range,Tp=Mc.range,_h=Hl.range,Kh=fc.range,Pp=Lf.range,Mp=$f.range,Ic=Wa(function(n){n.setHours(0,0,0,0)},function(n,c){n.setDate(n.getDate()+c)},function(n,c){return(c-n-(c.getTimezoneOffset()-n.getTimezoneOffset())*zo)/La},function(n){return n.getDate()-1}),Rf=Ic,xh=Ic.range,Vc=Wa(function(n){n.setTime(n-n.getMilliseconds()-n.getSeconds()*uo-n.getMinutes()*zo)},function(n,c){n.setTime(+n+c*Ys)},function(n,c){return(c-n)/Ys},function(n){return n.getHours()}),Jf=Vc,Ip=Vc.range,bh=Wa(function(n){n.setTime(n-n.getMilliseconds()-n.getSeconds()*uo)},function(n,c){n.setTime(+n+c*zo)},function(n,c){return(c-n)/zo},function(n){return n.getMinutes()}),Sh=bh,$h=bh.range,Eh=Wa(function(n){n.setTime(n-n.getMilliseconds())},function(n,c){n.setTime(+n+c*uo)},function(n,c){return(c-n)/uo},function(n){return n.getUTCSeconds()}),Ch=Eh,Jh=Eh.range,pf=Wa(function(){},function(n,c){n.setTime(+n+c)},function(n,c){return c-n});pf.every=function(n){return n=Math.floor(n),!isFinite(n)||!(n>0)?null:n>1?Wa(function(c){c.setTime(Math.floor(c/n)*n)},function(c,a){c.setTime(+c+a*n)},function(c,a){return(a-c)/n}):pf};var Qh=pf,wh=pf.range;function Oc(n){return Wa(function(c){c.setUTCDate(c.getUTCDate()-(c.getUTCDay()+7-n)%7),c.setUTCHours(0,0,0,0)},function(c,a){c.setUTCDate(c.getUTCDate()+a*7)},function(c,a){return(a-c)/cc})}var Df=Oc(0),df=Oc(1),kf=Oc(2),Ah=Oc(3),hc=Oc(4),Op=Oc(5),$p=Oc(6),Jp=Df.range,wd=df.range,Qp=kf.range,Hd=Ah.range,qh=hc.range,ds=Op.range,Lc=$p.range,qp=Wa(function(n){n.setUTCHours(0,0,0,0)},function(n,c){n.setUTCDate(n.getUTCDate()+c)},function(n,c){return(c-n)/La},function(n){return n.getUTCDate()-1}),Gc=qp,ed=qp.range,ep=Wa(function(n){n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},function(n,c){n.setUTCFullYear(n.getUTCFullYear()+c)},function(n,c){return c.getUTCFullYear()-n.getUTCFullYear()},function(n){return n.getUTCFullYear()});ep.every=function(n){return!isFinite(n=Math.floor(n))||!(n>0)?null:Wa(function(c){c.setUTCFullYear(Math.floor(c.getUTCFullYear()/n)*n),c.setUTCMonth(0,1),c.setUTCHours(0,0,0,0)},function(c,a){c.setUTCFullYear(c.getUTCFullYear()+a*n)})};var vf=ep,Hc=ep.range;function Qf(n){if(0<=n.y&&n.y<100){var c=new Date(-1,n.m,n.d,n.H,n.M,n.S,n.L);return c.setFullYear(n.y),c}return new Date(n.y,n.m,n.d,n.H,n.M,n.S,n.L)}function Ff(n){if(0<=n.y&&n.y<100){var c=new Date(Date.UTC(-1,n.m,n.d,n.H,n.M,n.S,n.L));return c.setUTCFullYear(n.y),c}return new Date(Date.UTC(n.y,n.m,n.d,n.H,n.M,n.S,n.L))}function mf(n,c,a){return{y:n,m:c,d:a,H:0,M:0,S:0,L:0}}function tp(n){var c=n.dateTime,a=n.date,s=n.time,l=n.periods,p=n.days,_=n.shortDays,C=n.months,M=n.shortMonths,R=qf(l),W=eh(l),G=qf(p),pe=eh(p),De=qf(_),rt=eh(_),Tt=qf(C),qt=eh(C),_r=qf(M),Hr=eh(M),cn={a:fp,A:hp,b:Kc,B:gy,c:null,d:ip,e:ip,f:zp,g:Ld,G:Dd,H:ud,I:Bp,j:ld,L:Np,m:cd,M:Ph,p:yy,q:_y,Q:Yd,s:Kd,S:fd,u:ap,U:Td,V:Pd,w:Md,W:Id,x:null,X:null,y:Od,Y:Rd,Z:kd,"%":Xd},_n={a:xy,A:by,b:Sy,B:Ey,c:null,d:pc,e:pc,f:Mm,g:zm,G:Zm,H:op,I:hd,j:Mh,L:Zp,m:Im,M:Om,p:Cy,q:wy,Q:Yd,s:Kd,S:Lm,u:Rm,U:Dm,V:km,w:Fm,W:Bm,x:null,X:null,y:Nm,Y:Um,Z:jm,"%":Xd},Un={a:_a,A:yi,b:Ta,B:Ua,c:lu,d:Bf,e:Bf,f:kp,g:gf,G:Lp,H:Rp,I:Rp,j:id,L:Dp,m:nh,M:ad,p:qi,q:rh,Q:sd,s:Fp,S:od,u:np,U:nd,V:Rc,w:pl,W:Ad,x:zf,X:cp,y:gf,Y:Lp,Z:th,"%":Wc};cn.x=ti(a,cn),cn.X=ti(s,cn),cn.c=ti(c,cn),_n.x=ti(a,_n),_n.X=ti(s,_n),_n.c=ti(c,_n);function ti(Fi,to){return function(Eo){var $n=[],Wl=-1,vs=0,dc=Fi.length,vc,Oh,Pm;for(Eo instanceof Date||(Eo=new Date(+Eo));++Wl<dc;)Fi.charCodeAt(Wl)===37&&($n.push(Fi.slice(vs,Wl)),(Oh=rp[vc=Fi.charAt(++Wl)])!=null?vc=Fi.charAt(++Wl):Oh=vc==="e"?" ":"0",(Pm=to[vc])&&(vc=Pm(Eo,Oh)),$n.push(vc),vs=Wl+1);return $n.push(Fi.slice(vs,Wl)),$n.join("")}}function ni(Fi,to){return function(Eo){var $n=mf(1900,void 0,1),Wl=Si($n,Fi,Eo+="",0),vs,dc;if(Wl!=Eo.length)return null;if("Q"in $n)return new Date($n.Q);if("s"in $n)return new Date($n.s*1e3+("L"in $n?$n.L:0));if(to&&!("Z"in $n)&&($n.Z=0),"p"in $n&&($n.H=$n.H%12+$n.p*12),$n.m===void 0&&($n.m="q"in $n?$n.q:0),"V"in $n){if($n.V<1||$n.V>53)return null;"w"in $n||($n.w=1),"Z"in $n?(vs=Ff(mf($n.y,0,1)),dc=vs.getUTCDay(),vs=dc>4||dc===0?df.ceil(vs):df(vs),vs=Gc.offset(vs,($n.V-1)*7),$n.y=vs.getUTCFullYear(),$n.m=vs.getUTCMonth(),$n.d=vs.getUTCDate()+($n.w+6)%7):(vs=Qf(mf($n.y,0,1)),dc=vs.getDay(),vs=dc>4||dc===0?Uo.ceil(vs):Uo(vs),vs=Rf.offset(vs,($n.V-1)*7),$n.y=vs.getFullYear(),$n.m=vs.getMonth(),$n.d=vs.getDate()+($n.w+6)%7)}else("W"in $n||"U"in $n)&&("w"in $n||($n.w="u"in $n?$n.u%7:"W"in $n?1:0),dc="Z"in $n?Ff(mf($n.y,0,1)).getUTCDay():Qf(mf($n.y,0,1)).getDay(),$n.m=0,$n.d="W"in $n?($n.w+6)%7+$n.W*7-(dc+5)%7:$n.w+$n.U*7-(dc+6)%7);return"Z"in $n?($n.H+=$n.Z/100|0,$n.M+=$n.Z%100,Ff($n)):Qf($n)}}function Si(Fi,to,Eo,$n){for(var Wl=0,vs=to.length,dc=Eo.length,vc,Oh;Wl<vs;){if($n>=dc)return-1;if(vc=to.charCodeAt(Wl++),vc===37){if(vc=to.charAt(Wl++),Oh=Un[vc in rp?to.charAt(Wl++):vc],!Oh||($n=Oh(Fi,Eo,$n))<0)return-1}else if(vc!=Eo.charCodeAt($n++))return-1}return $n}function qi(Fi,to,Eo){var $n=R.exec(to.slice(Eo));return $n?(Fi.p=W[$n[0].toLowerCase()],Eo+$n[0].length):-1}function _a(Fi,to,Eo){var $n=De.exec(to.slice(Eo));return $n?(Fi.w=rt[$n[0].toLowerCase()],Eo+$n[0].length):-1}function yi(Fi,to,Eo){var $n=G.exec(to.slice(Eo));return $n?(Fi.w=pe[$n[0].toLowerCase()],Eo+$n[0].length):-1}function Ta(Fi,to,Eo){var $n=_r.exec(to.slice(Eo));return $n?(Fi.m=Hr[$n[0].toLowerCase()],Eo+$n[0].length):-1}function Ua(Fi,to,Eo){var $n=Tt.exec(to.slice(Eo));return $n?(Fi.m=qt[$n[0].toLowerCase()],Eo+$n[0].length):-1}function lu(Fi,to,Eo){return Si(Fi,c,to,Eo)}function zf(Fi,to,Eo){return Si(Fi,a,to,Eo)}function cp(Fi,to,Eo){return Si(Fi,s,to,Eo)}function fp(Fi){return _[Fi.getDay()]}function hp(Fi){return p[Fi.getDay()]}function Kc(Fi){return M[Fi.getMonth()]}function gy(Fi){return C[Fi.getMonth()]}function yy(Fi){return l[+(Fi.getHours()>=12)]}function _y(Fi){return 1+~~(Fi.getMonth()/3)}function xy(Fi){return _[Fi.getUTCDay()]}function by(Fi){return p[Fi.getUTCDay()]}function Sy(Fi){return M[Fi.getUTCMonth()]}function Ey(Fi){return C[Fi.getUTCMonth()]}function Cy(Fi){return l[+(Fi.getUTCHours()>=12)]}function wy(Fi){return 1+~~(Fi.getUTCMonth()/3)}return{format:function(Fi){var to=ti(Fi+="",cn);return to.toString=function(){return Fi},to},parse:function(Fi){var to=ni(Fi+="",!1);return to.toString=function(){return Fi},to},utcFormat:function(Fi){var to=ti(Fi+="",_n);return to.toString=function(){return Fi},to},utcParse:function(Fi){var to=ni(Fi+="",!0);return to.toString=function(){return Fi},to}}}var rp={"-":"",_:" ","0":"0"},uu=/^\s*\d+/,Th=/^%/,td=/[\\^$*+?|[\]().{}]/g;function lo(n,c,a){var s=n<0?"-":"",l=(s?-n:n)+"",p=l.length;return s+(p<a?new Array(a-p+1).join(c)+l:l)}function rd(n){return n.replace(td,"\\$&")}function qf(n){return new RegExp("^(?:"+n.map(rd).join("|")+")","i")}function eh(n){for(var c={},a=-1,s=n.length;++a<s;)c[n[a].toLowerCase()]=a;return c}function pl(n,c,a){var s=uu.exec(c.slice(a,a+1));return s?(n.w=+s[0],a+s[0].length):-1}function np(n,c,a){var s=uu.exec(c.slice(a,a+1));return s?(n.u=+s[0],a+s[0].length):-1}function nd(n,c,a){var s=uu.exec(c.slice(a,a+2));return s?(n.U=+s[0],a+s[0].length):-1}function Rc(n,c,a){var s=uu.exec(c.slice(a,a+2));return s?(n.V=+s[0],a+s[0].length):-1}function Ad(n,c,a){var s=uu.exec(c.slice(a,a+2));return s?(n.W=+s[0],a+s[0].length):-1}function Lp(n,c,a){var s=uu.exec(c.slice(a,a+4));return s?(n.y=+s[0],a+s[0].length):-1}function gf(n,c,a){var s=uu.exec(c.slice(a,a+2));return s?(n.y=+s[0]+(+s[0]>68?1900:2e3),a+s[0].length):-1}function th(n,c,a){var s=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(c.slice(a,a+6));return s?(n.Z=s[1]?0:-(s[2]+(s[3]||"00")),a+s[0].length):-1}function rh(n,c,a){var s=uu.exec(c.slice(a,a+1));return s?(n.q=s[0]*3-3,a+s[0].length):-1}function nh(n,c,a){var s=uu.exec(c.slice(a,a+2));return s?(n.m=s[0]-1,a+s[0].length):-1}function Bf(n,c,a){var s=uu.exec(c.slice(a,a+2));return s?(n.d=+s[0],a+s[0].length):-1}function id(n,c,a){var s=uu.exec(c.slice(a,a+3));return s?(n.m=0,n.d=+s[0],a+s[0].length):-1}function Rp(n,c,a){var s=uu.exec(c.slice(a,a+2));return s?(n.H=+s[0],a+s[0].length):-1}function ad(n,c,a){var s=uu.exec(c.slice(a,a+2));return s?(n.M=+s[0],a+s[0].length):-1}function od(n,c,a){var s=uu.exec(c.slice(a,a+2));return s?(n.S=+s[0],a+s[0].length):-1}function Dp(n,c,a){var s=uu.exec(c.slice(a,a+3));return s?(n.L=+s[0],a+s[0].length):-1}function kp(n,c,a){var s=uu.exec(c.slice(a,a+6));return s?(n.L=Math.floor(s[0]/1e3),a+s[0].length):-1}function Wc(n,c,a){var s=Th.exec(c.slice(a,a+1));return s?a+s[0].length:-1}function sd(n,c,a){var s=uu.exec(c.slice(a));return s?(n.Q=+s[0],a+s[0].length):-1}function Fp(n,c,a){var s=uu.exec(c.slice(a));return s?(n.s=+s[0],a+s[0].length):-1}function ip(n,c){return lo(n.getDate(),c,2)}function ud(n,c){return lo(n.getHours(),c,2)}function Bp(n,c){return lo(n.getHours()%12||12,c,2)}function ld(n,c){return lo(1+Rf.count(Na(n),n),c,3)}function Np(n,c){return lo(n.getMilliseconds(),c,3)}function zp(n,c){return Np(n,c)+"000"}function cd(n,c){return lo(n.getMonth()+1,c,2)}function Ph(n,c){return lo(n.getMinutes(),c,2)}function fd(n,c){return lo(n.getSeconds(),c,2)}function ap(n){var c=n.getDay();return c===0?7:c}function Td(n,c){return lo(Gl.count(Na(n)-1,n),c,2)}function Up(n){var c=n.getDay();return c>=4||c===0?fc(n):fc.ceil(n)}function Pd(n,c){return n=Up(n),lo(fc.count(Na(n),n)+(Na(n).getDay()===4),c,2)}function Md(n){return n.getDay()}function Id(n,c){return lo(Uo.count(Na(n)-1,n),c,2)}function Od(n,c){return lo(n.getFullYear()%100,c,2)}function Ld(n,c){return n=Up(n),lo(n.getFullYear()%100,c,2)}function Rd(n,c){return lo(n.getFullYear()%1e4,c,4)}function Dd(n,c){var a=n.getDay();return n=a>=4||a===0?fc(n):fc.ceil(n),lo(n.getFullYear()%1e4,c,4)}function kd(n){var c=n.getTimezoneOffset();return(c>0?"-":(c*=-1,"+"))+lo(c/60|0,"0",2)+lo(c%60,"0",2)}function pc(n,c){return lo(n.getUTCDate(),c,2)}function op(n,c){return lo(n.getUTCHours(),c,2)}function hd(n,c){return lo(n.getUTCHours()%12||12,c,2)}function Mh(n,c){return lo(1+Gc.count(vf(n),n),c,3)}function Zp(n,c){return lo(n.getUTCMilliseconds(),c,3)}function Mm(n,c){return Zp(n,c)+"000"}function Im(n,c){return lo(n.getUTCMonth()+1,c,2)}function Om(n,c){return lo(n.getUTCMinutes(),c,2)}function Lm(n,c){return lo(n.getUTCSeconds(),c,2)}function Rm(n){var c=n.getUTCDay();return c===0?7:c}function Dm(n,c){return lo(Df.count(vf(n)-1,n),c,2)}function Wd(n){var c=n.getUTCDay();return c>=4||c===0?hc(n):hc.ceil(n)}function km(n,c){return n=Wd(n),lo(hc.count(vf(n),n)+(vf(n).getUTCDay()===4),c,2)}function Fm(n){return n.getUTCDay()}function Bm(n,c){return lo(df.count(vf(n)-1,n),c,2)}function Nm(n,c){return lo(n.getUTCFullYear()%100,c,2)}function zm(n,c){return n=Wd(n),lo(n.getUTCFullYear()%100,c,2)}function Um(n,c){return lo(n.getUTCFullYear()%1e4,c,4)}function Zm(n,c){var a=n.getUTCDay();return n=a>=4||a===0?hc(n):hc.ceil(n),lo(n.getUTCFullYear()%1e4,c,4)}function jm(){return"+0000"}function Xd(){return"%"}function Yd(n){return+n}function Kd(n){return Math.floor(+n/1e3)}var sp,$d,Vm,Gm,Hm;Wm({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Wm(n){return sp=tp(n),$d=sp.format,Vm=sp.parse,Gm=sp.utcFormat,Hm=sp.utcParse,sp}var jp=1e3,Vp=jp*60,Gp=Vp*60,Hp=Gp*24,Xm=Hp*7,Jd=Hp*30,Fd=Hp*365;function Ym(n){return new Date(n)}function Km(n){return n instanceof Date?+n:+new Date(+n)}function Qd(n,c,a,s,l,p,_,C,M){var R=Pc(qa,qa),W=R.invert,G=R.domain,pe=M(".%L"),De=M(":%S"),rt=M("%I:%M"),Tt=M("%I %p"),qt=M("%a %d"),_r=M("%b %d"),Hr=M("%B"),cn=M("%Y"),_n=[[_,1,jp],[_,5,5*jp],[_,15,15*jp],[_,30,30*jp],[p,1,Vp],[p,5,5*Vp],[p,15,15*Vp],[p,30,30*Vp],[l,1,Gp],[l,3,3*Gp],[l,6,6*Gp],[l,12,12*Gp],[s,1,Hp],[s,2,2*Hp],[a,1,Xm],[c,1,Jd],[c,3,3*Jd],[n,1,Fd]];function Un(ni){return(_(ni)<ni?pe:p(ni)<ni?De:l(ni)<ni?rt:s(ni)<ni?Tt:c(ni)<ni?a(ni)<ni?qt:_r:n(ni)<ni?Hr:cn)(ni)}function ti(ni,Si,qi,_a){if(ni==null&&(ni=10),typeof ni=="number"){var yi=Math.abs(qi-Si)/ni,Ta=Mi(function(Ua){return Ua[2]}).right(_n,yi);Ta===_n.length?(_a=tr(Si/Fd,qi/Fd,ni),ni=n):Ta?(Ta=_n[yi/_n[Ta-1][2]<_n[Ta][2]/yi?Ta-1:Ta],_a=Ta[1],ni=Ta[0]):(_a=Math.max(tr(Si,qi,ni),1),ni=C)}return _a==null?ni:ni.every(_a)}return R.invert=function(ni){return new Date(W(ni))},R.domain=function(ni){return arguments.length?G(pi.call(ni,Km)):G().map(Ym)},R.ticks=function(ni,Si){var qi=G(),_a=qi[0],yi=qi[qi.length-1],Ta=yi<_a,Ua;return Ta&&(Ua=_a,_a=yi,yi=Ua),Ua=ti(ni,_a,yi,Si),Ua=Ua?Ua.range(_a,yi+1):[],Ta?Ua.reverse():Ua},R.tickFormat=function(ni,Si){return Si==null?Un:M(Si)},R.nice=function(ni,Si){var qi=G();return(ni=ti(ni,qi[0],qi[qi.length-1],Si))?G(Br(qi,ni)):R},R.copy=function(){return Kf(R,Qd(n,c,a,s,l,p,_,C,M))},R}function $m(){return so.apply(Qd(Na,Tu,Gl,Rf,Jf,Sh,Ch,Qh,$d).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Ay(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function pd(){var n=0,c=1,a,s,l,p,_=identity,C=!1,M;function R(W){return isNaN(W=+W)?M:_(l===0?.5:(W=(p(W)-a)*l,C?Math.max(0,Math.min(1,W)):W))}return R.domain=function(W){return arguments.length?(a=p(n=+W[0]),s=p(c=+W[1]),l=a===s?0:1/(s-a),R):[n,c]},R.clamp=function(W){return arguments.length?(C=!!W,R):C},R.interpolator=function(W){return arguments.length?(_=W,R):_},R.unknown=function(W){return arguments.length?(M=W,R):M},function(W){return p=W,a=W(n),s=W(c),l=a===s?0:1/(s-a),R}}function dd(n,c){return c.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function Jm(){var n=linearish(pd()(identity));return n.copy=function(){return dd(n,Jm())},initInterpolator.apply(n,arguments)}function Qm(){var n=loggish(pd()).domain([1,10]);return n.copy=function(){return dd(n,Qm()).base(n.base())},initInterpolator.apply(n,arguments)}function qm(){var n=symlogish(pd());return n.copy=function(){return dd(n,qm()).constant(n.constant())},initInterpolator.apply(n,arguments)}function qd(){var n=powish(pd());return n.copy=function(){return dd(n,qd()).exponent(n.exponent())},initInterpolator.apply(n,arguments)}function Ty(){return qd.apply(null,arguments).exponent(.5)}function e0(){var n=[],c=identity;function a(s){if(!isNaN(s=+s))return c((bisect(n,s)-1)/(n.length-1))}return a.domain=function(s){if(!arguments.length)return n.slice();n=[];for(var l=0,p=s.length,_;l<p;++l)_=s[l],_!=null&&!isNaN(_=+_)&&n.push(_);return n.sort(ascending),a},a.interpolator=function(s){return arguments.length?(c=s,a):c},a.copy=function(){return e0(c).domain(n)},initInterpolator.apply(a,arguments)}function vd(){var n=0,c=.5,a=1,s,l,p,_,C,M=identity,R,W=!1,G;function pe(De){return isNaN(De=+De)?G:(De=.5+((De=+R(De))-l)*(De<l?_:C),M(W?Math.max(0,Math.min(1,De)):De))}return pe.domain=function(De){return arguments.length?(s=R(n=+De[0]),l=R(c=+De[1]),p=R(a=+De[2]),_=s===l?0:.5/(l-s),C=l===p?0:.5/(p-l),pe):[n,c,a]},pe.clamp=function(De){return arguments.length?(W=!!De,pe):W},pe.interpolator=function(De){return arguments.length?(M=De,pe):M},pe.unknown=function(De){return arguments.length?(G=De,pe):G},function(De){return R=De,s=De(n),l=De(c),p=De(a),_=s===l?0:.5/(l-s),C=l===p?0:.5/(p-l),pe}}function t0(){var n=linearish(vd()(identity));return n.copy=function(){return copy(n,t0())},initInterpolator.apply(n,arguments)}function r0(){var n=loggish(vd()).domain([.1,1,10]);return n.copy=function(){return copy(n,r0()).base(n.base())},initInterpolator.apply(n,arguments)}function n0(){var n=symlogish(vd());return n.copy=function(){return copy(n,n0()).constant(n.constant())},initInterpolator.apply(n,arguments)}function ev(){var n=powish(vd());return n.copy=function(){return copy(n,ev()).exponent(n.exponent())},initInterpolator.apply(n,arguments)}function Py(){return ev.apply(null,arguments).exponent(.5)}var Xc,tv,rv,nv,Bd,iv,i0=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,a0=(Xc={},(0,j.Z)(Xc,L.ScaleTypes.LINEAR,pr),(0,j.Z)(Xc,L.ScaleTypes.POWER,No),(0,j.Z)(Xc,L.ScaleTypes.LOG,fa),(0,j.Z)(Xc,L.ScaleTypes.IDENTITY,mr),(0,j.Z)(Xc,L.ScaleTypes.TIME,$m),(0,j.Z)(Xc,L.ScaleTypes.QUANTILE,Cs),(0,j.Z)(Xc,L.ScaleTypes.QUANTIZE,su),(0,j.Z)(Xc,L.ScaleTypes.THRESHOLD,Ls),(0,j.Z)(Xc,L.ScaleTypes.CAT,wa),Xc),o0=(tv=(0,ln.b2)(),rv=(0,ln.f3)(L.vK.IGlobalConfigService),tv(nv=(Bd=function(){function n(){(0,cr.Z)(this,n),(0,io.Z)(this,"configService",iv,this),(0,j.Z)(this,"scaleCache",{}),(0,j.Z)(this,"scaleOptions",{})}return(0,Mr.Z)(n,[{key:"apply",value:function(a,s){var l=this,p=s.styleAttributeService;a.hooks.init.tap("FeatureScalePlugin",function(){l.scaleOptions=a.getScaleOptions();var _=p.getLayerStyleAttributes(),C=a.getSource().data.dataArray;C.length!==0&&l.caculateScalesForAttributes(_||[],C)}),a.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){l.scaleOptions=a.getScaleOptions();var _=p.getLayerStyleAttributes(),C=a.getSource().data.dataArray;return l.caculateScalesForAttributes(_||[],C),a.layerModelNeedUpdate=!0,!0}),a.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!a.layerModelNeedUpdate){l.scaleOptions=a.getScaleOptions();var _=p.getLayerStyleAttributes();if(_){var C=a.getSource().data.dataArray;if(C.length===0)return;var M=_.filter(function(R){return R.needRescale});M.length&&l.caculateScalesForAttributes(M,C)}}})}},{key:"isNumber",value:function(a){return!isNaN(parseFloat(a))&&isFinite(a)}},{key:"caculateScalesForAttributes",value:function(a,s){var l=this;this.scaleCache={},a.forEach(function(p){if(p.scale){var _=p.scale,C=p.name;_.names=l.parseFields(p.scale.field||[]);var M=[];_.names.forEach(function(R){M.push(l.getOrCreateScale(R,p,s))}),M.some(function(R){return R.type===L.StyleScaleType.VARIABLE})?(_.type=L.StyleScaleType.VARIABLE,M.forEach(function(R){if(!_.callback){var W;if(_.values&&_.values!=="text"){var G;if(((G=R.option)===null||G===void 0?void 0:G.type)==="linear"&&_.values.length>2){var pe=R.scale.ticks(_.values.length);C==="color"&&R.scale.domain(pe)}R.scale.range(_.values)}else((W=R.option)===null||W===void 0?void 0:W.type)==="cat"&&R.scale.range(R.option.domain)}})):(_.type=L.StyleScaleType.CONSTANT,_.defaultValues=M.map(function(R,W){return R.scale(_.names[W])})),_.scalers=M.map(function(R){return{field:R.field,func:R.scale,option:R.option}}),p.needRescale=!1}})}},{key:"getOrCreateScale",value:function(a,s,l){var p,_=[a,s.name].join("_"),C=(p=s.scale)===null||p===void 0?void 0:p.values,M=this.createScale(a,s.name,C,l);return M}},{key:"parseFields",value:function(a){return Array.isArray(a)?a:B()(a)?a.split("*"):[a]}},{key:"createScale",value:function(a,s,l,p){var _,C,M=this.scaleOptions[s]&&((_=this.scaleOptions[s])===null||_===void 0?void 0:_.field)===a?this.scaleOptions[s]:this.scaleOptions[a],R={field:a,scale:void 0,type:L.StyleScaleType.VARIABLE,option:M};if(!p||!p.length)return M&&M.type?R.scale=this.createDefaultScale(M):(R.scale=wa([a]),R.type=L.StyleScaleType.CONSTANT),R;var W=(C=p.find(function(De){return!ki()(De[a])}))===null||C===void 0?void 0:C[a];if(this.isNumber(a)||ki()(W)&&!M)R.scale=wa([a]),R.type=L.StyleScaleType.CONSTANT;else{var G=M&&M.type||this.getDefaultType(W);l==="text"&&(G=L.ScaleTypes.CAT);var pe=this.createDefaultScaleConfig(G,a,p);Object.assign(pe,M),R.scale=this.createDefaultScale(pe),R.option=pe}return R}},{key:"getDefaultType",value:function(a){var s=L.ScaleTypes.LINEAR;return typeof a=="string"&&(s=i0.test(a)?L.ScaleTypes.TIME:L.ScaleTypes.CAT),s}},{key:"createDefaultScaleConfig",value:function(a,s,l){var p={type:a},_=(l==null?void 0:l.map(function(C){return C[s]}))||[];return a!==L.ScaleTypes.CAT&&a!==L.ScaleTypes.QUANTILE?p.domain=la(_):a===L.ScaleTypes.CAT?p.domain=Ln()(_):a===L.ScaleTypes.QUANTILE&&(p.domain=_),p}},{key:"createDefaultScale",value:function(a){var s=a.type,l=a.domain,p=a0[s]();return l&&p.domain(l),p}}]),n}(),iv=(0,bo.Z)(Bd.prototype,"configService",[rv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bd))||nv),av,ov,sv,uv,md,lv,cv;function fv(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function s0(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?fv(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):fv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var u0=(av=(0,ln.b2)(),ov=(0,ln.f3)(L.vK.ICameraService),sv=(0,ln.f3)(L.vK.IRendererService),av(uv=(md=function(){function n(){(0,cr.Z)(this,n),(0,io.Z)(this,"cameraService",lv,this),(0,io.Z)(this,"rendererService",cv,this)}return(0,Mr.Z)(n,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){a.models.forEach(function(s){s.addUniforms(s0({},a.layerModel.getAnimateUniforms()))})})}}]),n}(),lv=(0,bo.Z)(md.prototype,"cameraService",[ov],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cv=(0,bo.Z)(md.prototype,"rendererService",[sv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),md))||uv),hv,pv,l0=(hv=(0,ln.b2)(),hv(pv=function(){function n(){(0,cr.Z)(this,n)}return(0,Mr.Z)(n,[{key:"apply",value:function(a){a.hooks.init.tap("LayerModelPlugin",function(){a.prepareBuildModel(),a.buildModels(),a.styleNeedUpdate=!1}),a.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return a.prepareBuildModel(),a.clearModels(),a.buildModels(),a.layerModelNeedUpdate=!1,!1})}}]),n}())||pv),dv,vv,c0=(dv=(0,ln.b2)(),dv(vv=function(){function n(){(0,cr.Z)(this,n)}return(0,Mr.Z)(n,[{key:"apply",value:function(a){a.hooks.afterInit.tap("LayerStylePlugin",function(){a.updateLayerConfig({});var s=a.getLayerConfig(),l=s.autoFit,p=s.fitBoundsOptions;l&&setTimeout(function(){a.fitBounds(p)},100)})}}]),n}())||vv),mv,gv;function yv(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Wp(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?yv(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):yv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var _v={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},f0={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},h0={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},p0={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},My=null;function d0(n){var c={u_DirectionalLights:new Array(3).fill(Wp({},h0)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(Wp({},p0)),u_NumOfSpotLights:0};return(!n||!n.length)&&(n=[f0]),n.forEach(function(a,s){var l=a.type,p=l===void 0?"directional":l,_=(0,js.Z)(a,["type"]),C=_v[p].lights,M=_v[p].num,R=c[M];c[C][R]=Wp(Wp({},c[C][R]),_),c[M]++}),c}var v0=(mv=(0,ln.b2)(),mv(gv=function(){function n(){(0,cr.Z)(this,n)}return(0,Mr.Z)(n,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("LightingPlugin",function(){var s=a.getLayerConfig(),l=s.enableLighting;l&&a.models.forEach(function(p){return p.addUniforms(Wp({},d0()))})})}}]),n}())||gv),xv,bv,gd={NONE:0,ENCODE:1,HIGHLIGHT:2},m0=(xv=(0,ln.b2)(),xv(bv=function(){function n(){(0,cr.Z)(this,n)}return(0,Mr.Z)(n,[{key:"apply",value:function(a,s){var l=s.rendererService,p=s.styleAttributeService;a.hooks.init.tap("PixelPickingPlugin",function(){var _=a.getLayerConfig(),C=_.enablePicking;p.registerStyleAttribute({name:"pickingColor",type:L.AttributeType.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:L.gl.FLOAT},size:3,update:function(R,W){var G=R.id;return C?(0,Ke.Z6)(G):[0,0,0]}}})}),a.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var _=a.getLayerConfig(),C=_.enablePicking;C&&a.isVisible()&&a.models.forEach(function(M){return M.addUniforms({u_PickingStage:gd.ENCODE})})}),a.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var _=a.getLayerConfig(),C=_.enablePicking;C&&a.isVisible()&&a.models.forEach(function(M){return M.addUniforms({u_PickingStage:gd.HIGHLIGHT})})}),a.hooks.beforeHighlight.tap("PixelPickingPlugin",function(_){var C=a.getLayerConfig(),M=C.highlightColor,R=typeof M=="string"?(0,Ke.CI)(M):M||[1,0,0,1];a.updateLayerConfig({pickedFeatureID:(0,Ke.W0)(new Uint8Array(_))}),a.models.forEach(function(W){return W.addUniforms({u_PickingStage:gd.HIGHLIGHT,u_PickingColor:_,u_HighlightColor:R.map(function(G){return G*255})})})}),a.hooks.beforeSelect.tap("PixelPickingPlugin",function(_){var C=a.getLayerConfig(),M=C.selectColor,R=typeof M=="string"?(0,Ke.CI)(M):M||[1,0,0,1];a.updateLayerConfig({pickedFeatureID:(0,Ke.W0)(new Uint8Array(_))}),a.models.forEach(function(W){return W.addUniforms({u_PickingStage:gd.HIGHLIGHT,u_PickingColor:_,u_HighlightColor:R.map(function(G){return G*255})})})})}}]),n}())||bv),Sv,Ev,g0=(Sv=(0,ln.b2)(),Sv(Ev=function(){function n(){(0,cr.Z)(this,n)}return(0,Mr.Z)(n,[{key:"apply",value:function(a,s){var l=this,p=s.styleAttributeService;a.hooks.init.tap("RegisterStyleAttributePlugin",function(){l.registerBuiltinAttributes(p)})}},{key:"registerBuiltinAttributes",value:function(a){a.registerStyleAttribute({name:"position",type:L.AttributeType.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:L.gl.FLOAT},size:3,update:function(l,p,_){return _.length===2?[_[0],_[1],0]:[_[0],_[1],_[2]]}}}),a.registerStyleAttribute({name:"filter",type:L.AttributeType.Attribute,descriptor:{name:"filter",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:1,update:function(l,p){var _=l.filter;return _?[1]:[0]}}}),a.registerStyleAttribute({name:"color",type:L.AttributeType.Attribute,descriptor:{name:"a_Color",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:4,update:function(l,p){var _=l.color;return!_||!_.length?[1,1,1,1]:_}}}),a.registerStyleAttribute({name:"vertexId",type:L.AttributeType.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:1,update:function(l,p,_,C){return[p]}}})}}]),n}())||Ev),Cv,wv,Av,Tv,Pv,Mv,up,Iv,Ov,Lv,Rv,y0=(Cv=(0,ln.b2)(),wv=(0,ln.f3)(L.vK.ICameraService),Av=(0,ln.f3)(L.vK.ICoordinateSystemService),Tv=(0,ln.f3)(L.vK.IRendererService),Pv=(0,ln.f3)(L.vK.IMapService),Cv(Mv=(up=function(){function n(){(0,cr.Z)(this,n),(0,io.Z)(this,"cameraService",Iv,this),(0,io.Z)(this,"coordinateSystemService",Ov,this),(0,io.Z)(this,"rendererService",Lv,this),(0,io.Z)(this,"mapService",Rv,this)}return(0,Mr.Z)(n,[{key:"apply",value:function(a){var s=this,l=this.mapService.version,p=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_=[0,0];a.hooks.beforeRender.tap("ShaderUniformPlugin",function(){s.coordinateSystemService.refresh(),l==="GAODE2.x"&&(p=s.mapService.map.customCoords.getMVPMatrix(),_=s.mapService.getCustomCoordCenter());var C=s.rendererService.getViewportSize(),M=C.width,R=C.height;a.models.forEach(function(W){var G;W.addUniforms((G={},(0,j.Z)(G,L.CameraUniform.ProjectionMatrix,s.cameraService.getProjectionMatrix()),(0,j.Z)(G,L.CameraUniform.ViewMatrix,s.cameraService.getViewMatrix()),(0,j.Z)(G,L.CameraUniform.ViewProjectionMatrix,s.cameraService.getViewProjectionMatrix()),(0,j.Z)(G,L.CameraUniform.Zoom,s.cameraService.getZoom()),(0,j.Z)(G,L.CameraUniform.ZoomScale,s.cameraService.getZoomScale()),(0,j.Z)(G,L.CameraUniform.FocalDistance,s.cameraService.getFocalDistance()),(0,j.Z)(G,L.CameraUniform.CameraPosition,s.cameraService.getCameraPosition()),(0,j.Z)(G,L.CoordinateUniform.CoordinateSystem,s.coordinateSystemService.getCoordinateSystem()),(0,j.Z)(G,L.CoordinateUniform.ViewportCenter,s.coordinateSystemService.getViewportCenter()),(0,j.Z)(G,L.CoordinateUniform.ViewportCenterProjection,s.coordinateSystemService.getViewportCenterProjection()),(0,j.Z)(G,L.CoordinateUniform.PixelsPerDegree,s.coordinateSystemService.getPixelsPerDegree()),(0,j.Z)(G,L.CoordinateUniform.PixelsPerDegree2,s.coordinateSystemService.getPixelsPerDegree2()),(0,j.Z)(G,L.CoordinateUniform.PixelsPerMeter,s.coordinateSystemService.getPixelsPerMeter()),(0,j.Z)(G,L.CoordinateUniform.Mvp,p),(0,j.Z)(G,"u_SceneCenterMKT",_),(0,j.Z)(G,"u_ViewportSize",[M,R]),(0,j.Z)(G,"u_DevicePixelRatio",window.devicePixelRatio),(0,j.Z)(G,"u_ModelMatrix",s.cameraService.getModelMatrix()),(0,j.Z)(G,"u_PickingBuffer",a.getLayerConfig().pickingBuffer||0),G))})})}}]),n}(),Iv=(0,bo.Z)(up.prototype,"cameraService",[wv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ov=(0,bo.Z)(up.prototype,"coordinateSystemService",[Av],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lv=(0,bo.Z)(up.prototype,"rendererService",[Tv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rv=(0,bo.Z)(up.prototype,"mapService",[Pv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),up))||Mv),Dv,kv,_0=(Dv=(0,ln.b2)(),Dv(kv=function(){function n(){(0,cr.Z)(this,n)}return(0,Mr.Z)(n,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("UpdateModelPlugin",function(){a.layerModel&&a.layerModel.needUpdate()})}}]),n}())||kv),Fv,Bv,x0=(Fv=(0,ln.b2)(),Fv(Bv=function(){function n(){(0,cr.Z)(this,n)}return(0,Mr.Z)(n,[{key:"apply",value:function(a,s){var l=this,p=s.styleAttributeService;a.hooks.init.tap("UpdateStyleAttributePlugin",function(){l.initStyleAttribute(a,{styleAttributeService:p})}),a.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){a.layerModelNeedUpdate||l.updateStyleAtrribute(a,{styleAttributeService:p})})}},{key:"updateStyleAtrribute",value:function(a,s){var l=s.styleAttributeService,p=l.getLayerStyleAttributes()||[],_=l.getLayerStyleAttribute("filter"),C=l.getLayerStyleAttribute("shape");if(_&&_.needRegenerateVertices||C&&C.needRegenerateVertices){a.layerModelNeedUpdate=!0,p.forEach(function(M){return M.needRegenerateVertices=!1});return}p.filter(function(M){return M.needRegenerateVertices}).forEach(function(M){l.updateAttributeByFeatureRange(M.name,a.getEncodedData(),M.featureRange.startIndex,M.featureRange.endIndex),M.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(a,s){var l=s.styleAttributeService,p=l.getLayerStyleAttributes()||[];p.filter(function(_){return _.needRegenerateVertices}).forEach(function(_){l.updateAttributeByFeatureRange(_.name,a.getEncodedData(),_.featureRange.startIndex,_.featureRange.endIndex),_.needRegenerateVertices=!1})}}]),n}())||Bv);L.nC.bind(L.vK.ILayerPlugin).to(rn).inRequestScope(),L.nC.bind(L.vK.ILayerPlugin).to(g0).inRequestScope(),L.nC.bind(L.vK.ILayerPlugin).to(o0).inRequestScope(),L.nC.bind(L.vK.ILayerPlugin).to(wr).inRequestScope(),L.nC.bind(L.vK.ILayerPlugin).to(c0).inRequestScope(),L.nC.bind(L.vK.ILayerPlugin).to(x0).inRequestScope(),L.nC.bind(L.vK.ILayerPlugin).to(_0).inRequestScope(),L.nC.bind(L.vK.ILayerPlugin).to(kl).inRequestScope(),L.nC.bind(L.vK.ILayerPlugin).to(y0).inRequestScope(),L.nC.bind(L.vK.ILayerPlugin).to(u0).inRequestScope(),L.nC.bind(L.vK.ILayerPlugin).to(v0).inRequestScope(),L.nC.bind(L.vK.ILayerPlugin).to(m0).inRequestScope(),L.nC.bind(L.vK.ILayerPlugin).to(l0).inRequestScope();var Iy="2.5.41";function Nv(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Oy(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Nv(Object(a),!0).forEach(function(s){b0(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Nv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function b0(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function Ly(n,c){return w0(n)||C0(n,c)||E0(n,c)||S0()}function S0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function E0(n,c){if(!!n){if(typeof n=="string")return zv(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return zv(n,c)}}function zv(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function C0(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,p=!1,_,C;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(M){p=!0,C=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(p)throw C}}return s}}function w0(n){if(Array.isArray(n))return n}var Ry=null,Dy=null,Uv,Nd,Zv;function jv(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Vv(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?jv(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):jv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var A0=(Uv=(0,L.yT)(L.vK.IGlobalConfigService),Nd=function(){function n(c){(0,cr.Z)(this,n),(0,io.Z)(this,"configService",Zv,this),(0,j.Z)(this,"config",void 0),this.config=c}return(0,Mr.Z)(n,[{key:"setContainer",value:function(a,s){a.bind(L.vK.MapConfig).toConstantValue(Vv(Vv({},this.config),{},{id:s})),a.bind(L.vK.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),n}(),Zv=(0,bo.Z)(Nd.prototype,"configService",[Uv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nd),T0=S(6158),P0=S.n(T0),zd;(function(n){n["GAODE1.x"]="GAODE1.x",n["GAODE2.x"]="GAODE2.x",n.MAPBOX="MAPBOX",n.L7MAP="L7MAP",n.GLOBEL="GLOBEL"})(zd||(zd={}));function Xp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function yd(n,c){var a=mu.fF([],c,n);return mu.bA(a,a,1/a[3]),a}function ky(n,c){var a=n%c;return a<0?c+a:a}function Fy(n,c,a){return a*c+(1-a)*n}function Ih(n,c){if(!n)throw new Error(c||"viewport-mercator-project: assertion failed.")}var Yc=Math.PI,Gv=Yc/4,Nf=Yc/180,Hv=180/Yc,Ud=512,Zd=4003e4,M0=1.5;function Wv(n){return Math.pow(2,n)}function I0(n){return Math.log2(n)}function _d(n,c){var a=(0,Yi.Z)(n,2),s=a[0],l=a[1];Ih(Number.isFinite(s)&&Number.isFinite(c)),Ih(Number.isFinite(l)&&l>=-90&&l<=90,"invalid latitude"),c*=Ud;var p=s*Nf,_=l*Nf,C=c*(p+Yc)/(2*Yc),M=c*(Yc-Math.log(Math.tan(Gv+_*.5)))/(2*Yc);return[C,M]}function jd(n,c){var a=(0,Yi.Z)(n,2),s=a[0],l=a[1];c*=Ud;var p=s/c*(2*Yc)-Yc,_=2*(Math.atan(Math.exp(Yc-l/c*(2*Yc)))-Gv);return[p*Hv,_*Hv]}function By(n){var c=n.latitude;assert(Number.isFinite(c));var a=Math.cos(c*Nf);return I0(Zd*a)-9}function Xv(n){var c=n.latitude,a=n.longitude,s=n.zoom,l=n.scale,p=n.highPrecision,_=p===void 0?!1:p;l=l!==void 0?l:Wv(s),Ih(Number.isFinite(c)&&Number.isFinite(a)&&Number.isFinite(l));var C={},M=Ud*l,R=Math.cos(c*Nf),W=M/360,G=W/R,pe=M/Zd/R;if(C.pixelsPerMeter=[pe,-pe,pe],C.metersPerPixel=[1/pe,-1/pe,1/pe],C.pixelsPerDegree=[W,-G,pe],C.degreesPerPixel=[1/W,-1/G,1/pe],_){var De=Nf*Math.tan(c*Nf)/R,rt=W*De/2,Tt=M/Zd*De,qt=Tt/G*pe;C.pixelsPerDegree2=[0,-rt,Tt],C.pixelsPerMeter2=[qt,0,qt]}return C}function Ny(n,c){var a=_slicedToArray(n,3),s=a[0],l=a[1],p=a[2],_=_slicedToArray(c,3),C=_[0],M=_[1],R=_[2],W=1,G=Xv({longitude:s,latitude:l,scale:W,highPrecision:!0}),pe=G.pixelsPerMeter,De=G.pixelsPerMeter2,rt=_d(n,W);rt[0]+=C*(pe[0]+De[0]*M),rt[1]+=M*(pe[1]+De[1]*M);var Tt=jd(rt,W),qt=(p||0)+(R||0);return Number.isFinite(p)||Number.isFinite(R)?[Tt[0],Tt[1],qt]:Tt}function O0(n){var c=n.height,a=n.pitch,s=n.bearing,l=n.altitude,p=n.center,_=p===void 0?null:p,C=n.flipY,M=C===void 0?!1:C,R=Xp();return dn.translate(R,R,[0,0,-l]),dn.scale(R,R,[1,1,1/c]),dn.rotateX(R,R,-a*Nf),dn.rotateZ(R,R,s*Nf),M&&dn.scale(R,R,[1,-1,1]),_&&dn.translate(R,R,Ui.negate([],_)),R}function L0(n){var c=n.width,a=n.height,s=n.altitude,l=s===void 0?M0:s,p=n.pitch,_=p===void 0?0:p,C=n.nearZMultiplier,M=C===void 0?1:C,R=n.farZMultiplier,W=R===void 0?1:R,G=_*Nf,pe=Math.atan(.5/l),De=Math.sin(pe)*l/Math.sin(Math.PI/2-G-pe),rt=Math.cos(Math.PI/2-G)*De+l;return{fov:2*Math.atan(a/2/l),aspect:c/a,focalDistance:l,near:M,far:rt*W}}function R0(n){var c=n.width,a=n.height,s=n.pitch,l=n.altitude,p=n.nearZMultiplier,_=n.farZMultiplier,C=L0({width:c,height:a,altitude:l,pitch:s,nearZMultiplier:p,farZMultiplier:_}),M=C.fov,R=C.aspect,W=C.near,G=C.far,pe=dn.perspective([],M,R,W,G);return pe}function D0(n,c){var a=(0,Yi.Z)(n,3),s=a[0],l=a[1],p=a[2],_=p===void 0?0:p;return Ih(Number.isFinite(s)&&Number.isFinite(l)&&Number.isFinite(_)),yd(c,[s,l,_,1])}function Yv(n,c){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=(0,Yi.Z)(n,3),l=s[0],p=s[1],_=s[2];if(Ih(Number.isFinite(l)&&Number.isFinite(p),"invalid pixel coordinate"),Number.isFinite(_)){var C=yd(c,[l,p,_,1]);return C}var M=yd(c,[l,p,0,1]),R=yd(c,[l,p,1,1]),W=M[2],G=R[2],pe=W===G?0:((a||0)-W)/(G-W);return bi.lerp([],M,R,pe)}var Kv=Xp(),k0=function(){function n(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=c.width,s=c.height,l=c.viewMatrix,p=l===void 0?Kv:l,_=c.projectionMatrix,C=_===void 0?Kv:_;(0,cr.Z)(this,n),this.width=a||1,this.height=s||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=p,this.projectionMatrix=C;var M=Xp();dn.multiply(M,M,this.projectionMatrix),dn.multiply(M,M,this.viewMatrix),this.viewProjectionMatrix=M;var R=Xp();dn.scale(R,R,[this.width/2,-this.height/2,1]),dn.translate(R,R,[1,-1,0]),dn.multiply(R,R,this.viewProjectionMatrix);var W=dn.invert(Xp(),R);if(!W)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=R,this.pixelUnprojectionMatrix=W,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Mr.Z)(n,[{key:"equals",value:function(a){return a instanceof n?a.width===this.width&&a.height===this.height&&dn.equals(a.projectionMatrix,this.projectionMatrix)&&dn.equals(a.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,p=l===void 0?!0:l,_=this.projectPosition(a),C=D0(_,this.pixelProjectionMatrix),M=(0,Yi.Z)(C,2),R=M[0],W=M[1],G=p?W:this.height-W;return a.length===2?[R,G]:[R,G,C[2]]}},{key:"unproject",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,p=l===void 0?!0:l,_=s.targetZ,C=(0,Yi.Z)(a,3),M=C[0],R=C[1],W=C[2],G=p?R:this.height-R,pe=_&&_*this.pixelsPerMeter,De=Yv([M,G,W],this.pixelUnprojectionMatrix,pe),rt=this.unprojectPosition(De),Tt=(0,Yi.Z)(rt,3),qt=Tt[0],_r=Tt[1],Hr=Tt[2];return Number.isFinite(W)?[qt,_r,Hr]:Number.isFinite(_)?[qt,_r,_]:[qt,_r]}},{key:"projectPosition",value:function(a){var s=this.projectFlat(a),l=(0,Yi.Z)(s,2),p=l[0],_=l[1],C=(a[2]||0)*this.pixelsPerMeter;return[p,_,C]}},{key:"unprojectPosition",value:function(a){var s=this.unprojectFlat(a),l=(0,Yi.Z)(s,2),p=l[0],_=l[1],C=(a[2]||0)/this.pixelsPerMeter;return[p,_,C]}},{key:"projectFlat",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return a}},{key:"unprojectFlat",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return a}}]),n}();function F0(n){var c=n.width,a=n.height,s=n.bounds,l=n.minExtent,p=l===void 0?0:l,_=n.maxZoom,C=_===void 0?24:_,M=n.padding,R=M===void 0?0:M,W=n.offset,G=W===void 0?[0,0]:W,pe=(0,Yi.Z)(s,2),De=(0,Yi.Z)(pe[0],2),rt=De[0],Tt=De[1],qt=(0,Yi.Z)(pe[1],2),_r=qt[0],Hr=qt[1];if(Number.isFinite(R)){var cn=R;R={top:cn,bottom:cn,left:cn,right:cn}}else Ih(Number.isFinite(R.top)&&Number.isFinite(R.bottom)&&Number.isFinite(R.left)&&Number.isFinite(R.right));var _n=new $v({width:c,height:a,longitude:0,latitude:0,zoom:0}),Un=_n.project([rt,Hr]),ti=_n.project([_r,Tt]),ni=[Math.max(Math.abs(ti[0]-Un[0]),p),Math.max(Math.abs(ti[1]-Un[1]),p)],Si=[c-R.left-R.right-Math.abs(G[0])*2,a-R.top-R.bottom-Math.abs(G[1])*2];Ih(Si[0]>0&&Si[1]>0);var qi=Si[0]/ni[0],_a=Si[1]/ni[1],yi=(R.right-R.left)/2/qi,Ta=(R.bottom-R.top)/2/_a,Ua=[(ti[0]+Un[0])/2+yi,(ti[1]+Un[1])/2+Ta],lu=_n.unproject(Ua),zf=_n.zoom+Math.log2(Math.abs(Math.min(qi,_a)));return{longitude:lu[0],latitude:lu[1],zoom:Math.min(zf,C)}}var $v=function(n){(0,Gn.Z)(c,n);function c(){var a,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=s.width,p=s.height,_=s.latitude,C=_===void 0?0:_,M=s.longitude,R=M===void 0?0:M,W=s.zoom,G=W===void 0?0:W,pe=s.pitch,De=pe===void 0?0:pe,rt=s.bearing,Tt=rt===void 0?0:rt,qt=s.altitude,_r=qt===void 0?1.5:qt,Hr=s.nearZMultiplier,cn=s.farZMultiplier;(0,cr.Z)(this,c),l=l||1,p=p||1;var _n=Wv(G);_r=Math.max(.75,_r);var Un=_d([R,C],_n);Un[2]=0;var ti=R0({width:l,height:p,pitch:De,bearing:Tt,altitude:_r,nearZMultiplier:Hr||1/p,farZMultiplier:cn||1.01}),ni=O0({height:p,center:Un,pitch:De,bearing:Tt,altitude:_r,flipY:!0});return a=(0,Mn.Z)(this,(0,kr.Z)(c).call(this,{width:l,height:p,viewMatrix:ni,projectionMatrix:ti})),a.latitude=C,a.longitude=R,a.zoom=G,a.pitch=De,a.bearing=Tt,a.altitude=_r,a.scale=_n,a.center=Un,a.pixelsPerMeter=Xv((0,gt.Z)((0,gt.Z)(a))).pixelsPerMeter[2],Object.freeze((0,gt.Z)((0,gt.Z)(a))),a}return(0,Mr.Z)(c,[{key:"projectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return _d(s,l)}},{key:"unprojectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return jd(s,l)}},{key:"getMapCenterByLngLatPosition",value:function(s){var l=s.lngLat,p=s.pos,_=Yv(p,this.pixelUnprojectionMatrix),C=_d(l,this.scale),M=bi.add([],C,bi.negate([],_)),R=bi.add([],this.center,M);return jd(R,this.scale)}},{key:"getLocationAtPoint",value:function(s){var l=s.lngLat,p=s.pos;return this.getMapCenterByLngLatPosition({lngLat:l,pos:p})}},{key:"fitBounds",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=this.width,_=this.height,C=F0(Object.assign({width:p,height:_,bounds:s},l)),M=C.longitude,R=C.latitude,W=C.zoom;return new c({width:p,height:_,longitude:M,latitude:R,zoom:W})}}]),c}(k0),B0=function(){function n(){(0,cr.Z)(this,n),(0,j.Z)(this,"viewport",void 0)}return(0,Mr.Z)(n,[{key:"syncWithMapCamera",value:function(a){var s=a.center,l=a.zoom,p=a.pitch,_=a.bearing,C=a.viewportHeight,M=a.viewportWidth;this.viewport=new $v({width:M,height:C,longitude:s&&s[0],latitude:s&&s[1],zoom:l,pitch:p,bearing:_})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(a,s){return this.viewport.projectFlat(a,s)}}]),n}(),Jv={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},Qv,qv,em,tm,rm,nm,lp,im,am,om,sm;function um(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function N0(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?um(Object(a),!0).forEach(function(s){(0,j.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):um(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function z0(n,c){var a=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",s=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(a||s)&&(c||(c=document),!!c)){var l=c.head||c.getElementsByTagName("head")[0];if(!l){l=c.createElement("head");var p=c.body||c.getElementsByTagName("body")[0];p?p.parentNode.insertBefore(l,p):c.documentElement.appendChild(l)}var _=c.createElement("style");return _.type="text/css",_.styleSheet?_.styleSheet.cssText=n:_.appendChild(c.createTextNode(n)),l.appendChild(_),_}}z0(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=P0();var lm={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},U0=0,Z0=12,cm="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",j0=(Qv=(0,ln.b2)(),qv=(0,ln.f3)(L.vK.MapConfig),em=(0,ln.f3)(L.vK.IGlobalConfigService),tm=(0,ln.f3)(L.vK.ICoordinateSystemService),rm=(0,ln.f3)(L.vK.IEventEmitter),Qv(nm=(lp=function(){function n(){var c=this;(0,cr.Z)(this,n),(0,j.Z)(this,"version",zd.MAPBOX),(0,j.Z)(this,"map",void 0),(0,j.Z)(this,"dragging",!1),(0,j.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),(0,io.Z)(this,"config",im,this),(0,io.Z)(this,"configService",am,this),(0,io.Z)(this,"coordinateSystemService",om,this),(0,io.Z)(this,"eventEmitter",sm,this),(0,j.Z)(this,"viewport",void 0),(0,j.Z)(this,"markerContainer",void 0),(0,j.Z)(this,"cameraChangedCallback",void 0),(0,j.Z)(this,"$mapContainer",void 0),(0,j.Z)(this,"handleCameraChanged",function(){var a=c.map.getCenter().wrap(),s=a.lat,l=a.lng;c.emit("mapchange"),c.viewport.syncWithMapCamera({bearing:c.map.getBearing(),center:[l,s],viewportHeight:c.map.transform.height,pitch:c.map.getPitch(),viewportWidth:c.map.transform.width,zoom:c.map.getZoom(),cameraHeight:0});var p=c.config.offsetZoom,_=p===void 0?Z0:p;c.viewport.getZoom()>_?c.coordinateSystemService.setCoordinateSystem(L.CoordinateSystem.LNGLAT_OFFSET):c.coordinateSystemService.setCoordinateSystem(L.CoordinateSystem.LNGLAT),c.cameraChangedCallback(c.viewport)})}return(0,Mr.Z)(n,[{key:"setBgColor",value:function(a){this.bgColor=a}},{key:"addMarkerContainer",value:function(){var a=this.map.getCanvasContainer();this.markerContainer=Ke.SO.create("div","l7-marker-container",a),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(a,s){L.MapServiceEvent.indexOf(a)!==-1?this.eventEmitter.on(a,s):this.map.on(lm[a]||a,s)}},{key:"off",value:function(a,s){this.map.off(lm[a]||a,s)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var a=this.map.transform;return[a.width,a.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(a){return this.map.setZoom(a)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(a){this.map.setCenter(a)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(a){this.map.setBearing(a)}},{key:"zoomIn",value:function(a,s){this.map.zoomIn(a,s)}},{key:"zoomOut",value:function(a,s){this.map.zoomOut(a,s)}},{key:"setPitch",value:function(a){return this.map.setPitch(a)}},{key:"panTo",value:function(a){this.map.panTo(a)}},{key:"panBy",value:function(a,s){this.panTo([a,s])}},{key:"fitBounds",value:function(a,s){this.map.fitBounds(a,s)}},{key:"setMaxZoom",value:function(a){this.map.setMaxZoom(a)}},{key:"setMinZoom",value:function(a){this.map.setMinZoom(a)}},{key:"setMapStatus",value:function(a){a.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),a.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),a.dragEnable===!1&&this.map.dragPan.disable(),a.dragEnable===!0&&this.map.dragPan.enable(),a.rotateEnable===!1&&this.map.dragRotate.disable(),a.rotateEnable===!0&&this.map.dragRotate.enable(),a.keyboardEnable===!1&&this.map.keyboard.disable(),a.keyboardEnable===!0&&this.map.keyboard.enable(),a.zoomEnable===!1&&this.map.scrollZoom.disable(),a.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(a,s){this.map.flyTo({zoom:a,center:s})}},{key:"setMapStyle",value:function(a){this.map.setStyle(this.getMapStyle(a))}},{key:"pixelToLngLat",value:function(a){return this.map.unproject(a)}},{key:"lngLatToPixel",value:function(a){return this.map.project(a)}},{key:"containerToLngLat",value:function(a){return this.map.unproject(a)}},{key:"lngLatToContainer",value:function(a){return this.map.project(a)}},{key:"lngLatToCoord",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},l=this.lngLatToMercator(a,0),p=l.x,_=l.y;return[p-s.x,_-s.y]}},{key:"lngLatToMercator",value:function(a,s){var l=window.mapboxgl.MercatorCoordinate.fromLngLat(a,s),p=l.x,_=p===void 0?0:p,C=l.y,M=C===void 0?0:C,R=l.z,W=R===void 0?0:R;return{x:_,y:M,z:W}}},{key:"getModelMatrix",value:function(a,s,l){var p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],_=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},C=window.mapboxgl.MercatorCoordinate.fromLngLat(a,s),M=C.meterInMercatorCoordinateUnits(),R=dn.create();return dn.translate(R,R,Ui.fromValues(C.x-_.x,C.y-_.y,C.z||0-_.z)),dn.scale(R,R,Ui.fromValues(M*p[0],-M*p[1],M*p[2])),dn.rotateX(R,R,l[0]),dn.rotateY(R,R,l[1]),dn.rotateZ(R,R,l[2]),R}},{key:"init",value:function(){var c=(0,Nt.Z)(Wr().mark(function s(){var l=this,p,_,C,M,R,W,G,pe,De,rt,Tt,qt,_r;return Wr().wrap(function(cn){for(;;)switch(cn.prev=cn.next){case 0:p=this.config,_=p.id,C=_===void 0?"map":_,M=p.attributionControl,R=M===void 0?!1:M,W=p.style,G=W===void 0?"light":W,pe=p.token,De=pe===void 0?cm:pe,rt=p.rotation,Tt=rt===void 0?0:rt,qt=p.mapInstance,_r=(0,js.Z)(p,["id","attributionControl","style","token","rotation","mapInstance"]),this.viewport=new B0,!qt&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),De===cm&&G!=="blank"&&!window.mapboxgl.accessToken&&!qt&&console.warn(this.configService.getSceneWarninfo("MapToken")),!qt&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=De),qt?(this.map=qt,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(C),this.map=new window.mapboxgl.Map(N0({container:this.$mapContainer,style:this.getMapStyle(G),attributionControl:R,bearing:Tt},_r))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.map.on("dragstart",function(){return l.dragging=!0,""}),this.map.on("dragend",function(){return l.dragging=!1,""}),this.handleCameraChanged();case 11:case"end":return cn.stop()}},s,this)}));function a(){return c.apply(this,arguments)}return a}()},{key:"destroy",value:function(){var a,s;(a=this.$mapContainer)===null||a===void 0||(s=a.parentNode)===null||s===void 0||s.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(a){for(var s,l=arguments.length,p=new Array(l>1?l-1:0),_=1;_<l;_++)p[_-1]=arguments[_];(s=this.eventEmitter).emit.apply(s,[a].concat(p))}},{key:"once",value:function(a){for(var s,l=arguments.length,p=new Array(l>1?l-1:0),_=1;_<l;_++)p[_-1]=arguments[_];(s=this.eventEmitter).once.apply(s,[a].concat(p))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(a){var s=this.map.getCanvas(),l=a==="jpg"?s==null?void 0:s.toDataURL("image/jpeg"):s==null?void 0:s.toDataURL("image/png");return l}},{key:"onCameraChanged",value:function(a){this.cameraChangedCallback=a}},{key:"creatAmapContainer",value:function(a){var s=a;typeof a=="string"&&(s=document.getElementById(a));var l=document.createElement("div");return l.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,l.id="l7_mapbox_div"+U0++,s.appendChild(l),l}},{key:"getMapStyle",value:function(a){return typeof a!="string"?a:Jv[a]?Jv[a]:a}}]),n}(),im=(0,bo.Z)(lp.prototype,"config",[qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),am=(0,bo.Z)(lp.prototype,"configService",[em],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),om=(0,bo.Z)(lp.prototype,"coordinateSystemService",[tm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sm=(0,bo.Z)(lp.prototype,"eventEmitter",[rm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lp))||nm);function V0(n){var c=G0();return function(){var s=(0,kr.Z)(n),l;if(c){var p=(0,kr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Mn.Z)(this,l)}}function G0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function H0(n,c){var a=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",s=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(a||s)&&(c||(c=document),!!c)){var l=c.head||c.getElementsByTagName("head")[0];if(!l){l=c.createElement("head");var p=c.body||c.getElementsByTagName("body")[0];p?p.parentNode.insertBefore(l,p):c.documentElement.appendChild(l)}var _=c.createElement("style");return _.type="text/css",_.styleSheet?_.styleSheet.cssText=n:_.appendChild(c.createTextNode(n)),l.appendChild(_),_}}H0(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var W0=function(n){(0,Gn.Z)(a,n);var c=V0(a);function a(){return(0,cr.Z)(this,a),c.apply(this,arguments)}return(0,Mr.Z)(a,[{key:"getServiceConstructor",value:function(){return j0}}]),a}(A0);function fm(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function hm(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?fm(Object(a),!0).forEach(function(s){X0(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):fm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function X0(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function Y0(n,c){return Q0(n)||J0(n,c)||$0(n,c)||K0()}function K0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $0(n,c){if(!!n){if(typeof n=="string")return pm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return pm(n,c)}}function pm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function J0(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,p=!1,_,C;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(M){p=!0,C=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(p)throw C}}return s}}function Q0(n){if(Array.isArray(n))return n}var q0=ce.memo(function(n){var c=n.style,a=n.className,s=n.map,l=n.option,p=n.onSceneLoaded,_=(0,ce.createRef)(),C=(0,ce.useState)(),M=Y0(C,2),R=M[0],W=M[1];return(0,ce.useEffect)(function(){var G=new $l(hm(hm({id:_.current},l),{},{map:new W0(s)}));return G.on("loaded",function(){W(G),p&&p(G)}),function(){G.destroy()}},[]),(0,ce.useEffect)(function(){R&&s.style&&R.setMapStyle(s.style)},[JSON.stringify(s.style)]),(0,ce.useEffect)(function(){R&&s.zoom&&R.setZoom(s.zoom)},[s.zoom]),(0,ce.useEffect)(function(){R&&s.center&&R.setCenter(s.center)},[JSON.stringify(s.center)]),(0,ce.useEffect)(function(){R&&s.pitch!==void 0&&R.setPitch(s.pitch||0)},[s.pitch]),(0,ce.useEffect)(function(){R&&s.rotation&&R.setRotation(s.rotation)},[s.rotation]),ce.createElement(E.Provider,{value:R},(0,ce.createElement)("div",{ref:_,style:c,className:a},R&&n.children))}),eg=q0;function dm(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function zy(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?dm(Object(a),!0).forEach(function(s){tg(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):dm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function tg(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function Uy(n,c){return ag(n)||ig(n,c)||ng(n,c)||rg()}function rg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ng(n,c){if(!!n){if(typeof n=="string")return vm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return vm(n,c)}}function vm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function ig(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,p=!1,_,C;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(M){p=!0,C=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(p)throw C}}return s}}function ag(n){if(Array.isArray(n))return n}var Zy=null,jy=null;function mm(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Vy(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?mm(Object(a),!0).forEach(function(s){og(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):mm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function og(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function Gy(n,c){return cg(n)||lg(n,c)||ug(n,c)||sg()}function sg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ug(n,c){if(!!n){if(typeof n=="string")return gm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return gm(n,c)}}function gm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function lg(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,p=!1,_,C;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(M){p=!0,C=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(p)throw C}}return s}}function cg(n){if(Array.isArray(n))return n}var Hy=null,Wy=null;function Xy(n,c){return dg(n)||pg(n,c)||hg(n,c)||fg()}function fg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hg(n,c){if(!!n){if(typeof n=="string")return ym(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ym(n,c)}}function ym(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function pg(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,p=!1,_,C;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(M){p=!0,C=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(p)throw C}}return s}}function dg(n){if(Array.isArray(n))return n}var Yy=null,Ky=null;function _m(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function $y(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?_m(Object(a),!0).forEach(function(s){vg(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):_m(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function vg(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function Jy(n,c){if(n==null)return{};var a=mg(n,c),s,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(l=0;l<p.length;l++)s=p[l],!(c.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,s)||(a[s]=n[s]))}return a}function mg(n,c){if(n==null)return{};var a={},s=Object.keys(n),l,p;for(p=0;p<s.length;p++)l=s[p],!(c.indexOf(l)>=0)&&(a[l]=n[l]);return a}var Qy=null,xm=S(73935);function gg(n,c){return bg(n)||xg(n,c)||_g(n,c)||yg()}function yg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _g(n,c){if(!!n){if(typeof n=="string")return bm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return bm(n,c)}}function bm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function xg(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,p=!1,_,C;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(M){p=!0,C=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(p)throw C}}return s}}function bg(n){if(Array.isArray(n))return n}var Sg=ce.useEffect,Eg=ce.useState;function qy(n){var c=n.className,a=n.style,s=n.children,l=n.position,p=useSceneValue(),_=Eg(function(){return document.createElement("div")}),C=gg(_,1),M=C[0];return Sg(function(){var R=new Control({position:l});return R.onAdd=function(){if(c&&(M.className=c),a){var W=Object.keys(a).map(function(G){return"".concat(G,":").concat(a[G])}).join(";");M.style.cssText=W}return M},p.addControl(R),function(){p.removeControl(R)}},[]),createPortal(s,M)}var Sm=(0,ce.createContext)({});function e1(){return useContext(Sm)}var Cg=ce.useEffect,wg=ce.memo(function(c){var a=c.layer,s=c.active;return Cg(function(){a.active(s.option)},[JSON.stringify(s)]),null}),Ag=ce.useEffect,Tg=ce.memo(function(c){var a=c.layer,s=c.animate;return Ag(function(){a.animate(s)},[JSON.stringify(s)]),null}),Pg=ce.useEffect,Mg=ce.memo(function(c){var a=c.layer,s=c.color;return Pg(function(){s.field?a.color(s.field,s.values):a.color(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),Ig=ce.useEffect,Og=ce.memo(function(c){var a=c.layer,s=c.filter;return Ig(function(){s.field&&a.filter(s.field,s.values)},[s.field,s.values,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),Lg=ce.useEffect,Rg=ce.memo(function(c){var a=c.layer,s=c.scale;return Lg(function(){a.scale(s.values)},[s.values]),null}),Dg=ce.useEffect,kg=ce.memo(function(c){var a=c.layer,s=c.select;return Dg(function(){a.select(s.option)},[JSON.stringify(s)]),null}),Fg=ce.useEffect,Bg=ce.memo(function(c){var a=c.layer,s=c.shape;return Fg(function(){s.field?a.shape(s.field,s.values):a.shape(s.values)},[s.field,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),Ng=ce.useEffect,zg=ce.memo(function(c){var a=c.layer,s=c.size;return Ng(function(){s.field?a.size(s.field,s.values):a.size(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),Ug=["data"];function Zg(n,c){if(n==null)return{};var a=jg(n,c),s,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(l=0;l<p.length;l++)s=p[l],!(c.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,s)||(a[s]=n[s]))}return a}function jg(n,c){if(n==null)return{};var a={},s=Object.keys(n),l,p;for(p=0;p<s.length;p++)l=s[p],!(c.indexOf(l)>=0)&&(a[l]=n[l]);return a}var Vg=ce.useEffect,Gg=ce.memo(function(c){var a=c.layer,s=c.source,l=s.data,p=Zg(s,Ug);return Vg(function(){a.inited?a.setData(l,p):a.source(l,p),p.autoFit&&a.fitBounds(p&&p.fitBoundsOptions)},[l,JSON.stringify(p)]),null}),Hg=ce.useEffect,Wg=ce.memo(function(c){var a=c.layer,s=c.style;return Hg(function(){a.style(s)},Object.keys(s).map(function(l){return s[l]})),null});function Xg(n,c){return Jg(n)||$g(n,c)||Kg(n,c)||Yg()}function Yg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Kg(n,c){if(!!n){if(typeof n=="string")return Em(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Em(n,c)}}function Em(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function $g(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,p=!1,_,C;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(M){p=!0,C=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(p)throw C}}return s}}function Jg(n){if(Array.isArray(n))return n}var Yp=ce.useEffect,Qg=ce.useState;function Cm(n,c){var a=c.source,s=c.color,l=c.shape,p=c.style,_=c.size,C=c.scale,M=c.active,R=c.select,W=c.filter,G=c.animate,pe=c.options,De=c.onLayerLoaded,rt=d(),Tt=Qg(function(){var Hr;switch(n){case"polygonLayer":Hr=new Je(pe);break;case"lineLayer":Hr=new gp(pe);break;case"pointLayer":Hr=new jh(pe);break;case"heatmapLayer":Hr=new pa(pe);break;case"rasterLayer":Hr=new bn(pe);break;case"imageLayer":Hr=new Pi(pe);break;case"citybuildingLayer":Hr=new bt(pe);break;default:Hr=new Je(pe)}return Hr.on("inited",function(){De&&De(Hr,rt)}),Hr}),qt=Xg(Tt,1),_r=qt[0];return Yp(function(){return rt.addLayer(_r),function(){rt.removeLayer(_r)}},[]),Yp(function(){_r.inited&&pe&&_r.updateLayerConfig(pe)},[pe==null?void 0:pe.minZoom,pe==null?void 0:pe.maxZoom,pe==null?void 0:pe.visible]),Yp(function(){_r.inited&&(pe==null?void 0:pe.zIndex)&&_r.setIndex(pe.zIndex)},[pe==null?void 0:pe.zIndex]),Yp(function(){_r.inited&&(pe==null?void 0:pe.blend)&&_r.setBlend(pe.blend)},[pe==null?void 0:pe.blend]),Yp(function(){rt.render()}),ce.createElement(Sm.Provider,{value:_r},ce.createElement(Gg,{layer:_r,source:a}),C&&ce.createElement(Rg,{layer:_r,scale:C}),s&&ce.createElement(Mg,{layer:_r,color:s}),_&&ce.createElement(zg,{layer:_r,size:_}),l&&ce.createElement(Bg,{layer:_r,shape:l}),p&&ce.createElement(Wg,{layer:_r,style:p}),M&&ce.createElement(wg,{layer:_r,active:M}),R&&ce.createElement(kg,{layer:_r,select:R}),W&&ce.createElement(Og,{layer:_r,filter:W}),G&&ce.createElement(Tg,{layer:_r,animate:G}),c.children)}var t1=null,r1=null,qg=ce.memo(function(c){return Cm("pointLayer",c)}),ey=ce.memo(function(c){return Cm("heatmapLayer",c)}),n1=null,i1=null,a1=null,o1=ce.useEffect,s1=null,u1=null;function xd(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?xd=function(a){return typeof a}:xd=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},xd(n)}function wm(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function bd(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?wm(Object(a),!0).forEach(function(s){ty(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):wm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function ty(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function ry(n,c){if(!(n instanceof c))throw new TypeError("Cannot call a class as a function")}function Am(n,c){for(var a=0;a<c.length;a++){var s=c[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function ny(n,c,a){return c&&Am(n.prototype,c),a&&Am(n,a),n}function iy(n,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(c&&c.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),c&&Vd(n,c)}function Vd(n,c){return Vd=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},Vd(n,c)}function ay(n){var c=uy();return function(){var s=Sd(n),l;if(c){var p=Sd(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return oy(this,l)}}function oy(n,c){if(c&&(xd(c)==="object"||typeof c=="function"))return c;if(c!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return sy(n)}function sy(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function uy(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function Sd(n){return Sd=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},Sd(n)}var l1=function(n){iy(a,n);var c=ay(a);function a(s){var l;return ry(this,a),l=c.call(this,s),l.el=void 0,l.scene=void 0,l.popup=void 0,l.el=document.createElement("div"),l}return ny(a,[{key:"componentDidMount",value:function(){var l,p=this.props,_=p.lnglat,C=p.children,M=p.option,R=p.lngLat,W=new lt(bd(bd({},M),{},{stopPropagation:(l=this.props.option)===null||l===void 0?void 0:l.stopPropagation}));_&&W.setLnglat(_),R&&W.setLnglat(R),C&&W.setDOMContent(this.el),this.popup=W,this.scene.addPopup(W)}},{key:"componentDidUpdate",value:function(l){var p,_,C,M,R,W,G=Array.isArray(l.lnglat)?l.lnglat:[l==null||(p=l.lnglat)===null||p===void 0?void 0:p.lng,l==null||(_=l.lnglat)===null||_===void 0?void 0:_.lat],pe=Array.isArray(this.props.lnglat)?this.props.lnglat:[(C=this.props)===null||C===void 0||(M=C.lnglat)===null||M===void 0?void 0:M.lng,(R=this.props)===null||R===void 0||(W=R.lnglat)===null||W===void 0?void 0:W.lat],De=G.toString()!==pe.toString();if(De){var rt;this.popup.remove(),this.popup=new lt(bd(bd({},this.props.option),{},{stopPropagation:(rt=this.props.option)===null||rt===void 0?void 0:rt.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var l=this;return ce.createElement(E.Consumer,{},function(p){return p&&(l.scene=p),(0,xm.createPortal)(l.props.children,l.el)})}}]),a}(ce.PureComponent);function Ed(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ed=function(a){return typeof a}:Ed=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Ed(n)}function ly(n,c){if(!(n instanceof c))throw new TypeError("Cannot call a class as a function")}function Tm(n,c){for(var a=0;a<c.length;a++){var s=c[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function cy(n,c,a){return c&&Tm(n.prototype,c),a&&Tm(n,a),n}function fy(n,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(c&&c.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),c&&Gd(n,c)}function Gd(n,c){return Gd=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},Gd(n,c)}function hy(n){var c=vy();return function(){var s=Cd(n),l;if(c){var p=Cd(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return py(this,l)}}function py(n,c){if(c&&(Ed(c)==="object"||typeof c=="function"))return c;if(c!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return dy(n)}function dy(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function vy(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function Cd(n){return Cd=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},Cd(n)}var c1=function(n){fy(a,n);var c=hy(a);function a(s){var l;return ly(this,a),l=c.call(this,s),l.el=void 0,l.scene=void 0,l.marker=void 0,l.el=document.createElement("div"),l}return cy(a,[{key:"componentDidMount",value:function(){var l=this.props,p=l.lnglat,_=l.children,C=l.option,M=l.onMarkerLoaded,R=new Ku(C);p&&R.setLnglat(p),_&&R.setElement(this.el),this.marker=R,M&&M(R),this.scene.addMarker(R)}},{key:"componentDidUpdate",value:function(l){var p,_=(l==null?void 0:l.lnglat.toString())!==((p=this.props)===null||p===void 0?void 0:p.lnglat.toString());_&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var l=this;return ce.createElement(E.Consumer,{},function(p){return p&&(l.scene=p),(0,xm.createPortal)(l.props.children,l.el)})}}]),a}(ce.PureComponent),f1=ce.useEffect,h1=null,p1=null,d1=ce.useEffect,v1=null},4771:function(){},6901:function(zr,N,S){"use strict";S.d(N,{SO:function(){return ce},z6:function(){return ut},a5:function(){return E},Z:function(){return st},rQ:function(){return wn},bV:function(){return Yr},zi:function(){return cr},ds:function(){return Ye},Ev:function(){return At},oO:function(){return Ir},W0:function(){return Ar},Z6:function(){return Ke},We:function(){return nr},Cl:function(){return Xr},gJ:function(){return Ze},vP:function(){return un},yM:function(){return $},yA:function(){return Tr},CI:function(){return xr}});var ce={};S.r(ce),S.d(ce,{DPR:function(){return $e},addClass:function(){return Cr},create:function(){return mt},empty:function(){return St},getClass:function(){return Ut},getContainer:function(){return oe},getViewPortScale:function(){return wt},hasClass:function(){return Xt},printCanvas:function(){return hr},remove:function(){return Zt},removeClass:function(){return Qt},setClass:function(){return rr},setTransform:function(){return yr},splitWords:function(){return K},triggerResize:function(){return q},trim:function(){return Ne}});var E={};S.r(E),S.d(E,{getColumn:function(){return le},getSatByColumn:function(){return ve},max:function(){return Mr},mean:function(){return Mn},min:function(){return gt},mode:function(){return kr},statMap:function(){return Y},sum:function(){return Gn}});function d(B){var ee=131,de=137,Ae=0;B+="x";for(var ae=Math.floor(9007199254740991/de),_e=0;_e<B.length;_e++)Ae>ae&&(Ae=Math.floor(Ae/de)),Ae=Ae*ee+B.charCodeAt(_e);return Ae}function me(B){B=B.toString();for(var ee=5381,de=B.length;de;)ee=ee*33^B.charCodeAt(--de);return ee>>>0}var te=S(28481),ue=window.document.documentElement.style;function oe(B){var ee=B;return typeof B=="string"&&(ee=document.getElementById(B)),ee}function Ne(B){return B.trim?B.trim():B.replace(/^\s+|\s+$/g,"")}function K(B){return Ne(B).split(/\s+/)}function Qe(B){if(!ue)return B[0];for(var ee in B)if(B[ee]&&B[ee]in ue)return B[ee];return B[0]}function mt(B,ee,de){var Ae=document.createElement(B);return Ae.className=ee||"",de&&de.appendChild(Ae),Ae}function Zt(B){var ee=B.parentNode;ee&&ee.removeChild(B)}function Cr(B,ee){if(B.classList!==void 0)for(var de=K(ee),Ae=0,ae=de.length;Ae<ae;Ae++)B.classList.add(de[Ae]);else if(!Xt(B,ee)){var _e=Ut(B);rr(B,(_e?_e+" ":"")+ee)}}function Qt(B,ee){B.classList!==void 0?B.classList.remove(ee):rr(B,Ne((" "+Ut(B)+" ").replace(" "+ee+" "," ")))}function Xt(B,ee){if(B.classList!==void 0)return B.classList.contains(ee);var de=Ut(B);return de.length>0&&new RegExp("(^|\\s)"+ee+"(\\s|$)").test(de)}function rr(B,ee){B instanceof HTMLElement?B.className=ee:B.className.baseVal=ee}function Ut(B){return B instanceof SVGElement&&(B=B.correspondingElement),B.className.baseVal===void 0?B.className:B.className.baseVal}function St(B){for(;B&&B.firstChild;)B.removeChild(B.firstChild)}var Et=Qe(["transform","WebkitTransform"]);function yr(B,ee){B.style[Et]=ee}function q(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var B=window.document.createEvent("UIEvents");B.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(B)}}function hr(B){var ee=["padding: "+(B.height/2-8)+"px "+B.width/2+"px;","line-height: "+B.height+"px;","background-image: url("+B.toDataURL()+");"];console.log(`%c
`,ee.join(""))}function wt(){var B,ee=document.querySelector('meta[name="viewport"]');if(!ee)return 1;var de=(B=ee.content)===null||B===void 0?void 0:B.split(","),Ae=de.find(function(ae){var _e=ae.split("="),ct=(0,te.Z)(_e,2),Sr=ct[0],Ht=ct[1];return Sr==="initial-scale"});return Ae?Ae.split("=")[1]*1:1}var $e=wt()<1?1:window.devicePixelRatio,Ft=S(6610),Xe=S(5991),jt=S(63349),br=S(10379),sr=S(46070),j=S(77608),ie=S(14665);function Re(B){return Function.toString.call(B).indexOf("[native code]")!==-1}var ye=S(51814);function _t(B,ee,de){return(0,ye.Z)()?_t=Reflect.construct:_t=function(ae,_e,ct){var Sr=[null];Sr.push.apply(Sr,_e);var Ht=Function.bind.apply(ae,Sr),Jt=new Ht;return ct&&(0,ie.Z)(Jt,ct.prototype),Jt},_t.apply(null,arguments)}function dt(B){var ee=typeof Map=="function"?new Map:void 0;return dt=function(Ae){if(Ae===null||!Re(Ae))return Ae;if(typeof Ae!="function")throw new TypeError("Super expression must either be null or a function");if(typeof ee!="undefined"){if(ee.has(Ae))return ee.get(Ae);ee.set(Ae,ae)}function ae(){return _t(Ae,arguments,(0,j.Z)(this).constructor)}return ae.prototype=Object.create(Ae.prototype,{constructor:{value:ae,enumerable:!1,writable:!0,configurable:!0}}),(0,ie.Z)(ae,Ae)},dt(B)}var zt=S(96156);function Bt(B){var ee=Ur();return function(){var Ae=(0,j.Z)(B),ae;if(ee){var _e=(0,j.Z)(this).constructor;ae=Reflect.construct(Ae,arguments,_e)}else ae=Ae.apply(this,arguments);return(0,sr.Z)(this,ae)}}function Ur(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}var vn=function(B){(0,br.Z)(de,B);var ee=Bt(de);function de(Ae,ae,_e){var ct;return(0,Ft.Z)(this,de),ct=ee.call(this,Ae),(0,zt.Z)((0,jt.Z)(ct),"status",void 0),(0,zt.Z)((0,jt.Z)(ct),"url",void 0),ct.status=ae,ct.url=_e,ct.name=ct.constructor.name,ct.message=Ae,ct}return(0,Xe.Z)(de,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),de}(dt(Error));function En(B){var ee=new XMLHttpRequest;ee.open("GET",B.url,!0);for(var de in B.headers)B.headers.hasOwnProperty(de)&&ee.setRequestHeader(de,B.headers[de]);return ee.withCredentials=B.credentials==="include",ee}var ea=function(ee,de){var Ae=En(ee);return Ae.setRequestHeader("Accept","application/json"),Ae.onerror=function(){de(new Error(Ae.statusText))},Ae.onload=function(){if(Ae.status>=200&&Ae.status<300&&Ae.response){var ae;try{ae=JSON.parse(Ae.response)}catch(_e){return de(_e)}de(null,ae)}else Ae.status===401?de(new vn("".concat(Ae.statusText),Ae.status,ee.url)):de(new vn(Ae.statusText,Ae.status,ee.url))},Ae.send(),Ae},ar=function(ee,de){var Ae=En(ee);return Ae.responseType="arraybuffer",Ae.onerror=function(){de(new Error(Ae.statusText))},Ae.onload=function(){var ae=Ae.response;if(ae.byteLength===0&&Ae.status===200)return de(new Error("http status 200 returned without content."));Ae.status>=200&&Ae.status<300&&Ae.response?de(null,{data:ae,cacheControl:Ae.getResponseHeader("Cache-Control"),expires:Ae.getResponseHeader("Expires")}):de(new vn(Ae.statusText,Ae.status,ee.url))},Ae.send(),Ae};function ge(B){var ee=window.document.createElement("a");return ee.href=B,ee.protocol===window.document.location.protocol&&ee.host===window.document.location.host}var Te="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Ze=function(ee,de){return ar(ee,function(Ae,ae){if(Ae)de(Ae);else if(ae){var _e=new window.Image;_e.crossOrigin="anonymous";var ct=window.URL||window.webkitURL;_e.onload=function(){de(null,_e),ct.revokeObjectURL(_e.src)};var Sr=new window.Blob([new Uint8Array(ae.data)],{type:"image/png"});_e.src=ae.data.byteLength?ct.createObjectURL(Sr):Te}})},Oe=S(40271),Lt=2*Math.PI*6378137/2;function nr(B){var ee=[Infinity,Infinity,-Infinity,-Infinity];return B.forEach(function(de){var Ae=de.coordinates;dr(ee,Ae)}),ee}function dr(B,ee){return Array.isArray(ee[0])?ee.forEach(function(de){dr(B,de)}):(B[0]>ee[0]&&(B[0]=ee[0]),B[1]>ee[1]&&(B[1]=ee[1]),B[2]<ee[0]&&(B[2]=ee[0]),B[3]<ee[1]&&(B[3]=ee[1])),B}function Or(B,ee){return lr(B,ee)}function lr(B,ee){return Array.isArray(B[0])?B.map(function(de){return lr(de,ee)}):ee(B)}function un(B){var ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,de=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};B=et(B,ee);var Ae=B[0],ae=B[1],_e=Ae*Lt/180,ct=Math.log(Math.tan((90+ae)*Math.PI/360))/(Math.PI/180);return ct=ct*Lt/180,de.enable&&(_e=Number(_e.toFixed(de.decimal)),ct=Number(ct.toFixed(de.decimal))),B.length===3?[_e,ct,B[2]]:[_e,ct]}function w(B){var ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,de=B[0],Ae=B[1],ae=de/Lt*180,_e=Ae/Lt*180;return _e=180/Math.PI*(2*Math.atan(Math.exp(_e*Math.PI/180))-Math.PI/2),ee!=null&&(ae=Number(ae.toFixed(ee)),_e=Number(_e.toFixed(ee))),B.length===3?[ae,_e,B[2]]:[ae,_e]}function H(B){if(B==null)throw new Error("lng is required");return(B>180||B<-180)&&(B=B%360,B>180&&(B=-360+B),B<-180&&(B=360+B),B===0&&(B=0)),B}function Ue(B){if(B==null)throw new Error("lat is required");return(B>90||B<-90)&&(B=B%180,B>90&&(B=-180+B),B<-90&&(B=180+B),B===0&&(B=0)),B}function et(B,ee){if(ee===!1)return B;var de=H(B[0]),Ae=Ue(B[1]);return Ae>85&&(Ae=85),Ae<-85&&(Ae=-85),B.length===3?[de,Ae,B[2]]:[de,Ae]}function st(B){var ee=85.0511287798,de=Math.max(Math.min(ee,B[1]),-ee),Ae=256<<20,ae=Math.PI/180,_e=B[0]*ae,ct=de*ae;ct=Math.log(Math.tan(Math.PI/4+ct/2));var Sr=.5/Math.PI,Ht=.5,Jt=-.5/Math.PI;return ae=.5,_e=Ae*(Sr*_e+Ht),ct=Ae*(Jt*ct+ae),[Math.floor(_e),Math.floor(ct)]}function Ct(B){var ee=.5/Math.PI,de=.5,Ae=-.5/Math.PI,ae=.5,_e=256<<20,ct=_slicedToArray(B,2),Sr=ct[0],Ht=ct[1];Sr=(Sr/_e-de)/ee,Ht=(Ht/_e-ae)/Ae,Ht=(Math.atan(Math.pow(Math.E,Ht))-Math.PI/4)*2,ae=Math.PI/180;var Jt=Ht/ae,Nr=Sr/ae;return[Nr,Jt]}function $(B,ee,de){var Ae=(0,Oe.Ht)(ee[1]-B[1]),ae=(0,Oe.Ht)(ee[0]-B[0]),_e=(0,Oe.Ht)(B[1]),ct=(0,Oe.Ht)(ee[1]),Sr=Math.pow(Math.sin(Ae/2),2)+Math.pow(Math.sin(ae/2),2)*Math.cos(_e)*Math.cos(ct);return(0,Oe.DL)(2*Math.atan2(Math.sqrt(Sr),Math.sqrt(1-Sr)),de="meters")}function Gt(B){var ee=Math.PI/180,de=85.0511287798,Ae=6378137,ae=Math.max(Math.min(de,B[1]),-de),_e=Math.sin(ae*ee),ct=Ae*B[0]*ee,Sr=Ae*Math.log((1+_e)/(1-_e))/2;return[ct,Sr]}function Tr(B,ee){var de=Math.abs(B[1][1]-B[0][1])*ee,Ae=Math.abs(B[1][0]-B[0][0])*ee;return[[B[0][0]-Ae,B[0][1]-de],[B[1][0]+Ae,B[1][1]+de]]}function Ir(B,ee){return B[0][0]<=ee[0][0]&&B[0][1]<=ee[0][1]&&B[1][0]>=ee[1][0]&&B[1][1]>=ee[1][1]}function Ye(B){return[[B[0],B[1]],[B[2],B[3]]]}var ut=function(){function B(){var ee=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,de=arguments.length>1?arguments[1]:void 0;(0,Ft.Z)(this,B),(0,zt.Z)(this,"limit",void 0),(0,zt.Z)(this,"cache",void 0),(0,zt.Z)(this,"destroy",void 0),(0,zt.Z)(this,"order",void 0),this.limit=ee,this.destroy=de||this.defaultDestroy,this.order=[],this.clear()}return(0,Xe.Z)(B,[{key:"clear",value:function(){var de=this;this.order.forEach(function(Ae){de.delete(Ae)}),this.cache={},this.order=[]}},{key:"get",value:function(de){var Ae=this.cache[de];return Ae&&(this.deleteOrder(de),this.appendOrder(de)),Ae}},{key:"set",value:function(de,Ae){this.cache[de]?(this.delete(de),this.cache[de]=Ae,this.appendOrder(de)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[de]=Ae,this.appendOrder(de))}},{key:"delete",value:function(de){var Ae=this.cache[de];Ae&&(this.deleteCache(de),this.deleteOrder(de),this.destroy(Ae,de))}},{key:"deleteCache",value:function(de){delete this.cache[de]}},{key:"deleteOrder",value:function(de){var Ae=this.order.findIndex(function(ae){return ae===de});Ae>=0&&this.order.splice(Ae,1)}},{key:"appendOrder",value:function(de){this.order.push(de)}},{key:"defaultDestroy",value:function(de,Ae){return null}}]),B}();function At(B,ee){B.forEach(function(de){!ee[de]||(ee[de]=ee[de].bind(ee))})}var Rt=S(2650);function xr(B){var ee=Rt.ZP(B),de=[0,0,0,0];return ee!=null&&(de[0]=ee.r/255,de[1]=ee.g/255,de[2]=ee.b/255,de[3]=ee.opacity),de}function Ar(B){var ee=B&&B[0],de=B&&B[1],Ae=B&&B[2],ae=ee+de*256+Ae*65536-1;return ae}function Ke(B){return[B+1&255,B+1>>8&255,B+1>>8>>8&255]}function Xr(B){var ee=document.createElement("canvas"),de=ee.getContext("2d");ee.width=256,ee.height=1;for(var Ae=de.createLinearGradient(0,0,256,1),ae=null,_e=B.positions[0],ct=B.positions[B.positions.length-1],Sr=0;Sr<B.colors.length;++Sr){var Ht=(B.positions[Sr]-_e)/(ct-_e);Ae.addColorStop(Ht,B.colors[Sr])}return de.fillStyle=Ae,de.fillRect(0,0,256,1),ae=new Uint8ClampedArray(de.getImageData(0,0,256,1).data),new ImageData(ae,256,1)}var Yr;(function(B){B.CENTER="center",B.TOP="top",B["TOP-LEFT"]="top-left",B["TOP-RIGHT"]="top-right",B.BOTTOM="bottom",B["BOTTOM-LEFT"]="bottom-left",B.LEFT="left",B.RIGHT="right"})(Yr||(Yr={}));var wn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function cr(B,ee,de){var Ae=B.classList;for(var ae in wn)wn.hasOwnProperty(ae)&&Ae.remove("l7-".concat(de,"-anchor-").concat(ae));Ae.add("l7-".concat(de,"-anchor-").concat(ee))}function Mr(B){if(B.length===0)throw new Error("max requires at least one data point");for(var ee=B[0],de=1;de<B.length;de++)B[de]>ee&&(ee=B[de]);return ee*1}function gt(B){if(B.length===0)throw new Error("min requires at least one data point");for(var ee=B[0],de=1;de<B.length;de++)B[de]<ee&&(ee=B[de]);return ee*1}function Gn(B){if(B.length===0)return 0;for(var ee=B[0]*1,de=1;de<B.length;de++)ee+=B[de]*1;return ee}function Mn(B){if(B.length===0)throw new Error("mean requires at least one data point");return Gn(B)/B.length}function kr(B){if(B.length===0)throw new Error("mean requires at least one data point");if(B.length<3)return B[0];B.sort();for(var ee=B[0],de=NaN,Ae=0,ae=1,_e=1;_e<B.length+1;_e++)B[_e]!==ee?(ae>Ae&&(Ae=ae,de=ee),ae=1,ee=B[_e]):ae++;return de*1}var Y={min:gt,max:Mr,mean:Mn,sum:Gn,mode:kr};function le(B,ee){return B.map(function(de){return de[ee]})}function ve(B,ee){return Y[B](ee)}},3473:function(zr,N,S){"use strict";S.d(N,{Z:function(){return ce}});function ce(E,d,me,te,ue){var oe={};return Object.keys(te).forEach(function(Ne){oe[Ne]=te[Ne]}),oe.enumerable=!!oe.enumerable,oe.configurable=!!oe.configurable,("value"in oe||oe.initializer)&&(oe.writable=!0),oe=me.slice().reverse().reduce(function(Ne,K){return K(E,d,Ne)||Ne},oe),ue&&oe.initializer!==void 0&&(oe.value=oe.initializer?oe.initializer.call(ue):void 0,oe.initializer=void 0),oe.initializer===void 0&&(Object.defineProperty(E,d,oe),oe=null),oe}},66213:function(zr,N,S){"use strict";S.d(N,{Z:function(){return d}});var ce=S(77608);function E(me,te){for(;!Object.prototype.hasOwnProperty.call(me,te)&&(me=(0,ce.Z)(me),me!==null););return me}function d(me,te,ue){return typeof Reflect!="undefined"&&Reflect.get?d=Reflect.get:d=function(Ne,K,Qe){var mt=E(Ne,K);if(!!mt){var Zt=Object.getOwnPropertyDescriptor(mt,K);return Zt.get?Zt.get.call(Qe):Zt.value}},d(me,te,ue||me)}},55770:function(zr,N,S){"use strict";S.d(N,{Z:function(){return ce}});function ce(E,d,me,te){!me||Object.defineProperty(E,d,{enumerable:me.enumerable,configurable:me.configurable,writable:me.writable,value:me.initializer?me.initializer.call(te):void 0})}},31795:function(zr,N,S){var ce=S(75752);zr.exports.geometry=E,zr.exports.ring=me;function E(ue){var oe=0,Ne;switch(ue.type){case"Polygon":return d(ue.coordinates);case"MultiPolygon":for(Ne=0;Ne<ue.coordinates.length;Ne++)oe+=d(ue.coordinates[Ne]);return oe;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Ne=0;Ne<ue.geometries.length;Ne++)oe+=E(ue.geometries[Ne]);return oe}}function d(ue){var oe=0;if(ue&&ue.length>0){oe+=Math.abs(me(ue[0]));for(var Ne=1;Ne<ue.length;Ne++)oe-=Math.abs(me(ue[Ne]))}return oe}function me(ue){var oe,Ne,K,Qe,mt,Zt,Cr,Qt=0,Xt=ue.length;if(Xt>2){for(Cr=0;Cr<Xt;Cr++)Cr===Xt-2?(Qe=Xt-2,mt=Xt-1,Zt=0):Cr===Xt-1?(Qe=Xt-1,mt=0,Zt=1):(Qe=Cr,mt=Cr+1,Zt=Cr+2),oe=ue[Qe],Ne=ue[mt],K=ue[Zt],Qt+=(te(K[0])-te(oe[0]))*Math.sin(te(Ne[1]));Qt=Qt*ce.RADIUS*ce.RADIUS/2}return Qt}function te(ue){return ue*Math.PI/180}},38163:function(zr,N,S){var ce=S(31795);zr.exports=E;function E(Ne,K){switch(Ne&&Ne.type||null){case"FeatureCollection":return Ne.features=Ne.features.map(d(E,K)),Ne;case"GeometryCollection":return Ne.geometries=Ne.geometries.map(d(E,K)),Ne;case"Feature":return Ne.geometry=E(Ne.geometry,K),Ne;case"Polygon":case"MultiPolygon":return me(Ne,K);default:return Ne}}function d(Ne,K){return function(Qe){return Ne(Qe,K)}}function me(Ne,K){return Ne.type==="Polygon"?Ne.coordinates=te(Ne.coordinates,K):Ne.type==="MultiPolygon"&&(Ne.coordinates=Ne.coordinates.map(d(te,K))),Ne}function te(Ne,K){K=!!K,Ne[0]=ue(Ne[0],K);for(var Qe=1;Qe<Ne.length;Qe++)Ne[Qe]=ue(Ne[Qe],!K);return Ne}function ue(Ne,K){return oe(Ne)===K?Ne:Ne.reverse()}function oe(Ne){return ce.ring(Ne)>=0}},49296:function(zr){"use strict";zr.exports=S,zr.exports.default=S;var N=1e20;function S(te,ue,oe,Ne,K,Qe){this.fontSize=te||24,this.buffer=ue===void 0?3:ue,this.cutoff=Ne||.25,this.fontFamily=K||"sans-serif",this.fontWeight=Qe||"normal",this.radius=oe||8;var mt=this.size=this.fontSize+this.buffer*2,Zt=mt+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=mt,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Zt*Zt),this.gridInner=new Float64Array(Zt*Zt),this.f=new Float64Array(Zt),this.z=new Float64Array(Zt+1),this.v=new Uint16Array(Zt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(mt/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ce(te,ue,oe,Ne,K,Qe,mt){Qe.fill(N,0,ue*oe),mt.fill(0,0,ue*oe);for(var Zt=(ue-Ne)/2,Cr=0;Cr<K;Cr++)for(var Qt=0;Qt<Ne;Qt++){var Xt=(Cr+Zt)*ue+Qt+Zt,rr=te.data[4*(Cr*Ne+Qt)+3]/255;if(rr===1)Qe[Xt]=0,mt[Xt]=N;else if(rr===0)Qe[Xt]=N,mt[Xt]=0;else{var Ut=Math.max(0,.5-rr),St=Math.max(0,rr-.5);Qe[Xt]=Ut*Ut,mt[Xt]=St*St}}}function E(te,ue,oe,Ne,K,Qe,mt){for(var Zt=0;Zt<ue*oe;Zt++){var Cr=Math.sqrt(Ne[Zt])-Math.sqrt(K[Zt]);te[Zt]=Math.round(255-255*(Cr/Qe+mt))}}S.prototype._draw=function(te,ue){var oe=this.ctx.measureText(te),Ne=oe.width,K=2*this.buffer,Qe,mt,Zt,Cr,Qt,Xt,rr,Ut;ue&&this.useMetrics?(Qt=Math.floor(oe.actualBoundingBoxAscent),Ut=this.buffer+Math.ceil(oe.actualBoundingBoxAscent),Xt=this.buffer,rr=this.buffer,mt=Math.min(this.size,Math.ceil(oe.actualBoundingBoxRight-oe.actualBoundingBoxLeft)),Cr=Math.min(this.size-Xt,Math.ceil(oe.actualBoundingBoxAscent+oe.actualBoundingBoxDescent)),Qe=mt+K,Zt=Cr+K,this.ctx.textBaseline="alphabetic"):(Qe=mt=this.size,Zt=Cr=this.size,Qt=19*this.fontSize/24,Xt=rr=0,Ut=this.middle,this.ctx.textBaseline="middle");var St;mt&&Cr&&(this.ctx.clearRect(rr,Xt,mt,Cr),this.ctx.fillText(te,this.buffer,Ut),St=this.ctx.getImageData(rr,Xt,mt,Cr));var Et=new Uint8ClampedArray(Qe*Zt);return ce(St,Qe,Zt,mt,Cr,this.gridOuter,this.gridInner),d(this.gridOuter,Qe,Zt,this.f,this.v,this.z),d(this.gridInner,Qe,Zt,this.f,this.v,this.z),E(Et,Qe,Zt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:Et,metrics:{width:mt,height:Cr,sdfWidth:Qe,sdfHeight:Zt,top:Qt,left:0,advance:Ne}}},S.prototype.draw=function(te){return this._draw(te,!1).data},S.prototype.drawWithMetrics=function(te){return this._draw(te,!0)};function d(te,ue,oe,Ne,K,Qe){for(var mt=0;mt<ue;mt++)me(te,mt,ue,oe,Ne,K,Qe);for(var Zt=0;Zt<oe;Zt++)me(te,Zt*ue,1,ue,Ne,K,Qe)}function me(te,ue,oe,Ne,K,Qe,mt){var Zt,Cr,Qt,Xt;for(Qe[0]=0,mt[0]=-N,mt[1]=N,Zt=0;Zt<Ne;Zt++)K[Zt]=te[ue+Zt*oe];for(Zt=1,Cr=0,Qt=0;Zt<Ne;Zt++){do Xt=Qe[Cr],Qt=(K[Zt]-K[Xt]+Zt*Zt-Xt*Xt)/(Zt-Xt)/2;while(Qt<=mt[Cr]&&--Cr>-1);Cr++,Qe[Cr]=Zt,mt[Cr]=Qt,mt[Cr+1]=N}for(Zt=0,Cr=0;Zt<Ne;Zt++){for(;mt[Cr+1]<Zt;)Cr++;Xt=Qe[Cr],te[ue+Zt*oe]=K[Xt]+(Zt-Xt)*(Zt-Xt)}}},40271:function(zr,N,S){"use strict";S.d(N,{zL:function(){return te},DL:function(){return Et},Ht:function(){return $e}});var ce=63710088e-1,E={centimeters:ce*100,centimetres:ce*100,degrees:ce/111325,feet:ce*3.28084,inches:ce*39.37,kilometers:ce/1e3,kilometres:ce/1e3,meters:ce,metres:ce,miles:ce/1609.344,millimeters:ce*1e3,millimetres:ce*1e3,nauticalmiles:ce/1852,radians:1,yards:ce*1.0936},d={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/ce,yards:1.0936133},me={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function te(ie,Re,ye){ye===void 0&&(ye={});var _t={type:"Feature"};return(ye.id===0||ye.id)&&(_t.id=ye.id),ye.bbox&&(_t.bbox=ye.bbox),_t.properties=Re||{},_t.geometry=ie,_t}function ue(ie,Re,ye){switch(ye===void 0&&(ye={}),ie){case"Point":return oe(Re).geometry;case"LineString":return mt(Re).geometry;case"Polygon":return K(Re).geometry;case"MultiPoint":return Xt(Re).geometry;case"MultiLineString":return Qt(Re).geometry;case"MultiPolygon":return rr(Re).geometry;default:throw new Error(ie+" is invalid")}}function oe(ie,Re,ye){if(ye===void 0&&(ye={}),!ie)throw new Error("coordinates is required");if(!Array.isArray(ie))throw new Error("coordinates must be an Array");if(ie.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!jt(ie[0])||!jt(ie[1]))throw new Error("coordinates must contain numbers");var _t={type:"Point",coordinates:ie};return te(_t,Re,ye)}function Ne(ie,Re,ye){return ye===void 0&&(ye={}),Cr(ie.map(function(_t){return oe(_t,Re)}),ye)}function K(ie,Re,ye){ye===void 0&&(ye={});for(var _t=0,dt=ie;_t<dt.length;_t++){var zt=dt[_t];if(zt.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var Bt=0;Bt<zt[zt.length-1].length;Bt++)if(zt[zt.length-1][Bt]!==zt[0][Bt])throw new Error("First and last Position are not equivalent.")}var Ur={type:"Polygon",coordinates:ie};return te(Ur,Re,ye)}function Qe(ie,Re,ye){return ye===void 0&&(ye={}),Cr(ie.map(function(_t){return K(_t,Re)}),ye)}function mt(ie,Re,ye){if(ye===void 0&&(ye={}),ie.length<2)throw new Error("coordinates must be an array of two or more positions");var _t={type:"LineString",coordinates:ie};return te(_t,Re,ye)}function Zt(ie,Re,ye){return ye===void 0&&(ye={}),Cr(ie.map(function(_t){return mt(_t,Re)}),ye)}function Cr(ie,Re){Re===void 0&&(Re={});var ye={type:"FeatureCollection"};return Re.id&&(ye.id=Re.id),Re.bbox&&(ye.bbox=Re.bbox),ye.features=ie,ye}function Qt(ie,Re,ye){ye===void 0&&(ye={});var _t={type:"MultiLineString",coordinates:ie};return te(_t,Re,ye)}function Xt(ie,Re,ye){ye===void 0&&(ye={});var _t={type:"MultiPoint",coordinates:ie};return te(_t,Re,ye)}function rr(ie,Re,ye){ye===void 0&&(ye={});var _t={type:"MultiPolygon",coordinates:ie};return te(_t,Re,ye)}function Ut(ie,Re,ye){ye===void 0&&(ye={});var _t={type:"GeometryCollection",geometries:ie};return te(_t,Re,ye)}function St(ie,Re){if(Re===void 0&&(Re=0),Re&&!(Re>=0))throw new Error("precision must be a positive number");var ye=Math.pow(10,Re||0);return Math.round(ie*ye)/ye}function Et(ie,Re){Re===void 0&&(Re="kilometers");var ye=E[Re];if(!ye)throw new Error(Re+" units is invalid");return ie*ye}function yr(ie,Re){Re===void 0&&(Re="kilometers");var ye=E[Re];if(!ye)throw new Error(Re+" units is invalid");return ie/ye}function q(ie,Re){return wt(yr(ie,Re))}function hr(ie){var Re=ie%360;return Re<0&&(Re+=360),Re}function wt(ie){var Re=ie%(2*Math.PI);return Re*180/Math.PI}function $e(ie){var Re=ie%360;return Re*Math.PI/180}function Ft(ie,Re,ye){if(Re===void 0&&(Re="kilometers"),ye===void 0&&(ye="kilometers"),!(ie>=0))throw new Error("length must be a positive number");return Et(yr(ie,Re),ye)}function Xe(ie,Re,ye){if(Re===void 0&&(Re="meters"),ye===void 0&&(ye="kilometers"),!(ie>=0))throw new Error("area must be a positive number");var _t=me[Re];if(!_t)throw new Error("invalid original units");var dt=me[ye];if(!dt)throw new Error("invalid final units");return ie/_t*dt}function jt(ie){return!isNaN(ie)&&ie!==null&&!Array.isArray(ie)}function br(ie){return!!ie&&ie.constructor===Object}function sr(ie){if(!ie)throw new Error("bbox is required");if(!Array.isArray(ie))throw new Error("bbox must be an Array");if(ie.length!==4&&ie.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");ie.forEach(function(Re){if(!jt(Re))throw new Error("bbox must only contain numbers")})}function j(ie){if(!ie)throw new Error("id is required");if(["string","number"].indexOf(typeof ie)===-1)throw new Error("id must be a number or a string")}},53645:function(){},9187:function(zr){"use strict";zr.exports=N,zr.exports.default=N;function N(ie,Re,ye){ye=ye||2;var _t=Re&&Re.length,dt=_t?Re[0]*ye:ie.length,zt=S(ie,0,dt,ye,!0),Bt=[];if(!zt||zt.next===zt.prev)return Bt;var Ur,vn,En,ea,ar,ge,Te;if(_t&&(zt=oe(ie,Re,zt,ye)),ie.length>80*ye){Ur=En=ie[0],vn=ea=ie[1];for(var Ze=ye;Ze<dt;Ze+=ye)ar=ie[Ze],ge=ie[Ze+1],ar<Ur&&(Ur=ar),ge<vn&&(vn=ge),ar>En&&(En=ar),ge>ea&&(ea=ge);Te=Math.max(En-Ur,ea-vn),Te=Te!==0?1/Te:0}return E(zt,Bt,ye,Ur,vn,Te),Bt}function S(ie,Re,ye,_t,dt){var zt,Bt;if(dt===j(ie,Re,ye,_t)>0)for(zt=Re;zt<ye;zt+=_t)Bt=jt(zt,ie[zt],ie[zt+1],Bt);else for(zt=ye-_t;zt>=Re;zt-=_t)Bt=jt(zt,ie[zt],ie[zt+1],Bt);return Bt&&Et(Bt,Bt.next)&&(br(Bt),Bt=Bt.next),Bt}function ce(ie,Re){if(!ie)return ie;Re||(Re=ie);var ye=ie,_t;do if(_t=!1,!ye.steiner&&(Et(ye,ye.next)||St(ye.prev,ye,ye.next)===0)){if(br(ye),ye=Re=ye.prev,ye===ye.next)break;_t=!0}else ye=ye.next;while(_t||ye!==Re);return Re}function E(ie,Re,ye,_t,dt,zt,Bt){if(!!ie){!Bt&&zt&&Zt(ie,_t,dt,zt);for(var Ur=ie,vn,En;ie.prev!==ie.next;){if(vn=ie.prev,En=ie.next,zt?me(ie,_t,dt,zt):d(ie)){Re.push(vn.i/ye),Re.push(ie.i/ye),Re.push(En.i/ye),br(ie),ie=En.next,Ur=En.next;continue}if(ie=En,ie===Ur){Bt?Bt===1?(ie=te(ce(ie),Re,ye),E(ie,Re,ye,_t,dt,zt,2)):Bt===2&&ue(ie,Re,ye,_t,dt,zt):E(ce(ie),Re,ye,_t,dt,zt,1);break}}}}function d(ie){var Re=ie.prev,ye=ie,_t=ie.next;if(St(Re,ye,_t)>=0)return!1;for(var dt=ie.next.next;dt!==ie.prev;){if(rr(Re.x,Re.y,ye.x,ye.y,_t.x,_t.y,dt.x,dt.y)&&St(dt.prev,dt,dt.next)>=0)return!1;dt=dt.next}return!0}function me(ie,Re,ye,_t){var dt=ie.prev,zt=ie,Bt=ie.next;if(St(dt,zt,Bt)>=0)return!1;for(var Ur=dt.x<zt.x?dt.x<Bt.x?dt.x:Bt.x:zt.x<Bt.x?zt.x:Bt.x,vn=dt.y<zt.y?dt.y<Bt.y?dt.y:Bt.y:zt.y<Bt.y?zt.y:Bt.y,En=dt.x>zt.x?dt.x>Bt.x?dt.x:Bt.x:zt.x>Bt.x?zt.x:Bt.x,ea=dt.y>zt.y?dt.y>Bt.y?dt.y:Bt.y:zt.y>Bt.y?zt.y:Bt.y,ar=Qt(Ur,vn,Re,ye,_t),ge=Qt(En,ea,Re,ye,_t),Te=ie.prevZ,Ze=ie.nextZ;Te&&Te.z>=ar&&Ze&&Ze.z<=ge;){if(Te!==ie.prev&&Te!==ie.next&&rr(dt.x,dt.y,zt.x,zt.y,Bt.x,Bt.y,Te.x,Te.y)&&St(Te.prev,Te,Te.next)>=0||(Te=Te.prevZ,Ze!==ie.prev&&Ze!==ie.next&&rr(dt.x,dt.y,zt.x,zt.y,Bt.x,Bt.y,Ze.x,Ze.y)&&St(Ze.prev,Ze,Ze.next)>=0))return!1;Ze=Ze.nextZ}for(;Te&&Te.z>=ar;){if(Te!==ie.prev&&Te!==ie.next&&rr(dt.x,dt.y,zt.x,zt.y,Bt.x,Bt.y,Te.x,Te.y)&&St(Te.prev,Te,Te.next)>=0)return!1;Te=Te.prevZ}for(;Ze&&Ze.z<=ge;){if(Ze!==ie.prev&&Ze!==ie.next&&rr(dt.x,dt.y,zt.x,zt.y,Bt.x,Bt.y,Ze.x,Ze.y)&&St(Ze.prev,Ze,Ze.next)>=0)return!1;Ze=Ze.nextZ}return!0}function te(ie,Re,ye){var _t=ie;do{var dt=_t.prev,zt=_t.next.next;!Et(dt,zt)&&yr(dt,_t,_t.next,zt)&&$e(dt,zt)&&$e(zt,dt)&&(Re.push(dt.i/ye),Re.push(_t.i/ye),Re.push(zt.i/ye),br(_t),br(_t.next),_t=ie=zt),_t=_t.next}while(_t!==ie);return ce(_t)}function ue(ie,Re,ye,_t,dt,zt){var Bt=ie;do{for(var Ur=Bt.next.next;Ur!==Bt.prev;){if(Bt.i!==Ur.i&&Ut(Bt,Ur)){var vn=Xe(Bt,Ur);Bt=ce(Bt,Bt.next),vn=ce(vn,vn.next),E(Bt,Re,ye,_t,dt,zt),E(vn,Re,ye,_t,dt,zt);return}Ur=Ur.next}Bt=Bt.next}while(Bt!==ie)}function oe(ie,Re,ye,_t){var dt=[],zt,Bt,Ur,vn,En;for(zt=0,Bt=Re.length;zt<Bt;zt++)Ur=Re[zt]*_t,vn=zt<Bt-1?Re[zt+1]*_t:ie.length,En=S(ie,Ur,vn,_t,!1),En===En.next&&(En.steiner=!0),dt.push(Xt(En));for(dt.sort(Ne),zt=0;zt<dt.length;zt++)ye=K(dt[zt],ye),ye=ce(ye,ye.next);return ye}function Ne(ie,Re){return ie.x-Re.x}function K(ie,Re){var ye=Qe(ie,Re);if(!ye)return Re;var _t=Xe(ye,ie),dt=ce(ye,ye.next);return ce(_t,_t.next),Re===ye?dt:Re}function Qe(ie,Re){var ye=Re,_t=ie.x,dt=ie.y,zt=-Infinity,Bt;do{if(dt<=ye.y&&dt>=ye.next.y&&ye.next.y!==ye.y){var Ur=ye.x+(dt-ye.y)*(ye.next.x-ye.x)/(ye.next.y-ye.y);if(Ur<=_t&&Ur>zt){if(zt=Ur,Ur===_t){if(dt===ye.y)return ye;if(dt===ye.next.y)return ye.next}Bt=ye.x<ye.next.x?ye:ye.next}}ye=ye.next}while(ye!==Re);if(!Bt)return null;if(_t===zt)return Bt;var vn=Bt,En=Bt.x,ea=Bt.y,ar=Infinity,ge;ye=Bt;do _t>=ye.x&&ye.x>=En&&_t!==ye.x&&rr(dt<ea?_t:zt,dt,En,ea,dt<ea?zt:_t,dt,ye.x,ye.y)&&(ge=Math.abs(dt-ye.y)/(_t-ye.x),$e(ye,ie)&&(ge<ar||ge===ar&&(ye.x>Bt.x||ye.x===Bt.x&&mt(Bt,ye)))&&(Bt=ye,ar=ge)),ye=ye.next;while(ye!==vn);return Bt}function mt(ie,Re){return St(ie.prev,ie,Re.prev)<0&&St(Re.next,ie,ie.next)<0}function Zt(ie,Re,ye,_t){var dt=ie;do dt.z===null&&(dt.z=Qt(dt.x,dt.y,Re,ye,_t)),dt.prevZ=dt.prev,dt.nextZ=dt.next,dt=dt.next;while(dt!==ie);dt.prevZ.nextZ=null,dt.prevZ=null,Cr(dt)}function Cr(ie){var Re,ye,_t,dt,zt,Bt,Ur,vn,En=1;do{for(ye=ie,ie=null,zt=null,Bt=0;ye;){for(Bt++,_t=ye,Ur=0,Re=0;Re<En&&(Ur++,_t=_t.nextZ,!!_t);Re++);for(vn=En;Ur>0||vn>0&&_t;)Ur!==0&&(vn===0||!_t||ye.z<=_t.z)?(dt=ye,ye=ye.nextZ,Ur--):(dt=_t,_t=_t.nextZ,vn--),zt?zt.nextZ=dt:ie=dt,dt.prevZ=zt,zt=dt;ye=_t}zt.nextZ=null,En*=2}while(Bt>1);return ie}function Qt(ie,Re,ye,_t,dt){return ie=32767*(ie-ye)*dt,Re=32767*(Re-_t)*dt,ie=(ie|ie<<8)&16711935,ie=(ie|ie<<4)&252645135,ie=(ie|ie<<2)&858993459,ie=(ie|ie<<1)&1431655765,Re=(Re|Re<<8)&16711935,Re=(Re|Re<<4)&252645135,Re=(Re|Re<<2)&858993459,Re=(Re|Re<<1)&1431655765,ie|Re<<1}function Xt(ie){var Re=ie,ye=ie;do(Re.x<ye.x||Re.x===ye.x&&Re.y<ye.y)&&(ye=Re),Re=Re.next;while(Re!==ie);return ye}function rr(ie,Re,ye,_t,dt,zt,Bt,Ur){return(dt-Bt)*(Re-Ur)-(ie-Bt)*(zt-Ur)>=0&&(ie-Bt)*(_t-Ur)-(ye-Bt)*(Re-Ur)>=0&&(ye-Bt)*(zt-Ur)-(dt-Bt)*(_t-Ur)>=0}function Ut(ie,Re){return ie.next.i!==Re.i&&ie.prev.i!==Re.i&&!wt(ie,Re)&&($e(ie,Re)&&$e(Re,ie)&&Ft(ie,Re)&&(St(ie.prev,ie,Re.prev)||St(ie,Re.prev,Re))||Et(ie,Re)&&St(ie.prev,ie,ie.next)>0&&St(Re.prev,Re,Re.next)>0)}function St(ie,Re,ye){return(Re.y-ie.y)*(ye.x-Re.x)-(Re.x-ie.x)*(ye.y-Re.y)}function Et(ie,Re){return ie.x===Re.x&&ie.y===Re.y}function yr(ie,Re,ye,_t){var dt=hr(St(ie,Re,ye)),zt=hr(St(ie,Re,_t)),Bt=hr(St(ye,_t,ie)),Ur=hr(St(ye,_t,Re));return!!(dt!==zt&&Bt!==Ur||dt===0&&q(ie,ye,Re)||zt===0&&q(ie,_t,Re)||Bt===0&&q(ye,ie,_t)||Ur===0&&q(ye,Re,_t))}function q(ie,Re,ye){return Re.x<=Math.max(ie.x,ye.x)&&Re.x>=Math.min(ie.x,ye.x)&&Re.y<=Math.max(ie.y,ye.y)&&Re.y>=Math.min(ie.y,ye.y)}function hr(ie){return ie>0?1:ie<0?-1:0}function wt(ie,Re){var ye=ie;do{if(ye.i!==ie.i&&ye.next.i!==ie.i&&ye.i!==Re.i&&ye.next.i!==Re.i&&yr(ye,ye.next,ie,Re))return!0;ye=ye.next}while(ye!==ie);return!1}function $e(ie,Re){return St(ie.prev,ie,ie.next)<0?St(ie,Re,ie.next)>=0&&St(ie,ie.prev,Re)>=0:St(ie,Re,ie.prev)<0||St(ie,ie.next,Re)<0}function Ft(ie,Re){var ye=ie,_t=!1,dt=(ie.x+Re.x)/2,zt=(ie.y+Re.y)/2;do ye.y>zt!=ye.next.y>zt&&ye.next.y!==ye.y&&dt<(ye.next.x-ye.x)*(zt-ye.y)/(ye.next.y-ye.y)+ye.x&&(_t=!_t),ye=ye.next;while(ye!==ie);return _t}function Xe(ie,Re){var ye=new sr(ie.i,ie.x,ie.y),_t=new sr(Re.i,Re.x,Re.y),dt=ie.next,zt=Re.prev;return ie.next=Re,Re.prev=ie,ye.next=dt,dt.prev=ye,_t.next=ye,ye.prev=_t,zt.next=_t,_t.prev=zt,_t}function jt(ie,Re,ye,_t){var dt=new sr(ie,Re,ye);return _t?(dt.next=_t.next,dt.prev=_t,_t.next.prev=dt,_t.next=dt):(dt.prev=dt,dt.next=dt),dt}function br(ie){ie.next.prev=ie.prev,ie.prev.next=ie.next,ie.prevZ&&(ie.prevZ.nextZ=ie.nextZ),ie.nextZ&&(ie.nextZ.prevZ=ie.prevZ)}function sr(ie,Re,ye){this.i=ie,this.x=Re,this.y=ye,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}N.deviation=function(ie,Re,ye,_t){var dt=Re&&Re.length,zt=dt?Re[0]*ye:ie.length,Bt=Math.abs(j(ie,0,zt,ye));if(dt)for(var Ur=0,vn=Re.length;Ur<vn;Ur++){var En=Re[Ur]*ye,ea=Ur<vn-1?Re[Ur+1]*ye:ie.length;Bt-=Math.abs(j(ie,En,ea,ye))}var ar=0;for(Ur=0;Ur<_t.length;Ur+=3){var ge=_t[Ur]*ye,Te=_t[Ur+1]*ye,Ze=_t[Ur+2]*ye;ar+=Math.abs((ie[ge]-ie[Ze])*(ie[Te+1]-ie[ge+1])-(ie[ge]-ie[Te])*(ie[Ze+1]-ie[ge+1]))}return Bt===0&&ar===0?0:Math.abs((ar-Bt)/Bt)};function j(ie,Re,ye,_t){for(var dt=0,zt=Re,Bt=ye-_t;zt<ye;zt+=_t)dt+=(ie[Bt]-ie[zt])*(ie[zt+1]+ie[Bt+1]),Bt=zt;return dt}N.flatten=function(ie){for(var Re=ie[0][0].length,ye={vertices:[],holes:[],dimensions:Re},_t=0,dt=0;dt<ie.length;dt++){for(var zt=0;zt<ie[dt].length;zt++)for(var Bt=0;Bt<Re;Bt++)ye.vertices.push(ie[dt][zt][Bt]);dt>0&&(_t+=ie[dt-1].length,ye.holes.push(_t))}return ye}},67709:function(zr){function N(ce){var E=ce.target||ce.srcElement;E.__resizeRAF__&&cancelAnimationFrame(E.__resizeRAF__),E.__resizeRAF__=requestAnimationFrame(function(){var d=E.__resizeTrigger__,me=d&&d.__resizeListeners__;me&&me.forEach(function(te){te.call(d,ce)})})}var S=function(E,d){var me=this,te=me.document,ue,oe=te.attachEvent;typeof navigator!="undefined"&&(ue=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Ne(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",N)}if(!E.__resizeListeners__)if(E.__resizeListeners__=[],oe)E.__resizeTrigger__=E,E.attachEvent("onresize",N);else{getComputedStyle(E).position==="static"&&(E.style.position="relative");var K=E.__resizeTrigger__=te.createElement("object");K.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),K.setAttribute("class","resize-sensor"),K.setAttribute("tabindex","-1"),K.setAttribute("title",""),K.__resizeElement__=E,K.onload=Ne,K.type="text/html",ue&&E.appendChild(K),K.data="about:blank",ue||E.appendChild(K)}E.__resizeListeners__.push(d)};zr.exports=typeof window=="undefined"?S:S.bind(window),zr.exports.unbind=function(ce,E){var d=document.attachEvent,me=ce.__resizeListeners__||[];if(E){var te=me.indexOf(E);te!==-1&&me.splice(te,1)}else me=ce.__resizeListeners__=[];if(!me.length){if(d)ce.detachEvent("onresize",N);else if(ce.__resizeTrigger__){var ue=ce.__resizeTrigger__.contentDocument,oe=ue&&ue.defaultView;oe&&(oe.removeEventListener("resize",N),delete oe.__resizeTrigger__),ce.__resizeTrigger__=!ce.removeChild(ce.__resizeTrigger__)}delete ce.__resizeListeners__}}},26729:function(zr){"use strict";var N=Object.prototype.hasOwnProperty,S="~";function ce(){}Object.create&&(ce.prototype=Object.create(null),new ce().__proto__||(S=!1));function E(ue,oe,Ne){this.fn=ue,this.context=oe,this.once=Ne||!1}function d(ue,oe,Ne,K,Qe){if(typeof Ne!="function")throw new TypeError("The listener must be a function");var mt=new E(Ne,K||ue,Qe),Zt=S?S+oe:oe;return ue._events[Zt]?ue._events[Zt].fn?ue._events[Zt]=[ue._events[Zt],mt]:ue._events[Zt].push(mt):(ue._events[Zt]=mt,ue._eventsCount++),ue}function me(ue,oe){--ue._eventsCount==0?ue._events=new ce:delete ue._events[oe]}function te(){this._events=new ce,this._eventsCount=0}te.prototype.eventNames=function(){var oe=[],Ne,K;if(this._eventsCount===0)return oe;for(K in Ne=this._events)N.call(Ne,K)&&oe.push(S?K.slice(1):K);return Object.getOwnPropertySymbols?oe.concat(Object.getOwnPropertySymbols(Ne)):oe},te.prototype.listeners=function(oe){var Ne=S?S+oe:oe,K=this._events[Ne];if(!K)return[];if(K.fn)return[K.fn];for(var Qe=0,mt=K.length,Zt=new Array(mt);Qe<mt;Qe++)Zt[Qe]=K[Qe].fn;return Zt},te.prototype.listenerCount=function(oe){var Ne=S?S+oe:oe,K=this._events[Ne];return K?K.fn?1:K.length:0},te.prototype.emit=function(oe,Ne,K,Qe,mt,Zt){var Cr=S?S+oe:oe;if(!this._events[Cr])return!1;var Qt=this._events[Cr],Xt=arguments.length,rr,Ut;if(Qt.fn){switch(Qt.once&&this.removeListener(oe,Qt.fn,void 0,!0),Xt){case 1:return Qt.fn.call(Qt.context),!0;case 2:return Qt.fn.call(Qt.context,Ne),!0;case 3:return Qt.fn.call(Qt.context,Ne,K),!0;case 4:return Qt.fn.call(Qt.context,Ne,K,Qe),!0;case 5:return Qt.fn.call(Qt.context,Ne,K,Qe,mt),!0;case 6:return Qt.fn.call(Qt.context,Ne,K,Qe,mt,Zt),!0}for(Ut=1,rr=new Array(Xt-1);Ut<Xt;Ut++)rr[Ut-1]=arguments[Ut];Qt.fn.apply(Qt.context,rr)}else{var St=Qt.length,Et;for(Ut=0;Ut<St;Ut++)switch(Qt[Ut].once&&this.removeListener(oe,Qt[Ut].fn,void 0,!0),Xt){case 1:Qt[Ut].fn.call(Qt[Ut].context);break;case 2:Qt[Ut].fn.call(Qt[Ut].context,Ne);break;case 3:Qt[Ut].fn.call(Qt[Ut].context,Ne,K);break;case 4:Qt[Ut].fn.call(Qt[Ut].context,Ne,K,Qe);break;default:if(!rr)for(Et=1,rr=new Array(Xt-1);Et<Xt;Et++)rr[Et-1]=arguments[Et];Qt[Ut].fn.apply(Qt[Ut].context,rr)}}return!0},te.prototype.on=function(oe,Ne,K){return d(this,oe,Ne,K,!1)},te.prototype.once=function(oe,Ne,K){return d(this,oe,Ne,K,!0)},te.prototype.removeListener=function(oe,Ne,K,Qe){var mt=S?S+oe:oe;if(!this._events[mt])return this;if(!Ne)return me(this,mt),this;var Zt=this._events[mt];if(Zt.fn)Zt.fn===Ne&&(!Qe||Zt.once)&&(!K||Zt.context===K)&&me(this,mt);else{for(var Cr=0,Qt=[],Xt=Zt.length;Cr<Xt;Cr++)(Zt[Cr].fn!==Ne||Qe&&!Zt[Cr].once||K&&Zt[Cr].context!==K)&&Qt.push(Zt[Cr]);Qt.length?this._events[mt]=Qt.length===1?Qt[0]:Qt:me(this,mt)}return this},te.prototype.removeAllListeners=function(oe){var Ne;return oe?(Ne=S?S+oe:oe,this._events[Ne]&&me(this,Ne)):(this._events=new ce,this._eventsCount=0),this},te.prototype.off=te.prototype.removeListener,te.prototype.addListener=te.prototype.on,te.prefixed=S,te.EventEmitter=te,zr.exports=te},85975:function(zr,N,S){"use strict";S.r(N),S.d(N,{create:function(){return E},clone:function(){return d},copy:function(){return me},fromValues:function(){return te},set:function(){return ue},identity:function(){return oe},transpose:function(){return Ne},invert:function(){return K},adjoint:function(){return Qe},determinant:function(){return mt},multiply:function(){return Zt},translate:function(){return Cr},scale:function(){return Qt},rotate:function(){return Xt},rotateX:function(){return rr},rotateY:function(){return Ut},rotateZ:function(){return St},fromTranslation:function(){return Et},fromScaling:function(){return yr},fromRotation:function(){return q},fromXRotation:function(){return hr},fromYRotation:function(){return wt},fromZRotation:function(){return $e},fromRotationTranslation:function(){return Ft},fromQuat2:function(){return Xe},getTranslation:function(){return jt},getScaling:function(){return br},getRotation:function(){return sr},fromRotationTranslationScale:function(){return j},fromRotationTranslationScaleOrigin:function(){return ie},fromQuat:function(){return Re},frustum:function(){return ye},perspectiveNO:function(){return _t},perspective:function(){return dt},perspectiveZO:function(){return zt},perspectiveFromFieldOfView:function(){return Bt},orthoNO:function(){return Ur},ortho:function(){return vn},orthoZO:function(){return En},lookAt:function(){return ea},targetTo:function(){return ar},str:function(){return ge},frob:function(){return Te},add:function(){return Ze},subtract:function(){return Oe},multiplyScalar:function(){return Lt},multiplyScalarAndAdd:function(){return nr},exactEquals:function(){return dr},equals:function(){return Or},mul:function(){return lr},sub:function(){return un}});var ce=S(49685);function E(){var w=new ce.WT(16);return ce.WT!=Float32Array&&(w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=0,w[12]=0,w[13]=0,w[14]=0),w[0]=1,w[5]=1,w[10]=1,w[15]=1,w}function d(w){var H=new ce.WT(16);return H[0]=w[0],H[1]=w[1],H[2]=w[2],H[3]=w[3],H[4]=w[4],H[5]=w[5],H[6]=w[6],H[7]=w[7],H[8]=w[8],H[9]=w[9],H[10]=w[10],H[11]=w[11],H[12]=w[12],H[13]=w[13],H[14]=w[14],H[15]=w[15],H}function me(w,H){return w[0]=H[0],w[1]=H[1],w[2]=H[2],w[3]=H[3],w[4]=H[4],w[5]=H[5],w[6]=H[6],w[7]=H[7],w[8]=H[8],w[9]=H[9],w[10]=H[10],w[11]=H[11],w[12]=H[12],w[13]=H[13],w[14]=H[14],w[15]=H[15],w}function te(w,H,Ue,et,st,Ct,$,Gt,Tr,Ir,Ye,ut,At,Rt,xr,Ar){var Ke=new ce.WT(16);return Ke[0]=w,Ke[1]=H,Ke[2]=Ue,Ke[3]=et,Ke[4]=st,Ke[5]=Ct,Ke[6]=$,Ke[7]=Gt,Ke[8]=Tr,Ke[9]=Ir,Ke[10]=Ye,Ke[11]=ut,Ke[12]=At,Ke[13]=Rt,Ke[14]=xr,Ke[15]=Ar,Ke}function ue(w,H,Ue,et,st,Ct,$,Gt,Tr,Ir,Ye,ut,At,Rt,xr,Ar,Ke){return w[0]=H,w[1]=Ue,w[2]=et,w[3]=st,w[4]=Ct,w[5]=$,w[6]=Gt,w[7]=Tr,w[8]=Ir,w[9]=Ye,w[10]=ut,w[11]=At,w[12]=Rt,w[13]=xr,w[14]=Ar,w[15]=Ke,w}function oe(w){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function Ne(w,H){if(w===H){var Ue=H[1],et=H[2],st=H[3],Ct=H[6],$=H[7],Gt=H[11];w[1]=H[4],w[2]=H[8],w[3]=H[12],w[4]=Ue,w[6]=H[9],w[7]=H[13],w[8]=et,w[9]=Ct,w[11]=H[14],w[12]=st,w[13]=$,w[14]=Gt}else w[0]=H[0],w[1]=H[4],w[2]=H[8],w[3]=H[12],w[4]=H[1],w[5]=H[5],w[6]=H[9],w[7]=H[13],w[8]=H[2],w[9]=H[6],w[10]=H[10],w[11]=H[14],w[12]=H[3],w[13]=H[7],w[14]=H[11],w[15]=H[15];return w}function K(w,H){var Ue=H[0],et=H[1],st=H[2],Ct=H[3],$=H[4],Gt=H[5],Tr=H[6],Ir=H[7],Ye=H[8],ut=H[9],At=H[10],Rt=H[11],xr=H[12],Ar=H[13],Ke=H[14],Xr=H[15],Yr=Ue*Gt-et*$,wn=Ue*Tr-st*$,cr=Ue*Ir-Ct*$,Mr=et*Tr-st*Gt,gt=et*Ir-Ct*Gt,Gn=st*Ir-Ct*Tr,Mn=Ye*Ar-ut*xr,kr=Ye*Ke-At*xr,Y=Ye*Xr-Rt*xr,le=ut*Ke-At*Ar,ve=ut*Xr-Rt*Ar,B=At*Xr-Rt*Ke,ee=Yr*B-wn*ve+cr*le+Mr*Y-gt*kr+Gn*Mn;return ee?(ee=1/ee,w[0]=(Gt*B-Tr*ve+Ir*le)*ee,w[1]=(st*ve-et*B-Ct*le)*ee,w[2]=(Ar*Gn-Ke*gt+Xr*Mr)*ee,w[3]=(At*gt-ut*Gn-Rt*Mr)*ee,w[4]=(Tr*Y-$*B-Ir*kr)*ee,w[5]=(Ue*B-st*Y+Ct*kr)*ee,w[6]=(Ke*cr-xr*Gn-Xr*wn)*ee,w[7]=(Ye*Gn-At*cr+Rt*wn)*ee,w[8]=($*ve-Gt*Y+Ir*Mn)*ee,w[9]=(et*Y-Ue*ve-Ct*Mn)*ee,w[10]=(xr*gt-Ar*cr+Xr*Yr)*ee,w[11]=(ut*cr-Ye*gt-Rt*Yr)*ee,w[12]=(Gt*kr-$*le-Tr*Mn)*ee,w[13]=(Ue*le-et*kr+st*Mn)*ee,w[14]=(Ar*wn-xr*Mr-Ke*Yr)*ee,w[15]=(Ye*Mr-ut*wn+At*Yr)*ee,w):null}function Qe(w,H){var Ue=H[0],et=H[1],st=H[2],Ct=H[3],$=H[4],Gt=H[5],Tr=H[6],Ir=H[7],Ye=H[8],ut=H[9],At=H[10],Rt=H[11],xr=H[12],Ar=H[13],Ke=H[14],Xr=H[15];return w[0]=Gt*(At*Xr-Rt*Ke)-ut*(Tr*Xr-Ir*Ke)+Ar*(Tr*Rt-Ir*At),w[1]=-(et*(At*Xr-Rt*Ke)-ut*(st*Xr-Ct*Ke)+Ar*(st*Rt-Ct*At)),w[2]=et*(Tr*Xr-Ir*Ke)-Gt*(st*Xr-Ct*Ke)+Ar*(st*Ir-Ct*Tr),w[3]=-(et*(Tr*Rt-Ir*At)-Gt*(st*Rt-Ct*At)+ut*(st*Ir-Ct*Tr)),w[4]=-($*(At*Xr-Rt*Ke)-Ye*(Tr*Xr-Ir*Ke)+xr*(Tr*Rt-Ir*At)),w[5]=Ue*(At*Xr-Rt*Ke)-Ye*(st*Xr-Ct*Ke)+xr*(st*Rt-Ct*At),w[6]=-(Ue*(Tr*Xr-Ir*Ke)-$*(st*Xr-Ct*Ke)+xr*(st*Ir-Ct*Tr)),w[7]=Ue*(Tr*Rt-Ir*At)-$*(st*Rt-Ct*At)+Ye*(st*Ir-Ct*Tr),w[8]=$*(ut*Xr-Rt*Ar)-Ye*(Gt*Xr-Ir*Ar)+xr*(Gt*Rt-Ir*ut),w[9]=-(Ue*(ut*Xr-Rt*Ar)-Ye*(et*Xr-Ct*Ar)+xr*(et*Rt-Ct*ut)),w[10]=Ue*(Gt*Xr-Ir*Ar)-$*(et*Xr-Ct*Ar)+xr*(et*Ir-Ct*Gt),w[11]=-(Ue*(Gt*Rt-Ir*ut)-$*(et*Rt-Ct*ut)+Ye*(et*Ir-Ct*Gt)),w[12]=-($*(ut*Ke-At*Ar)-Ye*(Gt*Ke-Tr*Ar)+xr*(Gt*At-Tr*ut)),w[13]=Ue*(ut*Ke-At*Ar)-Ye*(et*Ke-st*Ar)+xr*(et*At-st*ut),w[14]=-(Ue*(Gt*Ke-Tr*Ar)-$*(et*Ke-st*Ar)+xr*(et*Tr-st*Gt)),w[15]=Ue*(Gt*At-Tr*ut)-$*(et*At-st*ut)+Ye*(et*Tr-st*Gt),w}function mt(w){var H=w[0],Ue=w[1],et=w[2],st=w[3],Ct=w[4],$=w[5],Gt=w[6],Tr=w[7],Ir=w[8],Ye=w[9],ut=w[10],At=w[11],Rt=w[12],xr=w[13],Ar=w[14],Ke=w[15],Xr=H*$-Ue*Ct,Yr=H*Gt-et*Ct,wn=H*Tr-st*Ct,cr=Ue*Gt-et*$,Mr=Ue*Tr-st*$,gt=et*Tr-st*Gt,Gn=Ir*xr-Ye*Rt,Mn=Ir*Ar-ut*Rt,kr=Ir*Ke-At*Rt,Y=Ye*Ar-ut*xr,le=Ye*Ke-At*xr,ve=ut*Ke-At*Ar;return Xr*ve-Yr*le+wn*Y+cr*kr-Mr*Mn+gt*Gn}function Zt(w,H,Ue){var et=H[0],st=H[1],Ct=H[2],$=H[3],Gt=H[4],Tr=H[5],Ir=H[6],Ye=H[7],ut=H[8],At=H[9],Rt=H[10],xr=H[11],Ar=H[12],Ke=H[13],Xr=H[14],Yr=H[15],wn=Ue[0],cr=Ue[1],Mr=Ue[2],gt=Ue[3];return w[0]=wn*et+cr*Gt+Mr*ut+gt*Ar,w[1]=wn*st+cr*Tr+Mr*At+gt*Ke,w[2]=wn*Ct+cr*Ir+Mr*Rt+gt*Xr,w[3]=wn*$+cr*Ye+Mr*xr+gt*Yr,wn=Ue[4],cr=Ue[5],Mr=Ue[6],gt=Ue[7],w[4]=wn*et+cr*Gt+Mr*ut+gt*Ar,w[5]=wn*st+cr*Tr+Mr*At+gt*Ke,w[6]=wn*Ct+cr*Ir+Mr*Rt+gt*Xr,w[7]=wn*$+cr*Ye+Mr*xr+gt*Yr,wn=Ue[8],cr=Ue[9],Mr=Ue[10],gt=Ue[11],w[8]=wn*et+cr*Gt+Mr*ut+gt*Ar,w[9]=wn*st+cr*Tr+Mr*At+gt*Ke,w[10]=wn*Ct+cr*Ir+Mr*Rt+gt*Xr,w[11]=wn*$+cr*Ye+Mr*xr+gt*Yr,wn=Ue[12],cr=Ue[13],Mr=Ue[14],gt=Ue[15],w[12]=wn*et+cr*Gt+Mr*ut+gt*Ar,w[13]=wn*st+cr*Tr+Mr*At+gt*Ke,w[14]=wn*Ct+cr*Ir+Mr*Rt+gt*Xr,w[15]=wn*$+cr*Ye+Mr*xr+gt*Yr,w}function Cr(w,H,Ue){var et=Ue[0],st=Ue[1],Ct=Ue[2],$,Gt,Tr,Ir,Ye,ut,At,Rt,xr,Ar,Ke,Xr;return H===w?(w[12]=H[0]*et+H[4]*st+H[8]*Ct+H[12],w[13]=H[1]*et+H[5]*st+H[9]*Ct+H[13],w[14]=H[2]*et+H[6]*st+H[10]*Ct+H[14],w[15]=H[3]*et+H[7]*st+H[11]*Ct+H[15]):($=H[0],Gt=H[1],Tr=H[2],Ir=H[3],Ye=H[4],ut=H[5],At=H[6],Rt=H[7],xr=H[8],Ar=H[9],Ke=H[10],Xr=H[11],w[0]=$,w[1]=Gt,w[2]=Tr,w[3]=Ir,w[4]=Ye,w[5]=ut,w[6]=At,w[7]=Rt,w[8]=xr,w[9]=Ar,w[10]=Ke,w[11]=Xr,w[12]=$*et+Ye*st+xr*Ct+H[12],w[13]=Gt*et+ut*st+Ar*Ct+H[13],w[14]=Tr*et+At*st+Ke*Ct+H[14],w[15]=Ir*et+Rt*st+Xr*Ct+H[15]),w}function Qt(w,H,Ue){var et=Ue[0],st=Ue[1],Ct=Ue[2];return w[0]=H[0]*et,w[1]=H[1]*et,w[2]=H[2]*et,w[3]=H[3]*et,w[4]=H[4]*st,w[5]=H[5]*st,w[6]=H[6]*st,w[7]=H[7]*st,w[8]=H[8]*Ct,w[9]=H[9]*Ct,w[10]=H[10]*Ct,w[11]=H[11]*Ct,w[12]=H[12],w[13]=H[13],w[14]=H[14],w[15]=H[15],w}function Xt(w,H,Ue,et){var st=et[0],Ct=et[1],$=et[2],Gt=Math.hypot(st,Ct,$),Tr,Ir,Ye,ut,At,Rt,xr,Ar,Ke,Xr,Yr,wn,cr,Mr,gt,Gn,Mn,kr,Y,le,ve,B,ee,de;return Gt<ce.Ib?null:(Gt=1/Gt,st*=Gt,Ct*=Gt,$*=Gt,Tr=Math.sin(Ue),Ir=Math.cos(Ue),Ye=1-Ir,ut=H[0],At=H[1],Rt=H[2],xr=H[3],Ar=H[4],Ke=H[5],Xr=H[6],Yr=H[7],wn=H[8],cr=H[9],Mr=H[10],gt=H[11],Gn=st*st*Ye+Ir,Mn=Ct*st*Ye+$*Tr,kr=$*st*Ye-Ct*Tr,Y=st*Ct*Ye-$*Tr,le=Ct*Ct*Ye+Ir,ve=$*Ct*Ye+st*Tr,B=st*$*Ye+Ct*Tr,ee=Ct*$*Ye-st*Tr,de=$*$*Ye+Ir,w[0]=ut*Gn+Ar*Mn+wn*kr,w[1]=At*Gn+Ke*Mn+cr*kr,w[2]=Rt*Gn+Xr*Mn+Mr*kr,w[3]=xr*Gn+Yr*Mn+gt*kr,w[4]=ut*Y+Ar*le+wn*ve,w[5]=At*Y+Ke*le+cr*ve,w[6]=Rt*Y+Xr*le+Mr*ve,w[7]=xr*Y+Yr*le+gt*ve,w[8]=ut*B+Ar*ee+wn*de,w[9]=At*B+Ke*ee+cr*de,w[10]=Rt*B+Xr*ee+Mr*de,w[11]=xr*B+Yr*ee+gt*de,H!==w&&(w[12]=H[12],w[13]=H[13],w[14]=H[14],w[15]=H[15]),w)}function rr(w,H,Ue){var et=Math.sin(Ue),st=Math.cos(Ue),Ct=H[4],$=H[5],Gt=H[6],Tr=H[7],Ir=H[8],Ye=H[9],ut=H[10],At=H[11];return H!==w&&(w[0]=H[0],w[1]=H[1],w[2]=H[2],w[3]=H[3],w[12]=H[12],w[13]=H[13],w[14]=H[14],w[15]=H[15]),w[4]=Ct*st+Ir*et,w[5]=$*st+Ye*et,w[6]=Gt*st+ut*et,w[7]=Tr*st+At*et,w[8]=Ir*st-Ct*et,w[9]=Ye*st-$*et,w[10]=ut*st-Gt*et,w[11]=At*st-Tr*et,w}function Ut(w,H,Ue){var et=Math.sin(Ue),st=Math.cos(Ue),Ct=H[0],$=H[1],Gt=H[2],Tr=H[3],Ir=H[8],Ye=H[9],ut=H[10],At=H[11];return H!==w&&(w[4]=H[4],w[5]=H[5],w[6]=H[6],w[7]=H[7],w[12]=H[12],w[13]=H[13],w[14]=H[14],w[15]=H[15]),w[0]=Ct*st-Ir*et,w[1]=$*st-Ye*et,w[2]=Gt*st-ut*et,w[3]=Tr*st-At*et,w[8]=Ct*et+Ir*st,w[9]=$*et+Ye*st,w[10]=Gt*et+ut*st,w[11]=Tr*et+At*st,w}function St(w,H,Ue){var et=Math.sin(Ue),st=Math.cos(Ue),Ct=H[0],$=H[1],Gt=H[2],Tr=H[3],Ir=H[4],Ye=H[5],ut=H[6],At=H[7];return H!==w&&(w[8]=H[8],w[9]=H[9],w[10]=H[10],w[11]=H[11],w[12]=H[12],w[13]=H[13],w[14]=H[14],w[15]=H[15]),w[0]=Ct*st+Ir*et,w[1]=$*st+Ye*et,w[2]=Gt*st+ut*et,w[3]=Tr*st+At*et,w[4]=Ir*st-Ct*et,w[5]=Ye*st-$*et,w[6]=ut*st-Gt*et,w[7]=At*st-Tr*et,w}function Et(w,H){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=H[0],w[13]=H[1],w[14]=H[2],w[15]=1,w}function yr(w,H){return w[0]=H[0],w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=H[1],w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=H[2],w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function q(w,H,Ue){var et=Ue[0],st=Ue[1],Ct=Ue[2],$=Math.hypot(et,st,Ct),Gt,Tr,Ir;return $<ce.Ib?null:($=1/$,et*=$,st*=$,Ct*=$,Gt=Math.sin(H),Tr=Math.cos(H),Ir=1-Tr,w[0]=et*et*Ir+Tr,w[1]=st*et*Ir+Ct*Gt,w[2]=Ct*et*Ir-st*Gt,w[3]=0,w[4]=et*st*Ir-Ct*Gt,w[5]=st*st*Ir+Tr,w[6]=Ct*st*Ir+et*Gt,w[7]=0,w[8]=et*Ct*Ir+st*Gt,w[9]=st*Ct*Ir-et*Gt,w[10]=Ct*Ct*Ir+Tr,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w)}function hr(w,H){var Ue=Math.sin(H),et=Math.cos(H);return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=et,w[6]=Ue,w[7]=0,w[8]=0,w[9]=-Ue,w[10]=et,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function wt(w,H){var Ue=Math.sin(H),et=Math.cos(H);return w[0]=et,w[1]=0,w[2]=-Ue,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=Ue,w[9]=0,w[10]=et,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function $e(w,H){var Ue=Math.sin(H),et=Math.cos(H);return w[0]=et,w[1]=Ue,w[2]=0,w[3]=0,w[4]=-Ue,w[5]=et,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function Ft(w,H,Ue){var et=H[0],st=H[1],Ct=H[2],$=H[3],Gt=et+et,Tr=st+st,Ir=Ct+Ct,Ye=et*Gt,ut=et*Tr,At=et*Ir,Rt=st*Tr,xr=st*Ir,Ar=Ct*Ir,Ke=$*Gt,Xr=$*Tr,Yr=$*Ir;return w[0]=1-(Rt+Ar),w[1]=ut+Yr,w[2]=At-Xr,w[3]=0,w[4]=ut-Yr,w[5]=1-(Ye+Ar),w[6]=xr+Ke,w[7]=0,w[8]=At+Xr,w[9]=xr-Ke,w[10]=1-(Ye+Rt),w[11]=0,w[12]=Ue[0],w[13]=Ue[1],w[14]=Ue[2],w[15]=1,w}function Xe(w,H){var Ue=new ce.WT(3),et=-H[0],st=-H[1],Ct=-H[2],$=H[3],Gt=H[4],Tr=H[5],Ir=H[6],Ye=H[7],ut=et*et+st*st+Ct*Ct+$*$;return ut>0?(Ue[0]=(Gt*$+Ye*et+Tr*Ct-Ir*st)*2/ut,Ue[1]=(Tr*$+Ye*st+Ir*et-Gt*Ct)*2/ut,Ue[2]=(Ir*$+Ye*Ct+Gt*st-Tr*et)*2/ut):(Ue[0]=(Gt*$+Ye*et+Tr*Ct-Ir*st)*2,Ue[1]=(Tr*$+Ye*st+Ir*et-Gt*Ct)*2,Ue[2]=(Ir*$+Ye*Ct+Gt*st-Tr*et)*2),Ft(w,H,Ue),w}function jt(w,H){return w[0]=H[12],w[1]=H[13],w[2]=H[14],w}function br(w,H){var Ue=H[0],et=H[1],st=H[2],Ct=H[4],$=H[5],Gt=H[6],Tr=H[8],Ir=H[9],Ye=H[10];return w[0]=Math.hypot(Ue,et,st),w[1]=Math.hypot(Ct,$,Gt),w[2]=Math.hypot(Tr,Ir,Ye),w}function sr(w,H){var Ue=new ce.WT(3);br(Ue,H);var et=1/Ue[0],st=1/Ue[1],Ct=1/Ue[2],$=H[0]*et,Gt=H[1]*st,Tr=H[2]*Ct,Ir=H[4]*et,Ye=H[5]*st,ut=H[6]*Ct,At=H[8]*et,Rt=H[9]*st,xr=H[10]*Ct,Ar=$+Ye+xr,Ke=0;return Ar>0?(Ke=Math.sqrt(Ar+1)*2,w[3]=.25*Ke,w[0]=(ut-Rt)/Ke,w[1]=(At-Tr)/Ke,w[2]=(Gt-Ir)/Ke):$>Ye&&$>xr?(Ke=Math.sqrt(1+$-Ye-xr)*2,w[3]=(ut-Rt)/Ke,w[0]=.25*Ke,w[1]=(Gt+Ir)/Ke,w[2]=(At+Tr)/Ke):Ye>xr?(Ke=Math.sqrt(1+Ye-$-xr)*2,w[3]=(At-Tr)/Ke,w[0]=(Gt+Ir)/Ke,w[1]=.25*Ke,w[2]=(ut+Rt)/Ke):(Ke=Math.sqrt(1+xr-$-Ye)*2,w[3]=(Gt-Ir)/Ke,w[0]=(At+Tr)/Ke,w[1]=(ut+Rt)/Ke,w[2]=.25*Ke),w}function j(w,H,Ue,et){var st=H[0],Ct=H[1],$=H[2],Gt=H[3],Tr=st+st,Ir=Ct+Ct,Ye=$+$,ut=st*Tr,At=st*Ir,Rt=st*Ye,xr=Ct*Ir,Ar=Ct*Ye,Ke=$*Ye,Xr=Gt*Tr,Yr=Gt*Ir,wn=Gt*Ye,cr=et[0],Mr=et[1],gt=et[2];return w[0]=(1-(xr+Ke))*cr,w[1]=(At+wn)*cr,w[2]=(Rt-Yr)*cr,w[3]=0,w[4]=(At-wn)*Mr,w[5]=(1-(ut+Ke))*Mr,w[6]=(Ar+Xr)*Mr,w[7]=0,w[8]=(Rt+Yr)*gt,w[9]=(Ar-Xr)*gt,w[10]=(1-(ut+xr))*gt,w[11]=0,w[12]=Ue[0],w[13]=Ue[1],w[14]=Ue[2],w[15]=1,w}function ie(w,H,Ue,et,st){var Ct=H[0],$=H[1],Gt=H[2],Tr=H[3],Ir=Ct+Ct,Ye=$+$,ut=Gt+Gt,At=Ct*Ir,Rt=Ct*Ye,xr=Ct*ut,Ar=$*Ye,Ke=$*ut,Xr=Gt*ut,Yr=Tr*Ir,wn=Tr*Ye,cr=Tr*ut,Mr=et[0],gt=et[1],Gn=et[2],Mn=st[0],kr=st[1],Y=st[2],le=(1-(Ar+Xr))*Mr,ve=(Rt+cr)*Mr,B=(xr-wn)*Mr,ee=(Rt-cr)*gt,de=(1-(At+Xr))*gt,Ae=(Ke+Yr)*gt,ae=(xr+wn)*Gn,_e=(Ke-Yr)*Gn,ct=(1-(At+Ar))*Gn;return w[0]=le,w[1]=ve,w[2]=B,w[3]=0,w[4]=ee,w[5]=de,w[6]=Ae,w[7]=0,w[8]=ae,w[9]=_e,w[10]=ct,w[11]=0,w[12]=Ue[0]+Mn-(le*Mn+ee*kr+ae*Y),w[13]=Ue[1]+kr-(ve*Mn+de*kr+_e*Y),w[14]=Ue[2]+Y-(B*Mn+Ae*kr+ct*Y),w[15]=1,w}function Re(w,H){var Ue=H[0],et=H[1],st=H[2],Ct=H[3],$=Ue+Ue,Gt=et+et,Tr=st+st,Ir=Ue*$,Ye=et*$,ut=et*Gt,At=st*$,Rt=st*Gt,xr=st*Tr,Ar=Ct*$,Ke=Ct*Gt,Xr=Ct*Tr;return w[0]=1-ut-xr,w[1]=Ye+Xr,w[2]=At-Ke,w[3]=0,w[4]=Ye-Xr,w[5]=1-Ir-xr,w[6]=Rt+Ar,w[7]=0,w[8]=At+Ke,w[9]=Rt-Ar,w[10]=1-Ir-ut,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function ye(w,H,Ue,et,st,Ct,$){var Gt=1/(Ue-H),Tr=1/(st-et),Ir=1/(Ct-$);return w[0]=Ct*2*Gt,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=Ct*2*Tr,w[6]=0,w[7]=0,w[8]=(Ue+H)*Gt,w[9]=(st+et)*Tr,w[10]=($+Ct)*Ir,w[11]=-1,w[12]=0,w[13]=0,w[14]=$*Ct*2*Ir,w[15]=0,w}function _t(w,H,Ue,et,st){var Ct=1/Math.tan(H/2),$;return w[0]=Ct/Ue,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=Ct,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=-1,w[12]=0,w[13]=0,w[15]=0,st!=null&&st!==Infinity?($=1/(et-st),w[10]=(st+et)*$,w[14]=2*st*et*$):(w[10]=-1,w[14]=-2*et),w}var dt=_t;function zt(w,H,Ue,et,st){var Ct=1/Math.tan(H/2),$;return w[0]=Ct/Ue,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=Ct,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=-1,w[12]=0,w[13]=0,w[15]=0,st!=null&&st!==Infinity?($=1/(et-st),w[10]=st*$,w[14]=st*et*$):(w[10]=-1,w[14]=-et),w}function Bt(w,H,Ue,et){var st=Math.tan(H.upDegrees*Math.PI/180),Ct=Math.tan(H.downDegrees*Math.PI/180),$=Math.tan(H.leftDegrees*Math.PI/180),Gt=Math.tan(H.rightDegrees*Math.PI/180),Tr=2/($+Gt),Ir=2/(st+Ct);return w[0]=Tr,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=Ir,w[6]=0,w[7]=0,w[8]=-(($-Gt)*Tr*.5),w[9]=(st-Ct)*Ir*.5,w[10]=et/(Ue-et),w[11]=-1,w[12]=0,w[13]=0,w[14]=et*Ue/(Ue-et),w[15]=0,w}function Ur(w,H,Ue,et,st,Ct,$){var Gt=1/(H-Ue),Tr=1/(et-st),Ir=1/(Ct-$);return w[0]=-2*Gt,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=-2*Tr,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=2*Ir,w[11]=0,w[12]=(H+Ue)*Gt,w[13]=(st+et)*Tr,w[14]=($+Ct)*Ir,w[15]=1,w}var vn=Ur;function En(w,H,Ue,et,st,Ct,$){var Gt=1/(H-Ue),Tr=1/(et-st),Ir=1/(Ct-$);return w[0]=-2*Gt,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=-2*Tr,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=Ir,w[11]=0,w[12]=(H+Ue)*Gt,w[13]=(st+et)*Tr,w[14]=Ct*Ir,w[15]=1,w}function ea(w,H,Ue,et){var st,Ct,$,Gt,Tr,Ir,Ye,ut,At,Rt,xr=H[0],Ar=H[1],Ke=H[2],Xr=et[0],Yr=et[1],wn=et[2],cr=Ue[0],Mr=Ue[1],gt=Ue[2];return Math.abs(xr-cr)<ce.Ib&&Math.abs(Ar-Mr)<ce.Ib&&Math.abs(Ke-gt)<ce.Ib?oe(w):(Ye=xr-cr,ut=Ar-Mr,At=Ke-gt,Rt=1/Math.hypot(Ye,ut,At),Ye*=Rt,ut*=Rt,At*=Rt,st=Yr*At-wn*ut,Ct=wn*Ye-Xr*At,$=Xr*ut-Yr*Ye,Rt=Math.hypot(st,Ct,$),Rt?(Rt=1/Rt,st*=Rt,Ct*=Rt,$*=Rt):(st=0,Ct=0,$=0),Gt=ut*$-At*Ct,Tr=At*st-Ye*$,Ir=Ye*Ct-ut*st,Rt=Math.hypot(Gt,Tr,Ir),Rt?(Rt=1/Rt,Gt*=Rt,Tr*=Rt,Ir*=Rt):(Gt=0,Tr=0,Ir=0),w[0]=st,w[1]=Gt,w[2]=Ye,w[3]=0,w[4]=Ct,w[5]=Tr,w[6]=ut,w[7]=0,w[8]=$,w[9]=Ir,w[10]=At,w[11]=0,w[12]=-(st*xr+Ct*Ar+$*Ke),w[13]=-(Gt*xr+Tr*Ar+Ir*Ke),w[14]=-(Ye*xr+ut*Ar+At*Ke),w[15]=1,w)}function ar(w,H,Ue,et){var st=H[0],Ct=H[1],$=H[2],Gt=et[0],Tr=et[1],Ir=et[2],Ye=st-Ue[0],ut=Ct-Ue[1],At=$-Ue[2],Rt=Ye*Ye+ut*ut+At*At;Rt>0&&(Rt=1/Math.sqrt(Rt),Ye*=Rt,ut*=Rt,At*=Rt);var xr=Tr*At-Ir*ut,Ar=Ir*Ye-Gt*At,Ke=Gt*ut-Tr*Ye;return Rt=xr*xr+Ar*Ar+Ke*Ke,Rt>0&&(Rt=1/Math.sqrt(Rt),xr*=Rt,Ar*=Rt,Ke*=Rt),w[0]=xr,w[1]=Ar,w[2]=Ke,w[3]=0,w[4]=ut*Ke-At*Ar,w[5]=At*xr-Ye*Ke,w[6]=Ye*Ar-ut*xr,w[7]=0,w[8]=Ye,w[9]=ut,w[10]=At,w[11]=0,w[12]=st,w[13]=Ct,w[14]=$,w[15]=1,w}function ge(w){return"mat4("+w[0]+", "+w[1]+", "+w[2]+", "+w[3]+", "+w[4]+", "+w[5]+", "+w[6]+", "+w[7]+", "+w[8]+", "+w[9]+", "+w[10]+", "+w[11]+", "+w[12]+", "+w[13]+", "+w[14]+", "+w[15]+")"}function Te(w){return Math.hypot(w[0],w[1],w[2],w[3],w[4],w[5],w[6],w[7],w[8],w[9],w[10],w[11],w[12],w[13],w[14],w[15])}function Ze(w,H,Ue){return w[0]=H[0]+Ue[0],w[1]=H[1]+Ue[1],w[2]=H[2]+Ue[2],w[3]=H[3]+Ue[3],w[4]=H[4]+Ue[4],w[5]=H[5]+Ue[5],w[6]=H[6]+Ue[6],w[7]=H[7]+Ue[7],w[8]=H[8]+Ue[8],w[9]=H[9]+Ue[9],w[10]=H[10]+Ue[10],w[11]=H[11]+Ue[11],w[12]=H[12]+Ue[12],w[13]=H[13]+Ue[13],w[14]=H[14]+Ue[14],w[15]=H[15]+Ue[15],w}function Oe(w,H,Ue){return w[0]=H[0]-Ue[0],w[1]=H[1]-Ue[1],w[2]=H[2]-Ue[2],w[3]=H[3]-Ue[3],w[4]=H[4]-Ue[4],w[5]=H[5]-Ue[5],w[6]=H[6]-Ue[6],w[7]=H[7]-Ue[7],w[8]=H[8]-Ue[8],w[9]=H[9]-Ue[9],w[10]=H[10]-Ue[10],w[11]=H[11]-Ue[11],w[12]=H[12]-Ue[12],w[13]=H[13]-Ue[13],w[14]=H[14]-Ue[14],w[15]=H[15]-Ue[15],w}function Lt(w,H,Ue){return w[0]=H[0]*Ue,w[1]=H[1]*Ue,w[2]=H[2]*Ue,w[3]=H[3]*Ue,w[4]=H[4]*Ue,w[5]=H[5]*Ue,w[6]=H[6]*Ue,w[7]=H[7]*Ue,w[8]=H[8]*Ue,w[9]=H[9]*Ue,w[10]=H[10]*Ue,w[11]=H[11]*Ue,w[12]=H[12]*Ue,w[13]=H[13]*Ue,w[14]=H[14]*Ue,w[15]=H[15]*Ue,w}function nr(w,H,Ue,et){return w[0]=H[0]+Ue[0]*et,w[1]=H[1]+Ue[1]*et,w[2]=H[2]+Ue[2]*et,w[3]=H[3]+Ue[3]*et,w[4]=H[4]+Ue[4]*et,w[5]=H[5]+Ue[5]*et,w[6]=H[6]+Ue[6]*et,w[7]=H[7]+Ue[7]*et,w[8]=H[8]+Ue[8]*et,w[9]=H[9]+Ue[9]*et,w[10]=H[10]+Ue[10]*et,w[11]=H[11]+Ue[11]*et,w[12]=H[12]+Ue[12]*et,w[13]=H[13]+Ue[13]*et,w[14]=H[14]+Ue[14]*et,w[15]=H[15]+Ue[15]*et,w}function dr(w,H){return w[0]===H[0]&&w[1]===H[1]&&w[2]===H[2]&&w[3]===H[3]&&w[4]===H[4]&&w[5]===H[5]&&w[6]===H[6]&&w[7]===H[7]&&w[8]===H[8]&&w[9]===H[9]&&w[10]===H[10]&&w[11]===H[11]&&w[12]===H[12]&&w[13]===H[13]&&w[14]===H[14]&&w[15]===H[15]}function Or(w,H){var Ue=w[0],et=w[1],st=w[2],Ct=w[3],$=w[4],Gt=w[5],Tr=w[6],Ir=w[7],Ye=w[8],ut=w[9],At=w[10],Rt=w[11],xr=w[12],Ar=w[13],Ke=w[14],Xr=w[15],Yr=H[0],wn=H[1],cr=H[2],Mr=H[3],gt=H[4],Gn=H[5],Mn=H[6],kr=H[7],Y=H[8],le=H[9],ve=H[10],B=H[11],ee=H[12],de=H[13],Ae=H[14],ae=H[15];return Math.abs(Ue-Yr)<=ce.Ib*Math.max(1,Math.abs(Ue),Math.abs(Yr))&&Math.abs(et-wn)<=ce.Ib*Math.max(1,Math.abs(et),Math.abs(wn))&&Math.abs(st-cr)<=ce.Ib*Math.max(1,Math.abs(st),Math.abs(cr))&&Math.abs(Ct-Mr)<=ce.Ib*Math.max(1,Math.abs(Ct),Math.abs(Mr))&&Math.abs($-gt)<=ce.Ib*Math.max(1,Math.abs($),Math.abs(gt))&&Math.abs(Gt-Gn)<=ce.Ib*Math.max(1,Math.abs(Gt),Math.abs(Gn))&&Math.abs(Tr-Mn)<=ce.Ib*Math.max(1,Math.abs(Tr),Math.abs(Mn))&&Math.abs(Ir-kr)<=ce.Ib*Math.max(1,Math.abs(Ir),Math.abs(kr))&&Math.abs(Ye-Y)<=ce.Ib*Math.max(1,Math.abs(Ye),Math.abs(Y))&&Math.abs(ut-le)<=ce.Ib*Math.max(1,Math.abs(ut),Math.abs(le))&&Math.abs(At-ve)<=ce.Ib*Math.max(1,Math.abs(At),Math.abs(ve))&&Math.abs(Rt-B)<=ce.Ib*Math.max(1,Math.abs(Rt),Math.abs(B))&&Math.abs(xr-ee)<=ce.Ib*Math.max(1,Math.abs(xr),Math.abs(ee))&&Math.abs(Ar-de)<=ce.Ib*Math.max(1,Math.abs(Ar),Math.abs(de))&&Math.abs(Ke-Ae)<=ce.Ib*Math.max(1,Math.abs(Ke),Math.abs(Ae))&&Math.abs(Xr-ae)<=ce.Ib*Math.max(1,Math.abs(Xr),Math.abs(ae))}var lr=Zt,un=Oe},98333:function(zr,N,S){"use strict";S.d(N,{Ue:function(){return E},al:function(){return me},bA:function(){return rr},fF:function(){return sr}});var ce=S(49685);function E(){var ge=new ce.WT(4);return ce.WT!=Float32Array&&(ge[0]=0,ge[1]=0,ge[2]=0,ge[3]=0),ge}function d(ge){var Te=new glMatrix.ARRAY_TYPE(4);return Te[0]=ge[0],Te[1]=ge[1],Te[2]=ge[2],Te[3]=ge[3],Te}function me(ge,Te,Ze,Oe){var Lt=new ce.WT(4);return Lt[0]=ge,Lt[1]=Te,Lt[2]=Ze,Lt[3]=Oe,Lt}function te(ge,Te){return ge[0]=Te[0],ge[1]=Te[1],ge[2]=Te[2],ge[3]=Te[3],ge}function ue(ge,Te,Ze,Oe,Lt){return ge[0]=Te,ge[1]=Ze,ge[2]=Oe,ge[3]=Lt,ge}function oe(ge,Te,Ze){return ge[0]=Te[0]+Ze[0],ge[1]=Te[1]+Ze[1],ge[2]=Te[2]+Ze[2],ge[3]=Te[3]+Ze[3],ge}function Ne(ge,Te,Ze){return ge[0]=Te[0]-Ze[0],ge[1]=Te[1]-Ze[1],ge[2]=Te[2]-Ze[2],ge[3]=Te[3]-Ze[3],ge}function K(ge,Te,Ze){return ge[0]=Te[0]*Ze[0],ge[1]=Te[1]*Ze[1],ge[2]=Te[2]*Ze[2],ge[3]=Te[3]*Ze[3],ge}function Qe(ge,Te,Ze){return ge[0]=Te[0]/Ze[0],ge[1]=Te[1]/Ze[1],ge[2]=Te[2]/Ze[2],ge[3]=Te[3]/Ze[3],ge}function mt(ge,Te){return ge[0]=Math.ceil(Te[0]),ge[1]=Math.ceil(Te[1]),ge[2]=Math.ceil(Te[2]),ge[3]=Math.ceil(Te[3]),ge}function Zt(ge,Te){return ge[0]=Math.floor(Te[0]),ge[1]=Math.floor(Te[1]),ge[2]=Math.floor(Te[2]),ge[3]=Math.floor(Te[3]),ge}function Cr(ge,Te,Ze){return ge[0]=Math.min(Te[0],Ze[0]),ge[1]=Math.min(Te[1],Ze[1]),ge[2]=Math.min(Te[2],Ze[2]),ge[3]=Math.min(Te[3],Ze[3]),ge}function Qt(ge,Te,Ze){return ge[0]=Math.max(Te[0],Ze[0]),ge[1]=Math.max(Te[1],Ze[1]),ge[2]=Math.max(Te[2],Ze[2]),ge[3]=Math.max(Te[3],Ze[3]),ge}function Xt(ge,Te){return ge[0]=Math.round(Te[0]),ge[1]=Math.round(Te[1]),ge[2]=Math.round(Te[2]),ge[3]=Math.round(Te[3]),ge}function rr(ge,Te,Ze){return ge[0]=Te[0]*Ze,ge[1]=Te[1]*Ze,ge[2]=Te[2]*Ze,ge[3]=Te[3]*Ze,ge}function Ut(ge,Te,Ze,Oe){return ge[0]=Te[0]+Ze[0]*Oe,ge[1]=Te[1]+Ze[1]*Oe,ge[2]=Te[2]+Ze[2]*Oe,ge[3]=Te[3]+Ze[3]*Oe,ge}function St(ge,Te){var Ze=Te[0]-ge[0],Oe=Te[1]-ge[1],Lt=Te[2]-ge[2],nr=Te[3]-ge[3];return Math.hypot(Ze,Oe,Lt,nr)}function Et(ge,Te){var Ze=Te[0]-ge[0],Oe=Te[1]-ge[1],Lt=Te[2]-ge[2],nr=Te[3]-ge[3];return Ze*Ze+Oe*Oe+Lt*Lt+nr*nr}function yr(ge){var Te=ge[0],Ze=ge[1],Oe=ge[2],Lt=ge[3];return Math.hypot(Te,Ze,Oe,Lt)}function q(ge){var Te=ge[0],Ze=ge[1],Oe=ge[2],Lt=ge[3];return Te*Te+Ze*Ze+Oe*Oe+Lt*Lt}function hr(ge,Te){return ge[0]=-Te[0],ge[1]=-Te[1],ge[2]=-Te[2],ge[3]=-Te[3],ge}function wt(ge,Te){return ge[0]=1/Te[0],ge[1]=1/Te[1],ge[2]=1/Te[2],ge[3]=1/Te[3],ge}function $e(ge,Te){var Ze=Te[0],Oe=Te[1],Lt=Te[2],nr=Te[3],dr=Ze*Ze+Oe*Oe+Lt*Lt+nr*nr;return dr>0&&(dr=1/Math.sqrt(dr)),ge[0]=Ze*dr,ge[1]=Oe*dr,ge[2]=Lt*dr,ge[3]=nr*dr,ge}function Ft(ge,Te){return ge[0]*Te[0]+ge[1]*Te[1]+ge[2]*Te[2]+ge[3]*Te[3]}function Xe(ge,Te,Ze,Oe){var Lt=Ze[0]*Oe[1]-Ze[1]*Oe[0],nr=Ze[0]*Oe[2]-Ze[2]*Oe[0],dr=Ze[0]*Oe[3]-Ze[3]*Oe[0],Or=Ze[1]*Oe[2]-Ze[2]*Oe[1],lr=Ze[1]*Oe[3]-Ze[3]*Oe[1],un=Ze[2]*Oe[3]-Ze[3]*Oe[2],w=Te[0],H=Te[1],Ue=Te[2],et=Te[3];return ge[0]=H*un-Ue*lr+et*Or,ge[1]=-(w*un)+Ue*dr-et*nr,ge[2]=w*lr-H*dr+et*Lt,ge[3]=-(w*Or)+H*nr-Ue*Lt,ge}function jt(ge,Te,Ze,Oe){var Lt=Te[0],nr=Te[1],dr=Te[2],Or=Te[3];return ge[0]=Lt+Oe*(Ze[0]-Lt),ge[1]=nr+Oe*(Ze[1]-nr),ge[2]=dr+Oe*(Ze[2]-dr),ge[3]=Or+Oe*(Ze[3]-Or),ge}function br(ge,Te){Te=Te||1;var Ze,Oe,Lt,nr,dr,Or;do Ze=glMatrix.RANDOM()*2-1,Oe=glMatrix.RANDOM()*2-1,dr=Ze*Ze+Oe*Oe;while(dr>=1);do Lt=glMatrix.RANDOM()*2-1,nr=glMatrix.RANDOM()*2-1,Or=Lt*Lt+nr*nr;while(Or>=1);var lr=Math.sqrt((1-dr)/Or);return ge[0]=Te*Ze,ge[1]=Te*Oe,ge[2]=Te*Lt*lr,ge[3]=Te*nr*lr,ge}function sr(ge,Te,Ze){var Oe=Te[0],Lt=Te[1],nr=Te[2],dr=Te[3];return ge[0]=Ze[0]*Oe+Ze[4]*Lt+Ze[8]*nr+Ze[12]*dr,ge[1]=Ze[1]*Oe+Ze[5]*Lt+Ze[9]*nr+Ze[13]*dr,ge[2]=Ze[2]*Oe+Ze[6]*Lt+Ze[10]*nr+Ze[14]*dr,ge[3]=Ze[3]*Oe+Ze[7]*Lt+Ze[11]*nr+Ze[15]*dr,ge}function j(ge,Te,Ze){var Oe=Te[0],Lt=Te[1],nr=Te[2],dr=Ze[0],Or=Ze[1],lr=Ze[2],un=Ze[3],w=un*Oe+Or*nr-lr*Lt,H=un*Lt+lr*Oe-dr*nr,Ue=un*nr+dr*Lt-Or*Oe,et=-dr*Oe-Or*Lt-lr*nr;return ge[0]=w*un+et*-dr+H*-lr-Ue*-Or,ge[1]=H*un+et*-Or+Ue*-dr-w*-lr,ge[2]=Ue*un+et*-lr+w*-Or-H*-dr,ge[3]=Te[3],ge}function ie(ge){return ge[0]=0,ge[1]=0,ge[2]=0,ge[3]=0,ge}function Re(ge){return"vec4("+ge[0]+", "+ge[1]+", "+ge[2]+", "+ge[3]+")"}function ye(ge,Te){return ge[0]===Te[0]&&ge[1]===Te[1]&&ge[2]===Te[2]&&ge[3]===Te[3]}function _t(ge,Te){var Ze=ge[0],Oe=ge[1],Lt=ge[2],nr=ge[3],dr=Te[0],Or=Te[1],lr=Te[2],un=Te[3];return Math.abs(Ze-dr)<=glMatrix.EPSILON*Math.max(1,Math.abs(Ze),Math.abs(dr))&&Math.abs(Oe-Or)<=glMatrix.EPSILON*Math.max(1,Math.abs(Oe),Math.abs(Or))&&Math.abs(Lt-lr)<=glMatrix.EPSILON*Math.max(1,Math.abs(Lt),Math.abs(lr))&&Math.abs(nr-un)<=glMatrix.EPSILON*Math.max(1,Math.abs(nr),Math.abs(un))}var dt=null,zt=null,Bt=null,Ur=null,vn=null,En=null,ea=null,ar=function(){var ge=E();return function(Te,Ze,Oe,Lt,nr,dr){var Or,lr;for(Ze||(Ze=4),Oe||(Oe=0),Lt?lr=Math.min(Lt*Ze+Oe,Te.length):lr=Te.length,Or=Oe;Or<lr;Or+=Ze)ge[0]=Te[Or],ge[1]=Te[Or+1],ge[2]=Te[Or+2],ge[3]=Te[Or+3],nr(ge,ge,dr),Te[Or]=ge[0],Te[Or+1]=ge[1],Te[Or+2]=ge[2],Te[Or+3]=ge[3];return Te}}()},50840:function(zr,N,S){var ce;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(E,d,me,te){"use strict";var ue=["","webkit","Moz","MS","ms","o"],oe=d.createElement("div"),Ne="function",K=Math.round,Qe=Math.abs,mt=Date.now;function Zt(Se,ke,ft){return setTimeout(yr(Se,ft),ke)}function Cr(Se,ke,ft){return Array.isArray(Se)?(Qt(Se,ft[ke],ft),!0):!1}function Qt(Se,ke,ft){var L;if(!!Se)if(Se.forEach)Se.forEach(ke,ft);else if(Se.length!==te)for(L=0;L<Se.length;)ke.call(ft,Se[L],L,Se),L++;else for(L in Se)Se.hasOwnProperty(L)&&ke.call(ft,Se[L],L,Se)}function Xt(Se,ke,ft){var L="DEPRECATED METHOD: "+ke+`
`+ft+` AT 
`;return function(){var Qr=new Error("get-stack-trace"),ai=Qr&&Qr.stack?Qr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",wi=E.console&&(E.console.warn||E.console.log);return wi&&wi.call(E.console,L,ai),Se.apply(this,arguments)}}var rr;typeof Object.assign!="function"?rr=function(ke){if(ke===te||ke===null)throw new TypeError("Cannot convert undefined or null to object");for(var ft=Object(ke),L=1;L<arguments.length;L++){var Qr=arguments[L];if(Qr!==te&&Qr!==null)for(var ai in Qr)Qr.hasOwnProperty(ai)&&(ft[ai]=Qr[ai])}return ft}:rr=Object.assign;var Ut=Xt(function(ke,ft,L){for(var Qr=Object.keys(ft),ai=0;ai<Qr.length;)(!L||L&&ke[Qr[ai]]===te)&&(ke[Qr[ai]]=ft[Qr[ai]]),ai++;return ke},"extend","Use `assign`."),St=Xt(function(ke,ft){return Ut(ke,ft,!0)},"merge","Use `assign`.");function Et(Se,ke,ft){var L=ke.prototype,Qr;Qr=Se.prototype=Object.create(L),Qr.constructor=Se,Qr._super=L,ft&&rr(Qr,ft)}function yr(Se,ke){return function(){return Se.apply(ke,arguments)}}function q(Se,ke){return typeof Se==Ne?Se.apply(ke&&ke[0]||te,ke):Se}function hr(Se,ke){return Se===te?ke:Se}function wt(Se,ke,ft){Qt(jt(ke),function(L){Se.addEventListener(L,ft,!1)})}function $e(Se,ke,ft){Qt(jt(ke),function(L){Se.removeEventListener(L,ft,!1)})}function Ft(Se,ke){for(;Se;){if(Se==ke)return!0;Se=Se.parentNode}return!1}function Xe(Se,ke){return Se.indexOf(ke)>-1}function jt(Se){return Se.trim().split(/\s+/g)}function br(Se,ke,ft){if(Se.indexOf&&!ft)return Se.indexOf(ke);for(var L=0;L<Se.length;){if(ft&&Se[L][ft]==ke||!ft&&Se[L]===ke)return L;L++}return-1}function sr(Se){return Array.prototype.slice.call(Se,0)}function j(Se,ke,ft){for(var L=[],Qr=[],ai=0;ai<Se.length;){var wi=ke?Se[ai][ke]:Se[ai];br(Qr,wi)<0&&L.push(Se[ai]),Qr[ai]=wi,ai++}return ft&&(ke?L=L.sort(function(Ya,ja){return Ya[ke]>ja[ke]}):L=L.sort()),L}function ie(Se,ke){for(var ft,L,Qr=ke[0].toUpperCase()+ke.slice(1),ai=0;ai<ue.length;){if(ft=ue[ai],L=ft?ft+Qr:ke,L in Se)return L;ai++}return te}var Re=1;function ye(){return Re++}function _t(Se){var ke=Se.ownerDocument||Se;return ke.defaultView||ke.parentWindow||E}var dt=/mobile|tablet|ip(ad|hone|od)|android/i,zt="ontouchstart"in E,Bt=ie(E,"PointerEvent")!==te,Ur=zt&&dt.test(navigator.userAgent),vn="touch",En="pen",ea="mouse",ar="kinect",ge=25,Te=1,Ze=2,Oe=4,Lt=8,nr=1,dr=2,Or=4,lr=8,un=16,w=dr|Or,H=lr|un,Ue=w|H,et=["x","y"],st=["clientX","clientY"];function Ct(Se,ke){var ft=this;this.manager=Se,this.callback=ke,this.element=Se.element,this.target=Se.options.inputTarget,this.domHandler=function(L){q(Se.options.enable,[Se])&&ft.handler(L)},this.init()}Ct.prototype={handler:function(){},init:function(){this.evEl&&wt(this.element,this.evEl,this.domHandler),this.evTarget&&wt(this.target,this.evTarget,this.domHandler),this.evWin&&wt(_t(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&$e(this.element,this.evEl,this.domHandler),this.evTarget&&$e(this.target,this.evTarget,this.domHandler),this.evWin&&$e(_t(this.element),this.evWin,this.domHandler)}};function $(Se){var ke,ft=Se.options.inputClass;return ft?ke=ft:Bt?ke=le:Ur?ke=ct:zt?ke=Nr:ke=gt,new ke(Se,Gt)}function Gt(Se,ke,ft){var L=ft.pointers.length,Qr=ft.changedPointers.length,ai=ke&Te&&L-Qr==0,wi=ke&(Oe|Lt)&&L-Qr==0;ft.isFirst=!!ai,ft.isFinal=!!wi,ai&&(Se.session={}),ft.eventType=ke,Tr(Se,ft),Se.emit("hammer.input",ft),Se.recognize(ft),Se.session.prevInput=ft}function Tr(Se,ke){var ft=Se.session,L=ke.pointers,Qr=L.length;ft.firstInput||(ft.firstInput=ut(ke)),Qr>1&&!ft.firstMultiple?ft.firstMultiple=ut(ke):Qr===1&&(ft.firstMultiple=!1);var ai=ft.firstInput,wi=ft.firstMultiple,fo=wi?wi.center:ai.center,Ya=ke.center=At(L);ke.timeStamp=mt(),ke.deltaTime=ke.timeStamp-ai.timeStamp,ke.angle=Ke(fo,Ya),ke.distance=Ar(fo,Ya),Ir(ft,ke),ke.offsetDirection=xr(ke.deltaX,ke.deltaY);var ja=Rt(ke.deltaTime,ke.deltaX,ke.deltaY);ke.overallVelocityX=ja.x,ke.overallVelocityY=ja.y,ke.overallVelocity=Qe(ja.x)>Qe(ja.y)?ja.x:ja.y,ke.scale=wi?Yr(wi.pointers,L):1,ke.rotation=wi?Xr(wi.pointers,L):0,ke.maxPointers=ft.prevInput?ke.pointers.length>ft.prevInput.maxPointers?ke.pointers.length:ft.prevInput.maxPointers:ke.pointers.length,Ye(ft,ke);var us=Se.element;Ft(ke.srcEvent.target,us)&&(us=ke.srcEvent.target),ke.target=us}function Ir(Se,ke){var ft=ke.center,L=Se.offsetDelta||{},Qr=Se.prevDelta||{},ai=Se.prevInput||{};(ke.eventType===Te||ai.eventType===Oe)&&(Qr=Se.prevDelta={x:ai.deltaX||0,y:ai.deltaY||0},L=Se.offsetDelta={x:ft.x,y:ft.y}),ke.deltaX=Qr.x+(ft.x-L.x),ke.deltaY=Qr.y+(ft.y-L.y)}function Ye(Se,ke){var ft=Se.lastInterval||ke,L=ke.timeStamp-ft.timeStamp,Qr,ai,wi,fo;if(ke.eventType!=Lt&&(L>ge||ft.velocity===te)){var Ya=ke.deltaX-ft.deltaX,ja=ke.deltaY-ft.deltaY,us=Rt(L,Ya,ja);ai=us.x,wi=us.y,Qr=Qe(us.x)>Qe(us.y)?us.x:us.y,fo=xr(Ya,ja),Se.lastInterval=ke}else Qr=ft.velocity,ai=ft.velocityX,wi=ft.velocityY,fo=ft.direction;ke.velocity=Qr,ke.velocityX=ai,ke.velocityY=wi,ke.direction=fo}function ut(Se){for(var ke=[],ft=0;ft<Se.pointers.length;)ke[ft]={clientX:K(Se.pointers[ft].clientX),clientY:K(Se.pointers[ft].clientY)},ft++;return{timeStamp:mt(),pointers:ke,center:At(ke),deltaX:Se.deltaX,deltaY:Se.deltaY}}function At(Se){var ke=Se.length;if(ke===1)return{x:K(Se[0].clientX),y:K(Se[0].clientY)};for(var ft=0,L=0,Qr=0;Qr<ke;)ft+=Se[Qr].clientX,L+=Se[Qr].clientY,Qr++;return{x:K(ft/ke),y:K(L/ke)}}function Rt(Se,ke,ft){return{x:ke/Se||0,y:ft/Se||0}}function xr(Se,ke){return Se===ke?nr:Qe(Se)>=Qe(ke)?Se<0?dr:Or:ke<0?lr:un}function Ar(Se,ke,ft){ft||(ft=et);var L=ke[ft[0]]-Se[ft[0]],Qr=ke[ft[1]]-Se[ft[1]];return Math.sqrt(L*L+Qr*Qr)}function Ke(Se,ke,ft){ft||(ft=et);var L=ke[ft[0]]-Se[ft[0]],Qr=ke[ft[1]]-Se[ft[1]];return Math.atan2(Qr,L)*180/Math.PI}function Xr(Se,ke){return Ke(ke[1],ke[0],st)+Ke(Se[1],Se[0],st)}function Yr(Se,ke){return Ar(ke[0],ke[1],st)/Ar(Se[0],Se[1],st)}var wn={mousedown:Te,mousemove:Ze,mouseup:Oe},cr="mousedown",Mr="mousemove mouseup";function gt(){this.evEl=cr,this.evWin=Mr,this.pressed=!1,Ct.apply(this,arguments)}Et(gt,Ct,{handler:function(ke){var ft=wn[ke.type];ft&Te&&ke.button===0&&(this.pressed=!0),ft&Ze&&ke.which!==1&&(ft=Oe),!!this.pressed&&(ft&Oe&&(this.pressed=!1),this.callback(this.manager,ft,{pointers:[ke],changedPointers:[ke],pointerType:ea,srcEvent:ke}))}});var Gn={pointerdown:Te,pointermove:Ze,pointerup:Oe,pointercancel:Lt,pointerout:Lt},Mn={2:vn,3:En,4:ea,5:ar},kr="pointerdown",Y="pointermove pointerup pointercancel";E.MSPointerEvent&&!E.PointerEvent&&(kr="MSPointerDown",Y="MSPointerMove MSPointerUp MSPointerCancel");function le(){this.evEl=kr,this.evWin=Y,Ct.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Et(le,Ct,{handler:function(ke){var ft=this.store,L=!1,Qr=ke.type.toLowerCase().replace("ms",""),ai=Gn[Qr],wi=Mn[ke.pointerType]||ke.pointerType,fo=wi==vn,Ya=br(ft,ke.pointerId,"pointerId");ai&Te&&(ke.button===0||fo)?Ya<0&&(ft.push(ke),Ya=ft.length-1):ai&(Oe|Lt)&&(L=!0),!(Ya<0)&&(ft[Ya]=ke,this.callback(this.manager,ai,{pointers:ft,changedPointers:[ke],pointerType:wi,srcEvent:ke}),L&&ft.splice(Ya,1))}});var ve={touchstart:Te,touchmove:Ze,touchend:Oe,touchcancel:Lt},B="touchstart",ee="touchstart touchmove touchend touchcancel";function de(){this.evTarget=B,this.evWin=ee,this.started=!1,Ct.apply(this,arguments)}Et(de,Ct,{handler:function(ke){var ft=ve[ke.type];if(ft===Te&&(this.started=!0),!!this.started){var L=Ae.call(this,ke,ft);ft&(Oe|Lt)&&L[0].length-L[1].length==0&&(this.started=!1),this.callback(this.manager,ft,{pointers:L[0],changedPointers:L[1],pointerType:vn,srcEvent:ke})}}});function Ae(Se,ke){var ft=sr(Se.touches),L=sr(Se.changedTouches);return ke&(Oe|Lt)&&(ft=j(ft.concat(L),"identifier",!0)),[ft,L]}var ae={touchstart:Te,touchmove:Ze,touchend:Oe,touchcancel:Lt},_e="touchstart touchmove touchend touchcancel";function ct(){this.evTarget=_e,this.targetIds={},Ct.apply(this,arguments)}Et(ct,Ct,{handler:function(ke){var ft=ae[ke.type],L=Sr.call(this,ke,ft);!L||this.callback(this.manager,ft,{pointers:L[0],changedPointers:L[1],pointerType:vn,srcEvent:ke})}});function Sr(Se,ke){var ft=sr(Se.touches),L=this.targetIds;if(ke&(Te|Ze)&&ft.length===1)return L[ft[0].identifier]=!0,[ft,ft];var Qr,ai,wi=sr(Se.changedTouches),fo=[],Ya=this.target;if(ai=ft.filter(function(ja){return Ft(ja.target,Ya)}),ke===Te)for(Qr=0;Qr<ai.length;)L[ai[Qr].identifier]=!0,Qr++;for(Qr=0;Qr<wi.length;)L[wi[Qr].identifier]&&fo.push(wi[Qr]),ke&(Oe|Lt)&&delete L[wi[Qr].identifier],Qr++;if(!!fo.length)return[j(ai.concat(fo),"identifier",!0),fo]}var Ht=2500,Jt=25;function Nr(){Ct.apply(this,arguments);var Se=yr(this.handler,this);this.touch=new ct(this.manager,Se),this.mouse=new gt(this.manager,Se),this.primaryTouch=null,this.lastTouches=[]}Et(Nr,Ct,{handler:function(ke,ft,L){var Qr=L.pointerType==vn,ai=L.pointerType==ea;if(!(ai&&L.sourceCapabilities&&L.sourceCapabilities.firesTouchEvents)){if(Qr)zn.call(this,ft,L);else if(ai&&Kt.call(this,L))return;this.callback(ke,ft,L)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function zn(Se,ke){Se&Te?(this.primaryTouch=ke.changedPointers[0].identifier,Nn.call(this,ke)):Se&(Oe|Lt)&&Nn.call(this,ke)}function Nn(Se){var ke=Se.changedPointers[0];if(ke.identifier===this.primaryTouch){var ft={x:ke.clientX,y:ke.clientY};this.lastTouches.push(ft);var L=this.lastTouches,Qr=function(){var ai=L.indexOf(ft);ai>-1&&L.splice(ai,1)};setTimeout(Qr,Ht)}}function Kt(Se){for(var ke=Se.srcEvent.clientX,ft=Se.srcEvent.clientY,L=0;L<this.lastTouches.length;L++){var Qr=this.lastTouches[L],ai=Math.abs(ke-Qr.x),wi=Math.abs(ft-Qr.y);if(ai<=Jt&&wi<=Jt)return!0}return!1}var In=ie(oe.style,"touchAction"),hn=In!==te,mn="compute",Bi="auto",An="manipulation",Di="none",ra="pan-x",hi="pan-y",na=ga();function Hi(Se,ke){this.manager=Se,this.set(ke)}Hi.prototype={set:function(Se){Se==mn&&(Se=this.compute()),hn&&this.manager.element.style&&na[Se]&&(this.manager.element.style[In]=Se),this.actions=Se.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var Se=[];return Qt(this.manager.recognizers,function(ke){q(ke.options.enable,[ke])&&(Se=Se.concat(ke.getTouchAction()))}),Oi(Se.join(" "))},preventDefaults:function(Se){var ke=Se.srcEvent,ft=Se.offsetDirection;if(this.manager.session.prevented){ke.preventDefault();return}var L=this.actions,Qr=Xe(L,Di)&&!na[Di],ai=Xe(L,hi)&&!na[hi],wi=Xe(L,ra)&&!na[ra];if(Qr){var fo=Se.pointers.length===1,Ya=Se.distance<2,ja=Se.deltaTime<250;if(fo&&Ya&&ja)return}if(!(wi&&ai)&&(Qr||ai&&ft&w||wi&&ft&H))return this.preventSrc(ke)},preventSrc:function(Se){this.manager.session.prevented=!0,Se.preventDefault()}};function Oi(Se){if(Xe(Se,Di))return Di;var ke=Xe(Se,ra),ft=Xe(Se,hi);return ke&&ft?Di:ke||ft?ke?ra:hi:Xe(Se,An)?An:Bi}function ga(){if(!hn)return!1;var Se={},ke=E.CSS&&E.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(ft){Se[ft]=ke?E.CSS.supports("touch-action",ft):!0}),Se}var Ra=1,Wi=2,Ni=4,Xi=8,ro=Xi,Qo=16,za=32;function $i(Se){this.options=rr({},this.defaults,Se||{}),this.id=ye(),this.manager=null,this.options.enable=hr(this.options.enable,!0),this.state=Ra,this.simultaneous={},this.requireFail=[]}$i.prototype={defaults:{},set:function(Se){return rr(this.options,Se),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(Se){if(Cr(Se,"recognizeWith",this))return this;var ke=this.simultaneous;return Se=Yi(Se,this),ke[Se.id]||(ke[Se.id]=Se,Se.recognizeWith(this)),this},dropRecognizeWith:function(Se){return Cr(Se,"dropRecognizeWith",this)?this:(Se=Yi(Se,this),delete this.simultaneous[Se.id],this)},requireFailure:function(Se){if(Cr(Se,"requireFailure",this))return this;var ke=this.requireFail;return Se=Yi(Se,this),br(ke,Se)===-1&&(ke.push(Se),Se.requireFailure(this)),this},dropRequireFailure:function(Se){if(Cr(Se,"dropRequireFailure",this))return this;Se=Yi(Se,this);var ke=br(this.requireFail,Se);return ke>-1&&this.requireFail.splice(ke,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(Se){return!!this.simultaneous[Se.id]},emit:function(Se){var ke=this,ft=this.state;function L(Qr){ke.manager.emit(Qr,Se)}ft<Xi&&L(ke.options.event+cu(ft)),L(ke.options.event),Se.additionalEvent&&L(Se.additionalEvent),ft>=Xi&&L(ke.options.event+cu(ft))},tryEmit:function(Se){if(this.canEmit())return this.emit(Se);this.state=za},canEmit:function(){for(var Se=0;Se<this.requireFail.length;){if(!(this.requireFail[Se].state&(za|Ra)))return!1;Se++}return!0},recognize:function(Se){var ke=rr({},Se);if(!q(this.options.enable,[this,ke])){this.reset(),this.state=za;return}this.state&(ro|Qo|za)&&(this.state=Ra),this.state=this.process(ke),this.state&(Wi|Ni|Xi|Qo)&&this.tryEmit(ke)},process:function(Se){},getTouchAction:function(){},reset:function(){}};function cu(Se){return Se&Qo?"cancel":Se&Xi?"end":Se&Ni?"move":Se&Wi?"start":""}function Pu(Se){return Se==un?"down":Se==lr?"up":Se==dr?"left":Se==Or?"right":""}function Yi(Se,ke){var ft=ke.manager;return ft?ft.get(Se):Se}function xo(){$i.apply(this,arguments)}Et(xo,$i,{defaults:{pointers:1},attrTest:function(Se){var ke=this.options.pointers;return ke===0||Se.pointers.length===ke},process:function(Se){var ke=this.state,ft=Se.eventType,L=ke&(Wi|Ni),Qr=this.attrTest(Se);return L&&(ft&Lt||!Qr)?ke|Qo:L||Qr?ft&Oe?ke|Xi:ke&Wi?ke|Ni:Wi:za}});function Ki(){xo.apply(this,arguments),this.pX=null,this.pY=null}Et(Ki,xo,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ue},getTouchAction:function(){var Se=this.options.direction,ke=[];return Se&w&&ke.push(hi),Se&H&&ke.push(ra),ke},directionTest:function(Se){var ke=this.options,ft=!0,L=Se.distance,Qr=Se.direction,ai=Se.deltaX,wi=Se.deltaY;return Qr&ke.direction||(ke.direction&w?(Qr=ai===0?nr:ai<0?dr:Or,ft=ai!=this.pX,L=Math.abs(Se.deltaX)):(Qr=wi===0?nr:wi<0?lr:un,ft=wi!=this.pY,L=Math.abs(Se.deltaY))),Se.direction=Qr,ft&&L>ke.threshold&&Qr&ke.direction},attrTest:function(Se){return xo.prototype.attrTest.call(this,Se)&&(this.state&Wi||!(this.state&Wi)&&this.directionTest(Se))},emit:function(Se){this.pX=Se.deltaX,this.pY=Se.deltaY;var ke=Pu(Se.direction);ke&&(Se.additionalEvent=this.options.event+ke),this._super.emit.call(this,Se)}});function Xa(){xo.apply(this,arguments)}Et(Xa,xo,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Di]},attrTest:function(Se){return this._super.attrTest.call(this,Se)&&(Math.abs(Se.scale-1)>this.options.threshold||this.state&Wi)},emit:function(Se){if(Se.scale!==1){var ke=Se.scale<1?"in":"out";Se.additionalEvent=this.options.event+ke}this._super.emit.call(this,Se)}});function qo(){$i.apply(this,arguments),this._timer=null,this._input=null}Et(qo,$i,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Bi]},process:function(Se){var ke=this.options,ft=Se.pointers.length===ke.pointers,L=Se.distance<ke.threshold,Qr=Se.deltaTime>ke.time;if(this._input=Se,!L||!ft||Se.eventType&(Oe|Lt)&&!Qr)this.reset();else if(Se.eventType&Te)this.reset(),this._timer=Zt(function(){this.state=ro,this.tryEmit()},ke.time,this);else if(Se.eventType&Oe)return ro;return za},reset:function(){clearTimeout(this._timer)},emit:function(Se){this.state===ro&&(Se&&Se.eventType&Oe?this.manager.emit(this.options.event+"up",Se):(this._input.timeStamp=mt(),this.manager.emit(this.options.event,this._input)))}});function xa(){xo.apply(this,arguments)}Et(xa,xo,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Di]},attrTest:function(Se){return this._super.attrTest.call(this,Se)&&(Math.abs(Se.rotation)>this.options.threshold||this.state&Wi)}});function Do(){xo.apply(this,arguments)}Et(Do,xo,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:w|H,pointers:1},getTouchAction:function(){return Ki.prototype.getTouchAction.call(this)},attrTest:function(Se){var ke=this.options.direction,ft;return ke&(w|H)?ft=Se.overallVelocity:ke&w?ft=Se.overallVelocityX:ke&H&&(ft=Se.overallVelocityY),this._super.attrTest.call(this,Se)&&ke&Se.offsetDirection&&Se.distance>this.options.threshold&&Se.maxPointers==this.options.pointers&&Qe(ft)>this.options.velocity&&Se.eventType&Oe},emit:function(Se){var ke=Pu(Se.offsetDirection);ke&&this.manager.emit(this.options.event+ke,Se),this.manager.emit(this.options.event,Se)}});function ko(){$i.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Et(ko,$i,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[An]},process:function(Se){var ke=this.options,ft=Se.pointers.length===ke.pointers,L=Se.distance<ke.threshold,Qr=Se.deltaTime<ke.time;if(this.reset(),Se.eventType&Te&&this.count===0)return this.failTimeout();if(L&&Qr&&ft){if(Se.eventType!=Oe)return this.failTimeout();var ai=this.pTime?Se.timeStamp-this.pTime<ke.interval:!0,wi=!this.pCenter||Ar(this.pCenter,Se.center)<ke.posThreshold;this.pTime=Se.timeStamp,this.pCenter=Se.center,!wi||!ai?this.count=1:this.count+=1,this._input=Se;var fo=this.count%ke.taps;if(fo===0)return this.hasRequireFailures()?(this._timer=Zt(function(){this.state=ro,this.tryEmit()},ke.interval,this),Wi):ro}return za},failTimeout:function(){return this._timer=Zt(function(){this.state=za},this.options.interval,this),za},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ro&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Rs(Se,ke){return ke=ke||{},ke.recognizers=hr(ke.recognizers,Rs.defaults.preset),new Da(Se,ke)}Rs.VERSION="2.0.7",Rs.defaults={domEvents:!1,touchAction:mn,enable:!0,inputTarget:null,inputClass:null,preset:[[xa,{enable:!1}],[Xa,{enable:!1},["rotate"]],[Do,{direction:w}],[Ki,{direction:w},["swipe"]],[ko],[ko,{event:"doubletap",taps:2},["tap"]],[qo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var vo=1,Xo=2;function Da(Se,ke){this.options=rr({},Rs.defaults,ke||{}),this.options.inputTarget=this.options.inputTarget||Se,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=Se,this.input=$(this),this.touchAction=new Hi(this,this.options.touchAction),co(this,!0),Qt(this.options.recognizers,function(ft){var L=this.add(new ft[0](ft[1]));ft[2]&&L.recognizeWith(ft[2]),ft[3]&&L.requireFailure(ft[3])},this)}Da.prototype={set:function(Se){return rr(this.options,Se),Se.touchAction&&this.touchAction.update(),Se.inputTarget&&(this.input.destroy(),this.input.target=Se.inputTarget,this.input.init()),this},stop:function(Se){this.session.stopped=Se?Xo:vo},recognize:function(Se){var ke=this.session;if(!ke.stopped){this.touchAction.preventDefaults(Se);var ft,L=this.recognizers,Qr=ke.curRecognizer;(!Qr||Qr&&Qr.state&ro)&&(Qr=ke.curRecognizer=null);for(var ai=0;ai<L.length;)ft=L[ai],ke.stopped!==Xo&&(!Qr||ft==Qr||ft.canRecognizeWith(Qr))?ft.recognize(Se):ft.reset(),!Qr&&ft.state&(Wi|Ni|Xi)&&(Qr=ke.curRecognizer=ft),ai++}},get:function(Se){if(Se instanceof $i)return Se;for(var ke=this.recognizers,ft=0;ft<ke.length;ft++)if(ke[ft].options.event==Se)return ke[ft];return null},add:function(Se){if(Cr(Se,"add",this))return this;var ke=this.get(Se.options.event);return ke&&this.remove(ke),this.recognizers.push(Se),Se.manager=this,this.touchAction.update(),Se},remove:function(Se){if(Cr(Se,"remove",this))return this;if(Se=this.get(Se),Se){var ke=this.recognizers,ft=br(ke,Se);ft!==-1&&(ke.splice(ft,1),this.touchAction.update())}return this},on:function(Se,ke){if(Se!==te&&ke!==te){var ft=this.handlers;return Qt(jt(Se),function(L){ft[L]=ft[L]||[],ft[L].push(ke)}),this}},off:function(Se,ke){if(Se!==te){var ft=this.handlers;return Qt(jt(Se),function(L){ke?ft[L]&&ft[L].splice(br(ft[L],ke),1):delete ft[L]}),this}},emit:function(Se,ke){this.options.domEvents&&ss(Se,ke);var ft=this.handlers[Se]&&this.handlers[Se].slice();if(!(!ft||!ft.length)){ke.type=Se,ke.preventDefault=function(){ke.srcEvent.preventDefault()};for(var L=0;L<ft.length;)ft[L](ke),L++}},destroy:function(){this.element&&co(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function co(Se,ke){var ft=Se.element;if(!!ft.style){var L;Qt(Se.options.cssProps,function(Qr,ai){L=ie(ft.style,ai),ke?(Se.oldCssProps[L]=ft.style[L],ft.style[L]=Qr):ft.style[L]=Se.oldCssProps[L]||""}),ke||(Se.oldCssProps={})}}function ss(Se,ke){var ft=d.createEvent("Event");ft.initEvent(Se,!0,!0),ft.gesture=ke,ke.target.dispatchEvent(ft)}rr(Rs,{INPUT_START:Te,INPUT_MOVE:Ze,INPUT_END:Oe,INPUT_CANCEL:Lt,STATE_POSSIBLE:Ra,STATE_BEGAN:Wi,STATE_CHANGED:Ni,STATE_ENDED:Xi,STATE_RECOGNIZED:ro,STATE_CANCELLED:Qo,STATE_FAILED:za,DIRECTION_NONE:nr,DIRECTION_LEFT:dr,DIRECTION_RIGHT:Or,DIRECTION_UP:lr,DIRECTION_DOWN:un,DIRECTION_HORIZONTAL:w,DIRECTION_VERTICAL:H,DIRECTION_ALL:Ue,Manager:Da,Input:Ct,TouchAction:Hi,TouchInput:ct,MouseInput:gt,PointerEventInput:le,TouchMouseInput:Nr,SingleTouchInput:de,Recognizer:$i,AttrRecognizer:xo,Tap:ko,Pan:Ki,Swipe:Do,Pinch:Xa,Rotate:xa,Press:qo,on:wt,off:$e,each:Qt,merge:St,extend:Ut,assign:rr,inherit:Et,bindFn:yr,prefixed:ie});var Fo=typeof E!="undefined"?E:typeof self!="undefined"?self:{};Fo.Hammer=Rs,ce=function(){return Rs}.call(N,S,N,zr),ce!==te&&(zr.exports=ce)})(window,document,"Hammer")},7375:function(zr,N){"use strict";Object.defineProperty(N,"__esModule",{value:!0});var S=Symbol.for("INJECTION");function ce(ue,oe,Ne,K){function Qe(){return K&&!Reflect.hasMetadata(S,this,oe)&&Reflect.defineMetadata(S,Ne(),this,oe),Reflect.hasMetadata(S,this,oe)?Reflect.getMetadata(S,this,oe):Ne()}function mt(Zt){Reflect.defineMetadata(S,Zt,this,oe)}Object.defineProperty(ue,oe,{configurable:!0,enumerable:!0,get:Qe,set:mt})}function E(ue,oe){return function(Ne){return function(K,Qe){var mt=function(){return ue.get(Ne)};ce(K,Qe,mt,oe)}}}N.makePropertyInjectDecorator=E;function d(ue,oe){return function(Ne,K){return function(Qe,mt){var Zt=function(){return ue.getNamed(Ne,K)};ce(Qe,mt,Zt,oe)}}}N.makePropertyInjectNamedDecorator=d;function me(ue,oe){return function(Ne,K,Qe){return function(mt,Zt){var Cr=function(){return ue.getTagged(Ne,K,Qe)};ce(mt,Zt,Cr,oe)}}}N.makePropertyInjectTaggedDecorator=me;function te(ue,oe){return function(Ne){return function(K,Qe){var mt=function(){return ue.getAll(Ne)};ce(K,Qe,mt,oe)}}}N.makePropertyMultiInjectDecorator=te},84879:function(zr,N,S){"use strict";var ce;ce={value:!0};var E=S(7375);function d(me,te){te===void 0&&(te=!0);var ue=E.makePropertyInjectDecorator(me,te),oe=E.makePropertyInjectNamedDecorator(me,te),Ne=E.makePropertyInjectTaggedDecorator(me,te),K=E.makePropertyMultiInjectDecorator(me,te);return{lazyInject:ue,lazyInjectNamed:oe,lazyInjectTagged:Ne,lazyMultiInject:K}}N.Z=d},99934:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.tagProperty=N.tagParameter=N.decorate=void 0;var ce=S(16674),E=S(6867);function d(K,Qe,mt,Zt){var Cr=E.TAGGED;te(Cr,K,Qe,Zt,mt)}N.tagParameter=d;function me(K,Qe,mt){var Zt=E.TAGGED_PROP;te(Zt,K.constructor,Qe,mt)}N.tagProperty=me;function te(K,Qe,mt,Zt,Cr){var Qt={},Xt=typeof Cr=="number",rr=Cr!==void 0&&Xt?Cr.toString():mt;if(Xt&&mt!==void 0)throw new Error(ce.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(K,Qe)&&(Qt=Reflect.getMetadata(K,Qe));var Ut=Qt[rr];if(!Array.isArray(Ut))Ut=[];else for(var St=0,Et=Ut;St<Et.length;St++){var yr=Et[St];if(yr.key===Zt.key)throw new Error(ce.DUPLICATED_METADATA+" "+yr.key.toString())}Ut.push(Zt),Qt[rr]=Ut,Reflect.defineMetadata(K,Qt,Qe)}function ue(K,Qe){Reflect.decorate(K,Qe)}function oe(K,Qe){return function(mt,Zt){Qe(mt,Zt,K)}}function Ne(K,Qe,mt){typeof mt=="number"?ue([oe(mt,K)],Qe):typeof mt=="string"?Reflect.decorate([K],Qe,mt):ue([K],Qe)}N.decorate=Ne},5744:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.inject=N.LazyServiceIdentifer=void 0;var ce=S(16674),E=S(6867),d=S(47738),me=S(99934),te=function(){function oe(Ne){this._cb=Ne}return oe.prototype.unwrap=function(){return this._cb()},oe}();N.LazyServiceIdentifer=te;function ue(oe){return function(Ne,K,Qe){if(oe===void 0)throw new Error(ce.UNDEFINED_INJECT_ANNOTATION(Ne.name));var mt=new d.Metadata(E.INJECT_TAG,oe);typeof Qe=="number"?me.tagParameter(Ne,K,Qe,mt):me.tagProperty(Ne,K,mt)}}N.inject=ue},64315:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.injectable=void 0;var ce=S(16674),E=S(6867);function d(){return function(me){if(Reflect.hasOwnMetadata(E.PARAM_TYPES,me))throw new Error(ce.DUPLICATED_INJECTABLE_DECORATOR);var te=Reflect.getMetadata(E.DESIGN_PARAM_TYPES,me)||[];return Reflect.defineMetadata(E.PARAM_TYPES,te,me),me}}N.injectable=d},71693:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.multiInject=void 0;var ce=S(6867),E=S(47738),d=S(99934);function me(te){return function(ue,oe,Ne){var K=new E.Metadata(ce.MULTI_INJECT_TAG,te);typeof Ne=="number"?d.tagParameter(ue,oe,Ne,K):d.tagProperty(ue,oe,K)}}N.multiInject=me},38085:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.named=void 0;var ce=S(6867),E=S(47738),d=S(99934);function me(te){return function(ue,oe,Ne){var K=new E.Metadata(ce.NAMED_TAG,te);typeof Ne=="number"?d.tagParameter(ue,oe,Ne,K):d.tagProperty(ue,oe,K)}}N.named=me},6515:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.optional=void 0;var ce=S(6867),E=S(47738),d=S(99934);function me(){return function(te,ue,oe){var Ne=new E.Metadata(ce.OPTIONAL_TAG,!0);typeof oe=="number"?d.tagParameter(te,ue,oe,Ne):d.tagProperty(te,ue,Ne)}}N.optional=me},7014:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.postConstruct=void 0;var ce=S(16674),E=S(6867),d=S(47738);function me(){return function(te,ue,oe){var Ne=new d.Metadata(E.POST_CONSTRUCT,ue);if(Reflect.hasOwnMetadata(E.POST_CONSTRUCT,te.constructor))throw new Error(ce.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(E.POST_CONSTRUCT,Ne,te.constructor)}}N.postConstruct=me},32052:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.tagged=void 0;var ce=S(47738),E=S(99934);function d(me,te){return function(ue,oe,Ne){var K=new ce.Metadata(me,te);typeof Ne=="number"?E.tagParameter(ue,oe,Ne,K):E.tagProperty(ue,oe,K)}}N.tagged=d},55638:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.targetName=void 0;var ce=S(6867),E=S(47738),d=S(99934);function me(te){return function(ue,oe,Ne){var K=new E.Metadata(ce.NAME_TAG,te);d.tagParameter(ue,oe,Ne,K)}}N.targetName=me},86757:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.unmanaged=void 0;var ce=S(6867),E=S(47738),d=S(99934);function me(){return function(te,ue,oe){var Ne=new E.Metadata(ce.UNMANAGED_TAG,!0);d.tagParameter(te,ue,oe,Ne)}}N.unmanaged=me},44290:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.Binding=void 0;var ce=S(28421),E=S(37791),d=function(){function me(te,ue){this.id=E.id(),this.activated=!1,this.serviceIdentifier=te,this.scope=ue,this.type=ce.BindingTypeEnum.Invalid,this.constraint=function(oe){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return me.prototype.clone=function(){var te=new me(this.serviceIdentifier,this.scope);return te.activated=te.scope===ce.BindingScopeEnum.Singleton?this.activated:!1,te.implementationType=this.implementationType,te.dynamicValue=this.dynamicValue,te.scope=this.scope,te.type=this.type,te.factory=this.factory,te.provider=this.provider,te.constraint=this.constraint,te.onActivation=this.onActivation,te.cache=this.cache,te},me}();N.Binding=d},23184:function(zr,N){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.BindingCount=void 0;var S={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};N.BindingCount=S},16674:function(zr,N){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.STACK_OVERFLOW=N.CIRCULAR_DEPENDENCY_IN_FACTORY=N.POST_CONSTRUCT_ERROR=N.MULTIPLE_POST_CONSTRUCT_METHODS=N.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=N.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=N.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=N.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=N.ARGUMENTS_LENGTH_MISMATCH=N.INVALID_DECORATOR_OPERATION=N.INVALID_TO_SELF_VALUE=N.INVALID_FUNCTION_BINDING=N.INVALID_MIDDLEWARE_RETURN=N.NO_MORE_SNAPSHOTS_AVAILABLE=N.INVALID_BINDING_TYPE=N.NOT_IMPLEMENTED=N.CIRCULAR_DEPENDENCY=N.UNDEFINED_INJECT_ANNOTATION=N.MISSING_INJECT_ANNOTATION=N.MISSING_INJECTABLE_ANNOTATION=N.NOT_REGISTERED=N.CANNOT_UNBIND=N.AMBIGUOUS_MATCH=N.KEY_NOT_FOUND=N.NULL_ARGUMENT=N.DUPLICATED_METADATA=N.DUPLICATED_INJECTABLE_DECORATOR=void 0,N.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",N.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",N.NULL_ARGUMENT="NULL argument",N.KEY_NOT_FOUND="Key Not Found",N.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",N.CANNOT_UNBIND="Could not unbind serviceIdentifier:",N.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",N.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",N.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var S=function(me){return"@inject called with undefined this could mean that the class "+me+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};N.UNDEFINED_INJECT_ANNOTATION=S,N.CIRCULAR_DEPENDENCY="Circular dependency found:",N.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",N.INVALID_BINDING_TYPE="Invalid binding type:",N.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",N.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",N.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",N.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",N.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var ce=function(){for(var me=[],te=0;te<arguments.length;te++)me[te]=arguments[te];return"The number of constructor arguments in the derived class "+(me[0]+" must be >= than the number of constructor arguments of its base class.")};N.ARGUMENTS_LENGTH_MISMATCH=ce,N.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",N.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",N.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",N.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",N.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var E=function(){for(var me=[],te=0;te<arguments.length;te++)me[te]=arguments[te];return"@postConstruct error in class "+me[0]+": "+me[1]};N.POST_CONSTRUCT_ERROR=E;var d=function(){for(var me=[],te=0;te<arguments.length;te++)me[te]=arguments[te];return"It looks like there is a circular dependency "+("in one of the '"+me[0]+"' bindings. Please investigate bindings with")+("service identifier '"+me[1]+"'.")};N.CIRCULAR_DEPENDENCY_IN_FACTORY=d,N.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(zr,N){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.TargetTypeEnum=N.BindingTypeEnum=N.BindingScopeEnum=void 0;var S={Request:"Request",Singleton:"Singleton",Transient:"Transient"};N.BindingScopeEnum=S;var ce={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};N.BindingTypeEnum=ce;var E={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};N.TargetTypeEnum=E},6867:function(zr,N){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.NON_CUSTOM_TAG_KEYS=N.POST_CONSTRUCT=N.DESIGN_PARAM_TYPES=N.PARAM_TYPES=N.TAGGED_PROP=N.TAGGED=N.MULTI_INJECT_TAG=N.INJECT_TAG=N.OPTIONAL_TAG=N.UNMANAGED_TAG=N.NAME_TAG=N.NAMED_TAG=void 0,N.NAMED_TAG="named",N.NAME_TAG="name",N.UNMANAGED_TAG="unmanaged",N.OPTIONAL_TAG="optional",N.INJECT_TAG="inject",N.MULTI_INJECT_TAG="multi_inject",N.TAGGED="inversify:tagged",N.TAGGED_PROP="inversify:tagged_props",N.PARAM_TYPES="inversify:paramtypes",N.DESIGN_PARAM_TYPES="design:paramtypes",N.POST_CONSTRUCT="post_construct";function S(){return[N.INJECT_TAG,N.MULTI_INJECT_TAG,N.NAME_TAG,N.UNMANAGED_TAG,N.NAMED_TAG,N.OPTIONAL_TAG]}N.NON_CUSTOM_TAG_KEYS=S()},51389:function(zr,N,S){"use strict";var ce=this&&this.__awaiter||function(Ut,St,Et,yr){function q(hr){return hr instanceof Et?hr:new Et(function(wt){wt(hr)})}return new(Et||(Et=Promise))(function(hr,wt){function $e(jt){try{Xe(yr.next(jt))}catch(br){wt(br)}}function Ft(jt){try{Xe(yr.throw(jt))}catch(br){wt(br)}}function Xe(jt){jt.done?hr(jt.value):q(jt.value).then($e,Ft)}Xe((yr=yr.apply(Ut,St||[])).next())})},E=this&&this.__generator||function(Ut,St){var Et={label:0,sent:function(){if(hr[0]&1)throw hr[1];return hr[1]},trys:[],ops:[]},yr,q,hr,wt;return wt={next:$e(0),throw:$e(1),return:$e(2)},typeof Symbol=="function"&&(wt[Symbol.iterator]=function(){return this}),wt;function $e(Xe){return function(jt){return Ft([Xe,jt])}}function Ft(Xe){if(yr)throw new TypeError("Generator is already executing.");for(;Et;)try{if(yr=1,q&&(hr=Xe[0]&2?q.return:Xe[0]?q.throw||((hr=q.return)&&hr.call(q),0):q.next)&&!(hr=hr.call(q,Xe[1])).done)return hr;switch(q=0,hr&&(Xe=[Xe[0]&2,hr.value]),Xe[0]){case 0:case 1:hr=Xe;break;case 4:return Et.label++,{value:Xe[1],done:!1};case 5:Et.label++,q=Xe[1],Xe=[0];continue;case 7:Xe=Et.ops.pop(),Et.trys.pop();continue;default:if(hr=Et.trys,!(hr=hr.length>0&&hr[hr.length-1])&&(Xe[0]===6||Xe[0]===2)){Et=0;continue}if(Xe[0]===3&&(!hr||Xe[1]>hr[0]&&Xe[1]<hr[3])){Et.label=Xe[1];break}if(Xe[0]===6&&Et.label<hr[1]){Et.label=hr[1],hr=Xe;break}if(hr&&Et.label<hr[2]){Et.label=hr[2],Et.ops.push(Xe);break}hr[2]&&Et.ops.pop(),Et.trys.pop();continue}Xe=St.call(Ut,Et)}catch(jt){Xe=[6,jt],q=0}finally{yr=hr=0}if(Xe[0]&5)throw Xe[1];return{value:Xe[0]?Xe[1]:void 0,done:!0}}},d=this&&this.__spreadArray||function(Ut,St){for(var Et=0,yr=St.length,q=Ut.length;Et<yr;Et++,q++)Ut[q]=St[Et];return Ut};Object.defineProperty(N,"__esModule",{value:!0}),N.Container=void 0;var me=S(44290),te=S(16674),ue=S(28421),oe=S(6867),Ne=S(51377),K=S(86311),Qe=S(31927),mt=S(15451),Zt=S(37791),Cr=S(55800),Qt=S(85700),Xt=S(80175),rr=function(){function Ut(St){this._appliedMiddleware=[];var Et=St||{};if(typeof Et!="object")throw new Error(""+te.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(Et.defaultScope===void 0)Et.defaultScope=ue.BindingScopeEnum.Transient;else if(Et.defaultScope!==ue.BindingScopeEnum.Singleton&&Et.defaultScope!==ue.BindingScopeEnum.Transient&&Et.defaultScope!==ue.BindingScopeEnum.Request)throw new Error(""+te.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(Et.autoBindInjectable===void 0)Et.autoBindInjectable=!1;else if(typeof Et.autoBindInjectable!="boolean")throw new Error(""+te.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(Et.skipBaseClassChecks===void 0)Et.skipBaseClassChecks=!1;else if(typeof Et.skipBaseClassChecks!="boolean")throw new Error(""+te.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:Et.autoBindInjectable,defaultScope:Et.defaultScope,skipBaseClassChecks:Et.skipBaseClassChecks},this.id=Zt.id(),this._bindingDictionary=new Xt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Ne.MetadataReader}return Ut.merge=function(St,Et){for(var yr=[],q=2;q<arguments.length;q++)yr[q-2]=arguments[q];var hr=new Ut,wt=d([St,Et],yr).map(function(Xe){return K.getBindingDictionary(Xe)}),$e=K.getBindingDictionary(hr);function Ft(Xe,jt){Xe.traverse(function(br,sr){sr.forEach(function(j){jt.add(j.serviceIdentifier,j.clone())})})}return wt.forEach(function(Xe){Ft(Xe,$e)}),hr},Ut.prototype.load=function(){for(var St=[],Et=0;Et<arguments.length;Et++)St[Et]=arguments[Et];for(var yr=this._getContainerModuleHelpersFactory(),q=0,hr=St;q<hr.length;q++){var wt=hr[q],$e=yr(wt.id);wt.registry($e.bindFunction,$e.unbindFunction,$e.isboundFunction,$e.rebindFunction)}},Ut.prototype.loadAsync=function(){for(var St=[],Et=0;Et<arguments.length;Et++)St[Et]=arguments[Et];return ce(this,void 0,void 0,function(){var yr,q,hr,wt,$e;return E(this,function(Ft){switch(Ft.label){case 0:yr=this._getContainerModuleHelpersFactory(),q=0,hr=St,Ft.label=1;case 1:return q<hr.length?(wt=hr[q],$e=yr(wt.id),[4,wt.registry($e.bindFunction,$e.unbindFunction,$e.isboundFunction,$e.rebindFunction)]):[3,4];case 2:Ft.sent(),Ft.label=3;case 3:return q++,[3,1];case 4:return[2]}})})},Ut.prototype.unload=function(){for(var St=this,Et=[],yr=0;yr<arguments.length;yr++)Et[yr]=arguments[yr];var q=function(hr){return function(wt){return wt.moduleId===hr}};Et.forEach(function(hr){var wt=q(hr.id);St._bindingDictionary.removeByCondition(wt)})},Ut.prototype.bind=function(St){var Et=this.options.defaultScope||ue.BindingScopeEnum.Transient,yr=new me.Binding(St,Et);return this._bindingDictionary.add(St,yr),new mt.BindingToSyntax(yr)},Ut.prototype.rebind=function(St){return this.unbind(St),this.bind(St)},Ut.prototype.unbind=function(St){try{this._bindingDictionary.remove(St)}catch(Et){throw new Error(te.CANNOT_UNBIND+" "+Cr.getServiceIdentifierAsString(St))}},Ut.prototype.unbindAll=function(){this._bindingDictionary=new Xt.Lookup},Ut.prototype.isBound=function(St){var Et=this._bindingDictionary.hasKey(St);return!Et&&this.parent&&(Et=this.parent.isBound(St)),Et},Ut.prototype.isBoundNamed=function(St,Et){return this.isBoundTagged(St,oe.NAMED_TAG,Et)},Ut.prototype.isBoundTagged=function(St,Et,yr){var q=!1;if(this._bindingDictionary.hasKey(St)){var hr=this._bindingDictionary.get(St),wt=K.createMockRequest(this,St,Et,yr);q=hr.some(function($e){return $e.constraint(wt)})}return!q&&this.parent&&(q=this.parent.isBoundTagged(St,Et,yr)),q},Ut.prototype.snapshot=function(){this._snapshots.push(Qt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Ut.prototype.restore=function(){var St=this._snapshots.pop();if(St===void 0)throw new Error(te.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=St.bindings,this._middleware=St.middleware},Ut.prototype.createChild=function(St){var Et=new Ut(St||this.options);return Et.parent=this,Et},Ut.prototype.applyMiddleware=function(){for(var St=[],Et=0;Et<arguments.length;Et++)St[Et]=arguments[Et];this._appliedMiddleware=this._appliedMiddleware.concat(St);var yr=this._middleware?this._middleware:this._planAndResolve();this._middleware=St.reduce(function(q,hr){return hr(q)},yr)},Ut.prototype.applyCustomMetadataReader=function(St){this._metadataReader=St},Ut.prototype.get=function(St){return this._get(!1,!1,ue.TargetTypeEnum.Variable,St)},Ut.prototype.getTagged=function(St,Et,yr){return this._get(!1,!1,ue.TargetTypeEnum.Variable,St,Et,yr)},Ut.prototype.getNamed=function(St,Et){return this.getTagged(St,oe.NAMED_TAG,Et)},Ut.prototype.getAll=function(St){return this._get(!0,!0,ue.TargetTypeEnum.Variable,St)},Ut.prototype.getAllTagged=function(St,Et,yr){return this._get(!1,!0,ue.TargetTypeEnum.Variable,St,Et,yr)},Ut.prototype.getAllNamed=function(St,Et){return this.getAllTagged(St,oe.NAMED_TAG,Et)},Ut.prototype.resolve=function(St){var Et=this.createChild();return Et.bind(St).toSelf(),this._appliedMiddleware.forEach(function(yr){Et.applyMiddleware(yr)}),Et.get(St)},Ut.prototype._getContainerModuleHelpersFactory=function(){var St=this,Et=function($e,Ft){$e._binding.moduleId=Ft},yr=function($e){return function(Ft){var Xe=St.bind.bind(St),jt=Xe(Ft);return Et(jt,$e),jt}},q=function($e){return function(Ft){var Xe=St.unbind.bind(St);Xe(Ft)}},hr=function($e){return function(Ft){var Xe=St.isBound.bind(St);return Xe(Ft)}},wt=function($e){return function(Ft){var Xe=St.rebind.bind(St),jt=Xe(Ft);return Et(jt,$e),jt}};return function($e){return{bindFunction:yr($e),isboundFunction:hr($e),rebindFunction:wt($e),unbindFunction:q($e)}}},Ut.prototype._get=function(St,Et,yr,q,hr,wt){var $e=null,Ft={avoidConstraints:St,contextInterceptor:function(Xe){return Xe},isMultiInject:Et,key:hr,serviceIdentifier:q,targetType:yr,value:wt};if(this._middleware){if($e=this._middleware(Ft),$e==null)throw new Error(te.INVALID_MIDDLEWARE_RETURN)}else $e=this._planAndResolve()(Ft);return $e},Ut.prototype._planAndResolve=function(){var St=this;return function(Et){var yr=K.plan(St._metadataReader,St,Et.isMultiInject,Et.targetType,Et.serviceIdentifier,Et.key,Et.value,Et.avoidConstraints);yr=Et.contextInterceptor(yr);var q=Qe.resolve(yr);return q}},Ut}();N.Container=rr},33244:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.AsyncContainerModule=N.ContainerModule=void 0;var ce=S(37791),E=function(){function me(te){this.id=ce.id(),this.registry=te}return me}();N.ContainerModule=E;var d=function(){function me(te){this.id=ce.id(),this.registry=te}return me}();N.AsyncContainerModule=d},85700:function(zr,N){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.ContainerSnapshot=void 0;var S=function(){function ce(){}return ce.of=function(E,d){var me=new ce;return me.bindings=E,me.middleware=d,me},ce}();N.ContainerSnapshot=S},80175:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.Lookup=void 0;var ce=S(16674),E=function(){function d(){this._map=new Map}return d.prototype.getMap=function(){return this._map},d.prototype.add=function(me,te){if(me==null)throw new Error(ce.NULL_ARGUMENT);if(te==null)throw new Error(ce.NULL_ARGUMENT);var ue=this._map.get(me);ue!==void 0?(ue.push(te),this._map.set(me,ue)):this._map.set(me,[te])},d.prototype.get=function(me){if(me==null)throw new Error(ce.NULL_ARGUMENT);var te=this._map.get(me);if(te!==void 0)return te;throw new Error(ce.KEY_NOT_FOUND)},d.prototype.remove=function(me){if(me==null)throw new Error(ce.NULL_ARGUMENT);if(!this._map.delete(me))throw new Error(ce.KEY_NOT_FOUND)},d.prototype.removeByCondition=function(me){var te=this;this._map.forEach(function(ue,oe){var Ne=ue.filter(function(K){return!me(K)});Ne.length>0?te._map.set(oe,Ne):te._map.delete(oe)})},d.prototype.hasKey=function(me){if(me==null)throw new Error(ce.NULL_ARGUMENT);return this._map.has(me)},d.prototype.clone=function(){var me=new d;return this._map.forEach(function(te,ue){te.forEach(function(oe){return me.add(ue,oe.clone())})}),me},d.prototype.traverse=function(me){this._map.forEach(function(te,ue){me(ue,te)})},d}();N.Lookup=E},86700:function(zr,N,S){"use strict";var ce;ce={value:!0},ce=ce=ce=ce=ce=ce=N.GW=ce=ce=N.zY=ce=ce=ce=ce=ce=N.f3=ce=ce=N.b2=ce=ce=ce=ce=ce=N.W2=ce=void 0;var E=S(6867);ce=E;var d=S(51389);Object.defineProperty(N,"W2",{enumerable:!0,get:function(){return d.Container}});var me=S(28421);ce={enumerable:!0,get:function(){return me.BindingScopeEnum}},ce={enumerable:!0,get:function(){return me.BindingTypeEnum}},ce={enumerable:!0,get:function(){return me.TargetTypeEnum}};var te=S(33244);ce={enumerable:!0,get:function(){return te.AsyncContainerModule}},ce={enumerable:!0,get:function(){return te.ContainerModule}};var ue=S(64315);Object.defineProperty(N,"b2",{enumerable:!0,get:function(){return ue.injectable}});var oe=S(32052);ce={enumerable:!0,get:function(){return oe.tagged}};var Ne=S(38085);ce={enumerable:!0,get:function(){return Ne.named}};var K=S(5744);Object.defineProperty(N,"f3",{enumerable:!0,get:function(){return K.inject}}),ce={enumerable:!0,get:function(){return K.LazyServiceIdentifer}};var Qe=S(6515);ce={enumerable:!0,get:function(){return Qe.optional}};var mt=S(86757);ce={enumerable:!0,get:function(){return mt.unmanaged}};var Zt=S(71693);ce={enumerable:!0,get:function(){return Zt.multiInject}};var Cr=S(55638);ce={enumerable:!0,get:function(){return Cr.targetName}};var Qt=S(7014);Object.defineProperty(N,"zY",{enumerable:!0,get:function(){return Qt.postConstruct}});var Xt=S(51377);ce={enumerable:!0,get:function(){return Xt.MetadataReader}};var rr=S(37791);ce={enumerable:!0,get:function(){return rr.id}};var Ut=S(99934);Object.defineProperty(N,"GW",{enumerable:!0,get:function(){return Ut.decorate}});var St=S(80758);ce={enumerable:!0,get:function(){return St.traverseAncerstors}},ce={enumerable:!0,get:function(){return St.taggedConstraint}},ce={enumerable:!0,get:function(){return St.namedConstraint}},ce={enumerable:!0,get:function(){return St.typeConstraint}};var Et=S(55800);ce={enumerable:!0,get:function(){return Et.getServiceIdentifierAsString}};var yr=S(70600);ce={enumerable:!0,get:function(){return yr.multiBindToService}}},95228:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.Context=void 0;var ce=S(37791),E=function(){function d(me){this.id=ce.id(),this.container=me}return d.prototype.addPlan=function(me){this.plan=me},d.prototype.setCurrentRequest=function(me){this.currentRequest=me},d}();N.Context=E},47738:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.Metadata=void 0;var ce=S(6867),E=function(){function d(me,te){this.key=me,this.value=te}return d.prototype.toString=function(){return this.key===ce.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},d}();N.Metadata=E},51377:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.MetadataReader=void 0;var ce=S(6867),E=function(){function d(){}return d.prototype.getConstructorMetadata=function(me){var te=Reflect.getMetadata(ce.PARAM_TYPES,me),ue=Reflect.getMetadata(ce.TAGGED,me);return{compilerGeneratedMetadata:te,userGeneratedMetadata:ue||{}}},d.prototype.getPropertiesMetadata=function(me){var te=Reflect.getMetadata(ce.TAGGED_PROP,me)||[];return te},d}();N.MetadataReader=E},55314:function(zr,N){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.Plan=void 0;var S=function(){function ce(E,d){this.parentContext=E,this.rootRequest=d}return ce}();N.Plan=S},86311:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.getBindingDictionary=N.createMockRequest=N.plan=void 0;var ce=S(23184),E=S(16674),d=S(28421),me=S(6867),te=S(85265),ue=S(55800),oe=S(95228),Ne=S(47738),K=S(55314),Qe=S(6e3),mt=S(6748),Zt=S(18924);function Cr(q){return q._bindingDictionary}N.getBindingDictionary=Cr;function Qt(q,hr,wt,$e,Ft,Xe){var jt=q?me.MULTI_INJECT_TAG:me.INJECT_TAG,br=new Ne.Metadata(jt,wt),sr=new Zt.Target(hr,$e,wt,br);if(Ft!==void 0){var j=new Ne.Metadata(Ft,Xe);sr.metadata.push(j)}return sr}function Xt(q,hr,wt,$e,Ft){var Xe=St(wt.container,Ft.serviceIdentifier),jt=[];return Xe.length===ce.BindingCount.NoBindingsAvailable&&wt.container.options.autoBindInjectable&&typeof Ft.serviceIdentifier=="function"&&q.getConstructorMetadata(Ft.serviceIdentifier).compilerGeneratedMetadata&&(wt.container.bind(Ft.serviceIdentifier).toSelf(),Xe=St(wt.container,Ft.serviceIdentifier)),hr?jt=Xe:jt=Xe.filter(function(br){var sr=new mt.Request(br.serviceIdentifier,wt,$e,br,Ft);return br.constraint(sr)}),rr(Ft.serviceIdentifier,jt,Ft,wt.container),jt}function rr(q,hr,wt,$e){switch(hr.length){case ce.BindingCount.NoBindingsAvailable:if(wt.isOptional())return hr;var Ft=ue.getServiceIdentifierAsString(q),Xe=E.NOT_REGISTERED;throw Xe+=ue.listMetadataForTarget(Ft,wt),Xe+=ue.listRegisteredBindingsForServiceIdentifier($e,Ft,St),new Error(Xe);case ce.BindingCount.OnlyOneBindingAvailable:if(!wt.isArray())return hr;case ce.BindingCount.MultipleBindingsAvailable:default:if(wt.isArray())return hr;var Ft=ue.getServiceIdentifierAsString(q),Xe=E.AMBIGUOUS_MATCH+" "+Ft;throw Xe+=ue.listRegisteredBindingsForServiceIdentifier($e,Ft,St),new Error(Xe)}}function Ut(q,hr,wt,$e,Ft,Xe){var jt,br;if(Ft===null){jt=Xt(q,hr,$e,null,Xe),br=new mt.Request(wt,$e,null,jt,Xe);var sr=new K.Plan($e,br);$e.addPlan(sr)}else jt=Xt(q,hr,$e,Ft,Xe),br=Ft.addChildRequest(Xe.serviceIdentifier,jt,Xe);jt.forEach(function(j){var ie=null;if(Xe.isArray())ie=br.addChildRequest(j.serviceIdentifier,j,Xe);else{if(j.cache)return;ie=br}if(j.type===d.BindingTypeEnum.Instance&&j.implementationType!==null){var Re=Qe.getDependencies(q,j.implementationType);if(!$e.container.options.skipBaseClassChecks){var ye=Qe.getBaseClassDependencyCount(q,j.implementationType);if(Re.length<ye){var _t=E.ARGUMENTS_LENGTH_MISMATCH(Qe.getFunctionName(j.implementationType));throw new Error(_t)}}Re.forEach(function(dt){Ut(q,!1,dt.serviceIdentifier,$e,ie,dt)})}})}function St(q,hr){var wt=[],$e=Cr(q);return $e.hasKey(hr)?wt=$e.get(hr):q.parent!==null&&(wt=St(q.parent,hr)),wt}function Et(q,hr,wt,$e,Ft,Xe,jt,br){br===void 0&&(br=!1);var sr=new oe.Context(hr),j=Qt(wt,$e,Ft,"",Xe,jt);try{return Ut(q,br,Ft,sr,null,j),sr}catch(ie){throw te.isStackOverflowExeption(ie)&&sr.plan&&ue.circularDependencyToException(sr.plan.rootRequest),ie}}N.plan=Et;function yr(q,hr,wt,$e){var Ft=new Zt.Target(d.TargetTypeEnum.Variable,"",hr,new Ne.Metadata(wt,$e)),Xe=new oe.Context(q),jt=new mt.Request(hr,Xe,null,[],Ft);return jt}N.createMockRequest=yr},88460:function(zr,N){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.QueryableString=void 0;var S=function(){function ce(E){this.str=E}return ce.prototype.startsWith=function(E){return this.str.indexOf(E)===0},ce.prototype.endsWith=function(E){var d="",me=E.split("").reverse().join("");return d=this.str.split("").reverse().join(""),this.startsWith.call({str:d},me)},ce.prototype.contains=function(E){return this.str.indexOf(E)!==-1},ce.prototype.equals=function(E){return this.str===E},ce.prototype.value=function(){return this.str},ce}();N.QueryableString=S},6e3:function(zr,N,S){"use strict";var ce=this&&this.__spreadArray||function(Xt,rr){for(var Ut=0,St=rr.length,Et=Xt.length;Ut<St;Ut++,Et++)Xt[Et]=rr[Ut];return Xt};Object.defineProperty(N,"__esModule",{value:!0}),N.getFunctionName=N.getBaseClassDependencyCount=N.getDependencies=void 0;var E=S(5744),d=S(16674),me=S(28421),te=S(6867),ue=S(55800);Object.defineProperty(N,"getFunctionName",{enumerable:!0,get:function(){return ue.getFunctionName}});var oe=S(18924);function Ne(Xt,rr){var Ut=ue.getFunctionName(rr),St=K(Xt,Ut,rr,!1);return St}N.getDependencies=Ne;function K(Xt,rr,Ut,St){var Et=Xt.getConstructorMetadata(Ut),yr=Et.compilerGeneratedMetadata;if(yr===void 0){var q=d.MISSING_INJECTABLE_ANNOTATION+" "+rr+".";throw new Error(q)}var hr=Et.userGeneratedMetadata,wt=Object.keys(hr),$e=Ut.length===0&&wt.length>0,Ft=wt.length>Ut.length,Xe=$e||Ft?wt.length:Ut.length,jt=mt(St,rr,yr,hr,Xe),br=Zt(Xt,Ut),sr=ce(ce([],jt),br);return sr}function Qe(Xt,rr,Ut,St,Et){var yr=Et[Xt.toString()]||[],q=Qt(yr),hr=q.unmanaged!==!0,wt=St[Xt],$e=q.inject||q.multiInject;if(wt=$e||wt,wt instanceof E.LazyServiceIdentifer&&(wt=wt.unwrap()),hr){var Ft=wt===Object,Xe=wt===Function,jt=wt===void 0,br=Ft||Xe||jt;if(!rr&&br){var sr=d.MISSING_INJECT_ANNOTATION+" argument "+Xt+" in class "+Ut+".";throw new Error(sr)}var j=new oe.Target(me.TargetTypeEnum.ConstructorArgument,q.targetName,wt);return j.metadata=yr,j}return null}function mt(Xt,rr,Ut,St,Et){for(var yr=[],q=0;q<Et;q++){var hr=q,wt=Qe(hr,Xt,rr,Ut,St);wt!==null&&yr.push(wt)}return yr}function Zt(Xt,rr){for(var Ut=Xt.getPropertiesMetadata(rr),St=[],Et=Object.keys(Ut),yr=0,q=Et;yr<q.length;yr++){var hr=q[yr],wt=Ut[hr],$e=Qt(Ut[hr]),Ft=$e.targetName||hr,Xe=$e.inject||$e.multiInject,jt=new oe.Target(me.TargetTypeEnum.ClassProperty,Ft,Xe);jt.metadata=wt,St.push(jt)}var br=Object.getPrototypeOf(rr.prototype).constructor;if(br!==Object){var sr=Zt(Xt,br);St=ce(ce([],St),sr)}return St}function Cr(Xt,rr){var Ut=Object.getPrototypeOf(rr.prototype).constructor;if(Ut!==Object){var St=ue.getFunctionName(Ut),Et=K(Xt,St,Ut,!0),yr=Et.map(function(wt){return wt.metadata.filter(function($e){return $e.key===te.UNMANAGED_TAG})}),q=[].concat.apply([],yr).length,hr=Et.length-q;return hr>0?hr:Cr(Xt,Ut)}else return 0}N.getBaseClassDependencyCount=Cr;function Qt(Xt){var rr={};return Xt.forEach(function(Ut){rr[Ut.key.toString()]=Ut.value}),{inject:rr[te.INJECT_TAG],multiInject:rr[te.MULTI_INJECT_TAG],targetName:rr[te.NAME_TAG],unmanaged:rr[te.UNMANAGED_TAG]}}},6748:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.Request=void 0;var ce=S(37791),E=function(){function d(me,te,ue,oe,Ne){this.id=ce.id(),this.serviceIdentifier=me,this.parentContext=te,this.parentRequest=ue,this.target=Ne,this.childRequests=[],this.bindings=Array.isArray(oe)?oe:[oe],this.requestScope=ue===null?new Map:null}return d.prototype.addChildRequest=function(me,te,ue){var oe=new d(me,this.parentContext,this,te,ue);return this.childRequests.push(oe),oe},d}();N.Request=E},18924:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.Target=void 0;var ce=S(6867),E=S(37791),d=S(47738),me=S(88460),te=function(){function ue(oe,Ne,K,Qe){this.id=E.id(),this.type=oe,this.serviceIdentifier=K,this.name=new me.QueryableString(Ne||""),this.metadata=new Array;var mt=null;typeof Qe=="string"?mt=new d.Metadata(ce.NAMED_TAG,Qe):Qe instanceof d.Metadata&&(mt=Qe),mt!==null&&this.metadata.push(mt)}return ue.prototype.hasTag=function(oe){for(var Ne=0,K=this.metadata;Ne<K.length;Ne++){var Qe=K[Ne];if(Qe.key===oe)return!0}return!1},ue.prototype.isArray=function(){return this.hasTag(ce.MULTI_INJECT_TAG)},ue.prototype.matchesArray=function(oe){return this.matchesTag(ce.MULTI_INJECT_TAG)(oe)},ue.prototype.isNamed=function(){return this.hasTag(ce.NAMED_TAG)},ue.prototype.isTagged=function(){return this.metadata.some(function(oe){return ce.NON_CUSTOM_TAG_KEYS.every(function(Ne){return oe.key!==Ne})})},ue.prototype.isOptional=function(){return this.matchesTag(ce.OPTIONAL_TAG)(!0)},ue.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(oe){return oe.key===ce.NAMED_TAG})[0]:null},ue.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(oe){return ce.NON_CUSTOM_TAG_KEYS.every(function(Ne){return oe.key!==Ne})}):null},ue.prototype.matchesNamedTag=function(oe){return this.matchesTag(ce.NAMED_TAG)(oe)},ue.prototype.matchesTag=function(oe){var Ne=this;return function(K){for(var Qe=0,mt=Ne.metadata;Qe<mt.length;Qe++){var Zt=mt[Qe];if(Zt.key===oe&&Zt.value===K)return!0}return!1}},ue}();N.Target=te},52279:function(zr,N,S){"use strict";var ce=this&&this.__spreadArray||function(K,Qe){for(var mt=0,Zt=Qe.length,Cr=K.length;mt<Zt;mt++,Cr++)K[Cr]=Qe[mt];return K};Object.defineProperty(N,"__esModule",{value:!0}),N.resolveInstance=void 0;var E=S(16674),d=S(28421),me=S(6867);function te(K,Qe,mt){var Zt=Qe.filter(function(Qt){return Qt.target!==null&&Qt.target.type===d.TargetTypeEnum.ClassProperty}),Cr=Zt.map(mt);return Zt.forEach(function(Qt,Xt){var rr="";rr=Qt.target.name.value();var Ut=Cr[Xt];K[rr]=Ut}),K}function ue(K,Qe){return new(K.bind.apply(K,ce([void 0],Qe)))}function oe(K,Qe){if(Reflect.hasMetadata(me.POST_CONSTRUCT,K)){var mt=Reflect.getMetadata(me.POST_CONSTRUCT,K);try{Qe[mt.value]()}catch(Zt){throw new Error(E.POST_CONSTRUCT_ERROR(K.name,Zt.message))}}}function Ne(K,Qe,mt){var Zt=null;if(Qe.length>0){var Cr=Qe.filter(function(Xt){return Xt.target!==null&&Xt.target.type===d.TargetTypeEnum.ConstructorArgument}),Qt=Cr.map(mt);Zt=ue(K,Qt),Zt=te(Zt,Qe,mt)}else Zt=new K;return oe(K,Zt),Zt}N.resolveInstance=Ne},31927:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.resolve=void 0;var ce=S(16674),E=S(28421),d=S(85265),me=S(55800),te=S(52279),ue=function(K,Qe,mt){try{return mt()}catch(Zt){throw d.isStackOverflowExeption(Zt)?new Error(ce.CIRCULAR_DEPENDENCY_IN_FACTORY(K,Qe.toString())):Zt}},oe=function(K){return function(Qe){Qe.parentContext.setCurrentRequest(Qe);var mt=Qe.bindings,Zt=Qe.childRequests,Cr=Qe.target&&Qe.target.isArray(),Qt=!Qe.parentRequest||!Qe.parentRequest.target||!Qe.target||!Qe.parentRequest.target.matchesArray(Qe.target.serviceIdentifier);if(Cr&&Qt)return Zt.map(function(yr){var q=oe(K);return q(yr)});var Xt=null;if(Qe.target.isOptional()&&mt.length===0)return;var rr=mt[0],Ut=rr.scope===E.BindingScopeEnum.Singleton,St=rr.scope===E.BindingScopeEnum.Request;if(Ut&&rr.activated)return rr.cache;if(St&&K!==null&&K.has(rr.id))return K.get(rr.id);if(rr.type===E.BindingTypeEnum.ConstantValue)Xt=rr.cache,rr.activated=!0;else if(rr.type===E.BindingTypeEnum.Function)Xt=rr.cache,rr.activated=!0;else if(rr.type===E.BindingTypeEnum.Constructor)Xt=rr.implementationType;else if(rr.type===E.BindingTypeEnum.DynamicValue&&rr.dynamicValue!==null)Xt=ue("toDynamicValue",rr.serviceIdentifier,function(){return rr.dynamicValue(Qe.parentContext)});else if(rr.type===E.BindingTypeEnum.Factory&&rr.factory!==null)Xt=ue("toFactory",rr.serviceIdentifier,function(){return rr.factory(Qe.parentContext)});else if(rr.type===E.BindingTypeEnum.Provider&&rr.provider!==null)Xt=ue("toProvider",rr.serviceIdentifier,function(){return rr.provider(Qe.parentContext)});else if(rr.type===E.BindingTypeEnum.Instance&&rr.implementationType!==null)Xt=te.resolveInstance(rr.implementationType,Zt,oe(K));else{var Et=me.getServiceIdentifierAsString(Qe.serviceIdentifier);throw new Error(ce.INVALID_BINDING_TYPE+" "+Et)}return typeof rr.onActivation=="function"&&(Xt=rr.onActivation(Qe.parentContext,Xt)),Ut&&(rr.cache=Xt,rr.activated=!0),St&&K!==null&&!K.has(rr.id)&&K.set(rr.id,Xt),Xt}};function Ne(K){var Qe=oe(K.plan.rootRequest.requestScope);return Qe(K.plan.rootRequest)}N.resolve=Ne},83366:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.BindingInSyntax=void 0;var ce=S(28421),E=S(71325),d=function(){function me(te){this._binding=te}return me.prototype.inRequestScope=function(){return this._binding.scope=ce.BindingScopeEnum.Request,new E.BindingWhenOnSyntax(this._binding)},me.prototype.inSingletonScope=function(){return this._binding.scope=ce.BindingScopeEnum.Singleton,new E.BindingWhenOnSyntax(this._binding)},me.prototype.inTransientScope=function(){return this._binding.scope=ce.BindingScopeEnum.Transient,new E.BindingWhenOnSyntax(this._binding)},me}();N.BindingInSyntax=d},74889:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.BindingInWhenOnSyntax=void 0;var ce=S(83366),E=S(51811),d=S(98370),me=function(){function te(ue){this._binding=ue,this._bindingWhenSyntax=new d.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new E.BindingOnSyntax(this._binding),this._bindingInSyntax=new ce.BindingInSyntax(ue)}return te.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},te.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},te.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},te.prototype.when=function(ue){return this._bindingWhenSyntax.when(ue)},te.prototype.whenTargetNamed=function(ue){return this._bindingWhenSyntax.whenTargetNamed(ue)},te.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},te.prototype.whenTargetTagged=function(ue,oe){return this._bindingWhenSyntax.whenTargetTagged(ue,oe)},te.prototype.whenInjectedInto=function(ue){return this._bindingWhenSyntax.whenInjectedInto(ue)},te.prototype.whenParentNamed=function(ue){return this._bindingWhenSyntax.whenParentNamed(ue)},te.prototype.whenParentTagged=function(ue,oe){return this._bindingWhenSyntax.whenParentTagged(ue,oe)},te.prototype.whenAnyAncestorIs=function(ue){return this._bindingWhenSyntax.whenAnyAncestorIs(ue)},te.prototype.whenNoAncestorIs=function(ue){return this._bindingWhenSyntax.whenNoAncestorIs(ue)},te.prototype.whenAnyAncestorNamed=function(ue){return this._bindingWhenSyntax.whenAnyAncestorNamed(ue)},te.prototype.whenAnyAncestorTagged=function(ue,oe){return this._bindingWhenSyntax.whenAnyAncestorTagged(ue,oe)},te.prototype.whenNoAncestorNamed=function(ue){return this._bindingWhenSyntax.whenNoAncestorNamed(ue)},te.prototype.whenNoAncestorTagged=function(ue,oe){return this._bindingWhenSyntax.whenNoAncestorTagged(ue,oe)},te.prototype.whenAnyAncestorMatches=function(ue){return this._bindingWhenSyntax.whenAnyAncestorMatches(ue)},te.prototype.whenNoAncestorMatches=function(ue){return this._bindingWhenSyntax.whenNoAncestorMatches(ue)},te.prototype.onActivation=function(ue){return this._bindingOnSyntax.onActivation(ue)},te}();N.BindingInWhenOnSyntax=me},51811:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.BindingOnSyntax=void 0;var ce=S(98370),E=function(){function d(me){this._binding=me}return d.prototype.onActivation=function(me){return this._binding.onActivation=me,new ce.BindingWhenSyntax(this._binding)},d}();N.BindingOnSyntax=E},15451:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.BindingToSyntax=void 0;var ce=S(16674),E=S(28421),d=S(74889),me=S(71325),te=function(){function ue(oe){this._binding=oe}return ue.prototype.to=function(oe){return this._binding.type=E.BindingTypeEnum.Instance,this._binding.implementationType=oe,new d.BindingInWhenOnSyntax(this._binding)},ue.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+ce.INVALID_TO_SELF_VALUE);var oe=this._binding.serviceIdentifier;return this.to(oe)},ue.prototype.toConstantValue=function(oe){return this._binding.type=E.BindingTypeEnum.ConstantValue,this._binding.cache=oe,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=E.BindingScopeEnum.Singleton,new me.BindingWhenOnSyntax(this._binding)},ue.prototype.toDynamicValue=function(oe){return this._binding.type=E.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=oe,this._binding.implementationType=null,new d.BindingInWhenOnSyntax(this._binding)},ue.prototype.toConstructor=function(oe){return this._binding.type=E.BindingTypeEnum.Constructor,this._binding.implementationType=oe,this._binding.scope=E.BindingScopeEnum.Singleton,new me.BindingWhenOnSyntax(this._binding)},ue.prototype.toFactory=function(oe){return this._binding.type=E.BindingTypeEnum.Factory,this._binding.factory=oe,this._binding.scope=E.BindingScopeEnum.Singleton,new me.BindingWhenOnSyntax(this._binding)},ue.prototype.toFunction=function(oe){if(typeof oe!="function")throw new Error(ce.INVALID_FUNCTION_BINDING);var Ne=this.toConstantValue(oe);return this._binding.type=E.BindingTypeEnum.Function,this._binding.scope=E.BindingScopeEnum.Singleton,Ne},ue.prototype.toAutoFactory=function(oe){return this._binding.type=E.BindingTypeEnum.Factory,this._binding.factory=function(Ne){var K=function(){return Ne.container.get(oe)};return K},this._binding.scope=E.BindingScopeEnum.Singleton,new me.BindingWhenOnSyntax(this._binding)},ue.prototype.toProvider=function(oe){return this._binding.type=E.BindingTypeEnum.Provider,this._binding.provider=oe,this._binding.scope=E.BindingScopeEnum.Singleton,new me.BindingWhenOnSyntax(this._binding)},ue.prototype.toService=function(oe){this.toDynamicValue(function(Ne){return Ne.container.get(oe)})},ue}();N.BindingToSyntax=te},71325:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.BindingWhenOnSyntax=void 0;var ce=S(51811),E=S(98370),d=function(){function me(te){this._binding=te,this._bindingWhenSyntax=new E.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ce.BindingOnSyntax(this._binding)}return me.prototype.when=function(te){return this._bindingWhenSyntax.when(te)},me.prototype.whenTargetNamed=function(te){return this._bindingWhenSyntax.whenTargetNamed(te)},me.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},me.prototype.whenTargetTagged=function(te,ue){return this._bindingWhenSyntax.whenTargetTagged(te,ue)},me.prototype.whenInjectedInto=function(te){return this._bindingWhenSyntax.whenInjectedInto(te)},me.prototype.whenParentNamed=function(te){return this._bindingWhenSyntax.whenParentNamed(te)},me.prototype.whenParentTagged=function(te,ue){return this._bindingWhenSyntax.whenParentTagged(te,ue)},me.prototype.whenAnyAncestorIs=function(te){return this._bindingWhenSyntax.whenAnyAncestorIs(te)},me.prototype.whenNoAncestorIs=function(te){return this._bindingWhenSyntax.whenNoAncestorIs(te)},me.prototype.whenAnyAncestorNamed=function(te){return this._bindingWhenSyntax.whenAnyAncestorNamed(te)},me.prototype.whenAnyAncestorTagged=function(te,ue){return this._bindingWhenSyntax.whenAnyAncestorTagged(te,ue)},me.prototype.whenNoAncestorNamed=function(te){return this._bindingWhenSyntax.whenNoAncestorNamed(te)},me.prototype.whenNoAncestorTagged=function(te,ue){return this._bindingWhenSyntax.whenNoAncestorTagged(te,ue)},me.prototype.whenAnyAncestorMatches=function(te){return this._bindingWhenSyntax.whenAnyAncestorMatches(te)},me.prototype.whenNoAncestorMatches=function(te){return this._bindingWhenSyntax.whenNoAncestorMatches(te)},me.prototype.onActivation=function(te){return this._bindingOnSyntax.onActivation(te)},me}();N.BindingWhenOnSyntax=d},98370:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.BindingWhenSyntax=void 0;var ce=S(51811),E=S(80758),d=function(){function me(te){this._binding=te}return me.prototype.when=function(te){return this._binding.constraint=te,new ce.BindingOnSyntax(this._binding)},me.prototype.whenTargetNamed=function(te){return this._binding.constraint=E.namedConstraint(te),new ce.BindingOnSyntax(this._binding)},me.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(te){var ue=te.target!==null&&!te.target.isNamed()&&!te.target.isTagged();return ue},new ce.BindingOnSyntax(this._binding)},me.prototype.whenTargetTagged=function(te,ue){return this._binding.constraint=E.taggedConstraint(te)(ue),new ce.BindingOnSyntax(this._binding)},me.prototype.whenInjectedInto=function(te){return this._binding.constraint=function(ue){return E.typeConstraint(te)(ue.parentRequest)},new ce.BindingOnSyntax(this._binding)},me.prototype.whenParentNamed=function(te){return this._binding.constraint=function(ue){return E.namedConstraint(te)(ue.parentRequest)},new ce.BindingOnSyntax(this._binding)},me.prototype.whenParentTagged=function(te,ue){return this._binding.constraint=function(oe){return E.taggedConstraint(te)(ue)(oe.parentRequest)},new ce.BindingOnSyntax(this._binding)},me.prototype.whenAnyAncestorIs=function(te){return this._binding.constraint=function(ue){return E.traverseAncerstors(ue,E.typeConstraint(te))},new ce.BindingOnSyntax(this._binding)},me.prototype.whenNoAncestorIs=function(te){return this._binding.constraint=function(ue){return!E.traverseAncerstors(ue,E.typeConstraint(te))},new ce.BindingOnSyntax(this._binding)},me.prototype.whenAnyAncestorNamed=function(te){return this._binding.constraint=function(ue){return E.traverseAncerstors(ue,E.namedConstraint(te))},new ce.BindingOnSyntax(this._binding)},me.prototype.whenNoAncestorNamed=function(te){return this._binding.constraint=function(ue){return!E.traverseAncerstors(ue,E.namedConstraint(te))},new ce.BindingOnSyntax(this._binding)},me.prototype.whenAnyAncestorTagged=function(te,ue){return this._binding.constraint=function(oe){return E.traverseAncerstors(oe,E.taggedConstraint(te)(ue))},new ce.BindingOnSyntax(this._binding)},me.prototype.whenNoAncestorTagged=function(te,ue){return this._binding.constraint=function(oe){return!E.traverseAncerstors(oe,E.taggedConstraint(te)(ue))},new ce.BindingOnSyntax(this._binding)},me.prototype.whenAnyAncestorMatches=function(te){return this._binding.constraint=function(ue){return E.traverseAncerstors(ue,te)},new ce.BindingOnSyntax(this._binding)},me.prototype.whenNoAncestorMatches=function(te){return this._binding.constraint=function(ue){return!E.traverseAncerstors(ue,te)},new ce.BindingOnSyntax(this._binding)},me}();N.BindingWhenSyntax=d},80758:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.typeConstraint=N.namedConstraint=N.taggedConstraint=N.traverseAncerstors=void 0;var ce=S(6867),E=S(47738),d=function(oe,Ne){var K=oe.parentRequest;return K!==null?Ne(K)?!0:d(K,Ne):!1};N.traverseAncerstors=d;var me=function(oe){return function(Ne){var K=function(Qe){return Qe!==null&&Qe.target!==null&&Qe.target.matchesTag(oe)(Ne)};return K.metaData=new E.Metadata(oe,Ne),K}};N.taggedConstraint=me;var te=me(ce.NAMED_TAG);N.namedConstraint=te;var ue=function(oe){return function(Ne){var K=null;if(Ne!==null)if(K=Ne.bindings[0],typeof oe=="string"){var Qe=K.serviceIdentifier;return Qe===oe}else{var mt=Ne.bindings[0].implementationType;return oe===mt}return!1}};N.typeConstraint=ue},70600:function(zr,N){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.multiBindToService=void 0;var S=function(ce){return function(E){return function(){for(var d=[],me=0;me<arguments.length;me++)d[me]=arguments[me];return d.forEach(function(te){return ce.bind(te).toService(E)})}}};N.multiBindToService=S},85265:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.isStackOverflowExeption=void 0;var ce=S(16674);function E(d){return d instanceof RangeError||d.message===ce.STACK_OVERFLOW}N.isStackOverflowExeption=E},37791:function(zr,N){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.id=void 0;var S=0;function ce(){return S++}N.id=ce},55800:function(zr,N,S){"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.circularDependencyToException=N.listMetadataForTarget=N.listRegisteredBindingsForServiceIdentifier=N.getServiceIdentifierAsString=N.getFunctionName=void 0;var ce=S(16674);function E(K){if(typeof K=="function"){var Qe=K;return Qe.name}else{if(typeof K=="symbol")return K.toString();var Qe=K;return Qe}}N.getServiceIdentifierAsString=E;function d(K,Qe,mt){var Zt="",Cr=mt(K,Qe);return Cr.length!==0&&(Zt=`
Registered bindings:`,Cr.forEach(function(Qt){var Xt="Object";Qt.implementationType!==null&&(Xt=Ne(Qt.implementationType)),Zt=Zt+`
 `+Xt,Qt.constraint.metaData&&(Zt=Zt+" - "+Qt.constraint.metaData)})),Zt}N.listRegisteredBindingsForServiceIdentifier=d;function me(K,Qe){return K.parentRequest===null?!1:K.parentRequest.serviceIdentifier===Qe?!0:me(K.parentRequest,Qe)}function te(K){function Qe(Zt,Cr){Cr===void 0&&(Cr=[]);var Qt=E(Zt.serviceIdentifier);return Cr.push(Qt),Zt.parentRequest!==null?Qe(Zt.parentRequest,Cr):Cr}var mt=Qe(K);return mt.reverse().join(" --> ")}function ue(K){K.childRequests.forEach(function(Qe){if(me(Qe,Qe.serviceIdentifier)){var mt=te(Qe);throw new Error(ce.CIRCULAR_DEPENDENCY+" "+mt)}else ue(Qe)})}N.circularDependencyToException=ue;function oe(K,Qe){if(Qe.isTagged()||Qe.isNamed()){var mt="",Zt=Qe.getNamedTag(),Cr=Qe.getCustomTags();return Zt!==null&&(mt+=Zt.toString()+`
`),Cr!==null&&Cr.forEach(function(Qt){mt+=Qt.toString()+`
`})," "+K+`
 `+K+" - "+mt}else return" "+K}N.listMetadataForTarget=oe;function Ne(K){if(K.name)return K.name;var Qe=K.toString(),mt=Qe.match(/^function\s*([^\s(]+)/);return mt?mt[1]:"Anonymous function: "+Qe}N.getFunctionName=Ne},18857:function(zr,N,S){"use strict";S.r(N),S.d(N,{Function:function(){return Zs},Interpreter:function(){return Co},default:function(){return gl},evaluate:function(){return Du},vm:function(){return ce}});var ce={};S.r(ce),S.d(ce,{Script:function(){return ml},compileFunction:function(){return vl},createContext:function(){return dl},runInContext:function(){return Ku},runInNewContext:function(){return Xl}});var E={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},d="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",me={5:d,"5module":d+" export import",6:d+" const class extends export import super"},te=/^in(stanceof)?$/,ue="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",oe="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Ne=new RegExp("["+ue+"]"),K=new RegExp("["+ue+oe+"]");ue=oe=null;var Qe=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],mt=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function Zt(m,A){for(var z=65536,I=0;I<A.length;I+=2){if(z+=A[I],z>m)return!1;if(z+=A[I+1],z>=m)return!0}}function Cr(m,A){return m<65?m===36:m<91?!0:m<97?m===95:m<123?!0:m<=65535?m>=170&&Ne.test(String.fromCharCode(m)):A===!1?!1:Zt(m,Qe)}function Qt(m,A){return m<48?m===36:m<58?!0:m<65?!1:m<91?!0:m<97?m===95:m<123?!0:m<=65535?m>=170&&K.test(String.fromCharCode(m)):A===!1?!1:Zt(m,Qe)||Zt(m,mt)}var Xt=function(A,z){z===void 0&&(z={}),this.label=A,this.keyword=z.keyword,this.beforeExpr=!!z.beforeExpr,this.startsExpr=!!z.startsExpr,this.isLoop=!!z.isLoop,this.isAssign=!!z.isAssign,this.prefix=!!z.prefix,this.postfix=!!z.postfix,this.binop=z.binop||null,this.updateContext=null};function rr(m,A){return new Xt(m,{beforeExpr:!0,binop:A})}var Ut={beforeExpr:!0},St={startsExpr:!0},Et={};function yr(m,A){return A===void 0&&(A={}),A.keyword=m,Et[m]=new Xt(m,A)}var q={num:new Xt("num",St),regexp:new Xt("regexp",St),string:new Xt("string",St),name:new Xt("name",St),eof:new Xt("eof"),bracketL:new Xt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Xt("]"),braceL:new Xt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Xt("}"),parenL:new Xt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Xt(")"),comma:new Xt(",",Ut),semi:new Xt(";",Ut),colon:new Xt(":",Ut),dot:new Xt("."),question:new Xt("?",Ut),questionDot:new Xt("?."),arrow:new Xt("=>",Ut),template:new Xt("template"),invalidTemplate:new Xt("invalidTemplate"),ellipsis:new Xt("...",Ut),backQuote:new Xt("`",St),dollarBraceL:new Xt("${",{beforeExpr:!0,startsExpr:!0}),eq:new Xt("=",{beforeExpr:!0,isAssign:!0}),assign:new Xt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Xt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Xt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:rr("||",1),logicalAND:rr("&&",2),bitwiseOR:rr("|",3),bitwiseXOR:rr("^",4),bitwiseAND:rr("&",5),equality:rr("==/!=/===/!==",6),relational:rr("</>/<=/>=",7),bitShift:rr("<</>>/>>>",8),plusMin:new Xt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:rr("%",10),star:rr("*",10),slash:rr("/",10),starstar:new Xt("**",{beforeExpr:!0}),coalesce:rr("??",1),_break:yr("break"),_case:yr("case",Ut),_catch:yr("catch"),_continue:yr("continue"),_debugger:yr("debugger"),_default:yr("default",Ut),_do:yr("do",{isLoop:!0,beforeExpr:!0}),_else:yr("else",Ut),_finally:yr("finally"),_for:yr("for",{isLoop:!0}),_function:yr("function",St),_if:yr("if"),_return:yr("return",Ut),_switch:yr("switch"),_throw:yr("throw",Ut),_try:yr("try"),_var:yr("var"),_const:yr("const"),_while:yr("while",{isLoop:!0}),_with:yr("with"),_new:yr("new",{beforeExpr:!0,startsExpr:!0}),_this:yr("this",St),_super:yr("super",St),_class:yr("class",St),_extends:yr("extends",Ut),_export:yr("export"),_import:yr("import",St),_null:yr("null",St),_true:yr("true",St),_false:yr("false",St),_in:yr("in",{beforeExpr:!0,binop:7}),_instanceof:yr("instanceof",{beforeExpr:!0,binop:7}),_typeof:yr("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:yr("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:yr("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},hr=/\r\n?|\n|\u2028|\u2029/,wt=new RegExp(hr.source,"g");function $e(m,A){return m===10||m===13||!A&&(m===8232||m===8233)}var Ft=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Xe=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,jt=Object.prototype,br=jt.hasOwnProperty,sr=jt.toString;function j(m,A){return br.call(m,A)}var ie=Array.isArray||function(m){return sr.call(m)==="[object Array]"};function Re(m){return new RegExp("^(?:"+m.replace(/ /g,"|")+")$")}var ye=function(A,z){this.line=A,this.column=z};ye.prototype.offset=function(A){return new ye(this.line,this.column+A)};var _t=function(A,z,I){this.start=z,this.end=I,A.sourceFile!==null&&(this.source=A.sourceFile)};function dt(m,A){for(var z=1,I=0;;){wt.lastIndex=I;var fe=wt.exec(m);if(fe&&fe.index<A)++z,I=fe.index+fe[0].length;else return new ye(z,A-I)}}var zt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Bt(m){var A={};for(var z in zt)A[z]=m&&j(m,z)?m[z]:zt[z];if(A.ecmaVersion>=2015&&(A.ecmaVersion-=2009),A.allowReserved==null&&(A.allowReserved=A.ecmaVersion<5),ie(A.onToken)){var I=A.onToken;A.onToken=function(fe){return I.push(fe)}}return ie(A.onComment)&&(A.onComment=Ur(A,A.onComment)),A}function Ur(m,A){return function(z,I,fe,Ie,lt,Dt){var Nt={type:z?"Block":"Line",value:I,start:fe,end:Ie};m.locations&&(Nt.loc=new _t(this,lt,Dt)),m.ranges&&(Nt.range=[fe,Ie]),A.push(Nt)}}var vn=1,En=2,ea=vn|En,ar=4,ge=8,Te=16,Ze=32,Oe=64,Lt=128;function nr(m,A){return En|(m?ar:0)|(A?ge:0)}var dr=0,Or=1,lr=2,un=3,w=4,H=5,Ue=function(A,z,I){this.options=A=Bt(A),this.sourceFile=A.sourceFile,this.keywords=Re(me[A.ecmaVersion>=6?6:A.sourceType==="module"?"5module":5]);var fe="";if(A.allowReserved!==!0){for(var Ie=A.ecmaVersion;!(fe=E[Ie]);Ie--);A.sourceType==="module"&&(fe+=" await")}this.reservedWords=Re(fe);var lt=(fe?fe+" ":"")+E.strict;this.reservedWordsStrict=Re(lt),this.reservedWordsStrictBind=Re(lt+" "+E.strictBind),this.input=String(z),this.containsEsc=!1,I?(this.pos=I,this.lineStart=this.input.lastIndexOf(`
`,I-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(hr).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=q.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=A.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&A.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(vn),this.regexpState=null},et={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Ue.prototype.parse=function(){var A=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(A)},et.inFunction.get=function(){return(this.currentVarScope().flags&En)>0},et.inGenerator.get=function(){return(this.currentVarScope().flags&ge)>0},et.inAsync.get=function(){return(this.currentVarScope().flags&ar)>0},et.allowSuper.get=function(){return(this.currentThisScope().flags&Oe)>0},et.allowDirectSuper.get=function(){return(this.currentThisScope().flags&Lt)>0},et.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Ue.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&En)>0},Ue.extend=function(){for(var A=[],z=arguments.length;z--;)A[z]=arguments[z];for(var I=this,fe=0;fe<A.length;fe++)I=A[fe](I);return I},Ue.parse=function(A,z){return new this(z,A).parse()},Ue.parseExpressionAt=function(A,z,I){var fe=new this(I,A,z);return fe.nextToken(),fe.parseExpression()},Ue.tokenizer=function(A,z){return new this(z,A)},Object.defineProperties(Ue.prototype,et);var st=Ue.prototype,Ct=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;st.strictDirective=function(m){for(;;){Xe.lastIndex=m,m+=Xe.exec(this.input)[0].length;var A=Ct.exec(this.input.slice(m));if(!A)return!1;if((A[1]||A[2])==="use strict"){Xe.lastIndex=m+A[0].length;var z=Xe.exec(this.input),I=z.index+z[0].length,fe=this.input.charAt(I);return fe===";"||fe==="}"||hr.test(z[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(fe)||fe==="!"&&this.input.charAt(I+1)==="=")}m+=A[0].length,Xe.lastIndex=m,m+=Xe.exec(this.input)[0].length,this.input[m]===";"&&m++}},st.eat=function(m){return this.type===m?(this.next(),!0):!1},st.isContextual=function(m){return this.type===q.name&&this.value===m&&!this.containsEsc},st.eatContextual=function(m){return this.isContextual(m)?(this.next(),!0):!1},st.expectContextual=function(m){this.eatContextual(m)||this.unexpected()},st.canInsertSemicolon=function(){return this.type===q.eof||this.type===q.braceR||hr.test(this.input.slice(this.lastTokEnd,this.start))},st.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},st.semicolon=function(){!this.eat(q.semi)&&!this.insertSemicolon()&&this.unexpected()},st.afterTrailingComma=function(m,A){if(this.type===m)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),A||this.next(),!0},st.expect=function(m){this.eat(m)||this.unexpected()},st.unexpected=function(m){this.raise(m!=null?m:this.start,"Unexpected token")};function $(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}st.checkPatternErrors=function(m,A){if(!!m){m.trailingComma>-1&&this.raiseRecoverable(m.trailingComma,"Comma is not permitted after the rest element");var z=A?m.parenthesizedAssign:m.parenthesizedBind;z>-1&&this.raiseRecoverable(z,"Parenthesized pattern")}},st.checkExpressionErrors=function(m,A){if(!m)return!1;var z=m.shorthandAssign,I=m.doubleProto;if(!A)return z>=0||I>=0;z>=0&&this.raise(z,"Shorthand property assignments are valid only in destructuring patterns"),I>=0&&this.raiseRecoverable(I,"Redefinition of __proto__ property")},st.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},st.isSimpleAssignTarget=function(m){return m.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(m.expression):m.type==="Identifier"||m.type==="MemberExpression"};var Gt=Ue.prototype;Gt.parseTopLevel=function(m){var A={};for(m.body||(m.body=[]);this.type!==q.eof;){var z=this.parseStatement(null,!0,A);m.body.push(z)}if(this.inModule)for(var I=0,fe=Object.keys(this.undefinedExports);I<fe.length;I+=1){var Ie=fe[I];this.raiseRecoverable(this.undefinedExports[Ie].start,"Export '"+Ie+"' is not defined")}return this.adaptDirectivePrologue(m.body),this.next(),m.sourceType=this.options.sourceType,this.finishNode(m,"Program")};var Tr={kind:"loop"},Ir={kind:"switch"};Gt.isLet=function(m){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Xe.lastIndex=this.pos;var A=Xe.exec(this.input),z=this.pos+A[0].length,I=this.input.charCodeAt(z);if(I===91)return!0;if(m)return!1;if(I===123)return!0;if(Cr(I,!0)){for(var fe=z+1;Qt(this.input.charCodeAt(fe),!0);)++fe;var Ie=this.input.slice(z,fe);if(!te.test(Ie))return!0}return!1},Gt.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Xe.lastIndex=this.pos;var m=Xe.exec(this.input),A=this.pos+m[0].length;return!hr.test(this.input.slice(this.pos,A))&&this.input.slice(A,A+8)==="function"&&(A+8===this.input.length||!Qt(this.input.charAt(A+8)))},Gt.parseStatement=function(m,A,z){var I=this.type,fe=this.startNode(),Ie;switch(this.isLet(m)&&(I=q._var,Ie="let"),I){case q._break:case q._continue:return this.parseBreakContinueStatement(fe,I.keyword);case q._debugger:return this.parseDebuggerStatement(fe);case q._do:return this.parseDoStatement(fe);case q._for:return this.parseForStatement(fe);case q._function:return m&&(this.strict||m!=="if"&&m!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(fe,!1,!m);case q._class:return m&&this.unexpected(),this.parseClass(fe,!0);case q._if:return this.parseIfStatement(fe);case q._return:return this.parseReturnStatement(fe);case q._switch:return this.parseSwitchStatement(fe);case q._throw:return this.parseThrowStatement(fe);case q._try:return this.parseTryStatement(fe);case q._const:case q._var:return Ie=Ie||this.value,m&&Ie!=="var"&&this.unexpected(),this.parseVarStatement(fe,Ie);case q._while:return this.parseWhileStatement(fe);case q._with:return this.parseWithStatement(fe);case q.braceL:return this.parseBlock(!0,fe);case q.semi:return this.parseEmptyStatement(fe);case q._export:case q._import:if(this.options.ecmaVersion>10&&I===q._import){Xe.lastIndex=this.pos;var lt=Xe.exec(this.input),Dt=this.pos+lt[0].length,Nt=this.input.charCodeAt(Dt);if(Nt===40||Nt===46)return this.parseExpressionStatement(fe,this.parseExpression())}return this.options.allowImportExportEverywhere||(A||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),I===q._import?this.parseImport(fe):this.parseExport(fe,z);default:if(this.isAsyncFunction())return m&&this.unexpected(),this.next(),this.parseFunctionStatement(fe,!0,!m);var Dr=this.value,Wr=this.parseExpression();return I===q.name&&Wr.type==="Identifier"&&this.eat(q.colon)?this.parseLabeledStatement(fe,Dr,Wr,m):this.parseExpressionStatement(fe,Wr)}},Gt.parseBreakContinueStatement=function(m,A){var z=A==="break";this.next(),this.eat(q.semi)||this.insertSemicolon()?m.label=null:this.type!==q.name?this.unexpected():(m.label=this.parseIdent(),this.semicolon());for(var I=0;I<this.labels.length;++I){var fe=this.labels[I];if((m.label==null||fe.name===m.label.name)&&(fe.kind!=null&&(z||fe.kind==="loop")||m.label&&z))break}return I===this.labels.length&&this.raise(m.start,"Unsyntactic "+A),this.finishNode(m,z?"BreakStatement":"ContinueStatement")},Gt.parseDebuggerStatement=function(m){return this.next(),this.semicolon(),this.finishNode(m,"DebuggerStatement")},Gt.parseDoStatement=function(m){return this.next(),this.labels.push(Tr),m.body=this.parseStatement("do"),this.labels.pop(),this.expect(q._while),m.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(q.semi):this.semicolon(),this.finishNode(m,"DoWhileStatement")},Gt.parseForStatement=function(m){this.next();var A=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Tr),this.enterScope(0),this.expect(q.parenL),this.type===q.semi)return A>-1&&this.unexpected(A),this.parseFor(m,null);var z=this.isLet();if(this.type===q._var||this.type===q._const||z){var I=this.startNode(),fe=z?"let":this.value;return this.next(),this.parseVar(I,!0,fe),this.finishNode(I,"VariableDeclaration"),(this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&I.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===q._in?A>-1&&this.unexpected(A):m.await=A>-1),this.parseForIn(m,I)):(A>-1&&this.unexpected(A),this.parseFor(m,I))}var Ie=new $,lt=this.parseExpression(!0,Ie);return this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===q._in?A>-1&&this.unexpected(A):m.await=A>-1),this.toAssignable(lt,!1,Ie),this.checkLVal(lt),this.parseForIn(m,lt)):(this.checkExpressionErrors(Ie,!0),A>-1&&this.unexpected(A),this.parseFor(m,lt))},Gt.parseFunctionStatement=function(m,A,z){return this.next(),this.parseFunction(m,ut|(z?0:At),!1,A)},Gt.parseIfStatement=function(m){return this.next(),m.test=this.parseParenExpression(),m.consequent=this.parseStatement("if"),m.alternate=this.eat(q._else)?this.parseStatement("if"):null,this.finishNode(m,"IfStatement")},Gt.parseReturnStatement=function(m){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(q.semi)||this.insertSemicolon()?m.argument=null:(m.argument=this.parseExpression(),this.semicolon()),this.finishNode(m,"ReturnStatement")},Gt.parseSwitchStatement=function(m){this.next(),m.discriminant=this.parseParenExpression(),m.cases=[],this.expect(q.braceL),this.labels.push(Ir),this.enterScope(0);for(var A,z=!1;this.type!==q.braceR;)if(this.type===q._case||this.type===q._default){var I=this.type===q._case;A&&this.finishNode(A,"SwitchCase"),m.cases.push(A=this.startNode()),A.consequent=[],this.next(),I?A.test=this.parseExpression():(z&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),z=!0,A.test=null),this.expect(q.colon)}else A||this.unexpected(),A.consequent.push(this.parseStatement(null));return this.exitScope(),A&&this.finishNode(A,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(m,"SwitchStatement")},Gt.parseThrowStatement=function(m){return this.next(),hr.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),m.argument=this.parseExpression(),this.semicolon(),this.finishNode(m,"ThrowStatement")};var Ye=[];Gt.parseTryStatement=function(m){if(this.next(),m.block=this.parseBlock(),m.handler=null,this.type===q._catch){var A=this.startNode();if(this.next(),this.eat(q.parenL)){A.param=this.parseBindingAtom();var z=A.param.type==="Identifier";this.enterScope(z?Ze:0),this.checkLVal(A.param,z?w:lr),this.expect(q.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),A.param=null,this.enterScope(0);A.body=this.parseBlock(!1),this.exitScope(),m.handler=this.finishNode(A,"CatchClause")}return m.finalizer=this.eat(q._finally)?this.parseBlock():null,!m.handler&&!m.finalizer&&this.raise(m.start,"Missing catch or finally clause"),this.finishNode(m,"TryStatement")},Gt.parseVarStatement=function(m,A){return this.next(),this.parseVar(m,!1,A),this.semicolon(),this.finishNode(m,"VariableDeclaration")},Gt.parseWhileStatement=function(m){return this.next(),m.test=this.parseParenExpression(),this.labels.push(Tr),m.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(m,"WhileStatement")},Gt.parseWithStatement=function(m){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),m.object=this.parseParenExpression(),m.body=this.parseStatement("with"),this.finishNode(m,"WithStatement")},Gt.parseEmptyStatement=function(m){return this.next(),this.finishNode(m,"EmptyStatement")},Gt.parseLabeledStatement=function(m,A,z,I){for(var fe=0,Ie=this.labels;fe<Ie.length;fe+=1){var lt=Ie[fe];lt.name===A&&this.raise(z.start,"Label '"+A+"' is already declared")}for(var Dt=this.type.isLoop?"loop":this.type===q._switch?"switch":null,Nt=this.labels.length-1;Nt>=0;Nt--){var Dr=this.labels[Nt];if(Dr.statementStart===m.start)Dr.statementStart=this.start,Dr.kind=Dt;else break}return this.labels.push({name:A,kind:Dt,statementStart:this.start}),m.body=this.parseStatement(I?I.indexOf("label")===-1?I+"label":I:"label"),this.labels.pop(),m.label=z,this.finishNode(m,"LabeledStatement")},Gt.parseExpressionStatement=function(m,A){return m.expression=A,this.semicolon(),this.finishNode(m,"ExpressionStatement")},Gt.parseBlock=function(m,A,z){for(m===void 0&&(m=!0),A===void 0&&(A=this.startNode()),A.body=[],this.expect(q.braceL),m&&this.enterScope(0);this.type!==q.braceR;){var I=this.parseStatement(null);A.body.push(I)}return z&&(this.strict=!1),this.next(),m&&this.exitScope(),this.finishNode(A,"BlockStatement")},Gt.parseFor=function(m,A){return m.init=A,this.expect(q.semi),m.test=this.type===q.semi?null:this.parseExpression(),this.expect(q.semi),m.update=this.type===q.parenR?null:this.parseExpression(),this.expect(q.parenR),m.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(m,"ForStatement")},Gt.parseForIn=function(m,A){var z=this.type===q._in;return this.next(),A.type==="VariableDeclaration"&&A.declarations[0].init!=null&&(!z||this.options.ecmaVersion<8||this.strict||A.kind!=="var"||A.declarations[0].id.type!=="Identifier")?this.raise(A.start,(z?"for-in":"for-of")+" loop variable declaration may not have an initializer"):A.type==="AssignmentPattern"&&this.raise(A.start,"Invalid left-hand side in for-loop"),m.left=A,m.right=z?this.parseExpression():this.parseMaybeAssign(),this.expect(q.parenR),m.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(m,z?"ForInStatement":"ForOfStatement")},Gt.parseVar=function(m,A,z){for(m.declarations=[],m.kind=z;;){var I=this.startNode();if(this.parseVarId(I,z),this.eat(q.eq)?I.init=this.parseMaybeAssign(A):z==="const"&&!(this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():I.id.type!=="Identifier"&&!(A&&(this.type===q._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):I.init=null,m.declarations.push(this.finishNode(I,"VariableDeclarator")),!this.eat(q.comma))break}return m},Gt.parseVarId=function(m,A){m.id=this.parseBindingAtom(),this.checkLVal(m.id,A==="var"?Or:lr,!1)};var ut=1,At=2,Rt=4;Gt.parseFunction=function(m,A,z,I){this.initFunction(m),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!I)&&(this.type===q.star&&A&At&&this.unexpected(),m.generator=this.eat(q.star)),this.options.ecmaVersion>=8&&(m.async=!!I),A&ut&&(m.id=A&Rt&&this.type!==q.name?null:this.parseIdent(),m.id&&!(A&At)&&this.checkLVal(m.id,this.strict||m.generator||m.async?this.treatFunctionsAsVar?Or:lr:un));var fe=this.yieldPos,Ie=this.awaitPos,lt=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(nr(m.async,m.generator)),A&ut||(m.id=this.type===q.name?this.parseIdent():null),this.parseFunctionParams(m),this.parseFunctionBody(m,z,!1),this.yieldPos=fe,this.awaitPos=Ie,this.awaitIdentPos=lt,this.finishNode(m,A&ut?"FunctionDeclaration":"FunctionExpression")},Gt.parseFunctionParams=function(m){this.expect(q.parenL),m.params=this.parseBindingList(q.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},Gt.parseClass=function(m,A){this.next();var z=this.strict;this.strict=!0,this.parseClassId(m,A),this.parseClassSuper(m);var I=this.startNode(),fe=!1;for(I.body=[],this.expect(q.braceL);this.type!==q.braceR;){var Ie=this.parseClassElement(m.superClass!==null);Ie&&(I.body.push(Ie),Ie.type==="MethodDefinition"&&Ie.kind==="constructor"&&(fe&&this.raise(Ie.start,"Duplicate constructor in the same class"),fe=!0))}return this.strict=z,this.next(),m.body=this.finishNode(I,"ClassBody"),this.finishNode(m,A?"ClassDeclaration":"ClassExpression")},Gt.parseClassElement=function(m){var A=this;if(this.eat(q.semi))return null;var z=this.startNode(),I=function(Nt,Dr){Dr===void 0&&(Dr=!1);var Wr=A.start,ln=A.startLoc;return A.eatContextual(Nt)?A.type!==q.parenL&&(!Dr||!A.canInsertSemicolon())?!0:(z.key&&A.unexpected(),z.computed=!1,z.key=A.startNodeAt(Wr,ln),z.key.name=Nt,A.finishNode(z.key,"Identifier"),!1):!1};z.kind="method",z.static=I("static");var fe=this.eat(q.star),Ie=!1;fe||(this.options.ecmaVersion>=8&&I("async",!0)?(Ie=!0,fe=this.options.ecmaVersion>=9&&this.eat(q.star)):I("get")?z.kind="get":I("set")&&(z.kind="set")),z.key||this.parsePropertyName(z);var lt=z.key,Dt=!1;return!z.computed&&!z.static&&(lt.type==="Identifier"&&lt.name==="constructor"||lt.type==="Literal"&&lt.value==="constructor")?(z.kind!=="method"&&this.raise(lt.start,"Constructor can't have get/set modifier"),fe&&this.raise(lt.start,"Constructor can't be a generator"),Ie&&this.raise(lt.start,"Constructor can't be an async method"),z.kind="constructor",Dt=m):z.static&&lt.type==="Identifier"&&lt.name==="prototype"&&this.raise(lt.start,"Classes may not have a static property named prototype"),this.parseClassMethod(z,fe,Ie,Dt),z.kind==="get"&&z.value.params.length!==0&&this.raiseRecoverable(z.value.start,"getter should have no params"),z.kind==="set"&&z.value.params.length!==1&&this.raiseRecoverable(z.value.start,"setter should have exactly one param"),z.kind==="set"&&z.value.params[0].type==="RestElement"&&this.raiseRecoverable(z.value.params[0].start,"Setter cannot use rest params"),z},Gt.parseClassMethod=function(m,A,z,I){return m.value=this.parseMethod(A,z,I),this.finishNode(m,"MethodDefinition")},Gt.parseClassId=function(m,A){this.type===q.name?(m.id=this.parseIdent(),A&&this.checkLVal(m.id,lr,!1)):(A===!0&&this.unexpected(),m.id=null)},Gt.parseClassSuper=function(m){m.superClass=this.eat(q._extends)?this.parseExprSubscripts():null},Gt.parseExport=function(m,A){if(this.next(),this.eat(q.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(m.exported=this.parseIdent(!0),this.checkExport(A,m.exported.name,this.lastTokStart)):m.exported=null),this.expectContextual("from"),this.type!==q.string&&this.unexpected(),m.source=this.parseExprAtom(),this.semicolon(),this.finishNode(m,"ExportAllDeclaration");if(this.eat(q._default)){this.checkExport(A,"default",this.lastTokStart);var z;if(this.type===q._function||(z=this.isAsyncFunction())){var I=this.startNode();this.next(),z&&this.next(),m.declaration=this.parseFunction(I,ut|Rt,!1,z)}else if(this.type===q._class){var fe=this.startNode();m.declaration=this.parseClass(fe,"nullableID")}else m.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(m,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())m.declaration=this.parseStatement(null),m.declaration.type==="VariableDeclaration"?this.checkVariableExport(A,m.declaration.declarations):this.checkExport(A,m.declaration.id.name,m.declaration.id.start),m.specifiers=[],m.source=null;else{if(m.declaration=null,m.specifiers=this.parseExportSpecifiers(A),this.eatContextual("from"))this.type!==q.string&&this.unexpected(),m.source=this.parseExprAtom();else{for(var Ie=0,lt=m.specifiers;Ie<lt.length;Ie+=1){var Dt=lt[Ie];this.checkUnreserved(Dt.local),this.checkLocalExport(Dt.local)}m.source=null}this.semicolon()}return this.finishNode(m,"ExportNamedDeclaration")},Gt.checkExport=function(m,A,z){!m||(j(m,A)&&this.raiseRecoverable(z,"Duplicate export '"+A+"'"),m[A]=!0)},Gt.checkPatternExport=function(m,A){var z=A.type;if(z==="Identifier")this.checkExport(m,A.name,A.start);else if(z==="ObjectPattern")for(var I=0,fe=A.properties;I<fe.length;I+=1){var Ie=fe[I];this.checkPatternExport(m,Ie)}else if(z==="ArrayPattern")for(var lt=0,Dt=A.elements;lt<Dt.length;lt+=1){var Nt=Dt[lt];Nt&&this.checkPatternExport(m,Nt)}else z==="Property"?this.checkPatternExport(m,A.value):z==="AssignmentPattern"?this.checkPatternExport(m,A.left):z==="RestElement"?this.checkPatternExport(m,A.argument):z==="ParenthesizedExpression"&&this.checkPatternExport(m,A.expression)},Gt.checkVariableExport=function(m,A){if(!!m)for(var z=0,I=A;z<I.length;z+=1){var fe=I[z];this.checkPatternExport(m,fe.id)}},Gt.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},Gt.parseExportSpecifiers=function(m){var A=[],z=!0;for(this.expect(q.braceL);!this.eat(q.braceR);){if(z)z=!1;else if(this.expect(q.comma),this.afterTrailingComma(q.braceR))break;var I=this.startNode();I.local=this.parseIdent(!0),I.exported=this.eatContextual("as")?this.parseIdent(!0):I.local,this.checkExport(m,I.exported.name,I.exported.start),A.push(this.finishNode(I,"ExportSpecifier"))}return A},Gt.parseImport=function(m){return this.next(),this.type===q.string?(m.specifiers=Ye,m.source=this.parseExprAtom()):(m.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),m.source=this.type===q.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(m,"ImportDeclaration")},Gt.parseImportSpecifiers=function(){var m=[],A=!0;if(this.type===q.name){var z=this.startNode();if(z.local=this.parseIdent(),this.checkLVal(z.local,lr),m.push(this.finishNode(z,"ImportDefaultSpecifier")),!this.eat(q.comma))return m}if(this.type===q.star){var I=this.startNode();return this.next(),this.expectContextual("as"),I.local=this.parseIdent(),this.checkLVal(I.local,lr),m.push(this.finishNode(I,"ImportNamespaceSpecifier")),m}for(this.expect(q.braceL);!this.eat(q.braceR);){if(A)A=!1;else if(this.expect(q.comma),this.afterTrailingComma(q.braceR))break;var fe=this.startNode();fe.imported=this.parseIdent(!0),this.eatContextual("as")?fe.local=this.parseIdent():(this.checkUnreserved(fe.imported),fe.local=fe.imported),this.checkLVal(fe.local,lr),m.push(this.finishNode(fe,"ImportSpecifier"))}return m},Gt.adaptDirectivePrologue=function(m){for(var A=0;A<m.length&&this.isDirectiveCandidate(m[A]);++A)m[A].directive=m[A].expression.raw.slice(1,-1)},Gt.isDirectiveCandidate=function(m){return m.type==="ExpressionStatement"&&m.expression.type==="Literal"&&typeof m.expression.value=="string"&&(this.input[m.start]==='"'||this.input[m.start]==="'")};var xr=Ue.prototype;xr.toAssignable=function(m,A,z){if(this.options.ecmaVersion>=6&&m)switch(m.type){case"Identifier":this.inAsync&&m.name==="await"&&this.raise(m.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":m.type="ObjectPattern",z&&this.checkPatternErrors(z,!0);for(var I=0,fe=m.properties;I<fe.length;I+=1){var Ie=fe[I];this.toAssignable(Ie,A),Ie.type==="RestElement"&&(Ie.argument.type==="ArrayPattern"||Ie.argument.type==="ObjectPattern")&&this.raise(Ie.argument.start,"Unexpected token")}break;case"Property":m.kind!=="init"&&this.raise(m.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(m.value,A);break;case"ArrayExpression":m.type="ArrayPattern",z&&this.checkPatternErrors(z,!0),this.toAssignableList(m.elements,A);break;case"SpreadElement":m.type="RestElement",this.toAssignable(m.argument,A),m.argument.type==="AssignmentPattern"&&this.raise(m.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":m.operator!=="="&&this.raise(m.left.end,"Only '=' operator can be used for specifying default value."),m.type="AssignmentPattern",delete m.operator,this.toAssignable(m.left,A);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(m.expression,A,z);break;case"ChainExpression":this.raiseRecoverable(m.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!A)break;default:this.raise(m.start,"Assigning to rvalue")}else z&&this.checkPatternErrors(z,!0);return m},xr.toAssignableList=function(m,A){for(var z=m.length,I=0;I<z;I++){var fe=m[I];fe&&this.toAssignable(fe,A)}if(z){var Ie=m[z-1];this.options.ecmaVersion===6&&A&&Ie&&Ie.type==="RestElement"&&Ie.argument.type!=="Identifier"&&this.unexpected(Ie.argument.start)}return m},xr.parseSpread=function(m){var A=this.startNode();return this.next(),A.argument=this.parseMaybeAssign(!1,m),this.finishNode(A,"SpreadElement")},xr.parseRestBinding=function(){var m=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==q.name&&this.unexpected(),m.argument=this.parseBindingAtom(),this.finishNode(m,"RestElement")},xr.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case q.bracketL:var m=this.startNode();return this.next(),m.elements=this.parseBindingList(q.bracketR,!0,!0),this.finishNode(m,"ArrayPattern");case q.braceL:return this.parseObj(!0)}return this.parseIdent()},xr.parseBindingList=function(m,A,z){for(var I=[],fe=!0;!this.eat(m);)if(fe?fe=!1:this.expect(q.comma),A&&this.type===q.comma)I.push(null);else{if(z&&this.afterTrailingComma(m))break;if(this.type===q.ellipsis){var Ie=this.parseRestBinding();this.parseBindingListItem(Ie),I.push(Ie),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(m);break}else{var lt=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(lt),I.push(lt)}}return I},xr.parseBindingListItem=function(m){return m},xr.parseMaybeDefault=function(m,A,z){if(z=z||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(q.eq))return z;var I=this.startNodeAt(m,A);return I.left=z,I.right=this.parseMaybeAssign(),this.finishNode(I,"AssignmentPattern")},xr.checkLVal=function(m,A,z){switch(A===void 0&&(A=dr),m.type){case"Identifier":A===lr&&m.name==="let"&&this.raiseRecoverable(m.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(m.name)&&this.raiseRecoverable(m.start,(A?"Binding ":"Assigning to ")+m.name+" in strict mode"),z&&(j(z,m.name)&&this.raiseRecoverable(m.start,"Argument name clash"),z[m.name]=!0),A!==dr&&A!==H&&this.declareName(m.name,A,m.start);break;case"ChainExpression":this.raiseRecoverable(m.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":A&&this.raiseRecoverable(m.start,"Binding member expression");break;case"ObjectPattern":for(var I=0,fe=m.properties;I<fe.length;I+=1){var Ie=fe[I];this.checkLVal(Ie,A,z)}break;case"Property":this.checkLVal(m.value,A,z);break;case"ArrayPattern":for(var lt=0,Dt=m.elements;lt<Dt.length;lt+=1){var Nt=Dt[lt];Nt&&this.checkLVal(Nt,A,z)}break;case"AssignmentPattern":this.checkLVal(m.left,A,z);break;case"RestElement":this.checkLVal(m.argument,A,z);break;case"ParenthesizedExpression":this.checkLVal(m.expression,A,z);break;default:this.raise(m.start,(A?"Binding":"Assigning to")+" rvalue")}};var Ar=Ue.prototype;Ar.checkPropClash=function(m,A,z){if(!(this.options.ecmaVersion>=9&&m.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(m.computed||m.method||m.shorthand))){var I=m.key,fe;switch(I.type){case"Identifier":fe=I.name;break;case"Literal":fe=String(I.value);break;default:return}var Ie=m.kind;if(this.options.ecmaVersion>=6){fe==="__proto__"&&Ie==="init"&&(A.proto&&(z?z.doubleProto<0&&(z.doubleProto=I.start):this.raiseRecoverable(I.start,"Redefinition of __proto__ property")),A.proto=!0);return}fe="$"+fe;var lt=A[fe];if(lt){var Dt;Ie==="init"?Dt=this.strict&&lt.init||lt.get||lt.set:Dt=lt.init||lt[Ie],Dt&&this.raiseRecoverable(I.start,"Redefinition of property")}else lt=A[fe]={init:!1,get:!1,set:!1};lt[Ie]=!0}},Ar.parseExpression=function(m,A){var z=this.start,I=this.startLoc,fe=this.parseMaybeAssign(m,A);if(this.type===q.comma){var Ie=this.startNodeAt(z,I);for(Ie.expressions=[fe];this.eat(q.comma);)Ie.expressions.push(this.parseMaybeAssign(m,A));return this.finishNode(Ie,"SequenceExpression")}return fe},Ar.parseMaybeAssign=function(m,A,z){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(m);this.exprAllowed=!1}var I=!1,fe=-1,Ie=-1;A?(fe=A.parenthesizedAssign,Ie=A.trailingComma,A.parenthesizedAssign=A.trailingComma=-1):(A=new $,I=!0);var lt=this.start,Dt=this.startLoc;(this.type===q.parenL||this.type===q.name)&&(this.potentialArrowAt=this.start);var Nt=this.parseMaybeConditional(m,A);if(z&&(Nt=z.call(this,Nt,lt,Dt)),this.type.isAssign){var Dr=this.startNodeAt(lt,Dt);return Dr.operator=this.value,Dr.left=this.type===q.eq?this.toAssignable(Nt,!1,A):Nt,I||(A.parenthesizedAssign=A.trailingComma=A.doubleProto=-1),A.shorthandAssign>=Dr.left.start&&(A.shorthandAssign=-1),this.checkLVal(Nt),this.next(),Dr.right=this.parseMaybeAssign(m),this.finishNode(Dr,"AssignmentExpression")}else I&&this.checkExpressionErrors(A,!0);return fe>-1&&(A.parenthesizedAssign=fe),Ie>-1&&(A.trailingComma=Ie),Nt},Ar.parseMaybeConditional=function(m,A){var z=this.start,I=this.startLoc,fe=this.parseExprOps(m,A);if(this.checkExpressionErrors(A))return fe;if(this.eat(q.question)){var Ie=this.startNodeAt(z,I);return Ie.test=fe,Ie.consequent=this.parseMaybeAssign(),this.expect(q.colon),Ie.alternate=this.parseMaybeAssign(m),this.finishNode(Ie,"ConditionalExpression")}return fe},Ar.parseExprOps=function(m,A){var z=this.start,I=this.startLoc,fe=this.parseMaybeUnary(A,!1);return this.checkExpressionErrors(A)||fe.start===z&&fe.type==="ArrowFunctionExpression"?fe:this.parseExprOp(fe,z,I,-1,m)},Ar.parseExprOp=function(m,A,z,I,fe){var Ie=this.type.binop;if(Ie!=null&&(!fe||this.type!==q._in)&&Ie>I){var lt=this.type===q.logicalOR||this.type===q.logicalAND,Dt=this.type===q.coalesce;Dt&&(Ie=q.logicalAND.binop);var Nt=this.value;this.next();var Dr=this.start,Wr=this.startLoc,ln=this.parseExprOp(this.parseMaybeUnary(null,!1),Dr,Wr,Ie,fe),Li=this.buildBinary(A,z,m,ln,Nt,lt||Dt);return(lt&&this.type===q.coalesce||Dt&&(this.type===q.logicalOR||this.type===q.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(Li,A,z,I,fe)}return m},Ar.buildBinary=function(m,A,z,I,fe,Ie){var lt=this.startNodeAt(m,A);return lt.left=z,lt.operator=fe,lt.right=I,this.finishNode(lt,Ie?"LogicalExpression":"BinaryExpression")},Ar.parseMaybeUnary=function(m,A){var z=this.start,I=this.startLoc,fe;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))fe=this.parseAwait(),A=!0;else if(this.type.prefix){var Ie=this.startNode(),lt=this.type===q.incDec;Ie.operator=this.value,Ie.prefix=!0,this.next(),Ie.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(m,!0),lt?this.checkLVal(Ie.argument):this.strict&&Ie.operator==="delete"&&Ie.argument.type==="Identifier"?this.raiseRecoverable(Ie.start,"Deleting local variable in strict mode"):A=!0,fe=this.finishNode(Ie,lt?"UpdateExpression":"UnaryExpression")}else{if(fe=this.parseExprSubscripts(m),this.checkExpressionErrors(m))return fe;for(;this.type.postfix&&!this.canInsertSemicolon();){var Dt=this.startNodeAt(z,I);Dt.operator=this.value,Dt.prefix=!1,Dt.argument=fe,this.checkLVal(fe),this.next(),fe=this.finishNode(Dt,"UpdateExpression")}}return!A&&this.eat(q.starstar)?this.buildBinary(z,I,fe,this.parseMaybeUnary(null,!1),"**",!1):fe},Ar.parseExprSubscripts=function(m){var A=this.start,z=this.startLoc,I=this.parseExprAtom(m);if(I.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return I;var fe=this.parseSubscripts(I,A,z);return m&&fe.type==="MemberExpression"&&(m.parenthesizedAssign>=fe.start&&(m.parenthesizedAssign=-1),m.parenthesizedBind>=fe.start&&(m.parenthesizedBind=-1)),fe},Ar.parseSubscripts=function(m,A,z,I){for(var fe=this.options.ecmaVersion>=8&&m.type==="Identifier"&&m.name==="async"&&this.lastTokEnd===m.end&&!this.canInsertSemicolon()&&m.end-m.start==5&&this.potentialArrowAt===m.start,Ie=!1;;){var lt=this.parseSubscript(m,A,z,I,fe,Ie);if(lt.optional&&(Ie=!0),lt===m||lt.type==="ArrowFunctionExpression"){if(Ie){var Dt=this.startNodeAt(A,z);Dt.expression=lt,lt=this.finishNode(Dt,"ChainExpression")}return lt}m=lt}},Ar.parseSubscript=function(m,A,z,I,fe,Ie){var lt=this.options.ecmaVersion>=11,Dt=lt&&this.eat(q.questionDot);I&&Dt&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var Nt=this.eat(q.bracketL);if(Nt||Dt&&this.type!==q.parenL&&this.type!==q.backQuote||this.eat(q.dot)){var Dr=this.startNodeAt(A,z);Dr.object=m,Dr.property=Nt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),Dr.computed=!!Nt,Nt&&this.expect(q.bracketR),lt&&(Dr.optional=Dt),m=this.finishNode(Dr,"MemberExpression")}else if(!I&&this.eat(q.parenL)){var Wr=new $,ln=this.yieldPos,Li=this.awaitPos,Ei=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var ha=this.parseExprList(q.parenR,this.options.ecmaVersion>=8,!1,Wr);if(fe&&!Dt&&!this.canInsertSemicolon()&&this.eat(q.arrow))return this.checkPatternErrors(Wr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=ln,this.awaitPos=Li,this.awaitIdentPos=Ei,this.parseArrowExpression(this.startNodeAt(A,z),ha,!0);this.checkExpressionErrors(Wr,!0),this.yieldPos=ln||this.yieldPos,this.awaitPos=Li||this.awaitPos,this.awaitIdentPos=Ei||this.awaitIdentPos;var Pa=this.startNodeAt(A,z);Pa.callee=m,Pa.arguments=ha,lt&&(Pa.optional=Dt),m=this.finishNode(Pa,"CallExpression")}else if(this.type===q.backQuote){(Dt||Ie)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var ya=this.startNodeAt(A,z);ya.tag=m,ya.quasi=this.parseTemplate({isTagged:!0}),m=this.finishNode(ya,"TaggedTemplateExpression")}return m},Ar.parseExprAtom=function(m){this.type===q.slash&&this.readRegexp();var A,z=this.potentialArrowAt===this.start;switch(this.type){case q._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),A=this.startNode(),this.next(),this.type===q.parenL&&!this.allowDirectSuper&&this.raise(A.start,"super() call outside constructor of a subclass"),this.type!==q.dot&&this.type!==q.bracketL&&this.type!==q.parenL&&this.unexpected(),this.finishNode(A,"Super");case q._this:return A=this.startNode(),this.next(),this.finishNode(A,"ThisExpression");case q.name:var I=this.start,fe=this.startLoc,Ie=this.containsEsc,lt=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!Ie&&lt.name==="async"&&!this.canInsertSemicolon()&&this.eat(q._function))return this.parseFunction(this.startNodeAt(I,fe),0,!1,!0);if(z&&!this.canInsertSemicolon()){if(this.eat(q.arrow))return this.parseArrowExpression(this.startNodeAt(I,fe),[lt],!1);if(this.options.ecmaVersion>=8&&lt.name==="async"&&this.type===q.name&&!Ie)return lt=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(q.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(I,fe),[lt],!0)}return lt;case q.regexp:var Dt=this.value;return A=this.parseLiteral(Dt.value),A.regex={pattern:Dt.pattern,flags:Dt.flags},A;case q.num:case q.string:return this.parseLiteral(this.value);case q._null:case q._true:case q._false:return A=this.startNode(),A.value=this.type===q._null?null:this.type===q._true,A.raw=this.type.keyword,this.next(),this.finishNode(A,"Literal");case q.parenL:var Nt=this.start,Dr=this.parseParenAndDistinguishExpression(z);return m&&(m.parenthesizedAssign<0&&!this.isSimpleAssignTarget(Dr)&&(m.parenthesizedAssign=Nt),m.parenthesizedBind<0&&(m.parenthesizedBind=Nt)),Dr;case q.bracketL:return A=this.startNode(),this.next(),A.elements=this.parseExprList(q.bracketR,!0,!0,m),this.finishNode(A,"ArrayExpression");case q.braceL:return this.parseObj(!1,m);case q._function:return A=this.startNode(),this.next(),this.parseFunction(A,0);case q._class:return this.parseClass(this.startNode(),!1);case q._new:return this.parseNew();case q.backQuote:return this.parseTemplate();case q._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Ar.parseExprImport=function(){var m=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var A=this.parseIdent(!0);switch(this.type){case q.parenL:return this.parseDynamicImport(m);case q.dot:return m.meta=A,this.parseImportMeta(m);default:this.unexpected()}},Ar.parseDynamicImport=function(m){if(this.next(),m.source=this.parseMaybeAssign(),!this.eat(q.parenR)){var A=this.start;this.eat(q.comma)&&this.eat(q.parenR)?this.raiseRecoverable(A,"Trailing comma is not allowed in import()"):this.unexpected(A)}return this.finishNode(m,"ImportExpression")},Ar.parseImportMeta=function(m){this.next();var A=this.containsEsc;return m.property=this.parseIdent(!0),m.property.name!=="meta"&&this.raiseRecoverable(m.property.start,"The only valid meta property for import is 'import.meta'"),A&&this.raiseRecoverable(m.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(m.start,"Cannot use 'import.meta' outside a module"),this.finishNode(m,"MetaProperty")},Ar.parseLiteral=function(m){var A=this.startNode();return A.value=m,A.raw=this.input.slice(this.start,this.end),A.raw.charCodeAt(A.raw.length-1)===110&&(A.bigint=A.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(A,"Literal")},Ar.parseParenExpression=function(){this.expect(q.parenL);var m=this.parseExpression();return this.expect(q.parenR),m},Ar.parseParenAndDistinguishExpression=function(m){var A=this.start,z=this.startLoc,I,fe=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var Ie=this.start,lt=this.startLoc,Dt=[],Nt=!0,Dr=!1,Wr=new $,ln=this.yieldPos,Li=this.awaitPos,Ei;for(this.yieldPos=0,this.awaitPos=0;this.type!==q.parenR;)if(Nt?Nt=!1:this.expect(q.comma),fe&&this.afterTrailingComma(q.parenR,!0)){Dr=!0;break}else if(this.type===q.ellipsis){Ei=this.start,Dt.push(this.parseParenItem(this.parseRestBinding())),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Dt.push(this.parseMaybeAssign(!1,Wr,this.parseParenItem));var ha=this.start,Pa=this.startLoc;if(this.expect(q.parenR),m&&!this.canInsertSemicolon()&&this.eat(q.arrow))return this.checkPatternErrors(Wr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=ln,this.awaitPos=Li,this.parseParenArrowList(A,z,Dt);(!Dt.length||Dr)&&this.unexpected(this.lastTokStart),Ei&&this.unexpected(Ei),this.checkExpressionErrors(Wr,!0),this.yieldPos=ln||this.yieldPos,this.awaitPos=Li||this.awaitPos,Dt.length>1?(I=this.startNodeAt(Ie,lt),I.expressions=Dt,this.finishNodeAt(I,"SequenceExpression",ha,Pa)):I=Dt[0]}else I=this.parseParenExpression();if(this.options.preserveParens){var ya=this.startNodeAt(A,z);return ya.expression=I,this.finishNode(ya,"ParenthesizedExpression")}else return I},Ar.parseParenItem=function(m){return m},Ar.parseParenArrowList=function(m,A,z){return this.parseArrowExpression(this.startNodeAt(m,A),z)};var Ke=[];Ar.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var m=this.startNode(),A=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(q.dot)){m.meta=A;var z=this.containsEsc;return m.property=this.parseIdent(!0),m.property.name!=="target"&&this.raiseRecoverable(m.property.start,"The only valid meta property for new is 'new.target'"),z&&this.raiseRecoverable(m.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(m.start,"'new.target' can only be used in functions"),this.finishNode(m,"MetaProperty")}var I=this.start,fe=this.startLoc,Ie=this.type===q._import;return m.callee=this.parseSubscripts(this.parseExprAtom(),I,fe,!0),Ie&&m.callee.type==="ImportExpression"&&this.raise(I,"Cannot use new with import()"),this.eat(q.parenL)?m.arguments=this.parseExprList(q.parenR,this.options.ecmaVersion>=8,!1):m.arguments=Ke,this.finishNode(m,"NewExpression")},Ar.parseTemplateElement=function(m){var A=m.isTagged,z=this.startNode();return this.type===q.invalidTemplate?(A||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),z.value={raw:this.value,cooked:null}):z.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),z.tail=this.type===q.backQuote,this.finishNode(z,"TemplateElement")},Ar.parseTemplate=function(m){m===void 0&&(m={});var A=m.isTagged;A===void 0&&(A=!1);var z=this.startNode();this.next(),z.expressions=[];var I=this.parseTemplateElement({isTagged:A});for(z.quasis=[I];!I.tail;)this.type===q.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(q.dollarBraceL),z.expressions.push(this.parseExpression()),this.expect(q.braceR),z.quasis.push(I=this.parseTemplateElement({isTagged:A}));return this.next(),this.finishNode(z,"TemplateLiteral")},Ar.isAsyncProp=function(m){return!m.computed&&m.key.type==="Identifier"&&m.key.name==="async"&&(this.type===q.name||this.type===q.num||this.type===q.string||this.type===q.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===q.star)&&!hr.test(this.input.slice(this.lastTokEnd,this.start))},Ar.parseObj=function(m,A){var z=this.startNode(),I=!0,fe={};for(z.properties=[],this.next();!this.eat(q.braceR);){if(I)I=!1;else if(this.expect(q.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(q.braceR))break;var Ie=this.parseProperty(m,A);m||this.checkPropClash(Ie,fe,A),z.properties.push(Ie)}return this.finishNode(z,m?"ObjectPattern":"ObjectExpression")},Ar.parseProperty=function(m,A){var z=this.startNode(),I,fe,Ie,lt;if(this.options.ecmaVersion>=9&&this.eat(q.ellipsis))return m?(z.argument=this.parseIdent(!1),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(z,"RestElement")):(this.type===q.parenL&&A&&(A.parenthesizedAssign<0&&(A.parenthesizedAssign=this.start),A.parenthesizedBind<0&&(A.parenthesizedBind=this.start)),z.argument=this.parseMaybeAssign(!1,A),this.type===q.comma&&A&&A.trailingComma<0&&(A.trailingComma=this.start),this.finishNode(z,"SpreadElement"));this.options.ecmaVersion>=6&&(z.method=!1,z.shorthand=!1,(m||A)&&(Ie=this.start,lt=this.startLoc),m||(I=this.eat(q.star)));var Dt=this.containsEsc;return this.parsePropertyName(z),!m&&!Dt&&this.options.ecmaVersion>=8&&!I&&this.isAsyncProp(z)?(fe=!0,I=this.options.ecmaVersion>=9&&this.eat(q.star),this.parsePropertyName(z,A)):fe=!1,this.parsePropertyValue(z,m,I,fe,Ie,lt,A,Dt),this.finishNode(z,"Property")},Ar.parsePropertyValue=function(m,A,z,I,fe,Ie,lt,Dt){if((z||I)&&this.type===q.colon&&this.unexpected(),this.eat(q.colon))m.value=A?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,lt),m.kind="init";else if(this.options.ecmaVersion>=6&&this.type===q.parenL)A&&this.unexpected(),m.kind="init",m.method=!0,m.value=this.parseMethod(z,I);else if(!A&&!Dt&&this.options.ecmaVersion>=5&&!m.computed&&m.key.type==="Identifier"&&(m.key.name==="get"||m.key.name==="set")&&this.type!==q.comma&&this.type!==q.braceR&&this.type!==q.eq){(z||I)&&this.unexpected(),m.kind=m.key.name,this.parsePropertyName(m),m.value=this.parseMethod(!1);var Nt=m.kind==="get"?0:1;if(m.value.params.length!==Nt){var Dr=m.value.start;m.kind==="get"?this.raiseRecoverable(Dr,"getter should have no params"):this.raiseRecoverable(Dr,"setter should have exactly one param")}else m.kind==="set"&&m.value.params[0].type==="RestElement"&&this.raiseRecoverable(m.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!m.computed&&m.key.type==="Identifier"?((z||I)&&this.unexpected(),this.checkUnreserved(m.key),m.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=fe),m.kind="init",A?m.value=this.parseMaybeDefault(fe,Ie,m.key):this.type===q.eq&&lt?(lt.shorthandAssign<0&&(lt.shorthandAssign=this.start),m.value=this.parseMaybeDefault(fe,Ie,m.key)):m.value=m.key,m.shorthand=!0):this.unexpected()},Ar.parsePropertyName=function(m){if(this.options.ecmaVersion>=6){if(this.eat(q.bracketL))return m.computed=!0,m.key=this.parseMaybeAssign(),this.expect(q.bracketR),m.key;m.computed=!1}return m.key=this.type===q.num||this.type===q.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Ar.initFunction=function(m){m.id=null,this.options.ecmaVersion>=6&&(m.generator=m.expression=!1),this.options.ecmaVersion>=8&&(m.async=!1)},Ar.parseMethod=function(m,A,z){var I=this.startNode(),fe=this.yieldPos,Ie=this.awaitPos,lt=this.awaitIdentPos;return this.initFunction(I),this.options.ecmaVersion>=6&&(I.generator=m),this.options.ecmaVersion>=8&&(I.async=!!A),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(nr(A,I.generator)|Oe|(z?Lt:0)),this.expect(q.parenL),I.params=this.parseBindingList(q.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(I,!1,!0),this.yieldPos=fe,this.awaitPos=Ie,this.awaitIdentPos=lt,this.finishNode(I,"FunctionExpression")},Ar.parseArrowExpression=function(m,A,z){var I=this.yieldPos,fe=this.awaitPos,Ie=this.awaitIdentPos;return this.enterScope(nr(z,!1)|Te),this.initFunction(m),this.options.ecmaVersion>=8&&(m.async=!!z),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,m.params=this.toAssignableList(A,!0),this.parseFunctionBody(m,!0,!1),this.yieldPos=I,this.awaitPos=fe,this.awaitIdentPos=Ie,this.finishNode(m,"ArrowFunctionExpression")},Ar.parseFunctionBody=function(m,A,z){var I=A&&this.type!==q.braceL,fe=this.strict,Ie=!1;if(I)m.body=this.parseMaybeAssign(),m.expression=!0,this.checkParams(m,!1);else{var lt=this.options.ecmaVersion>=7&&!this.isSimpleParamList(m.params);(!fe||lt)&&(Ie=this.strictDirective(this.end),Ie&&lt&&this.raiseRecoverable(m.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Dt=this.labels;this.labels=[],Ie&&(this.strict=!0),this.checkParams(m,!fe&&!Ie&&!A&&!z&&this.isSimpleParamList(m.params)),this.strict&&m.id&&this.checkLVal(m.id,H),m.body=this.parseBlock(!1,void 0,Ie&&!fe),m.expression=!1,this.adaptDirectivePrologue(m.body.body),this.labels=Dt}this.exitScope()},Ar.isSimpleParamList=function(m){for(var A=0,z=m;A<z.length;A+=1){var I=z[A];if(I.type!=="Identifier")return!1}return!0},Ar.checkParams=function(m,A){for(var z={},I=0,fe=m.params;I<fe.length;I+=1){var Ie=fe[I];this.checkLVal(Ie,Or,A?null:z)}},Ar.parseExprList=function(m,A,z,I){for(var fe=[],Ie=!0;!this.eat(m);){if(Ie)Ie=!1;else if(this.expect(q.comma),A&&this.afterTrailingComma(m))break;var lt=void 0;z&&this.type===q.comma?lt=null:this.type===q.ellipsis?(lt=this.parseSpread(I),I&&this.type===q.comma&&I.trailingComma<0&&(I.trailingComma=this.start)):lt=this.parseMaybeAssign(!1,I),fe.push(lt)}return fe},Ar.checkUnreserved=function(m){var A=m.start,z=m.end,I=m.name;if(this.inGenerator&&I==="yield"&&this.raiseRecoverable(A,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&I==="await"&&this.raiseRecoverable(A,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(I)&&this.raise(A,"Unexpected keyword '"+I+"'"),!(this.options.ecmaVersion<6&&this.input.slice(A,z).indexOf("\\")!==-1)){var fe=this.strict?this.reservedWordsStrict:this.reservedWords;fe.test(I)&&(!this.inAsync&&I==="await"&&this.raiseRecoverable(A,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(A,"The keyword '"+I+"' is reserved"))}},Ar.parseIdent=function(m,A){var z=this.startNode();return this.type===q.name?z.name=this.value:this.type.keyword?(z.name=this.type.keyword,(z.name==="class"||z.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!m),this.finishNode(z,"Identifier"),m||(this.checkUnreserved(z),z.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=z.start)),z},Ar.parseYield=function(m){this.yieldPos||(this.yieldPos=this.start);var A=this.startNode();return this.next(),this.type===q.semi||this.canInsertSemicolon()||this.type!==q.star&&!this.type.startsExpr?(A.delegate=!1,A.argument=null):(A.delegate=this.eat(q.star),A.argument=this.parseMaybeAssign(m)),this.finishNode(A,"YieldExpression")},Ar.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var m=this.startNode();return this.next(),m.argument=this.parseMaybeUnary(null,!1),this.finishNode(m,"AwaitExpression")};var Xr=Ue.prototype;Xr.raise=function(m,A){var z=dt(this.input,m);A+=" ("+z.line+":"+z.column+")";var I=new SyntaxError(A);throw I.pos=m,I.loc=z,I.raisedAt=this.pos,I},Xr.raiseRecoverable=Xr.raise,Xr.curPosition=function(){if(this.options.locations)return new ye(this.curLine,this.pos-this.lineStart)};var Yr=Ue.prototype,wn=function(A){this.flags=A,this.var=[],this.lexical=[],this.functions=[]};Yr.enterScope=function(m){this.scopeStack.push(new wn(m))},Yr.exitScope=function(){this.scopeStack.pop()},Yr.treatFunctionsAsVarInScope=function(m){return m.flags&En||!this.inModule&&m.flags&vn},Yr.declareName=function(m,A,z){var I=!1;if(A===lr){var fe=this.currentScope();I=fe.lexical.indexOf(m)>-1||fe.functions.indexOf(m)>-1||fe.var.indexOf(m)>-1,fe.lexical.push(m),this.inModule&&fe.flags&vn&&delete this.undefinedExports[m]}else if(A===w){var Ie=this.currentScope();Ie.lexical.push(m)}else if(A===un){var lt=this.currentScope();this.treatFunctionsAsVar?I=lt.lexical.indexOf(m)>-1:I=lt.lexical.indexOf(m)>-1||lt.var.indexOf(m)>-1,lt.functions.push(m)}else for(var Dt=this.scopeStack.length-1;Dt>=0;--Dt){var Nt=this.scopeStack[Dt];if(Nt.lexical.indexOf(m)>-1&&!(Nt.flags&Ze&&Nt.lexical[0]===m)||!this.treatFunctionsAsVarInScope(Nt)&&Nt.functions.indexOf(m)>-1){I=!0;break}if(Nt.var.push(m),this.inModule&&Nt.flags&vn&&delete this.undefinedExports[m],Nt.flags&ea)break}I&&this.raiseRecoverable(z,"Identifier '"+m+"' has already been declared")},Yr.checkLocalExport=function(m){this.scopeStack[0].lexical.indexOf(m.name)===-1&&this.scopeStack[0].var.indexOf(m.name)===-1&&(this.undefinedExports[m.name]=m)},Yr.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},Yr.currentVarScope=function(){for(var m=this.scopeStack.length-1;;m--){var A=this.scopeStack[m];if(A.flags&ea)return A}},Yr.currentThisScope=function(){for(var m=this.scopeStack.length-1;;m--){var A=this.scopeStack[m];if(A.flags&ea&&!(A.flags&Te))return A}};var cr=function(A,z,I){this.type="",this.start=z,this.end=0,A.options.locations&&(this.loc=new _t(A,I)),A.options.directSourceFile&&(this.sourceFile=A.options.directSourceFile),A.options.ranges&&(this.range=[z,0])},Mr=Ue.prototype;Mr.startNode=function(){return new cr(this,this.start,this.startLoc)},Mr.startNodeAt=function(m,A){return new cr(this,m,A)};function gt(m,A,z,I){return m.type=A,m.end=z,this.options.locations&&(m.loc.end=I),this.options.ranges&&(m.range[1]=z),m}Mr.finishNode=function(m,A){return gt.call(this,m,A,this.lastTokEnd,this.lastTokEndLoc)},Mr.finishNodeAt=function(m,A,z,I){return gt.call(this,m,A,z,I)};var Gn=function(A,z,I,fe,Ie){this.token=A,this.isExpr=!!z,this.preserveSpace=!!I,this.override=fe,this.generator=!!Ie},Mn={b_stat:new Gn("{",!1),b_expr:new Gn("{",!0),b_tmpl:new Gn("${",!1),p_stat:new Gn("(",!1),p_expr:new Gn("(",!0),q_tmpl:new Gn("`",!0,!0,function(m){return m.tryReadTemplateToken()}),f_stat:new Gn("function",!1),f_expr:new Gn("function",!0),f_expr_gen:new Gn("function",!0,!1,null,!0),f_gen:new Gn("function",!1,!1,null,!0)},kr=Ue.prototype;kr.initialContext=function(){return[Mn.b_stat]},kr.braceIsBlock=function(m){var A=this.curContext();return A===Mn.f_expr||A===Mn.f_stat?!0:m===q.colon&&(A===Mn.b_stat||A===Mn.b_expr)?!A.isExpr:m===q._return||m===q.name&&this.exprAllowed?hr.test(this.input.slice(this.lastTokEnd,this.start)):m===q._else||m===q.semi||m===q.eof||m===q.parenR||m===q.arrow?!0:m===q.braceL?A===Mn.b_stat:m===q._var||m===q._const||m===q.name?!1:!this.exprAllowed},kr.inGeneratorContext=function(){for(var m=this.context.length-1;m>=1;m--){var A=this.context[m];if(A.token==="function")return A.generator}return!1},kr.updateContext=function(m){var A,z=this.type;z.keyword&&m===q.dot?this.exprAllowed=!1:(A=z.updateContext)?A.call(this,m):this.exprAllowed=z.beforeExpr},q.parenR.updateContext=q.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var m=this.context.pop();m===Mn.b_stat&&this.curContext().token==="function"&&(m=this.context.pop()),this.exprAllowed=!m.isExpr},q.braceL.updateContext=function(m){this.context.push(this.braceIsBlock(m)?Mn.b_stat:Mn.b_expr),this.exprAllowed=!0},q.dollarBraceL.updateContext=function(){this.context.push(Mn.b_tmpl),this.exprAllowed=!0},q.parenL.updateContext=function(m){var A=m===q._if||m===q._for||m===q._with||m===q._while;this.context.push(A?Mn.p_stat:Mn.p_expr),this.exprAllowed=!0},q.incDec.updateContext=function(){},q._function.updateContext=q._class.updateContext=function(m){m.beforeExpr&&m!==q.semi&&m!==q._else&&!(m===q._return&&hr.test(this.input.slice(this.lastTokEnd,this.start)))&&!((m===q.colon||m===q.braceL)&&this.curContext()===Mn.b_stat)?this.context.push(Mn.f_expr):this.context.push(Mn.f_stat),this.exprAllowed=!1},q.backQuote.updateContext=function(){this.curContext()===Mn.q_tmpl?this.context.pop():this.context.push(Mn.q_tmpl),this.exprAllowed=!1},q.star.updateContext=function(m){if(m===q._function){var A=this.context.length-1;this.context[A]===Mn.f_expr?this.context[A]=Mn.f_expr_gen:this.context[A]=Mn.f_gen}this.exprAllowed=!0},q.name.updateContext=function(m){var A=!1;this.options.ecmaVersion>=6&&m!==q.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(A=!0),this.exprAllowed=A};var Y="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",le=Y+" Extended_Pictographic",ve=le,B={9:Y,10:le,11:ve},ee="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",de="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Ae=de+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",ae=Ae+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",_e={9:de,10:Ae,11:ae},ct={};function Sr(m){var A=ct[m]={binary:Re(B[m]+" "+ee),nonBinary:{General_Category:Re(ee),Script:Re(_e[m])}};A.nonBinary.Script_Extensions=A.nonBinary.Script,A.nonBinary.gc=A.nonBinary.General_Category,A.nonBinary.sc=A.nonBinary.Script,A.nonBinary.scx=A.nonBinary.Script_Extensions}Sr(9),Sr(10),Sr(11);var Ht=Ue.prototype,Jt=function(A){this.parser=A,this.validFlags="gim"+(A.options.ecmaVersion>=6?"uy":"")+(A.options.ecmaVersion>=9?"s":""),this.unicodeProperties=ct[A.options.ecmaVersion>=11?11:A.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Jt.prototype.reset=function(A,z,I){var fe=I.indexOf("u")!==-1;this.start=A|0,this.source=z+"",this.flags=I,this.switchU=fe&&this.parser.options.ecmaVersion>=6,this.switchN=fe&&this.parser.options.ecmaVersion>=9},Jt.prototype.raise=function(A){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+A)},Jt.prototype.at=function(A,z){z===void 0&&(z=!1);var I=this.source,fe=I.length;if(A>=fe)return-1;var Ie=I.charCodeAt(A);if(!(z||this.switchU)||Ie<=55295||Ie>=57344||A+1>=fe)return Ie;var lt=I.charCodeAt(A+1);return lt>=56320&&lt<=57343?(Ie<<10)+lt-56613888:Ie},Jt.prototype.nextIndex=function(A,z){z===void 0&&(z=!1);var I=this.source,fe=I.length;if(A>=fe)return fe;var Ie=I.charCodeAt(A),lt;return!(z||this.switchU)||Ie<=55295||Ie>=57344||A+1>=fe||(lt=I.charCodeAt(A+1))<56320||lt>57343?A+1:A+2},Jt.prototype.current=function(A){return A===void 0&&(A=!1),this.at(this.pos,A)},Jt.prototype.lookahead=function(A){return A===void 0&&(A=!1),this.at(this.nextIndex(this.pos,A),A)},Jt.prototype.advance=function(A){A===void 0&&(A=!1),this.pos=this.nextIndex(this.pos,A)},Jt.prototype.eat=function(A,z){return z===void 0&&(z=!1),this.current(z)===A?(this.advance(z),!0):!1};function Nr(m){return m<=65535?String.fromCharCode(m):(m-=65536,String.fromCharCode((m>>10)+55296,(m&1023)+56320))}Ht.validateRegExpFlags=function(m){for(var A=m.validFlags,z=m.flags,I=0;I<z.length;I++){var fe=z.charAt(I);A.indexOf(fe)===-1&&this.raise(m.start,"Invalid regular expression flag"),z.indexOf(fe,I+1)>-1&&this.raise(m.start,"Duplicate regular expression flag")}},Ht.validateRegExpPattern=function(m){this.regexp_pattern(m),!m.switchN&&this.options.ecmaVersion>=9&&m.groupNames.length>0&&(m.switchN=!0,this.regexp_pattern(m))},Ht.regexp_pattern=function(m){m.pos=0,m.lastIntValue=0,m.lastStringValue="",m.lastAssertionIsQuantifiable=!1,m.numCapturingParens=0,m.maxBackReference=0,m.groupNames.length=0,m.backReferenceNames.length=0,this.regexp_disjunction(m),m.pos!==m.source.length&&(m.eat(41)&&m.raise("Unmatched ')'"),(m.eat(93)||m.eat(125))&&m.raise("Lone quantifier brackets")),m.maxBackReference>m.numCapturingParens&&m.raise("Invalid escape");for(var A=0,z=m.backReferenceNames;A<z.length;A+=1){var I=z[A];m.groupNames.indexOf(I)===-1&&m.raise("Invalid named capture referenced")}},Ht.regexp_disjunction=function(m){for(this.regexp_alternative(m);m.eat(124);)this.regexp_alternative(m);this.regexp_eatQuantifier(m,!0)&&m.raise("Nothing to repeat"),m.eat(123)&&m.raise("Lone quantifier brackets")},Ht.regexp_alternative=function(m){for(;m.pos<m.source.length&&this.regexp_eatTerm(m););},Ht.regexp_eatTerm=function(m){return this.regexp_eatAssertion(m)?(m.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(m)&&m.switchU&&m.raise("Invalid quantifier"),!0):(m.switchU?this.regexp_eatAtom(m):this.regexp_eatExtendedAtom(m))?(this.regexp_eatQuantifier(m),!0):!1},Ht.regexp_eatAssertion=function(m){var A=m.pos;if(m.lastAssertionIsQuantifiable=!1,m.eat(94)||m.eat(36))return!0;if(m.eat(92)){if(m.eat(66)||m.eat(98))return!0;m.pos=A}if(m.eat(40)&&m.eat(63)){var z=!1;if(this.options.ecmaVersion>=9&&(z=m.eat(60)),m.eat(61)||m.eat(33))return this.regexp_disjunction(m),m.eat(41)||m.raise("Unterminated group"),m.lastAssertionIsQuantifiable=!z,!0}return m.pos=A,!1},Ht.regexp_eatQuantifier=function(m,A){return A===void 0&&(A=!1),this.regexp_eatQuantifierPrefix(m,A)?(m.eat(63),!0):!1},Ht.regexp_eatQuantifierPrefix=function(m,A){return m.eat(42)||m.eat(43)||m.eat(63)||this.regexp_eatBracedQuantifier(m,A)},Ht.regexp_eatBracedQuantifier=function(m,A){var z=m.pos;if(m.eat(123)){var I=0,fe=-1;if(this.regexp_eatDecimalDigits(m)&&(I=m.lastIntValue,m.eat(44)&&this.regexp_eatDecimalDigits(m)&&(fe=m.lastIntValue),m.eat(125)))return fe!==-1&&fe<I&&!A&&m.raise("numbers out of order in {} quantifier"),!0;m.switchU&&!A&&m.raise("Incomplete quantifier"),m.pos=z}return!1},Ht.regexp_eatAtom=function(m){return this.regexp_eatPatternCharacters(m)||m.eat(46)||this.regexp_eatReverseSolidusAtomEscape(m)||this.regexp_eatCharacterClass(m)||this.regexp_eatUncapturingGroup(m)||this.regexp_eatCapturingGroup(m)},Ht.regexp_eatReverseSolidusAtomEscape=function(m){var A=m.pos;if(m.eat(92)){if(this.regexp_eatAtomEscape(m))return!0;m.pos=A}return!1},Ht.regexp_eatUncapturingGroup=function(m){var A=m.pos;if(m.eat(40)){if(m.eat(63)&&m.eat(58)){if(this.regexp_disjunction(m),m.eat(41))return!0;m.raise("Unterminated group")}m.pos=A}return!1},Ht.regexp_eatCapturingGroup=function(m){if(m.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(m):m.current()===63&&m.raise("Invalid group"),this.regexp_disjunction(m),m.eat(41))return m.numCapturingParens+=1,!0;m.raise("Unterminated group")}return!1},Ht.regexp_eatExtendedAtom=function(m){return m.eat(46)||this.regexp_eatReverseSolidusAtomEscape(m)||this.regexp_eatCharacterClass(m)||this.regexp_eatUncapturingGroup(m)||this.regexp_eatCapturingGroup(m)||this.regexp_eatInvalidBracedQuantifier(m)||this.regexp_eatExtendedPatternCharacter(m)},Ht.regexp_eatInvalidBracedQuantifier=function(m){return this.regexp_eatBracedQuantifier(m,!0)&&m.raise("Nothing to repeat"),!1},Ht.regexp_eatSyntaxCharacter=function(m){var A=m.current();return zn(A)?(m.lastIntValue=A,m.advance(),!0):!1};function zn(m){return m===36||m>=40&&m<=43||m===46||m===63||m>=91&&m<=94||m>=123&&m<=125}Ht.regexp_eatPatternCharacters=function(m){for(var A=m.pos,z=0;(z=m.current())!==-1&&!zn(z);)m.advance();return m.pos!==A},Ht.regexp_eatExtendedPatternCharacter=function(m){var A=m.current();return A!==-1&&A!==36&&!(A>=40&&A<=43)&&A!==46&&A!==63&&A!==91&&A!==94&&A!==124?(m.advance(),!0):!1},Ht.regexp_groupSpecifier=function(m){if(m.eat(63)){if(this.regexp_eatGroupName(m)){m.groupNames.indexOf(m.lastStringValue)!==-1&&m.raise("Duplicate capture group name"),m.groupNames.push(m.lastStringValue);return}m.raise("Invalid group")}},Ht.regexp_eatGroupName=function(m){if(m.lastStringValue="",m.eat(60)){if(this.regexp_eatRegExpIdentifierName(m)&&m.eat(62))return!0;m.raise("Invalid capture group name")}return!1},Ht.regexp_eatRegExpIdentifierName=function(m){if(m.lastStringValue="",this.regexp_eatRegExpIdentifierStart(m)){for(m.lastStringValue+=Nr(m.lastIntValue);this.regexp_eatRegExpIdentifierPart(m);)m.lastStringValue+=Nr(m.lastIntValue);return!0}return!1},Ht.regexp_eatRegExpIdentifierStart=function(m){var A=m.pos,z=this.options.ecmaVersion>=11,I=m.current(z);return m.advance(z),I===92&&this.regexp_eatRegExpUnicodeEscapeSequence(m,z)&&(I=m.lastIntValue),Nn(I)?(m.lastIntValue=I,!0):(m.pos=A,!1)};function Nn(m){return Cr(m,!0)||m===36||m===95}Ht.regexp_eatRegExpIdentifierPart=function(m){var A=m.pos,z=this.options.ecmaVersion>=11,I=m.current(z);return m.advance(z),I===92&&this.regexp_eatRegExpUnicodeEscapeSequence(m,z)&&(I=m.lastIntValue),Kt(I)?(m.lastIntValue=I,!0):(m.pos=A,!1)};function Kt(m){return Qt(m,!0)||m===36||m===95||m===8204||m===8205}Ht.regexp_eatAtomEscape=function(m){return this.regexp_eatBackReference(m)||this.regexp_eatCharacterClassEscape(m)||this.regexp_eatCharacterEscape(m)||m.switchN&&this.regexp_eatKGroupName(m)?!0:(m.switchU&&(m.current()===99&&m.raise("Invalid unicode escape"),m.raise("Invalid escape")),!1)},Ht.regexp_eatBackReference=function(m){var A=m.pos;if(this.regexp_eatDecimalEscape(m)){var z=m.lastIntValue;if(m.switchU)return z>m.maxBackReference&&(m.maxBackReference=z),!0;if(z<=m.numCapturingParens)return!0;m.pos=A}return!1},Ht.regexp_eatKGroupName=function(m){if(m.eat(107)){if(this.regexp_eatGroupName(m))return m.backReferenceNames.push(m.lastStringValue),!0;m.raise("Invalid named reference")}return!1},Ht.regexp_eatCharacterEscape=function(m){return this.regexp_eatControlEscape(m)||this.regexp_eatCControlLetter(m)||this.regexp_eatZero(m)||this.regexp_eatHexEscapeSequence(m)||this.regexp_eatRegExpUnicodeEscapeSequence(m,!1)||!m.switchU&&this.regexp_eatLegacyOctalEscapeSequence(m)||this.regexp_eatIdentityEscape(m)},Ht.regexp_eatCControlLetter=function(m){var A=m.pos;if(m.eat(99)){if(this.regexp_eatControlLetter(m))return!0;m.pos=A}return!1},Ht.regexp_eatZero=function(m){return m.current()===48&&!Di(m.lookahead())?(m.lastIntValue=0,m.advance(),!0):!1},Ht.regexp_eatControlEscape=function(m){var A=m.current();return A===116?(m.lastIntValue=9,m.advance(),!0):A===110?(m.lastIntValue=10,m.advance(),!0):A===118?(m.lastIntValue=11,m.advance(),!0):A===102?(m.lastIntValue=12,m.advance(),!0):A===114?(m.lastIntValue=13,m.advance(),!0):!1},Ht.regexp_eatControlLetter=function(m){var A=m.current();return In(A)?(m.lastIntValue=A%32,m.advance(),!0):!1};function In(m){return m>=65&&m<=90||m>=97&&m<=122}Ht.regexp_eatRegExpUnicodeEscapeSequence=function(m,A){A===void 0&&(A=!1);var z=m.pos,I=A||m.switchU;if(m.eat(117)){if(this.regexp_eatFixedHexDigits(m,4)){var fe=m.lastIntValue;if(I&&fe>=55296&&fe<=56319){var Ie=m.pos;if(m.eat(92)&&m.eat(117)&&this.regexp_eatFixedHexDigits(m,4)){var lt=m.lastIntValue;if(lt>=56320&&lt<=57343)return m.lastIntValue=(fe-55296)*1024+(lt-56320)+65536,!0}m.pos=Ie,m.lastIntValue=fe}return!0}if(I&&m.eat(123)&&this.regexp_eatHexDigits(m)&&m.eat(125)&&hn(m.lastIntValue))return!0;I&&m.raise("Invalid unicode escape"),m.pos=z}return!1};function hn(m){return m>=0&&m<=1114111}Ht.regexp_eatIdentityEscape=function(m){if(m.switchU)return this.regexp_eatSyntaxCharacter(m)?!0:m.eat(47)?(m.lastIntValue=47,!0):!1;var A=m.current();return A!==99&&(!m.switchN||A!==107)?(m.lastIntValue=A,m.advance(),!0):!1},Ht.regexp_eatDecimalEscape=function(m){m.lastIntValue=0;var A=m.current();if(A>=49&&A<=57){do m.lastIntValue=10*m.lastIntValue+(A-48),m.advance();while((A=m.current())>=48&&A<=57);return!0}return!1},Ht.regexp_eatCharacterClassEscape=function(m){var A=m.current();if(mn(A))return m.lastIntValue=-1,m.advance(),!0;if(m.switchU&&this.options.ecmaVersion>=9&&(A===80||A===112)){if(m.lastIntValue=-1,m.advance(),m.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(m)&&m.eat(125))return!0;m.raise("Invalid property name")}return!1};function mn(m){return m===100||m===68||m===115||m===83||m===119||m===87}Ht.regexp_eatUnicodePropertyValueExpression=function(m){var A=m.pos;if(this.regexp_eatUnicodePropertyName(m)&&m.eat(61)){var z=m.lastStringValue;if(this.regexp_eatUnicodePropertyValue(m)){var I=m.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(m,z,I),!0}}if(m.pos=A,this.regexp_eatLoneUnicodePropertyNameOrValue(m)){var fe=m.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(m,fe),!0}return!1},Ht.regexp_validateUnicodePropertyNameAndValue=function(m,A,z){j(m.unicodeProperties.nonBinary,A)||m.raise("Invalid property name"),m.unicodeProperties.nonBinary[A].test(z)||m.raise("Invalid property value")},Ht.regexp_validateUnicodePropertyNameOrValue=function(m,A){m.unicodeProperties.binary.test(A)||m.raise("Invalid property name")},Ht.regexp_eatUnicodePropertyName=function(m){var A=0;for(m.lastStringValue="";Bi(A=m.current());)m.lastStringValue+=Nr(A),m.advance();return m.lastStringValue!==""};function Bi(m){return In(m)||m===95}Ht.regexp_eatUnicodePropertyValue=function(m){var A=0;for(m.lastStringValue="";An(A=m.current());)m.lastStringValue+=Nr(A),m.advance();return m.lastStringValue!==""};function An(m){return Bi(m)||Di(m)}Ht.regexp_eatLoneUnicodePropertyNameOrValue=function(m){return this.regexp_eatUnicodePropertyValue(m)},Ht.regexp_eatCharacterClass=function(m){if(m.eat(91)){if(m.eat(94),this.regexp_classRanges(m),m.eat(93))return!0;m.raise("Unterminated character class")}return!1},Ht.regexp_classRanges=function(m){for(;this.regexp_eatClassAtom(m);){var A=m.lastIntValue;if(m.eat(45)&&this.regexp_eatClassAtom(m)){var z=m.lastIntValue;m.switchU&&(A===-1||z===-1)&&m.raise("Invalid character class"),A!==-1&&z!==-1&&A>z&&m.raise("Range out of order in character class")}}},Ht.regexp_eatClassAtom=function(m){var A=m.pos;if(m.eat(92)){if(this.regexp_eatClassEscape(m))return!0;if(m.switchU){var z=m.current();(z===99||na(z))&&m.raise("Invalid class escape"),m.raise("Invalid escape")}m.pos=A}var I=m.current();return I!==93?(m.lastIntValue=I,m.advance(),!0):!1},Ht.regexp_eatClassEscape=function(m){var A=m.pos;if(m.eat(98))return m.lastIntValue=8,!0;if(m.switchU&&m.eat(45))return m.lastIntValue=45,!0;if(!m.switchU&&m.eat(99)){if(this.regexp_eatClassControlLetter(m))return!0;m.pos=A}return this.regexp_eatCharacterClassEscape(m)||this.regexp_eatCharacterEscape(m)},Ht.regexp_eatClassControlLetter=function(m){var A=m.current();return Di(A)||A===95?(m.lastIntValue=A%32,m.advance(),!0):!1},Ht.regexp_eatHexEscapeSequence=function(m){var A=m.pos;if(m.eat(120)){if(this.regexp_eatFixedHexDigits(m,2))return!0;m.switchU&&m.raise("Invalid escape"),m.pos=A}return!1},Ht.regexp_eatDecimalDigits=function(m){var A=m.pos,z=0;for(m.lastIntValue=0;Di(z=m.current());)m.lastIntValue=10*m.lastIntValue+(z-48),m.advance();return m.pos!==A};function Di(m){return m>=48&&m<=57}Ht.regexp_eatHexDigits=function(m){var A=m.pos,z=0;for(m.lastIntValue=0;ra(z=m.current());)m.lastIntValue=16*m.lastIntValue+hi(z),m.advance();return m.pos!==A};function ra(m){return m>=48&&m<=57||m>=65&&m<=70||m>=97&&m<=102}function hi(m){return m>=65&&m<=70?10+(m-65):m>=97&&m<=102?10+(m-97):m-48}Ht.regexp_eatLegacyOctalEscapeSequence=function(m){if(this.regexp_eatOctalDigit(m)){var A=m.lastIntValue;if(this.regexp_eatOctalDigit(m)){var z=m.lastIntValue;A<=3&&this.regexp_eatOctalDigit(m)?m.lastIntValue=A*64+z*8+m.lastIntValue:m.lastIntValue=A*8+z}else m.lastIntValue=A;return!0}return!1},Ht.regexp_eatOctalDigit=function(m){var A=m.current();return na(A)?(m.lastIntValue=A-48,m.advance(),!0):(m.lastIntValue=0,!1)};function na(m){return m>=48&&m<=55}Ht.regexp_eatFixedHexDigits=function(m,A){var z=m.pos;m.lastIntValue=0;for(var I=0;I<A;++I){var fe=m.current();if(!ra(fe))return m.pos=z,!1;m.lastIntValue=16*m.lastIntValue+hi(fe),m.advance()}return!0};var Hi=function(A){this.type=A.type,this.value=A.value,this.start=A.start,this.end=A.end,A.options.locations&&(this.loc=new _t(A,A.startLoc,A.endLoc)),A.options.ranges&&(this.range=[A.start,A.end])},Oi=Ue.prototype;Oi.next=function(m){!m&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Hi(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Oi.getToken=function(){return this.next(),new Hi(this)},typeof Symbol!="undefined"&&(Oi[Symbol.iterator]=function(){var m=this;return{next:function(){var A=m.getToken();return{done:A.type===q.eof,value:A}}}}),Oi.curContext=function(){return this.context[this.context.length-1]},Oi.nextToken=function(){var m=this.curContext();if((!m||!m.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(q.eof);if(m.override)return m.override(this);this.readToken(this.fullCharCodeAtPos())},Oi.readToken=function(m){return Cr(m,this.options.ecmaVersion>=6)||m===92?this.readWord():this.getTokenFromCode(m)},Oi.fullCharCodeAtPos=function(){var m=this.input.charCodeAt(this.pos);if(m<=55295||m>=57344)return m;var A=this.input.charCodeAt(this.pos+1);return(m<<10)+A-56613888},Oi.skipBlockComment=function(){var m=this.options.onComment&&this.curPosition(),A=this.pos,z=this.input.indexOf("*/",this.pos+=2);if(z===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=z+2,this.options.locations){wt.lastIndex=A;for(var I;(I=wt.exec(this.input))&&I.index<this.pos;)++this.curLine,this.lineStart=I.index+I[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(A+2,z),A,this.pos,m,this.curPosition())},Oi.skipLineComment=function(m){for(var A=this.pos,z=this.options.onComment&&this.curPosition(),I=this.input.charCodeAt(this.pos+=m);this.pos<this.input.length&&!$e(I);)I=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(A+m,this.pos),A,this.pos,z,this.curPosition())},Oi.skipSpace=function(){e:for(;this.pos<this.input.length;){var m=this.input.charCodeAt(this.pos);switch(m){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(m>8&&m<14||m>=5760&&Ft.test(String.fromCharCode(m)))++this.pos;else break e}}},Oi.finishToken=function(m,A){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var z=this.type;this.type=m,this.value=A,this.updateContext(z)},Oi.readToken_dot=function(){var m=this.input.charCodeAt(this.pos+1);if(m>=48&&m<=57)return this.readNumber(!0);var A=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&m===46&&A===46?(this.pos+=3,this.finishToken(q.ellipsis)):(++this.pos,this.finishToken(q.dot))},Oi.readToken_slash=function(){var m=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):m===61?this.finishOp(q.assign,2):this.finishOp(q.slash,1)},Oi.readToken_mult_modulo_exp=function(m){var A=this.input.charCodeAt(this.pos+1),z=1,I=m===42?q.star:q.modulo;return this.options.ecmaVersion>=7&&m===42&&A===42&&(++z,I=q.starstar,A=this.input.charCodeAt(this.pos+2)),A===61?this.finishOp(q.assign,z+1):this.finishOp(I,z)},Oi.readToken_pipe_amp=function(m){var A=this.input.charCodeAt(this.pos+1);if(A===m){if(this.options.ecmaVersion>=12){var z=this.input.charCodeAt(this.pos+2);if(z===61)return this.finishOp(q.assign,3)}return this.finishOp(m===124?q.logicalOR:q.logicalAND,2)}return A===61?this.finishOp(q.assign,2):this.finishOp(m===124?q.bitwiseOR:q.bitwiseAND,1)},Oi.readToken_caret=function(){var m=this.input.charCodeAt(this.pos+1);return m===61?this.finishOp(q.assign,2):this.finishOp(q.bitwiseXOR,1)},Oi.readToken_plus_min=function(m){var A=this.input.charCodeAt(this.pos+1);return A===m?A===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||hr.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(q.incDec,2):A===61?this.finishOp(q.assign,2):this.finishOp(q.plusMin,1)},Oi.readToken_lt_gt=function(m){var A=this.input.charCodeAt(this.pos+1),z=1;return A===m?(z=m===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+z)===61?this.finishOp(q.assign,z+1):this.finishOp(q.bitShift,z)):A===33&&m===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(A===61&&(z=2),this.finishOp(q.relational,z))},Oi.readToken_eq_excl=function(m){var A=this.input.charCodeAt(this.pos+1);return A===61?this.finishOp(q.equality,this.input.charCodeAt(this.pos+2)===61?3:2):m===61&&A===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(q.arrow)):this.finishOp(m===61?q.eq:q.prefix,1)},Oi.readToken_question=function(){var m=this.options.ecmaVersion;if(m>=11){var A=this.input.charCodeAt(this.pos+1);if(A===46){var z=this.input.charCodeAt(this.pos+2);if(z<48||z>57)return this.finishOp(q.questionDot,2)}if(A===63){if(m>=12){var I=this.input.charCodeAt(this.pos+2);if(I===61)return this.finishOp(q.assign,3)}return this.finishOp(q.coalesce,2)}}return this.finishOp(q.question,1)},Oi.getTokenFromCode=function(m){switch(m){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(q.parenL);case 41:return++this.pos,this.finishToken(q.parenR);case 59:return++this.pos,this.finishToken(q.semi);case 44:return++this.pos,this.finishToken(q.comma);case 91:return++this.pos,this.finishToken(q.bracketL);case 93:return++this.pos,this.finishToken(q.bracketR);case 123:return++this.pos,this.finishToken(q.braceL);case 125:return++this.pos,this.finishToken(q.braceR);case 58:return++this.pos,this.finishToken(q.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(q.backQuote);case 48:var A=this.input.charCodeAt(this.pos+1);if(A===120||A===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(A===111||A===79)return this.readRadixNumber(8);if(A===98||A===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(m);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(m);case 124:case 38:return this.readToken_pipe_amp(m);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(m);case 60:case 62:return this.readToken_lt_gt(m);case 61:case 33:return this.readToken_eq_excl(m);case 63:return this.readToken_question();case 126:return this.finishOp(q.prefix,1)}this.raise(this.pos,"Unexpected character '"+Wi(m)+"'")},Oi.finishOp=function(m,A){var z=this.input.slice(this.pos,this.pos+A);return this.pos+=A,this.finishToken(m,z)},Oi.readRegexp=function(){for(var m,A,z=this.pos;;){this.pos>=this.input.length&&this.raise(z,"Unterminated regular expression");var I=this.input.charAt(this.pos);if(hr.test(I)&&this.raise(z,"Unterminated regular expression"),m)m=!1;else{if(I==="[")A=!0;else if(I==="]"&&A)A=!1;else if(I==="/"&&!A)break;m=I==="\\"}++this.pos}var fe=this.input.slice(z,this.pos);++this.pos;var Ie=this.pos,lt=this.readWord1();this.containsEsc&&this.unexpected(Ie);var Dt=this.regexpState||(this.regexpState=new Jt(this));Dt.reset(z,fe,lt),this.validateRegExpFlags(Dt),this.validateRegExpPattern(Dt);var Nt=null;try{Nt=new RegExp(fe,lt)}catch(Dr){}return this.finishToken(q.regexp,{pattern:fe,flags:lt,value:Nt})},Oi.readInt=function(m,A,z){for(var I=this.options.ecmaVersion>=12&&A===void 0,fe=z&&this.input.charCodeAt(this.pos)===48,Ie=this.pos,lt=0,Dt=0,Nt=0,Dr=A==null?Infinity:A;Nt<Dr;++Nt,++this.pos){var Wr=this.input.charCodeAt(this.pos),ln=void 0;if(I&&Wr===95){fe&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Dt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Nt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Dt=Wr;continue}if(Wr>=97?ln=Wr-97+10:Wr>=65?ln=Wr-65+10:Wr>=48&&Wr<=57?ln=Wr-48:ln=Infinity,ln>=m)break;Dt=Wr,lt=lt*m+ln}return I&&Dt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===Ie||A!=null&&this.pos-Ie!==A?null:lt};function ga(m,A){return A?parseInt(m,8):parseFloat(m.replace(/_/g,""))}function Ra(m){return typeof BigInt!="function"?null:BigInt(m.replace(/_/g,""))}Oi.readRadixNumber=function(m){var A=this.pos;this.pos+=2;var z=this.readInt(m);return z==null&&this.raise(this.start+2,"Expected number in radix "+m),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(z=Ra(this.input.slice(A,this.pos)),++this.pos):Cr(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(q.num,z)},Oi.readNumber=function(m){var A=this.pos;!m&&this.readInt(10,void 0,!0)===null&&this.raise(A,"Invalid number");var z=this.pos-A>=2&&this.input.charCodeAt(A)===48;z&&this.strict&&this.raise(A,"Invalid number");var I=this.input.charCodeAt(this.pos);if(!z&&!m&&this.options.ecmaVersion>=11&&I===110){var fe=Ra(this.input.slice(A,this.pos));return++this.pos,Cr(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(q.num,fe)}z&&/[89]/.test(this.input.slice(A,this.pos))&&(z=!1),I===46&&!z&&(++this.pos,this.readInt(10),I=this.input.charCodeAt(this.pos)),(I===69||I===101)&&!z&&(I=this.input.charCodeAt(++this.pos),(I===43||I===45)&&++this.pos,this.readInt(10)===null&&this.raise(A,"Invalid number")),Cr(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var Ie=ga(this.input.slice(A,this.pos),z);return this.finishToken(q.num,Ie)},Oi.readCodePoint=function(){var m=this.input.charCodeAt(this.pos),A;if(m===123){this.options.ecmaVersion<6&&this.unexpected();var z=++this.pos;A=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,A>1114111&&this.invalidStringToken(z,"Code point out of bounds")}else A=this.readHexChar(4);return A};function Wi(m){return m<=65535?String.fromCharCode(m):(m-=65536,String.fromCharCode((m>>10)+55296,(m&1023)+56320))}Oi.readString=function(m){for(var A="",z=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var I=this.input.charCodeAt(this.pos);if(I===m)break;I===92?(A+=this.input.slice(z,this.pos),A+=this.readEscapedChar(!1),z=this.pos):($e(I,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return A+=this.input.slice(z,this.pos++),this.finishToken(q.string,A)};var Ni={};Oi.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(m){if(m===Ni)this.readInvalidTemplateToken();else throw m}this.inTemplateElement=!1},Oi.invalidStringToken=function(m,A){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Ni;this.raise(m,A)},Oi.readTmplToken=function(){for(var m="",A=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var z=this.input.charCodeAt(this.pos);if(z===96||z===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===q.template||this.type===q.invalidTemplate)?z===36?(this.pos+=2,this.finishToken(q.dollarBraceL)):(++this.pos,this.finishToken(q.backQuote)):(m+=this.input.slice(A,this.pos),this.finishToken(q.template,m));if(z===92)m+=this.input.slice(A,this.pos),m+=this.readEscapedChar(!0),A=this.pos;else if($e(z)){switch(m+=this.input.slice(A,this.pos),++this.pos,z){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:m+=`
`;break;default:m+=String.fromCharCode(z);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),A=this.pos}else++this.pos}},Oi.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(q.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Oi.readEscapedChar=function(m){var A=this.input.charCodeAt(++this.pos);switch(++this.pos,A){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Wi(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(m){var z=this.pos-1;return this.invalidStringToken(z,"Invalid escape sequence in template string"),null}default:if(A>=48&&A<=55){var I=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],fe=parseInt(I,8);return fe>255&&(I=I.slice(0,-1),fe=parseInt(I,8)),this.pos+=I.length-1,A=this.input.charCodeAt(this.pos),(I!=="0"||A===56||A===57)&&(this.strict||m)&&this.invalidStringToken(this.pos-1-I.length,m?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(fe)}return $e(A)?"":String.fromCharCode(A)}},Oi.readHexChar=function(m){var A=this.pos,z=this.readInt(16,m);return z===null&&this.invalidStringToken(A,"Bad character escape sequence"),z},Oi.readWord1=function(){this.containsEsc=!1;for(var m="",A=!0,z=this.pos,I=this.options.ecmaVersion>=6;this.pos<this.input.length;){var fe=this.fullCharCodeAtPos();if(Qt(fe,I))this.pos+=fe<=65535?1:2;else if(fe===92){this.containsEsc=!0,m+=this.input.slice(z,this.pos);var Ie=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var lt=this.readCodePoint();(A?Cr:Qt)(lt,I)||this.invalidStringToken(Ie,"Invalid Unicode escape"),m+=Wi(lt),z=this.pos}else break;A=!1}return m+this.input.slice(z,this.pos)},Oi.readWord=function(){var m=this.readWord1(),A=q.name;return this.keywords.test(m)&&(A=Et[m]),this.finishToken(A,m)};var Xi="7.4.1";Ue.acorn={Parser:Ue,version:Xi,defaultOptions:zt,Position:ye,SourceLocation:_t,getLineInfo:dt,Node:cr,TokenType:Xt,tokTypes:q,keywordTypes:Et,TokContext:Gn,tokContexts:Mn,isIdentifierChar:Qt,isIdentifierStart:Cr,Token:Hi,isNewLine:$e,lineBreak:hr,lineBreakG:wt,nonASCIIwhitespace:Ft};function ro(m,A){return Ue.parse(m,A)}function Qo(m,A,z){return Ue.parseExpressionAt(m,A,z)}function za(m,A){return Ue.tokenizer(m,A)}function $i(m,A){m.prototype=Object.create(A.prototype),m.prototype.constructor=m,m.__proto__=A}function cu(m){var A=typeof Map=="function"?new Map:void 0;return cu=function(I){if(I===null||!xo(I))return I;if(typeof I!="function")throw new TypeError("Super expression must either be null or a function");if(typeof A!="undefined"){if(A.has(I))return A.get(I);A.set(I,fe)}function fe(){return Yi(I,arguments,Xa(this).constructor)}return fe.prototype=Object.create(I.prototype,{constructor:{value:fe,enumerable:!1,writable:!0,configurable:!0}}),Ki(fe,I)},cu(m)}function Pu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}function Yi(m,A,z){return Pu()?Yi=Reflect.construct:Yi=function(fe,Ie,lt){var Dt=[null];Dt.push.apply(Dt,Ie);var Nt=Function.bind.apply(fe,Dt),Dr=new Nt;return lt&&Ki(Dr,lt.prototype),Dr},Yi.apply(null,arguments)}function xo(m){return Function.toString.call(m).indexOf("[native code]")!==-1}function Ki(m,A){return Ki=Object.setPrototypeOf||function(I,fe){return I.__proto__=fe,I},Ki(m,A)}function Xa(m){return Xa=Object.setPrototypeOf?Object.getPrototypeOf:function(z){return z.__proto__||Object.getPrototypeOf(z)},Xa(m)}var qo=function(m){$i(A,m);function A(){return m.apply(this,arguments)||this}return A}(cu(Error)),xa=function(m){$i(A,m);function A(){return m.apply(this,arguments)||this}return A}(cu(SyntaxError)),Do=function(m){$i(A,m);function A(){return m.apply(this,arguments)||this}return A}(cu(ReferenceError)),ko=function(m){$i(A,m);function A(){return m.apply(this,arguments)||this}return A}(cu(TypeError)),Rs=function(m){$i(A,m);function A(){return m.apply(this,arguments)||this}return A}(qo),vo=function(m){$i(A,m);function A(){return m.apply(this,arguments)||this}return A}(xa),Xo=function(m){$i(A,m);function A(){return m.apply(this,arguments)||this}return A}(Do),Da={UnknownError:[3001,"%0",Rs],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Rs],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Xo],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Xo],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Xo],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Xo],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Xo],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Xo],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Xo],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Xo],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Xo],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Xo],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Do],VariableUndefinedReferenceError:[2002,"%0 is not defined",Do],IsNotConstructor:[2003,"%0 is not a constructor",ko]};function co(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}function ss(m,A,z){return co()?ss=Reflect.construct:ss=function(fe,Ie,lt){var Dt=[null];Dt.push.apply(Dt,Ie);var Nt=Function.bind.apply(fe,Dt),Dr=new Nt;return lt&&Fo(Dr,lt.prototype),Dr},ss.apply(null,arguments)}function Fo(m,A){return Fo=Object.setPrototypeOf||function(I,fe){return I.__proto__=fe,I},Fo(m,A)}var Se="0.0.2";function ke(m,A){Object.defineProperty(m,"name",{value:A,writable:!1,enumerable:!1,configurable:!0})}var ft=Object.prototype.hasOwnProperty,L=Symbol("Break"),Qr=Symbol("Continue"),ai=Symbol("DefaultCase"),wi=Symbol("EmptyStatementReturn"),fo=Symbol("WithScopeName"),Ya=Symbol("SuperScopeName"),ja=Symbol("RootScopeName"),us=Symbol("GlobalScopeName");function fu(m){return typeof m=="function"}var Mu=function(){function m(z){this.interpreter=z}var A=m.prototype;return A.generator=function(){var I=this.interpreter;function fe(){return this.getCurrentScope()}function Ie(){return this.getGlobalScope()}function lt(){return this.getCurrentContext()}return{getOptions:I.getOptions.bind(I),getCurrentScope:fe.bind(I),getGlobalScope:Ie.bind(I),getCurrentContext:lt.bind(I),getExecStartTime:I.getExecStartTime.bind(I)}},m}();function Yu(m,A,z){if(z===void 0&&(z=!0),!(m instanceof Mu))throw new Error("Illegal call");if(typeof A!="string")return A;if(!!A){var I=m.generator(),fe=I.getOptions(),Ie={timeout:fe.timeout,_initEnv:function(){z||this.setCurrentContext(I.getCurrentContext()),this.execStartTime=I.getExecStartTime(),this.execEndTime=this.execStartTime}},lt=z?I.getGlobalScope():I.getCurrentScope(),Dt=new Co(lt,Ie);return Dt.evaluate(A)}}Object.defineProperty(Yu,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function es(m){if(!(m instanceof Mu))throw new Error("Illegal call");for(var A=m.generator(),z=arguments.length,I=new Array(z>1?z-1:0),fe=1;fe<z;fe++)I[fe-1]=arguments[fe];var Ie=I.pop(),lt=new Co(A.getGlobalScope(),A.getOptions()),Dt=`
		    (function anonymous(`+I.join(",")+`){
		        `+Ie+`
		    });
		    `;return lt.evaluate(Dt)}Object.defineProperty(es,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var ts=function(A){this.value=A},ls=function(A){this.value=A},ws=function(A){this.value=A},cs=function(A,z,I){z===void 0&&(z=null),this.name=I,this.parent=z,this.data=A,this.labelStack=[]};function Us(){}function $s(m,A){return m===void 0&&(m=null),new cs(Object.create(null),m,A)}function As(m){return Object.create(m)}var Ea={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Yu,Function:es};typeof JSON!="undefined"&&(Ea.JSON=JSON),typeof Promise!="undefined"&&(Ea.Promise=Promise),typeof Set!="undefined"&&(Ea.Set=Set),typeof Map!="undefined"&&(Ea.Map=Map),typeof Symbol!="undefined"&&(Ea.Symbol=Symbol),typeof Proxy!="undefined"&&(Ea.Proxy=Proxy),typeof WeakMap!="undefined"&&(Ea.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(Ea.WeakSet=WeakSet),typeof Reflect!="undefined"&&(Ea.Reflect=Reflect);var Co=function(){function m(z,I){z===void 0&&(z=m.global),I===void 0&&(I={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:I.ecmaVersion||m.ecmaVersion,timeout:I.timeout||0,rootContext:I.rootContext,globalContextInFunction:I.globalContextInFunction===void 0?m.globalContextInFunction:I.globalContextInFunction,_initEnv:I._initEnv},this.context=z||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var A=m.prototype;return A.initEnvironment=function(I){var fe;if(I instanceof cs)fe=I;else{var Ie=null,lt=this.createSuperScope(I);this.options.rootContext&&(Ie=new cs(As(this.options.rootContext),lt,ja)),fe=new cs(I,Ie||lt,us)}this.globalScope=fe,this.currentScope=this.globalScope,this.globalContext=fe.data,this.currentContext=fe.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var Dt=this.options._initEnv;Dt&&Dt.call(this)},A.getExecStartTime=function(){return this.execStartTime},A.getExecutionTime=function(){return this.execEndTime-this.execStartTime},A.setExecTimeout=function(I){I===void 0&&(I=0),this.options.timeout=I},A.getOptions=function(){return this.options},A.getGlobalScope=function(){return this.globalScope},A.getCurrentScope=function(){return this.currentScope},A.getCurrentContext=function(){return this.currentContext},A.isInterruptThrow=function(I){return I instanceof Rs||I instanceof Xo||I instanceof vo},A.createSuperScope=function(I){var fe=Object.assign({},Ea),Ie=Object.keys(fe);return Ie.forEach(function(lt){lt in I&&delete fe[lt]}),new cs(fe,null,Ya)},A.setCurrentContext=function(I){this.currentContext=I},A.setCurrentScope=function(I){this.currentScope=I},A.evaluate=function(I){I===void 0&&(I="");var fe;if(!!I)return fe=ro(I,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||m.ecmaVersion}),this.evaluateNode(fe,I)},A.appendCode=function(I){return this.evaluate(I)},A.evaluateNode=function(I,fe){var Ie=this;fe===void 0&&(fe=""),this.value=void 0,this.source=fe,this.sourceList.push(fe),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var lt=this.getCurrentScope(),Dt=this.getCurrentContext(),Nt=lt.labelStack.concat([]),Dr=this.callStack.concat([]),Wr=function(){Ie.setCurrentScope(lt),Ie.setCurrentContext(Dt),lt.labelStack=Nt,Ie.callStack=Dr};try{var ln=this.createClosure(I);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),ln()}catch(Li){throw Li}finally{Wr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},A.createErrorMessage=function(I,fe,Ie){var lt=I[1].replace("%0",String(fe));return Ie!==null&&(lt+=this.getNodePosition(Ie||this.lastExecNode)),lt},A.createError=function(I,fe){return new fe(I)},A.createThrowError=function(I,fe){return this.createError(I,fe)},A.createInternalThrowError=function(I,fe,Ie){return this.createError(this.createErrorMessage(I,fe,Ie),I[2])},A.checkTimeout=function(){if(!this.isRunning)return!1;var I=this.options.timeout||0,fe=Date.now();return fe-this.execStartTime>I},A.getNodePosition=function(I){if(I){var fe="";return I.loc?" ["+I.loc.start.line+":"+I.loc.start.column+"]"+fe:""}return""},A.createClosure=function(I){var fe=this,Ie;switch(I.type){case"BinaryExpression":Ie=this.binaryExpressionHandler(I);break;case"LogicalExpression":Ie=this.logicalExpressionHandler(I);break;case"UnaryExpression":Ie=this.unaryExpressionHandler(I);break;case"UpdateExpression":Ie=this.updateExpressionHandler(I);break;case"ObjectExpression":Ie=this.objectExpressionHandler(I);break;case"ArrayExpression":Ie=this.arrayExpressionHandler(I);break;case"CallExpression":Ie=this.callExpressionHandler(I);break;case"NewExpression":Ie=this.newExpressionHandler(I);break;case"MemberExpression":Ie=this.memberExpressionHandler(I);break;case"ThisExpression":Ie=this.thisExpressionHandler(I);break;case"SequenceExpression":Ie=this.sequenceExpressionHandler(I);break;case"Literal":Ie=this.literalHandler(I);break;case"Identifier":Ie=this.identifierHandler(I);break;case"AssignmentExpression":Ie=this.assignmentExpressionHandler(I);break;case"FunctionDeclaration":Ie=this.functionDeclarationHandler(I);break;case"VariableDeclaration":Ie=this.variableDeclarationHandler(I);break;case"BlockStatement":case"Program":Ie=this.programHandler(I);break;case"ExpressionStatement":Ie=this.expressionStatementHandler(I);break;case"EmptyStatement":Ie=this.emptyStatementHandler(I);break;case"ReturnStatement":Ie=this.returnStatementHandler(I);break;case"FunctionExpression":Ie=this.functionExpressionHandler(I);break;case"IfStatement":Ie=this.ifStatementHandler(I);break;case"ConditionalExpression":Ie=this.conditionalExpressionHandler(I);break;case"ForStatement":Ie=this.forStatementHandler(I);break;case"WhileStatement":Ie=this.whileStatementHandler(I);break;case"DoWhileStatement":Ie=this.doWhileStatementHandler(I);break;case"ForInStatement":Ie=this.forInStatementHandler(I);break;case"WithStatement":Ie=this.withStatementHandler(I);break;case"ThrowStatement":Ie=this.throwStatementHandler(I);break;case"TryStatement":Ie=this.tryStatementHandler(I);break;case"ContinueStatement":Ie=this.continueStatementHandler(I);break;case"BreakStatement":Ie=this.breakStatementHandler(I);break;case"SwitchStatement":Ie=this.switchStatementHandler(I);break;case"LabeledStatement":Ie=this.labeledStatementHandler(I);break;case"DebuggerStatement":Ie=this.debuggerStatementHandler(I);break;default:throw this.createInternalThrowError(Da.NodeTypeSyntaxError,I.type,I)}return function(){var lt=fe.options.timeout;if(lt&&lt>0&&fe.checkTimeout())throw fe.createInternalThrowError(Da.ExecutionTimeOutError,lt,null);return fe.lastExecNode=I,Ie.apply(void 0,arguments)}},A.binaryExpressionHandler=function(I){var fe=this,Ie=this.createClosure(I.left),lt=this.createClosure(I.right);return function(){var Dt=Ie(),Nt=lt();switch(I.operator){case"==":return Dt==Nt;case"!=":return Dt!=Nt;case"===":return Dt===Nt;case"!==":return Dt!==Nt;case"<":return Dt<Nt;case"<=":return Dt<=Nt;case">":return Dt>Nt;case">=":return Dt>=Nt;case"<<":return Dt<<Nt;case">>":return Dt>>Nt;case">>>":return Dt>>>Nt;case"+":return Dt+Nt;case"-":return Dt-Nt;case"*":return Dt*Nt;case"**":return Math.pow(Dt,Nt);case"/":return Dt/Nt;case"%":return Dt%Nt;case"|":return Dt|Nt;case"^":return Dt^Nt;case"&":return Dt&Nt;case"in":return Dt in Nt;case"instanceof":return Dt instanceof Nt;default:throw fe.createInternalThrowError(Da.BinaryOperatorSyntaxError,I.operator,I)}}},A.logicalExpressionHandler=function(I){var fe=this,Ie=this.createClosure(I.left),lt=this.createClosure(I.right);return function(){switch(I.operator){case"||":return Ie()||lt();case"&&":return Ie()&&lt();default:throw fe.createInternalThrowError(Da.LogicalOperatorSyntaxError,I.operator,I)}}},A.unaryExpressionHandler=function(I){var fe=this;switch(I.operator){case"delete":var Ie=this.createObjectGetter(I.argument),lt=this.createNameGetter(I.argument);return function(){var Wr=Ie(),ln=lt();return delete Wr[ln]};default:var Dt;if(I.operator==="typeof"&&I.argument.type==="Identifier"){var Nt=this.createObjectGetter(I.argument),Dr=this.createNameGetter(I.argument);Dt=function(){return Nt()[Dr()]}}else Dt=this.createClosure(I.argument);return function(){var Wr=Dt();switch(I.operator){case"-":return-Wr;case"+":return+Wr;case"!":return!Wr;case"~":return~Wr;case"void":return;case"typeof":return typeof Wr;default:throw fe.createInternalThrowError(Da.UnaryOperatorSyntaxError,I.operator,I)}}}},A.updateExpressionHandler=function(I){var fe=this,Ie=this.createObjectGetter(I.argument),lt=this.createNameGetter(I.argument);return function(){var Dt=Ie(),Nt=lt();switch(fe.assertVariable(Dt,Nt,I),I.operator){case"++":return I.prefix?++Dt[Nt]:Dt[Nt]++;case"--":return I.prefix?--Dt[Nt]:Dt[Nt]--;default:throw fe.createInternalThrowError(Da.UpdateOperatorSyntaxError,I.operator,I)}}},A.objectExpressionHandler=function(I){var fe=this,Ie=[];function lt(Nt){return Nt.type==="Identifier"?Nt.name:Nt.type==="Literal"?Nt.value:this.throwError(Da.ObjectStructureSyntaxError,Nt.type,Nt)}var Dt=Object.create(null);return I.properties.forEach(function(Nt){var Dr=Nt.kind,Wr=lt(Nt.key);(!Dt[Wr]||Dr==="init")&&(Dt[Wr]={}),Dt[Wr][Dr]=fe.createClosure(Nt.value),Ie.push({key:Wr,property:Nt})}),function(){for(var Nt={},Dr=Ie.length,Wr=0;Wr<Dr;Wr++){var ln=Ie[Wr],Li=ln.key,Ei=Dt[Li],ha=Ei.init?Ei.init():void 0,Pa=Ei.get?Ei.get():function(){},ya=Ei.set?Ei.set():function(Js){};if("set"in Ei||"get"in Ei){var _i={configurable:!0,enumerable:!0,get:Pa,set:ya};Object.defineProperty(Nt,Li,_i)}else{var mo=ln.property,wo=mo.kind;mo.key.type==="Identifier"&&mo.value.type==="FunctionExpression"&&wo==="init"&&!mo.value.id&&ke(ha,mo.key.name),Nt[Li]=ha}}return Nt}},A.arrayExpressionHandler=function(I){var fe=this,Ie=I.elements.map(function(lt){return lt&&fe.createClosure(lt)});return function(){for(var lt=Ie.length,Dt=Array(lt),Nt=0;Nt<lt;Nt++){var Dr=Ie[Nt];Dr&&(Dt[Nt]=Dr())}return Dt}},A.safeObjectGet=function(I,fe,Ie){return I[fe]},A.createCallFunctionGetter=function(I){var fe=this;switch(I.type){case"MemberExpression":var Ie=this.createClosure(I.object),lt=this.createMemberKeyGetter(I),Dt=this.source;return function(){var Dr=Ie(),Wr=lt(),ln=fe.safeObjectGet(Dr,Wr,I);if(!ln||!fu(ln)){var Li=Dt.slice(I.start,I.end);throw fe.createInternalThrowError(Da.FunctionUndefinedReferenceError,Li,I)}return ln.__IS_EVAL_FUNC?function(Ei){return ln(new Mu(fe),Ei,!0)}:ln.__IS_FUNCTION_FUNC?function(){for(var Ei=arguments.length,ha=new Array(Ei),Pa=0;Pa<Ei;Pa++)ha[Pa]=arguments[Pa];return ln.apply(void 0,[new Mu(fe)].concat(ha))}:ln.bind(Dr)};default:var Nt=this.createClosure(I);return function(){var Dr="";I.type==="Identifier"&&(Dr=I.name);var Wr=Nt();if(!Wr||!fu(Wr))throw fe.createInternalThrowError(Da.FunctionUndefinedReferenceError,Dr,I);if(I.type==="Identifier"&&Wr.__IS_EVAL_FUNC&&Dr==="eval")return function(Ei){var ha=fe.getScopeFromName(Dr,fe.getCurrentScope()),Pa=ha.name===Ya||ha.name===us||ha.name===ja;return Wr(new Mu(fe),Ei,!Pa)};if(Wr.__IS_EVAL_FUNC)return function(Ei){return Wr(new Mu(fe),Ei,!0)};if(Wr.__IS_FUNCTION_FUNC)return function(){for(var Ei=arguments.length,ha=new Array(Ei),Pa=0;Pa<Ei;Pa++)ha[Pa]=arguments[Pa];return Wr.apply(void 0,[new Mu(fe)].concat(ha))};var ln=fe.options.globalContextInFunction;if(I.type==="Identifier"){var Li=fe.getIdentifierScope(I);Li.name===fo&&(ln=Li.data)}return Wr.bind(ln)}}},A.callExpressionHandler=function(I){var fe=this,Ie=this.createCallFunctionGetter(I.callee),lt=I.arguments.map(function(Dt){return fe.createClosure(Dt)});return function(){return Ie().apply(void 0,lt.map(function(Dt){return Dt()}))}},A.functionExpressionHandler=function(I){var fe=this,Ie=this,lt=this.source,Dt=this.collectDeclVars,Nt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Dr=I.id?I.id.name:"",Wr=I.params.length,ln=I.params.map(function(Pa){return fe.createParamNameGetter(Pa)}),Li=this.createClosure(I.body),Ei=this.collectDeclVars,ha=this.collectDeclFuncs;return this.collectDeclVars=Dt,this.collectDeclFuncs=Nt,function(){var Pa=Ie.getCurrentScope(),ya=function _i(){for(var mo=arguments.length,wo=new Array(mo),Js=0;Js<mo;Js++)wo[Js]=arguments[Js];Ie.callStack.push(""+Dr);var hu=Ie.getCurrentScope(),Qs=$s(Pa,"FunctionScope("+Dr+")");Ie.setCurrentScope(Qs),Ie.addDeclarationsToScope(Ei,ha,Qs),Dr&&(Qs.data[Dr]=_i),Qs.data.arguments=arguments,ln.forEach(function(ms,no){Qs.data[ms()]=wo[no]});var ku=Ie.getCurrentContext();Ie.setCurrentContext(this);var Yo=Li();if(Ie.setCurrentContext(ku),Ie.setCurrentScope(hu),Ie.callStack.pop(),Yo instanceof ts)return Yo.value};return ke(ya,Dr),Object.defineProperty(ya,"length",{value:Wr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(ya,"toString",{value:function(){return lt.slice(I.start,I.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(ya,"valueOf",{value:function(){return lt.slice(I.start,I.end)},writable:!0,configurable:!0,enumerable:!1}),ya}},A.newExpressionHandler=function(I){var fe=this,Ie=this.source,lt=this.createClosure(I.callee),Dt=I.arguments.map(function(Nt){return fe.createClosure(Nt)});return function(){var Nt=lt();if(!fu(Nt)||Nt.__IS_EVAL_FUNC){var Dr=I.callee,Wr=Ie.slice(Dr.start,Dr.end);throw fe.createInternalThrowError(Da.IsNotConstructor,Wr,I)}return Nt.__IS_FUNCTION_FUNC?Nt.apply(void 0,[new Mu(fe)].concat(Dt.map(function(ln){return ln()}))):ss(Nt,Dt.map(function(ln){return ln()}))}},A.memberExpressionHandler=function(I){var fe=this.createClosure(I.object),Ie=this.createMemberKeyGetter(I);return function(){var lt=fe(),Dt=Ie();return lt[Dt]}},A.thisExpressionHandler=function(I){var fe=this;return function(){return fe.getCurrentContext()}},A.sequenceExpressionHandler=function(I){var fe=this,Ie=I.expressions.map(function(lt){return fe.createClosure(lt)});return function(){for(var lt,Dt=Ie.length,Nt=0;Nt<Dt;Nt++){var Dr=Ie[Nt];lt=Dr()}return lt}},A.literalHandler=function(I){return function(){return I.regex?new RegExp(I.regex.pattern,I.regex.flags):I.value}},A.identifierHandler=function(I){var fe=this;return function(){var Ie=fe.getCurrentScope(),lt=fe.getScopeDataFromName(I.name,Ie);return fe.assertVariable(lt,I.name,I),lt[I.name]}},A.getIdentifierScope=function(I){var fe=this.getCurrentScope(),Ie=this.getScopeFromName(I.name,fe);return Ie},A.assignmentExpressionHandler=function(I){var fe=this;I.left.type==="Identifier"&&I.right.type==="FunctionExpression"&&!I.right.id&&(I.right.id={type:"Identifier",name:I.left.name});var Ie=this.createObjectGetter(I.left),lt=this.createNameGetter(I.left),Dt=this.createClosure(I.right);return function(){var Nt=Ie(),Dr=lt(),Wr=Dt();switch(I.operator!=="="&&fe.assertVariable(Nt,Dr,I),I.operator){case"=":return Nt[Dr]=Wr;case"+=":return Nt[Dr]+=Wr;case"-=":return Nt[Dr]-=Wr;case"*=":return Nt[Dr]*=Wr;case"**=":return Nt[Dr]=Math.pow(Nt[Dr],Wr);case"/=":return Nt[Dr]/=Wr;case"%=":return Nt[Dr]%=Wr;case"<<=":return Nt[Dr]<<=Wr;case">>=":return Nt[Dr]>>=Wr;case">>>=":return Nt[Dr]>>>=Wr;case"&=":return Nt[Dr]&=Wr;case"^=":return Nt[Dr]^=Wr;case"|=":return Nt[Dr]|=Wr;default:throw fe.createInternalThrowError(Da.AssignmentExpressionSyntaxError,I.type,I)}}},A.functionDeclarationHandler=function(I){if(I.id){var fe=this.functionExpressionHandler(I);Object.defineProperty(fe,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(I.id.name,fe)}return function(){return wi}},A.getVariableName=function(I){if(I.type==="Identifier")return I.name;throw this.createInternalThrowError(Da.VariableTypeSyntaxError,I.type,I)},A.variableDeclarationHandler=function(I){for(var fe=this,Ie,lt=[],Dt=0;Dt<I.declarations.length;Dt++){var Nt=I.declarations[Dt];this.varDeclaration(this.getVariableName(Nt.id)),Nt.init&&lt.push({type:"AssignmentExpression",operator:"=",left:Nt.id,right:Nt.init})}return lt.length&&(Ie=this.createClosure({type:"BlockStatement",body:lt})),function(){if(Ie){var Dr=fe.isVarDeclMode;fe.isVarDeclMode=!0,Ie(),fe.isVarDeclMode=Dr}return wi}},A.assertVariable=function(I,fe,Ie){if(I===this.globalScope.data&&!(fe in I))throw this.createInternalThrowError(Da.VariableUndefinedReferenceError,fe,Ie)},A.programHandler=function(I){var fe=this,Ie=I.body.map(function(lt){return fe.createClosure(lt)});return function(){for(var lt=wi,Dt=0;Dt<Ie.length;Dt++){var Nt=Ie[Dt],Dr=fe.setValue(Nt());if(Dr!==wi&&(lt=Dr,lt instanceof ts||lt instanceof ls||lt instanceof ws||lt===L||lt===Qr))break}return lt}},A.expressionStatementHandler=function(I){return this.createClosure(I.expression)},A.emptyStatementHandler=function(I){return function(){return wi}},A.returnStatementHandler=function(I){var fe=I.argument?this.createClosure(I.argument):Us;return function(){return new ts(fe())}},A.ifStatementHandler=function(I){var fe=this.createClosure(I.test),Ie=this.createClosure(I.consequent),lt=I.alternate?this.createClosure(I.alternate):function(){return wi};return function(){return fe()?Ie():lt()}},A.conditionalExpressionHandler=function(I){return this.ifStatementHandler(I)},A.forStatementHandler=function(I){var fe=this,Ie=Us,lt=I.test?this.createClosure(I.test):function(){return!0},Dt=Us,Nt=this.createClosure(I.body);return I.type==="ForStatement"&&(Ie=I.init?this.createClosure(I.init):Ie,Dt=I.update?this.createClosure(I.update):Us),function(Dr){var Wr,ln=wi,Li=I.type==="DoWhileStatement";for(Dr&&Dr.type==="LabeledStatement"&&(Wr=Dr.label.name),Ie();Li||lt();Dt()){Li=!1;var Ei=fe.setValue(Nt());if(!(Ei===wi||Ei===Qr)){if(Ei===L)break;if(ln=Ei,ln instanceof ws&&ln.value===Wr){ln=wi;continue}if(ln instanceof ts||ln instanceof ls||ln instanceof ws)break}}return ln}},A.whileStatementHandler=function(I){return this.forStatementHandler(I)},A.doWhileStatementHandler=function(I){return this.forStatementHandler(I)},A.forInStatementHandler=function(I){var fe=this,Ie=I.left,lt=this.createClosure(I.right),Dt=this.createClosure(I.body);return I.left.type==="VariableDeclaration"&&(this.createClosure(I.left)(),Ie=I.left.declarations[0].id),function(Nt){var Dr,Wr=wi,ln;Nt&&Nt.type==="LabeledStatement"&&(Dr=Nt.label.name);var Li=lt();for(ln in Li){fe.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:Ie,right:{type:"Literal",value:ln}})();var Ei=fe.setValue(Dt());if(!(Ei===wi||Ei===Qr)){if(Ei===L)break;if(Wr=Ei,Wr instanceof ws&&Wr.value===Dr){Wr=wi;continue}if(Wr instanceof ts||Wr instanceof ls||Wr instanceof ws)break}}return Wr}},A.withStatementHandler=function(I){var fe=this,Ie=this.createClosure(I.object),lt=this.createClosure(I.body);return function(){var Dt=Ie(),Nt=fe.getCurrentScope(),Dr=new cs(Dt,Nt,fo);fe.setCurrentScope(Dr);var Wr=fe.setValue(lt());return fe.setCurrentScope(Nt),Wr}},A.throwStatementHandler=function(I){var fe=this,Ie=this.createClosure(I.argument);return function(){throw fe.setValue(void 0),Ie()}},A.tryStatementHandler=function(I){var fe=this,Ie=this.createClosure(I.block),lt=I.handler?this.catchClauseHandler(I.handler):null,Dt=I.finalizer?this.createClosure(I.finalizer):null;return function(){var Nt=fe.getCurrentScope(),Dr=fe.getCurrentContext(),Wr=Nt.labelStack.concat([]),ln=fe.callStack.concat([]),Li=wi,Ei,ha,Pa=function(){fe.setCurrentScope(Nt),fe.setCurrentContext(Dr),Nt.labelStack=Wr,fe.callStack=ln};try{Li=fe.setValue(Ie()),Li instanceof ts&&(Ei=Li)}catch(ya){if(Pa(),fe.isInterruptThrow(ya))throw ya;if(lt)try{Li=fe.setValue(lt(ya)),Li instanceof ts&&(Ei=Li)}catch(_i){if(Pa(),fe.isInterruptThrow(_i))throw _i;ha=_i}}if(Dt)try{Li=Dt(),Li instanceof ts&&(Ei=Li)}catch(ya){if(Pa(),fe.isInterruptThrow(ya))throw ya;ha=ya}if(ha)throw ha;return Ei||Li}},A.catchClauseHandler=function(I){var fe=this,Ie=this.createParamNameGetter(I.param),lt=this.createClosure(I.body);return function(Dt){var Nt,Dr=fe.getCurrentScope(),Wr=Dr.data,ln=Ie(),Li=ft.call(Wr,ln),Ei=Wr[ln];return Wr[ln]=Dt,Nt=lt(),Li?Wr[ln]=Ei:delete Wr[ln],Nt}},A.continueStatementHandler=function(I){return function(){return I.label?new ws(I.label.name):Qr}},A.breakStatementHandler=function(I){return function(){return I.label?new ls(I.label.name):L}},A.switchStatementHandler=function(I){var fe=this,Ie=this.createClosure(I.discriminant),lt=I.cases.map(function(Dt){return fe.switchCaseHandler(Dt)});return function(){for(var Dt=Ie(),Nt=!1,Dr,Wr,ln,Li=0;Li<lt.length;Li++){var Ei=lt[Li](),ha=Ei.testClosure();if(ha===ai){ln=Ei;continue}if(Nt||ha===Dt){if(Nt=!0,Wr=fe.setValue(Ei.bodyClosure()),Wr===wi)continue;if(Wr===L||(Dr=Wr,Dr instanceof ts||Dr instanceof ls||Dr instanceof ws||Dr===Qr))break}}if(!Nt&&ln){Wr=fe.setValue(ln.bodyClosure());var Pa=Wr===wi||Wr===L||Wr===Qr;Pa||(Dr=Wr)}return Dr}},A.switchCaseHandler=function(I){var fe=I.test?this.createClosure(I.test):function(){return ai},Ie=this.createClosure({type:"BlockStatement",body:I.consequent});return function(){return{testClosure:fe,bodyClosure:Ie}}},A.labeledStatementHandler=function(I){var fe=this,Ie=I.label.name,lt=this.createClosure(I.body);return function(){var Dt,Nt=fe.getCurrentScope();return Nt.labelStack.push(Ie),Dt=lt(I),Dt instanceof ls&&Dt.value===Ie&&(Dt=wi),Nt.labelStack.pop(),Dt}},A.debuggerStatementHandler=function(I){return function(){debugger;return wi}},A.createParamNameGetter=function(I){if(I.type==="Identifier")return function(){return I.name};throw this.createInternalThrowError(Da.ParamTypeSyntaxError,I.type,I)},A.createObjectKeyGetter=function(I){var fe;return I.type==="Identifier"?fe=function(){return I.name}:fe=this.createClosure(I),function(){return fe()}},A.createMemberKeyGetter=function(I){return I.computed?this.createClosure(I.property):this.createObjectKeyGetter(I.property)},A.createObjectGetter=function(I){var fe=this;switch(I.type){case"Identifier":return function(){return fe.getScopeDataFromName(I.name,fe.getCurrentScope())};case"MemberExpression":return this.createClosure(I.object);default:throw this.createInternalThrowError(Da.AssignmentTypeSyntaxError,I.type,I)}},A.createNameGetter=function(I){switch(I.type){case"Identifier":return function(){return I.name};case"MemberExpression":return this.createMemberKeyGetter(I);default:throw this.createInternalThrowError(Da.AssignmentTypeSyntaxError,I.type,I)}},A.varDeclaration=function(I){var fe=this.collectDeclVars;fe[I]=void 0},A.funcDeclaration=function(I,fe){var Ie=this.collectDeclFuncs;Ie[I]=fe},A.addDeclarationsToScope=function(I,fe,Ie){var lt=Ie.data;for(var Dt in fe){var Nt=fe[Dt];lt[Dt]=Nt&&Nt()}for(var Dr in I)Dr in lt||(lt[Dr]=void 0)},A.getScopeValue=function(I,fe){var Ie=this.getScopeFromName(I,fe);return Ie.data[I]},A.getScopeDataFromName=function(I,fe){return this.getScopeFromName(I,fe).data},A.getScopeFromName=function(I,fe){var Ie=fe;do if(I in Ie.data)return Ie;while(Ie=Ie.parent);return this.globalScope},A.setValue=function(I){var fe=this.callStack.length;return this.isVarDeclMode||fe||I===wi||I===L||I===Qr||I instanceof ls||I instanceof ws||(this.value=I instanceof ts?I.value:I),I},A.getValue=function(){return this.value},m}();Co.version=Se,Co.eval=Yu,Co.Function=es,Co.ecmaVersion=5,Co.globalContextInFunction=void 0,Co.global=Object.create(null);function dl(m){return m===void 0&&(m=Object.create(null)),m}function vl(m,A,z){A===void 0&&(A=[]),z===void 0&&(z={});var I=z.parsingContext,fe=z.timeout===void 0?0:z.timeout,Ie=`
    (function anonymous(`+A.join(",")+`){
         `+m+`
    });
    `,lt=new Co(I,{ecmaVersion:z.ecmaVersion,timeout:fe,rootContext:z.rootContext,globalContextInFunction:z.globalContextInFunction});return lt.evaluate(Ie)}function Ku(m,A,z){var I=new Co(A,z);return I.evaluate(m)}var Xl=Ku,ml=function(){function m(z){this._code=z}var A=m.prototype;return A.runInContext=function(I){return Ku(this._code,I)},A.runInNewContext=function(I){return Ku(this._code,I)},m}(),Du=function(m,A,z){return Ku(m,A,z)};function Zs(){for(var m=arguments.length,A=new Array(m),z=0;z<m;z++)A[z]=arguments[z];var I=A.pop();return vl(I||"",A)}var gl=Du},88307:function(zr,N,S){(function(ce,E){zr.exports=E(S(18857))})(this,function(ce){"use strict";var E=function(U){return U instanceof Uint8Array||U instanceof Uint16Array||U instanceof Uint32Array||U instanceof Int8Array||U instanceof Int16Array||U instanceof Int32Array||U instanceof Float32Array||U instanceof Float64Array||U instanceof Uint8ClampedArray},d=function(U,Me){for(var Je=Object.keys(Me),ir=0;ir<Je.length;++ir)U[Je[ir]]=Me[Je[ir]];return U},me=`
`;function te(U){return typeof atob!="undefined"?atob(U):"base64:"+U}function ue(U){var Me=new Error("(regl) "+U);throw console.error(Me),Me}function oe(U,Me){U||ue(Me)}function Ne(U){return U?": "+U:""}function K(U,Me,Je){U in Me||ue("unknown parameter ("+U+")"+Ne(Je)+". possible values: "+Object.keys(Me).join())}function Qe(U,Me){E(U)||ue("invalid parameter type"+Ne(Me)+". must be a typed array")}function mt(U,Me){switch(Me){case"number":return typeof U=="number";case"object":return typeof U=="object";case"string":return typeof U=="string";case"boolean":return typeof U=="boolean";case"function":return typeof U=="function";case"undefined":return typeof U=="undefined";case"symbol":return typeof U=="symbol"}}function Zt(U,Me,Je){mt(U,Me)||ue("invalid parameter type"+Ne(Je)+". expected "+Me+", got "+typeof U)}function Cr(U,Me){U>=0&&(U|0)===U||ue("invalid parameter type, ("+U+")"+Ne(Me)+". must be a nonnegative integer")}function Qt(U,Me,Je){Me.indexOf(U)<0&&ue("invalid value"+Ne(Je)+". must be one of: "+Me)}var Xt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function rr(U){Object.keys(U).forEach(function(Me){Xt.indexOf(Me)<0&&ue('invalid regl constructor argument "'+Me+'". must be one of '+Xt)})}function Ut(U,Me){for(U=U+"";U.length<Me;)U=" "+U;return U}function St(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Et(U,Me){this.number=U,this.line=Me,this.errors=[]}function yr(U,Me,Je){this.file=U,this.line=Me,this.message=Je}function q(){var U=new Error,Me=(U.stack||U).toString(),Je=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Me);if(Je)return Je[1];var ir=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Me);return ir?ir[1]:"unknown"}function hr(){var U=new Error,Me=(U.stack||U).toString(),Je=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Me);if(Je)return Je[1];var ir=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Me);return ir?ir[1]:"unknown"}function wt(U,Me){var Je=U.split(`
`),ir=1,Fr=0,er={unknown:new St,0:new St};er.unknown.name=er[0].name=Me||q(),er.unknown.lines.push(new Et(0,""));for(var Pr=0;Pr<Je.length;++Pr){var Zr=Je[Pr],Kr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Zr);if(Kr)switch(Kr[1]){case"line":var qr=/(\d+)(\s+\d+)?/.exec(Kr[2]);qr&&(ir=qr[1]|0,qr[2]&&(Fr=qr[2]|0,Fr in er||(er[Fr]=new St)));break;case"define":var en=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Kr[2]);en&&(er[Fr].name=en[1]?te(en[2]):en[2]);break}er[Fr].lines.push(new Et(ir++,Zr))}return Object.keys(er).forEach(function(an){var bn=er[an];bn.lines.forEach(function($r){bn.index[$r.number]=$r})}),er}function $e(U){var Me=[];return U.split(`
`).forEach(function(Je){if(!(Je.length<5)){var ir=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Je);ir?Me.push(new yr(ir[1]|0,ir[2]|0,ir[3].trim())):Je.length>0&&Me.push(new yr("unknown",0,Je))}}),Me}function Ft(U,Me){Me.forEach(function(Je){var ir=U[Je.file];if(ir){var Fr=ir.index[Je.line];if(Fr){Fr.errors.push(Je),ir.hasErrors=!0;return}}U.unknown.hasErrors=!0,U.unknown.lines[0].errors.push(Je)})}function Xe(U,Me,Je,ir,Fr){if(!U.getShaderParameter(Me,U.COMPILE_STATUS)){var er=U.getShaderInfoLog(Me),Pr=ir===U.FRAGMENT_SHADER?"fragment":"vertex";ye(Je,"string",Pr+" shader source must be a string",Fr);var Zr=wt(Je,Fr),Kr=$e(er);Ft(Zr,Kr),Object.keys(Zr).forEach(function(qr){var en=Zr[qr];if(!en.hasErrors)return;var an=[""],bn=[""];function $r(nn,Ot){an.push(nn),bn.push(Ot||"")}$r("file number "+qr+": "+en.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),en.lines.forEach(function(nn){if(nn.errors.length>0){$r(Ut(nn.number,4)+"|  ","background-color:yellow; font-weight:bold"),$r(nn.line+me,"color:red; background-color:yellow; font-weight:bold");var Ot=0;nn.errors.forEach(function(vr){var Jr=vr.message,Tn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Jr);if(Tn){var Lr=Tn[1];switch(Jr=Tn[2],Lr){case"assign":Lr="=";break}Ot=Math.max(nn.line.indexOf(Lr,Ot),0)}else Ot=0;$r(Ut("| ",6)),$r(Ut("^^^",Ot+3)+me,"font-weight:bold"),$r(Ut("| ",6)),$r(Jr+me,"font-weight:bold")}),$r(Ut("| ",6)+me)}else $r(Ut(nn.number,4)+"|  "),$r(nn.line+me,"color:red")}),typeof document!="undefined"&&!window.chrome?(bn[0]=an.join("%c"),console.log.apply(console,bn)):console.log(an.join(""))}),oe.raise("Error compiling "+Pr+" shader, "+Zr[0].name)}}function jt(U,Me,Je,ir,Fr){if(!U.getProgramParameter(Me,U.LINK_STATUS)){var er=U.getProgramInfoLog(Me),Pr=wt(Je,Fr),Zr=wt(ir,Fr),Kr='Error linking program with vertex shader, "'+Zr[0].name+'", and fragment shader "'+Pr[0].name+'"';typeof document!="undefined"?console.log("%c"+Kr+me+"%c"+er,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Kr+me+er),oe.raise(Kr)}}function br(U){U._commandRef=q()}function sr(U,Me,Je,ir){br(U);function Fr(Kr){return Kr?ir.id(Kr):0}U._fragId=Fr(U.static.frag),U._vertId=Fr(U.static.vert);function er(Kr,qr){Object.keys(qr).forEach(function(en){Kr[ir.id(en)]=!0})}var Pr=U._uniformSet={};er(Pr,Me.static),er(Pr,Me.dynamic);var Zr=U._attributeSet={};er(Zr,Je.static),er(Zr,Je.dynamic),U._hasCount="count"in U.static||"count"in U.dynamic||"elements"in U.static||"elements"in U.dynamic}function j(U,Me){var Je=hr();ue(U+" in command "+(Me||q())+(Je==="unknown"?"":" called from "+Je))}function ie(U,Me,Je){U||j(Me,Je||q())}function Re(U,Me,Je,ir){U in Me||j("unknown parameter ("+U+")"+Ne(Je)+". possible values: "+Object.keys(Me).join(),ir||q())}function ye(U,Me,Je,ir){mt(U,Me)||j("invalid parameter type"+Ne(Je)+". expected "+Me+", got "+typeof U,ir||q())}function _t(U){U()}function dt(U,Me,Je){U.texture?Qt(U.texture._texture.internalformat,Me,"unsupported texture format for attachment"):Qt(U.renderbuffer._renderbuffer.format,Je,"unsupported renderbuffer format for attachment")}var zt=33071,Bt=9728,Ur=9984,vn=9985,En=9986,ea=9987,ar=5120,ge=5121,Te=5122,Ze=5123,Oe=5124,Lt=5125,nr=5126,dr=32819,Or=32820,lr=33635,un=34042,w=36193,H={};H[ar]=H[ge]=1,H[Te]=H[Ze]=H[w]=H[lr]=H[dr]=H[Or]=2,H[Oe]=H[Lt]=H[nr]=H[un]=4;function Ue(U,Me){return U===Or||U===dr||U===lr?2:U===un?4:H[U]*Me}function et(U){return!(U&U-1)&&!!U}function st(U,Me,Je){var ir,Fr=Me.width,er=Me.height,Pr=Me.channels;oe(Fr>0&&Fr<=Je.maxTextureSize&&er>0&&er<=Je.maxTextureSize,"invalid texture shape"),(U.wrapS!==zt||U.wrapT!==zt)&&oe(et(Fr)&&et(er),"incompatible wrap mode for texture, both width and height must be power of 2"),Me.mipmask===1?Fr!==1&&er!==1&&oe(U.minFilter!==Ur&&U.minFilter!==En&&U.minFilter!==vn&&U.minFilter!==ea,"min filter requires mipmap"):(oe(et(Fr)&&et(er),"texture must be a square power of 2 to support mipmapping"),oe(Me.mipmask===(Fr<<1)-1,"missing or incomplete mipmap data")),Me.type===nr&&(Je.extensions.indexOf("oes_texture_float_linear")<0&&oe(U.minFilter===Bt&&U.magFilter===Bt,"filter not supported, must enable oes_texture_float_linear"),oe(!U.genMipmaps,"mipmap generation not supported with float textures"));var Zr=Me.images;for(ir=0;ir<16;++ir)if(Zr[ir]){var Kr=Fr>>ir,qr=er>>ir;oe(Me.mipmask&1<<ir,"missing mipmap data");var en=Zr[ir];if(oe(en.width===Kr&&en.height===qr,"invalid shape for mip images"),oe(en.format===Me.format&&en.internalformat===Me.internalformat&&en.type===Me.type,"incompatible type for mip image"),!en.compressed)if(en.data){var an=Math.ceil(Ue(en.type,Pr)*Kr/en.unpackAlignment)*en.unpackAlignment;oe(en.data.byteLength===an*qr,"invalid data for image, buffer size is inconsistent with image format")}else en.element||en.copy}else U.genMipmaps||oe((Me.mipmask&1<<ir)==0,"extra mipmap data");Me.compressed&&oe(!U.genMipmaps,"mipmap generation for compressed images not supported")}function Ct(U,Me,Je,ir){var Fr=U.width,er=U.height,Pr=U.channels;oe(Fr>0&&Fr<=ir.maxTextureSize&&er>0&&er<=ir.maxTextureSize,"invalid texture shape"),oe(Fr===er,"cube map must be square"),oe(Me.wrapS===zt&&Me.wrapT===zt,"wrap mode not supported by cube map");for(var Zr=0;Zr<Je.length;++Zr){var Kr=Je[Zr];oe(Kr.width===Fr&&Kr.height===er,"inconsistent cube map face shape"),Me.genMipmaps&&(oe(!Kr.compressed,"can not generate mipmap for compressed textures"),oe(Kr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var qr=Kr.images,en=0;en<16;++en){var an=qr[en];if(an){var bn=Fr>>en,$r=er>>en;oe(Kr.mipmask&1<<en,"missing mipmap data"),oe(an.width===bn&&an.height===$r,"invalid shape for mip images"),oe(an.format===U.format&&an.internalformat===U.internalformat&&an.type===U.type,"incompatible type for mip image"),an.compressed||(an.data?oe(an.data.byteLength===bn*$r*Math.max(Ue(an.type,Pr),an.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):an.element||an.copy)}}}}var $=d(oe,{optional:_t,raise:ue,commandRaise:j,command:ie,parameter:K,commandParameter:Re,constructor:rr,type:Zt,commandType:ye,isTypedArray:Qe,nni:Cr,oneOf:Qt,shaderError:Xe,linkError:jt,callSite:hr,saveCommandRef:br,saveDrawInfo:sr,framebufferFormat:dt,guessCommand:q,texture2D:st,textureCube:Ct}),Gt=0,Tr=0,Ir=5,Ye=6;function ut(U,Me){this.id=Gt++,this.type=U,this.data=Me}function At(U){return U.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Rt(U){if(U.length===0)return[];var Me=U.charAt(0),Je=U.charAt(U.length-1);if(U.length>1&&Me===Je&&(Me==='"'||Me==="'"))return['"'+At(U.substr(1,U.length-2))+'"'];var ir=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(U);if(ir)return Rt(U.substr(0,ir.index)).concat(Rt(ir[1])).concat(Rt(U.substr(ir.index+ir[0].length)));var Fr=U.split(".");if(Fr.length===1)return['"'+At(U)+'"'];for(var er=[],Pr=0;Pr<Fr.length;++Pr)er=er.concat(Rt(Fr[Pr]));return er}function xr(U){return"["+Rt(U).join("][")+"]"}function Ar(U,Me){return new ut(U,xr(Me+""))}function Ke(U){return typeof U=="function"&&!U._reglType||U instanceof ut}function Xr(U,Me){if(typeof U=="function")return new ut(Tr,U);if(typeof U=="number"||typeof U=="boolean")return new ut(Ir,U);if(Array.isArray(U))return new ut(Ye,U.map(function(Je,ir){return Xr(Je,Me+"["+ir+"]")}));if(U instanceof ut)return U;$(!1,"invalid option type in uniform "+Me)}var Yr={DynamicVariable:ut,define:Ar,isDynamic:Ke,unbox:Xr,accessor:xr},wn={next:typeof requestAnimationFrame=="function"?function(U){return requestAnimationFrame(U)}:function(U){return setTimeout(U,16)},cancel:typeof cancelAnimationFrame=="function"?function(U){return cancelAnimationFrame(U)}:clearTimeout},cr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Mr=cr?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function gt(){var U={"":0},Me=[""];return{id:function(Je){var ir=U[Je];return ir||(ir=U[Je]=Me.length,Me.push(Je),ir)},str:function(Je){return Me[Je]}}}function Gn(U,Me,Je){var ir=document.createElement("canvas");d(ir.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),U.appendChild(ir),U===document.body&&(ir.style.position="absolute",d(U.style,{margin:0,padding:0}));function Fr(){var Zr=window.innerWidth,Kr=window.innerHeight;if(U!==document.body){var qr=ir.getBoundingClientRect();Zr=qr.right-qr.left,Kr=qr.bottom-qr.top}ir.width=Je*Zr,ir.height=Je*Kr}var er;U!==document.body&&typeof ResizeObserver=="function"?(er=new ResizeObserver(function(){setTimeout(Fr)}),er.observe(U)):window.addEventListener("resize",Fr,!1);function Pr(){er?er.disconnect():window.removeEventListener("resize",Fr),U.removeChild(ir)}return Fr(),{canvas:ir,onDestroy:Pr}}function Mn(U,Me){function Je(ir){try{return U.getContext(ir,Me)}catch(Fr){return null}}return Je("webgl")||Je("experimental-webgl")||Je("webgl-experimental")}function kr(U){return typeof U.nodeName=="string"&&typeof U.appendChild=="function"&&typeof U.getBoundingClientRect=="function"}function Y(U){return typeof U.drawArrays=="function"||typeof U.drawElements=="function"}function le(U){return typeof U=="string"?U.split():($(Array.isArray(U),"invalid extension array"),U)}function ve(U){return typeof U=="string"?($(typeof document!="undefined","not supported outside of DOM"),document.querySelector(U)):U}function B(U){var Me=U||{},Je,ir,Fr,er,Pr={},Zr=[],Kr=[],qr=typeof window=="undefined"?1:window.devicePixelRatio,en=!1,an=function(nn){nn&&$.raise(nn)},bn=function(){};if(typeof Me=="string"?($(typeof document!="undefined","selector queries only supported in DOM environments"),Je=document.querySelector(Me),$(Je,"invalid query string for element")):typeof Me=="object"?kr(Me)?Je=Me:Y(Me)?(er=Me,Fr=er.canvas):($.constructor(Me),"gl"in Me?er=Me.gl:"canvas"in Me?Fr=ve(Me.canvas):"container"in Me&&(ir=ve(Me.container)),"attributes"in Me&&(Pr=Me.attributes,$.type(Pr,"object","invalid context attributes")),"extensions"in Me&&(Zr=le(Me.extensions)),"optionalExtensions"in Me&&(Kr=le(Me.optionalExtensions)),"onDone"in Me&&($.type(Me.onDone,"function","invalid or missing onDone callback"),an=Me.onDone),"profile"in Me&&(en=!!Me.profile),"pixelRatio"in Me&&(qr=+Me.pixelRatio,$(qr>0,"invalid pixel ratio"))):$.raise("invalid arguments to regl"),Je&&(Je.nodeName.toLowerCase()==="canvas"?Fr=Je:ir=Je),!er){if(!Fr){$(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var $r=Gn(ir||document.body,an,qr);if(!$r)return null;Fr=$r.canvas,bn=$r.onDestroy}Pr.premultipliedAlpha===void 0&&(Pr.premultipliedAlpha=!0),er=Mn(Fr,Pr)}return er?{gl:er,canvas:Fr,container:ir,extensions:Zr,optionalExtensions:Kr,pixelRatio:qr,profile:en,onDone:an,onDestroy:bn}:(bn(),an("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function ee(U,Me){var Je={};function ir(Zr){$.type(Zr,"string","extension name must be string");var Kr=Zr.toLowerCase(),qr;try{qr=Je[Kr]=Fr(Zr)}catch(en){}return!!qr}function Fr(Zr){return U.getExtension(Zr)?U.getExtension(Zr):U.getExtension(Zr.toLowerCase())?U.getExtension(Zr.toLowerCase()):null}for(var er=0;er<Me.extensions.length;++er){var Pr=Me.extensions[er];if(!ir(Pr))return Me.onDestroy(),Me.onDone('"'+Pr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Me.optionalExtensions.forEach(ir),{extensions:Je,restore:function(){Object.keys(Je).forEach(function(Zr){if(Je[Zr]&&!ir(Zr))throw new Error("(regl): error restoring extension "+Zr)})}}}function de(U,Me){for(var Je=Array(U),ir=0;ir<U;++ir)Je[ir]=Me(ir);return Je}var Ae=5120,ae=5121,_e=5122,ct=5123,Sr=5124,Ht=5125,Jt=5126;function Nr(U){for(var Me=16;Me<=1<<28;Me*=16)if(U<=Me)return Me;return 0}function zn(U){var Me,Je;return Me=(U>65535)<<4,U>>>=Me,Je=(U>255)<<3,U>>>=Je,Me|=Je,Je=(U>15)<<2,U>>>=Je,Me|=Je,Je=(U>3)<<1,U>>>=Je,Me|=Je,Me|U>>1}function Nn(){var U=de(8,function(){return[]});function Me(er){var Pr=Nr(er),Zr=U[zn(Pr)>>2];return Zr.length>0?Zr.pop():new ArrayBuffer(Pr)}function Je(er){U[zn(er.byteLength)>>2].push(er)}function ir(er,Pr){var Zr=null;switch(er){case Ae:Zr=new Int8Array(Me(Pr),0,Pr);break;case ae:Zr=new Uint8Array(Me(Pr),0,Pr);break;case _e:Zr=new Int16Array(Me(2*Pr),0,Pr);break;case ct:Zr=new Uint16Array(Me(2*Pr),0,Pr);break;case Sr:Zr=new Int32Array(Me(4*Pr),0,Pr);break;case Ht:Zr=new Uint32Array(Me(4*Pr),0,Pr);break;case Jt:Zr=new Float32Array(Me(4*Pr),0,Pr);break;default:return null}return Zr.length!==Pr?Zr.subarray(0,Pr):Zr}function Fr(er){Je(er.buffer)}return{alloc:Me,free:Je,allocType:ir,freeType:Fr}}var Kt=Nn();Kt.zero=Nn();var In=3408,hn=3410,mn=3411,Bi=3412,An=3413,Di=3414,ra=3415,hi=33901,na=33902,Hi=3379,Oi=3386,ga=34921,Ra=36347,Wi=36348,Ni=35661,Xi=35660,ro=34930,Qo=36349,za=34076,$i=34024,cu=7936,Pu=7937,Yi=7938,xo=35724,Ki=34047,Xa=36063,qo=34852,xa=3553,Do=34067,ko=34069,Rs=33984,vo=6408,Xo=5126,Da=5121,co=36160,ss=36053,Fo=36064,Se=16384,ke=function(U,Me){var Je=1;Me.ext_texture_filter_anisotropic&&(Je=U.getParameter(Ki));var ir=1,Fr=1;Me.webgl_draw_buffers&&(ir=U.getParameter(qo),Fr=U.getParameter(Xa));var er=!!Me.oes_texture_float;if(er){var Pr=U.createTexture();U.bindTexture(xa,Pr),U.texImage2D(xa,0,vo,1,1,0,vo,Xo,null);var Zr=U.createFramebuffer();if(U.bindFramebuffer(co,Zr),U.framebufferTexture2D(co,Fo,xa,Pr,0),U.bindTexture(xa,null),U.checkFramebufferStatus(co)!==ss)er=!1;else{U.viewport(0,0,1,1),U.clearColor(1,0,0,1),U.clear(Se);var Kr=Kt.allocType(Xo,4);U.readPixels(0,0,1,1,vo,Xo,Kr),U.getError()?er=!1:(U.deleteFramebuffer(Zr),U.deleteTexture(Pr),er=Kr[0]===1),Kt.freeType(Kr)}}var qr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),en=!0;if(!qr){var an=U.createTexture(),bn=Kt.allocType(Da,36);U.activeTexture(Rs),U.bindTexture(Do,an),U.texImage2D(ko,0,vo,3,3,0,vo,Da,bn),Kt.freeType(bn),U.bindTexture(Do,null),U.deleteTexture(an),en=!U.getError()}return{colorBits:[U.getParameter(hn),U.getParameter(mn),U.getParameter(Bi),U.getParameter(An)],depthBits:U.getParameter(Di),stencilBits:U.getParameter(ra),subpixelBits:U.getParameter(In),extensions:Object.keys(Me).filter(function($r){return!!Me[$r]}),maxAnisotropic:Je,maxDrawbuffers:ir,maxColorAttachments:Fr,pointSizeDims:U.getParameter(hi),lineWidthDims:U.getParameter(na),maxViewportDims:U.getParameter(Oi),maxCombinedTextureUnits:U.getParameter(Ni),maxCubeMapSize:U.getParameter(za),maxRenderbufferSize:U.getParameter($i),maxTextureUnits:U.getParameter(ro),maxTextureSize:U.getParameter(Hi),maxAttributes:U.getParameter(ga),maxVertexUniforms:U.getParameter(Ra),maxVertexTextureUnits:U.getParameter(Xi),maxVaryingVectors:U.getParameter(Wi),maxFragmentUniforms:U.getParameter(Qo),glsl:U.getParameter(xo),renderer:U.getParameter(Pu),vendor:U.getParameter(cu),version:U.getParameter(Yi),readFloat:er,npotTextureCube:en}};function ft(U){return!!U&&typeof U=="object"&&Array.isArray(U.shape)&&Array.isArray(U.stride)&&typeof U.offset=="number"&&U.shape.length===U.stride.length&&(Array.isArray(U.data)||E(U.data))}var L=function(U){return Object.keys(U).map(function(Me){return U[Me]})},Qr={shape:us,flatten:ja};function ai(U,Me,Je){for(var ir=0;ir<Me;++ir)Je[ir]=U[ir]}function wi(U,Me,Je,ir){for(var Fr=0,er=0;er<Me;++er)for(var Pr=U[er],Zr=0;Zr<Je;++Zr)ir[Fr++]=Pr[Zr]}function fo(U,Me,Je,ir,Fr,er){for(var Pr=er,Zr=0;Zr<Me;++Zr)for(var Kr=U[Zr],qr=0;qr<Je;++qr)for(var en=Kr[qr],an=0;an<ir;++an)Fr[Pr++]=en[an]}function Ya(U,Me,Je,ir,Fr){for(var er=1,Pr=Je+1;Pr<Me.length;++Pr)er*=Me[Pr];var Zr=Me[Je];if(Me.length-Je==4){var Kr=Me[Je+1],qr=Me[Je+2],en=Me[Je+3];for(Pr=0;Pr<Zr;++Pr)fo(U[Pr],Kr,qr,en,ir,Fr),Fr+=er}else for(Pr=0;Pr<Zr;++Pr)Ya(U[Pr],Me,Je+1,ir,Fr),Fr+=er}function ja(U,Me,Je,ir){var Fr=1;if(Me.length)for(var er=0;er<Me.length;++er)Fr*=Me[er];else Fr=0;var Pr=ir||Kt.allocType(Je,Fr);switch(Me.length){case 0:break;case 1:ai(U,Me[0],Pr);break;case 2:wi(U,Me[0],Me[1],Pr);break;case 3:fo(U,Me[0],Me[1],Me[2],Pr,0);break;default:Ya(U,Me,0,Pr,0)}return Pr}function us(U){for(var Me=[],Je=U;Je.length;Je=Je[0])Me.push(Je.length);return Me}var fu={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Mu=5120,Yu=5122,es=5124,ts=5121,ls=5123,ws=5125,cs=5126,Us=5126,$s={int8:Mu,int16:Yu,int32:es,uint8:ts,uint16:ls,uint32:ws,float:cs,float32:Us},As=35048,Ea=35040,Co={dynamic:As,stream:Ea,static:35044},dl=Qr.flatten,vl=Qr.shape,Ku=35044,Xl=35040,ml=5121,Du=5126,Zs=[];Zs[5120]=1,Zs[5122]=2,Zs[5124]=4,Zs[5121]=1,Zs[5123]=2,Zs[5125]=4,Zs[5126]=4;function gl(U){return fu[Object.prototype.toString.call(U)]|0}function m(U,Me){for(var Je=0;Je<Me.length;++Je)U[Je]=Me[Je]}function A(U,Me,Je,ir,Fr,er,Pr){for(var Zr=0,Kr=0;Kr<Je;++Kr)for(var qr=0;qr<ir;++qr)U[Zr++]=Me[Fr*Kr+er*qr+Pr]}function z(U,Me,Je,ir){var Fr=0,er={};function Pr(Ot){this.id=Fr++,this.buffer=U.createBuffer(),this.type=Ot,this.usage=Ku,this.byteLength=0,this.dimension=1,this.dtype=ml,this.persistentData=null,Je.profile&&(this.stats={size:0})}Pr.prototype.bind=function(){U.bindBuffer(this.type,this.buffer)},Pr.prototype.destroy=function(){bn(this)};var Zr=[];function Kr(Ot,vr){var Jr=Zr.pop();return Jr||(Jr=new Pr(Ot)),Jr.bind(),an(Jr,vr,Xl,0,1,!1),Jr}function qr(Ot){Zr.push(Ot)}function en(Ot,vr,Jr){Ot.byteLength=vr.byteLength,U.bufferData(Ot.type,vr,Jr)}function an(Ot,vr,Jr,Tn,Lr,Pn){var on;if(Ot.usage=Jr,Array.isArray(vr)){if(Ot.dtype=Tn||Du,vr.length>0){var ci;if(Array.isArray(vr[0])){on=vl(vr);for(var Rr=1,wr=1;wr<on.length;++wr)Rr*=on[wr];Ot.dimension=Rr,ci=dl(vr,on,Ot.dtype),en(Ot,ci,Jr),Pn?Ot.persistentData=ci:Kt.freeType(ci)}else if(typeof vr[0]=="number"){Ot.dimension=Lr;var Qn=Kt.allocType(Ot.dtype,vr.length);m(Qn,vr),en(Ot,Qn,Jr),Pn?Ot.persistentData=Qn:Kt.freeType(Qn)}else E(vr[0])?(Ot.dimension=vr[0].length,Ot.dtype=Tn||gl(vr[0])||Du,ci=dl(vr,[vr.length,vr[0].length],Ot.dtype),en(Ot,ci,Jr),Pn?Ot.persistentData=ci:Kt.freeType(ci)):$.raise("invalid buffer data")}}else if(E(vr))Ot.dtype=Tn||gl(vr),Ot.dimension=Lr,en(Ot,vr,Jr),Pn&&(Ot.persistentData=new Uint8Array(new Uint8Array(vr.buffer)));else if(ft(vr)){on=vr.shape;var Sn=vr.stride,rn=vr.offset,On=0,Ln=0,Vi=0,ki=0;on.length===1?(On=on[0],Ln=1,Vi=Sn[0],ki=0):on.length===2?(On=on[0],Ln=on[1],Vi=Sn[0],ki=Sn[1]):$.raise("invalid shape"),Ot.dtype=Tn||gl(vr.data)||Du,Ot.dimension=Ln;var kn=Kt.allocType(Ot.dtype,On*Ln);A(kn,vr.data,On,Ln,Vi,ki,rn),en(Ot,kn,Jr),Pn?Ot.persistentData=kn:Kt.freeType(kn)}else vr instanceof ArrayBuffer?(Ot.dtype=ml,Ot.dimension=Lr,en(Ot,vr,Jr),Pn&&(Ot.persistentData=new Uint8Array(new Uint8Array(vr)))):$.raise("invalid buffer data")}function bn(Ot){Me.bufferCount--,ir(Ot);var vr=Ot.buffer;$(vr,"buffer must not be deleted already"),U.deleteBuffer(vr),Ot.buffer=null,delete er[Ot.id]}function $r(Ot,vr,Jr,Tn){Me.bufferCount++;var Lr=new Pr(vr);er[Lr.id]=Lr;function Pn(Rr){var wr=Ku,Qn=null,Sn=0,rn=0,On=1;return Array.isArray(Rr)||E(Rr)||ft(Rr)||Rr instanceof ArrayBuffer?Qn=Rr:typeof Rr=="number"?Sn=Rr|0:Rr&&($.type(Rr,"object","buffer arguments must be an object, a number or an array"),"data"in Rr&&($(Qn===null||Array.isArray(Qn)||E(Qn)||ft(Qn),"invalid data for buffer"),Qn=Rr.data),"usage"in Rr&&($.parameter(Rr.usage,Co,"invalid buffer usage"),wr=Co[Rr.usage]),"type"in Rr&&($.parameter(Rr.type,$s,"invalid buffer type"),rn=$s[Rr.type]),"dimension"in Rr&&($.type(Rr.dimension,"number","invalid dimension"),On=Rr.dimension|0),"length"in Rr&&($.nni(Sn,"buffer length must be a nonnegative integer"),Sn=Rr.length|0)),Lr.bind(),Qn?an(Lr,Qn,wr,rn,On,Tn):(Sn&&U.bufferData(Lr.type,Sn,wr),Lr.dtype=rn||ml,Lr.usage=wr,Lr.dimension=On,Lr.byteLength=Sn),Je.profile&&(Lr.stats.size=Lr.byteLength*Zs[Lr.dtype]),Pn}function on(Rr,wr){$(wr+Rr.byteLength<=Lr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Rr.byteLength+" starting from offset "+wr+" to a buffer of size "+Lr.byteLength),U.bufferSubData(Lr.type,wr,Rr)}function ci(Rr,wr){var Qn=(wr||0)|0,Sn;if(Lr.bind(),E(Rr)||Rr instanceof ArrayBuffer)on(Rr,Qn);else if(Array.isArray(Rr)){if(Rr.length>0)if(typeof Rr[0]=="number"){var rn=Kt.allocType(Lr.dtype,Rr.length);m(rn,Rr),on(rn,Qn),Kt.freeType(rn)}else if(Array.isArray(Rr[0])||E(Rr[0])){Sn=vl(Rr);var On=dl(Rr,Sn,Lr.dtype);on(On,Qn),Kt.freeType(On)}else $.raise("invalid buffer data")}else if(ft(Rr)){Sn=Rr.shape;var Ln=Rr.stride,Vi=0,ki=0,kn=0,Fn=0;Sn.length===1?(Vi=Sn[0],ki=1,kn=Ln[0],Fn=0):Sn.length===2?(Vi=Sn[0],ki=Sn[1],kn=Ln[0],Fn=Ln[1]):$.raise("invalid shape");var Ti=Array.isArray(Rr.data)?Lr.dtype:gl(Rr.data),zi=Kt.allocType(Ti,Vi*ki);A(zi,Rr.data,Vi,ki,kn,Fn,Rr.offset),on(zi,Qn),Kt.freeType(zi)}else $.raise("invalid data for buffer subdata");return Pn}return Jr||Pn(Ot),Pn._reglType="buffer",Pn._buffer=Lr,Pn.subdata=ci,Je.profile&&(Pn.stats=Lr.stats),Pn.destroy=function(){bn(Lr)},Pn}function nn(){L(er).forEach(function(Ot){Ot.buffer=U.createBuffer(),U.bindBuffer(Ot.type,Ot.buffer),U.bufferData(Ot.type,Ot.persistentData||Ot.byteLength,Ot.usage)})}return Je.profile&&(Me.getTotalBufferSize=function(){var Ot=0;return Object.keys(er).forEach(function(vr){Ot+=er[vr].stats.size}),Ot}),{create:$r,createStream:Kr,destroyStream:qr,clear:function(){L(er).forEach(bn),Zr.forEach(bn)},getBuffer:function(Ot){return Ot&&Ot._buffer instanceof Pr?Ot._buffer:null},restore:nn,_initBuffer:an}}var I=0,fe=0,Ie=1,lt=1,Dt=4,Nt=4,Dr={points:I,point:fe,lines:Ie,line:lt,triangles:Dt,triangle:Nt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Wr=0,ln=1,Li=4,Ei=5120,ha=5121,Pa=5122,ya=5123,_i=5124,mo=5125,wo=34963,Js=35040,hu=35044;function Qs(U,Me,Je,ir){var Fr={},er=0,Pr={uint8:ha,uint16:ya};Me.oes_element_index_uint&&(Pr.uint32=mo);function Zr(nn){this.id=er++,Fr[this.id]=this,this.buffer=nn,this.primType=Li,this.vertCount=0,this.type=0}Zr.prototype.bind=function(){this.buffer.bind()};var Kr=[];function qr(nn){var Ot=Kr.pop();return Ot||(Ot=new Zr(Je.create(null,wo,!0,!1)._buffer)),an(Ot,nn,Js,-1,-1,0,0),Ot}function en(nn){Kr.push(nn)}function an(nn,Ot,vr,Jr,Tn,Lr,Pn){nn.buffer.bind();var on;if(Ot){var ci=Pn;!Pn&&(!E(Ot)||ft(Ot)&&!E(Ot.data))&&(ci=Me.oes_element_index_uint?mo:ya),Je._initBuffer(nn.buffer,Ot,vr,ci,3)}else U.bufferData(wo,Lr,vr),nn.buffer.dtype=on||ha,nn.buffer.usage=vr,nn.buffer.dimension=3,nn.buffer.byteLength=Lr;if(on=Pn,!Pn){switch(nn.buffer.dtype){case ha:case Ei:on=ha;break;case ya:case Pa:on=ya;break;case mo:case _i:on=mo;break;default:$.raise("unsupported type for element array")}nn.buffer.dtype=on}nn.type=on,$(on!==mo||!!Me.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Rr=Tn;Rr<0&&(Rr=nn.buffer.byteLength,on===ya?Rr>>=1:on===mo&&(Rr>>=2)),nn.vertCount=Rr;var wr=Jr;if(Jr<0){wr=Li;var Qn=nn.buffer.dimension;Qn===1&&(wr=Wr),Qn===2&&(wr=ln),Qn===3&&(wr=Li)}nn.primType=wr}function bn(nn){ir.elementsCount--,$(nn.buffer!==null,"must not double destroy elements"),delete Fr[nn.id],nn.buffer.destroy(),nn.buffer=null}function $r(nn,Ot){var vr=Je.create(null,wo,!0),Jr=new Zr(vr._buffer);ir.elementsCount++;function Tn(Lr){if(!Lr)vr(),Jr.primType=Li,Jr.vertCount=0,Jr.type=ha;else if(typeof Lr=="number")vr(Lr),Jr.primType=Li,Jr.vertCount=Lr|0,Jr.type=ha;else{var Pn=null,on=hu,ci=-1,Rr=-1,wr=0,Qn=0;Array.isArray(Lr)||E(Lr)||ft(Lr)?Pn=Lr:($.type(Lr,"object","invalid arguments for elements"),"data"in Lr&&(Pn=Lr.data,$(Array.isArray(Pn)||E(Pn)||ft(Pn),"invalid data for element buffer")),"usage"in Lr&&($.parameter(Lr.usage,Co,"invalid element buffer usage"),on=Co[Lr.usage]),"primitive"in Lr&&($.parameter(Lr.primitive,Dr,"invalid element buffer primitive"),ci=Dr[Lr.primitive]),"count"in Lr&&($(typeof Lr.count=="number"&&Lr.count>=0,"invalid vertex count for elements"),Rr=Lr.count|0),"type"in Lr&&($.parameter(Lr.type,Pr,"invalid buffer type"),Qn=Pr[Lr.type]),"length"in Lr?wr=Lr.length|0:(wr=Rr,Qn===ya||Qn===Pa?wr*=2:(Qn===mo||Qn===_i)&&(wr*=4))),an(Jr,Pn,on,ci,Rr,wr,Qn)}return Tn}return Tn(nn),Tn._reglType="elements",Tn._elements=Jr,Tn.subdata=function(Lr,Pn){return vr.subdata(Lr,Pn),Tn},Tn.destroy=function(){bn(Jr)},Tn}return{create:$r,createStream:qr,destroyStream:en,getElements:function(nn){return typeof nn=="function"&&nn._elements instanceof Zr?nn._elements:null},clear:function(){L(Fr).forEach(bn)}}}var ku=new Float32Array(1),Yo=new Uint32Array(ku.buffer),ms=5123;function no(U){for(var Me=Kt.allocType(ms,U.length),Je=0;Je<U.length;++Je)if(isNaN(U[Je]))Me[Je]=65535;else if(U[Je]===Infinity)Me[Je]=31744;else if(U[Je]===-Infinity)Me[Je]=64512;else{ku[0]=U[Je];var ir=Yo[0],Fr=ir>>>31<<15,er=(ir<<1>>>24)-127,Pr=ir>>13&(1<<10)-1;if(er<-24)Me[Je]=Fr;else if(er<-14){var Zr=-14-er;Me[Je]=Fr+(Pr+(1<<10)>>Zr)}else er>15?Me[Je]=Fr+31744:Me[Je]=Fr+(er+15<<10)+Pr}return Me}function Ma(U){return Array.isArray(U)||E(U)}var qs=function(U){return!(U&U-1)&&!!U},yl=34467,gs=3553,Ol=34067,eu=34069,tu=6408,mc=6406,Fu=6407,Ia=6409,_l=6410,$c=32854,Bu=32855,xl=36194,Jc=32819,$u=32820,Yl=33635,Iu=34042,Ju=6402,bl=34041,Sl=35904,Qu=35906,El=36193,qu=33776,ru=33777,Kl=33778,Nu=33779,Dc=35986,el=35987,Cl=34798,Ll=35840,gc=35841,Rl=35842,kc=35843,$l=36196,js=5121,io=5123,bo=5125,zu=5126,Ds=10242,Dl=10243,Jl=10497,_u=33071,Ql=33648,Uu=10240,ao=10241,kl=9728,Vs=9729,pu=9984,sa=9985,Ai=9986,ys=9987,du=33170,tl=4352,rs=4353,Qc=4354,Fc=34046,wl=3317,Fl=37440,xu=37441,Ao=37443,Zu=37444,Al=33984,To=[pu,Ai,sa,ys],Dn=[0,Ia,_l,Fu,tu],ho={};ho[Ia]=ho[mc]=ho[Ju]=1,ho[bl]=ho[_l]=2,ho[Fu]=ho[Sl]=3,ho[tu]=ho[Qu]=4;function bu(U){return"[object "+U+"]"}var ju=bu("HTMLCanvasElement"),Ka=bu("OffscreenCanvas"),ks=bu("CanvasRenderingContext2D"),yc=bu("ImageBitmap"),xn=bu("HTMLImageElement"),Ou=bu("HTMLVideoElement"),_c=Object.keys(fu).concat([ju,Ka,ks,yc,xn,Ou]),nu=[];nu[js]=1,nu[zu]=4,nu[El]=2,nu[io]=2,nu[bo]=4;var Za=[];Za[$c]=2,Za[Bu]=2,Za[xl]=2,Za[bl]=4,Za[qu]=.5,Za[ru]=.5,Za[Kl]=1,Za[Nu]=1,Za[Dc]=.5,Za[el]=1,Za[Cl]=1,Za[Ll]=.5,Za[gc]=.25,Za[Rl]=.5,Za[kc]=.25,Za[$l]=.5;function _s(U){return Array.isArray(U)&&(U.length===0||typeof U[0]=="number")}function Tl(U){if(!Array.isArray(U))return!1;var Me=U.length;return!(Me===0||!Ma(U[0]))}function iu(U){return Object.prototype.toString.call(U)}function Ts(U){return iu(U)===ju}function Su(U){return iu(U)===Ka}function qc(U){return iu(U)===ks}function ql(U){return iu(U)===yc}function ec(U){return iu(U)===xn}function Po(U){return iu(U)===Ou}function Gs(U){var Me=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(Me&&U&&U.getContext)}function Mo(U){if(!U)return!1;if(Gs(U))return!0;var Me=iu(U);return _c.indexOf(Me)>=0?!0:_s(U)||Tl(U)||ft(U)}function ta(U){return fu[Object.prototype.toString.call(U)]|0}function Vu(U,Me){var Je=Me.length;switch(U.type){case js:case io:case bo:case zu:var ir=Kt.allocType(U.type,Je);ir.set(Me),U.data=ir;break;case El:U.data=no(Me);break;default:$.raise("unsupported texture type, must specify a typed array")}}function vu(U,Me){return Kt.allocType(U.type===El?zu:U.type,Me)}function Ko(U,Me){U.type===El?(U.data=no(Me),Kt.freeType(Me)):U.data=Me}function rl(U,Me,Je,ir,Fr,er){for(var Pr=U.width,Zr=U.height,Kr=U.channels,qr=Pr*Zr*Kr,en=vu(U,qr),an=0,bn=0;bn<Zr;++bn)for(var $r=0;$r<Pr;++$r)for(var nn=0;nn<Kr;++nn)en[an++]=Me[Je*$r+ir*bn+Fr*nn+er];Ko(U,en)}function Eu(U,Me,Je,ir,Fr,er){var Pr;if(typeof Za[U]!="undefined"?Pr=Za[U]:Pr=ho[U]*nu[Me],er&&(Pr*=6),Fr){for(var Zr=0,Kr=Je;Kr>=1;)Zr+=Pr*Kr*Kr,Kr/=2;return Zr}else return Pr*Je*ir}function bi(U,Me,Je,ir,Fr,er,Pr){var Zr={"don't care":tl,"dont care":tl,nice:Qc,fast:rs},Kr={repeat:Jl,clamp:_u,mirror:Ql},qr={nearest:kl,linear:Vs},en=d({mipmap:ys,"nearest mipmap nearest":pu,"linear mipmap nearest":sa,"nearest mipmap linear":Ai,"linear mipmap linear":ys},qr),an={none:0,browser:Zu},bn={uint8:js,rgba4:Jc,rgb565:Yl,"rgb5 a1":$u},$r={alpha:mc,luminance:Ia,"luminance alpha":_l,rgb:Fu,rgba:tu,rgba4:$c,"rgb5 a1":Bu,rgb565:xl},nn={};Me.ext_srgb&&($r.srgb=Sl,$r.srgba=Qu),Me.oes_texture_float&&(bn.float32=bn.float=zu),Me.oes_texture_half_float&&(bn.float16=bn["half float"]=El),Me.webgl_depth_texture&&(d($r,{depth:Ju,"depth stencil":bl}),d(bn,{uint16:io,uint32:bo,"depth stencil":Iu})),Me.webgl_compressed_texture_s3tc&&d(nn,{"rgb s3tc dxt1":qu,"rgba s3tc dxt1":ru,"rgba s3tc dxt3":Kl,"rgba s3tc dxt5":Nu}),Me.webgl_compressed_texture_atc&&d(nn,{"rgb atc":Dc,"rgba atc explicit alpha":el,"rgba atc interpolated alpha":Cl}),Me.webgl_compressed_texture_pvrtc&&d(nn,{"rgb pvrtc 4bppv1":Ll,"rgb pvrtc 2bppv1":gc,"rgba pvrtc 4bppv1":Rl,"rgba pvrtc 2bppv1":kc}),Me.webgl_compressed_texture_etc1&&(nn["rgb etc1"]=$l);var Ot=Array.prototype.slice.call(U.getParameter(yl)||new Uint32Array(0));Object.keys(nn).forEach(function(je){var or=nn[je];Ot.indexOf(or)>=0&&($r[je]=or)});var vr=Object.keys($r);Je.textureFormats=vr;var Jr=[];Object.keys($r).forEach(function(je){var or=$r[je];Jr[or]=je});var Tn=[];Object.keys(bn).forEach(function(je){var or=bn[je];Tn[or]=je});var Lr=[];Object.keys(qr).forEach(function(je){var or=qr[je];Lr[or]=je});var Pn=[];Object.keys(en).forEach(function(je){var or=en[je];Pn[or]=je});var on=[];Object.keys(Kr).forEach(function(je){var or=Kr[je];on[or]=je});var ci=vr.reduce(function(je,or){var $t=$r[or];return $t===Ia||$t===mc||$t===Ia||$t===_l||$t===Ju||$t===bl||Me.ext_srgb&&($t===Sl||$t===Qu)?je[$t]=$t:$t===Bu||or.indexOf("rgba")>=0?je[$t]=tu:je[$t]=Fu,je},{});function Rr(){this.internalformat=tu,this.format=tu,this.type=js,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Zu,this.width=0,this.height=0,this.channels=0}function wr(je,or){je.internalformat=or.internalformat,je.format=or.format,je.type=or.type,je.compressed=or.compressed,je.premultiplyAlpha=or.premultiplyAlpha,je.flipY=or.flipY,je.unpackAlignment=or.unpackAlignment,je.colorSpace=or.colorSpace,je.width=or.width,je.height=or.height,je.channels=or.channels}function Qn(je,or){if(!(typeof or!="object"||!or)){if("premultiplyAlpha"in or&&($.type(or.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),je.premultiplyAlpha=or.premultiplyAlpha),"flipY"in or&&($.type(or.flipY,"boolean","invalid texture flip"),je.flipY=or.flipY),"alignment"in or&&($.oneOf(or.alignment,[1,2,4,8],"invalid texture unpack alignment"),je.unpackAlignment=or.alignment),"colorSpace"in or&&($.parameter(or.colorSpace,an,"invalid colorSpace"),je.colorSpace=an[or.colorSpace]),"type"in or){var $t=or.type;$(Me.oes_texture_float||!($t==="float"||$t==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),$(Me.oes_texture_half_float||!($t==="half float"||$t==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),$(Me.webgl_depth_texture||!($t==="uint16"||$t==="uint32"||$t==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),$.parameter($t,bn,"invalid texture type"),je.type=bn[$t]}var Yn=je.width,ua=je.height,Fe=je.channels,Ee=!1;"shape"in or?($(Array.isArray(or.shape)&&or.shape.length>=2,"shape must be an array"),Yn=or.shape[0],ua=or.shape[1],or.shape.length===3&&(Fe=or.shape[2],$(Fe>0&&Fe<=4,"invalid number of channels"),Ee=!0),$(Yn>=0&&Yn<=Je.maxTextureSize,"invalid width"),$(ua>=0&&ua<=Je.maxTextureSize,"invalid height")):("radius"in or&&(Yn=ua=or.radius,$(Yn>=0&&Yn<=Je.maxTextureSize,"invalid radius")),"width"in or&&(Yn=or.width,$(Yn>=0&&Yn<=Je.maxTextureSize,"invalid width")),"height"in or&&(ua=or.height,$(ua>=0&&ua<=Je.maxTextureSize,"invalid height")),"channels"in or&&(Fe=or.channels,$(Fe>0&&Fe<=4,"invalid number of channels"),Ee=!0)),je.width=Yn|0,je.height=ua|0,je.channels=Fe|0;var at=!1;if("format"in or){var Mt=or.format;$(Me.webgl_depth_texture||!(Mt==="depth"||Mt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),$.parameter(Mt,$r,"invalid texture format");var tr=je.internalformat=$r[Mt];je.format=ci[tr],Mt in bn&&("type"in or||(je.type=bn[Mt])),Mt in nn&&(je.compressed=!0),at=!0}!Ee&&at?je.channels=ho[je.format]:Ee&&!at?je.channels!==Dn[je.format]&&(je.format=je.internalformat=Dn[je.channels]):at&&Ee&&$(je.channels===ho[je.format],"number of channels inconsistent with specified format")}}function Sn(je){U.pixelStorei(Fl,je.flipY),U.pixelStorei(xu,je.premultiplyAlpha),U.pixelStorei(Ao,je.colorSpace),U.pixelStorei(wl,je.unpackAlignment)}function rn(){Rr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function On(je,or){var $t=null;if(Mo(or)?$t=or:or&&($.type(or,"object","invalid pixel data type"),Qn(je,or),"x"in or&&(je.xOffset=or.x|0),"y"in or&&(je.yOffset=or.y|0),Mo(or.data)&&($t=or.data)),$(!je.compressed||$t instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),or.copy){$(!$t,"can not specify copy and data field for the same texture");var Yn=Fr.viewportWidth,ua=Fr.viewportHeight;je.width=je.width||Yn-je.xOffset,je.height=je.height||ua-je.yOffset,je.needsCopy=!0,$(je.xOffset>=0&&je.xOffset<Yn&&je.yOffset>=0&&je.yOffset<ua&&je.width>0&&je.width<=Yn&&je.height>0&&je.height<=ua,"copy texture read out of bounds")}else if(!$t)je.width=je.width||1,je.height=je.height||1,je.channels=je.channels||4;else if(E($t))je.channels=je.channels||4,je.data=$t,!("type"in or)&&je.type===js&&(je.type=ta($t));else if(_s($t))je.channels=je.channels||4,Vu(je,$t),je.alignment=1,je.needsFree=!0;else if(ft($t)){var Fe=$t.data;!Array.isArray(Fe)&&je.type===js&&(je.type=ta(Fe));var Ee=$t.shape,at=$t.stride,Mt,tr,yt,ht,ot,Le;Ee.length===3?(yt=Ee[2],Le=at[2]):($(Ee.length===2,"invalid ndarray pixel data, must be 2 or 3D"),yt=1,Le=1),Mt=Ee[0],tr=Ee[1],ht=at[0],ot=at[1],je.alignment=1,je.width=Mt,je.height=tr,je.channels=yt,je.format=je.internalformat=Dn[yt],je.needsFree=!0,rl(je,Fe,ht,ot,Le,$t.offset)}else if(Gs($t)||Ts($t)||Su($t)||qc($t))Gs($t)||Ts($t)||Su($t)?je.element=$t:je.element=$t.canvas,je.width=je.element.width,je.height=je.element.height,je.channels=4;else if(ql($t))je.element=$t,je.width=$t.width,je.height=$t.height,je.channels=4;else if(ec($t))je.element=$t,je.width=$t.naturalWidth,je.height=$t.naturalHeight,je.channels=4;else if(Po($t))je.element=$t,je.width=$t.videoWidth,je.height=$t.videoHeight,je.channels=4;else if(Tl($t)){var qe=je.width||$t[0].length,Be=je.height||$t.length,kt=je.channels;Ma($t[0][0])?kt=kt||$t[0][0].length:kt=kt||1;for(var Yt=Qr.shape($t),Gr=1,gn=0;gn<Yt.length;++gn)Gr*=Yt[gn];var yn=vu(je,Gr);Qr.flatten($t,Yt,"",yn),Ko(je,yn),je.alignment=1,je.width=qe,je.height=Be,je.channels=kt,je.format=je.internalformat=Dn[kt],je.needsFree=!0}je.type===zu?$(Je.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):je.type===El&&$(Je.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Ln(je,or,$t){var Yn=je.element,ua=je.data,Fe=je.internalformat,Ee=je.format,at=je.type,Mt=je.width,tr=je.height;Sn(je),Yn?U.texImage2D(or,$t,Ee,Ee,at,Yn):je.compressed?U.compressedTexImage2D(or,$t,Fe,Mt,tr,0,ua):je.needsCopy?(ir(),U.copyTexImage2D(or,$t,Ee,je.xOffset,je.yOffset,Mt,tr,0)):U.texImage2D(or,$t,Ee,Mt,tr,0,Ee,at,ua||null)}function Vi(je,or,$t,Yn,ua){var Fe=je.element,Ee=je.data,at=je.internalformat,Mt=je.format,tr=je.type,yt=je.width,ht=je.height;Sn(je),Fe?U.texSubImage2D(or,ua,$t,Yn,Mt,tr,Fe):je.compressed?U.compressedTexSubImage2D(or,ua,$t,Yn,at,yt,ht,Ee):je.needsCopy?(ir(),U.copyTexSubImage2D(or,ua,$t,Yn,je.xOffset,je.yOffset,yt,ht)):U.texSubImage2D(or,ua,$t,Yn,yt,ht,Mt,tr,Ee)}var ki=[];function kn(){return ki.pop()||new rn}function Fn(je){je.needsFree&&Kt.freeType(je.data),rn.call(je),ki.push(je)}function Ti(){Rr.call(this),this.genMipmaps=!1,this.mipmapHint=tl,this.mipmask=0,this.images=Array(16)}function zi(je,or,$t){var Yn=je.images[0]=kn();je.mipmask=1,Yn.width=je.width=or,Yn.height=je.height=$t,Yn.channels=je.channels=4}function va(je,or){var $t=null;if(Mo(or))$t=je.images[0]=kn(),wr($t,je),On($t,or),je.mipmask=1;else if(Qn(je,or),Array.isArray(or.mipmap))for(var Yn=or.mipmap,ua=0;ua<Yn.length;++ua)$t=je.images[ua]=kn(),wr($t,je),$t.width>>=ua,$t.height>>=ua,On($t,Yn[ua]),je.mipmask|=1<<ua;else $t=je.images[0]=kn(),wr($t,je),On($t,or),je.mipmask=1;wr(je,je.images[0]),je.compressed&&(je.internalformat===qu||je.internalformat===ru||je.internalformat===Kl||je.internalformat===Nu)&&$(je.width%4==0&&je.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function jo(je,or){for(var $t=je.images,Yn=0;Yn<$t.length;++Yn){if(!$t[Yn])return;Ln($t[Yn],or,Yn)}}var Vo=[];function la(){var je=Vo.pop()||new Ti;Rr.call(je),je.mipmask=0;for(var or=0;or<16;++or)je.images[or]=null;return je}function Ss(je){for(var or=je.images,$t=0;$t<or.length;++$t)or[$t]&&Fn(or[$t]),or[$t]=null;Vo.push(je)}function _o(){this.minFilter=kl,this.magFilter=kl,this.wrapS=_u,this.wrapT=_u,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=tl}function Is(je,or){if("min"in or){var $t=or.min;$.parameter($t,en),je.minFilter=en[$t],To.indexOf(je.minFilter)>=0&&!("faces"in or)&&(je.genMipmaps=!0)}if("mag"in or){var Yn=or.mag;$.parameter(Yn,qr),je.magFilter=qr[Yn]}var ua=je.wrapS,Fe=je.wrapT;if("wrap"in or){var Ee=or.wrap;typeof Ee=="string"?($.parameter(Ee,Kr),ua=Fe=Kr[Ee]):Array.isArray(Ee)&&($.parameter(Ee[0],Kr),$.parameter(Ee[1],Kr),ua=Kr[Ee[0]],Fe=Kr[Ee[1]])}else{if("wrapS"in or){var at=or.wrapS;$.parameter(at,Kr),ua=Kr[at]}if("wrapT"in or){var Mt=or.wrapT;$.parameter(Mt,Kr),Fe=Kr[Mt]}}if(je.wrapS=ua,je.wrapT=Fe,"anisotropic"in or){var tr=or.anisotropic;$(typeof tr=="number"&&tr>=1&&tr<=Je.maxAnisotropic,"aniso samples must be between 1 and "),je.anisotropic=or.anisotropic}if("mipmap"in or){var yt=!1;switch(typeof or.mipmap){case"string":$.parameter(or.mipmap,Zr,"invalid mipmap hint"),je.mipmapHint=Zr[or.mipmap],je.genMipmaps=!0,yt=!0;break;case"boolean":yt=je.genMipmaps=or.mipmap;break;case"object":$(Array.isArray(or.mipmap),"invalid mipmap type"),je.genMipmaps=!1,yt=!0;break;default:$.raise("invalid mipmap type")}yt&&!("min"in or)&&(je.minFilter=pu)}}function Go(je,or){U.texParameteri(or,ao,je.minFilter),U.texParameteri(or,Uu,je.magFilter),U.texParameteri(or,Ds,je.wrapS),U.texParameteri(or,Dl,je.wrapT),Me.ext_texture_filter_anisotropic&&U.texParameteri(or,Fc,je.anisotropic),je.genMipmaps&&(U.hint(du,je.mipmapHint),U.generateMipmap(or))}var os=0,ps={},Os=Je.maxTextureUnits,$o=Array(Os).map(function(){return null});function Ji(je){Rr.call(this),this.mipmask=0,this.internalformat=tu,this.id=os++,this.refCount=1,this.target=je,this.texture=U.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new _o,Pr.profile&&(this.stats={size:0})}function Es(je){U.activeTexture(Al),U.bindTexture(je.target,je.texture)}function Fa(){var je=$o[0];je?U.bindTexture(je.target,je.texture):U.bindTexture(gs,null)}function Oo(je){var or=je.texture;$(or,"must not double destroy texture");var $t=je.unit,Yn=je.target;$t>=0&&(U.activeTexture(Al+$t),U.bindTexture(Yn,null),$o[$t]=null),U.deleteTexture(or),je.texture=null,je.params=null,je.pixels=null,je.refCount=0,delete ps[je.id],er.textureCount--}d(Ji.prototype,{bind:function(){var je=this;je.bindCount+=1;var or=je.unit;if(or<0){for(var $t=0;$t<Os;++$t){var Yn=$o[$t];if(Yn){if(Yn.bindCount>0)continue;Yn.unit=-1}$o[$t]=je,or=$t;break}or>=Os&&$.raise("insufficient number of texture units"),Pr.profile&&er.maxTextureUnits<or+1&&(er.maxTextureUnits=or+1),je.unit=or,U.activeTexture(Al+or),U.bindTexture(je.target,je.texture)}return or},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Oo(this)}});function Mi(je,or){var $t=new Ji(gs);ps[$t.id]=$t,er.textureCount++;function Yn(Ee,at){var Mt=$t.texInfo;_o.call(Mt);var tr=la();return typeof Ee=="number"?typeof at=="number"?zi(tr,Ee|0,at|0):zi(tr,Ee|0,Ee|0):Ee?($.type(Ee,"object","invalid arguments to regl.texture"),Is(Mt,Ee),va(tr,Ee)):zi(tr,1,1),Mt.genMipmaps&&(tr.mipmask=(tr.width<<1)-1),$t.mipmask=tr.mipmask,wr($t,tr),$.texture2D(Mt,tr,Je),$t.internalformat=tr.internalformat,Yn.width=tr.width,Yn.height=tr.height,Es($t),jo(tr,gs),Go(Mt,gs),Fa(),Ss(tr),Pr.profile&&($t.stats.size=Eu($t.internalformat,$t.type,tr.width,tr.height,Mt.genMipmaps,!1)),Yn.format=Jr[$t.internalformat],Yn.type=Tn[$t.type],Yn.mag=Lr[Mt.magFilter],Yn.min=Pn[Mt.minFilter],Yn.wrapS=on[Mt.wrapS],Yn.wrapT=on[Mt.wrapT],Yn}function ua(Ee,at,Mt,tr){$(!!Ee,"must specify image data");var yt=at|0,ht=Mt|0,ot=tr|0,Le=kn();return wr(Le,$t),Le.width=0,Le.height=0,On(Le,Ee),Le.width=Le.width||($t.width>>ot)-yt,Le.height=Le.height||($t.height>>ot)-ht,$($t.type===Le.type&&$t.format===Le.format&&$t.internalformat===Le.internalformat,"incompatible format for texture.subimage"),$(yt>=0&&ht>=0&&yt+Le.width<=$t.width&&ht+Le.height<=$t.height,"texture.subimage write out of bounds"),$($t.mipmask&1<<ot,"missing mipmap data"),$(Le.data||Le.element||Le.needsCopy,"missing image data"),Es($t),Vi(Le,gs,yt,ht,ot),Fa(),Fn(Le),Yn}function Fe(Ee,at){var Mt=Ee|0,tr=at|0||Mt;if(Mt===$t.width&&tr===$t.height)return Yn;Yn.width=$t.width=Mt,Yn.height=$t.height=tr,Es($t);for(var yt=0;$t.mipmask>>yt;++yt){var ht=Mt>>yt,ot=tr>>yt;if(!ht||!ot)break;U.texImage2D(gs,yt,$t.format,ht,ot,0,$t.format,$t.type,null)}return Fa(),Pr.profile&&($t.stats.size=Eu($t.internalformat,$t.type,Mt,tr,!1,!1)),Yn}return Yn(je,or),Yn.subimage=ua,Yn.resize=Fe,Yn._reglType="texture2d",Yn._texture=$t,Pr.profile&&(Yn.stats=$t.stats),Yn.destroy=function(){$t.decRef()},Yn}function ca(je,or,$t,Yn,ua,Fe){var Ee=new Ji(Ol);ps[Ee.id]=Ee,er.cubeCount++;var at=new Array(6);function Mt(ht,ot,Le,qe,Be,kt){var Yt,Gr=Ee.texInfo;for(_o.call(Gr),Yt=0;Yt<6;++Yt)at[Yt]=la();if(typeof ht=="number"||!ht){var gn=ht|0||1;for(Yt=0;Yt<6;++Yt)zi(at[Yt],gn,gn)}else if(typeof ht=="object")if(ot)va(at[0],ht),va(at[1],ot),va(at[2],Le),va(at[3],qe),va(at[4],Be),va(at[5],kt);else if(Is(Gr,ht),Qn(Ee,ht),"faces"in ht){var yn=ht.faces;for($(Array.isArray(yn)&&yn.length===6,"cube faces must be a length 6 array"),Yt=0;Yt<6;++Yt)$(typeof yn[Yt]=="object"&&!!yn[Yt],"invalid input for cube map face"),wr(at[Yt],Ee),va(at[Yt],yn[Yt])}else for(Yt=0;Yt<6;++Yt)va(at[Yt],ht);else $.raise("invalid arguments to cube map");for(wr(Ee,at[0]),$.optional(function(){Je.npotTextureCube||$(qs(Ee.width)&&qs(Ee.height),"your browser does not support non power or two texture dimensions")}),Gr.genMipmaps?Ee.mipmask=(at[0].width<<1)-1:Ee.mipmask=at[0].mipmask,$.textureCube(Ee,Gr,at,Je),Ee.internalformat=at[0].internalformat,Mt.width=at[0].width,Mt.height=at[0].height,Es(Ee),Yt=0;Yt<6;++Yt)jo(at[Yt],eu+Yt);for(Go(Gr,Ol),Fa(),Pr.profile&&(Ee.stats.size=Eu(Ee.internalformat,Ee.type,Mt.width,Mt.height,Gr.genMipmaps,!0)),Mt.format=Jr[Ee.internalformat],Mt.type=Tn[Ee.type],Mt.mag=Lr[Gr.magFilter],Mt.min=Pn[Gr.minFilter],Mt.wrapS=on[Gr.wrapS],Mt.wrapT=on[Gr.wrapT],Yt=0;Yt<6;++Yt)Ss(at[Yt]);return Mt}function tr(ht,ot,Le,qe,Be){$(!!ot,"must specify image data"),$(typeof ht=="number"&&ht===(ht|0)&&ht>=0&&ht<6,"invalid face");var kt=Le|0,Yt=qe|0,Gr=Be|0,gn=kn();return wr(gn,Ee),gn.width=0,gn.height=0,On(gn,ot),gn.width=gn.width||(Ee.width>>Gr)-kt,gn.height=gn.height||(Ee.height>>Gr)-Yt,$(Ee.type===gn.type&&Ee.format===gn.format&&Ee.internalformat===gn.internalformat,"incompatible format for texture.subimage"),$(kt>=0&&Yt>=0&&kt+gn.width<=Ee.width&&Yt+gn.height<=Ee.height,"texture.subimage write out of bounds"),$(Ee.mipmask&1<<Gr,"missing mipmap data"),$(gn.data||gn.element||gn.needsCopy,"missing image data"),Es(Ee),Vi(gn,eu+ht,kt,Yt,Gr),Fa(),Fn(gn),Mt}function yt(ht){var ot=ht|0;if(ot!==Ee.width){Mt.width=Ee.width=ot,Mt.height=Ee.height=ot,Es(Ee);for(var Le=0;Le<6;++Le)for(var qe=0;Ee.mipmask>>qe;++qe)U.texImage2D(eu+Le,qe,Ee.format,ot>>qe,ot>>qe,0,Ee.format,Ee.type,null);return Fa(),Pr.profile&&(Ee.stats.size=Eu(Ee.internalformat,Ee.type,Mt.width,Mt.height,!1,!0)),Mt}}return Mt(je,or,$t,Yn,ua,Fe),Mt.subimage=tr,Mt.resize=yt,Mt._reglType="textureCube",Mt._texture=Ee,Pr.profile&&(Mt.stats=Ee.stats),Mt.destroy=function(){Ee.decRef()},Mt}function Ha(){for(var je=0;je<Os;++je)U.activeTexture(Al+je),U.bindTexture(gs,null),$o[je]=null;L(ps).forEach(Oo),er.cubeCount=0,er.textureCount=0}Pr.profile&&(er.getTotalTextureSize=function(){var je=0;return Object.keys(ps).forEach(function(or){je+=ps[or].stats.size}),je});function Lo(){for(var je=0;je<Os;++je){var or=$o[je];or&&(or.bindCount=0,or.unit=-1,$o[je]=null)}L(ps).forEach(function($t){$t.texture=U.createTexture(),U.bindTexture($t.target,$t.texture);for(var Yn=0;Yn<32;++Yn)if(($t.mipmask&1<<Yn)!=0)if($t.target===gs)U.texImage2D(gs,Yn,$t.internalformat,$t.width>>Yn,$t.height>>Yn,0,$t.internalformat,$t.type,null);else for(var ua=0;ua<6;++ua)U.texImage2D(eu+ua,Yn,$t.internalformat,$t.width>>Yn,$t.height>>Yn,0,$t.internalformat,$t.type,null);Go($t.texInfo,$t.target)})}function Vl(){for(var je=0;je<Os;++je){var or=$o[je];or&&(or.bindCount=0,or.unit=-1,$o[je]=null),U.activeTexture(Al+je),U.bindTexture(gs,null),U.bindTexture(Ol,null)}}return{create2D:Mi,createCube:ca,clear:Ha,getTexture:function(je){return null},restore:Lo,refresh:Vl}}var po=36161,Pl=32854,jn=32855,Hn=36194,nl=33189,ns=36168,fs=34041,Io=35907,au=34836,Bc=34842,tc=34843,Gi=[];Gi[Pl]=2,Gi[jn]=2,Gi[Hn]=2,Gi[nl]=2,Gi[ns]=1,Gi[fs]=4,Gi[Io]=4,Gi[au]=16,Gi[Bc]=8,Gi[tc]=6;function Ui(U,Me,Je){return Gi[U]*Me*Je}var ef=function(U,Me,Je,ir,Fr){var er={rgba4:Pl,rgb565:Hn,"rgb5 a1":jn,depth:nl,stencil:ns,"depth stencil":fs};Me.ext_srgb&&(er.srgba=Io),Me.ext_color_buffer_half_float&&(er.rgba16f=Bc,er.rgb16f=tc),Me.webgl_color_buffer_float&&(er.rgba32f=au);var Pr=[];Object.keys(er).forEach(function($r){var nn=er[$r];Pr[nn]=$r});var Zr=0,Kr={};function qr($r){this.id=Zr++,this.refCount=1,this.renderbuffer=$r,this.format=Pl,this.width=0,this.height=0,Fr.profile&&(this.stats={size:0})}qr.prototype.decRef=function(){--this.refCount<=0&&en(this)};function en($r){var nn=$r.renderbuffer;$(nn,"must not double destroy renderbuffer"),U.bindRenderbuffer(po,null),U.deleteRenderbuffer(nn),$r.renderbuffer=null,$r.refCount=0,delete Kr[$r.id],ir.renderbufferCount--}function an($r,nn){var Ot=new qr(U.createRenderbuffer());Kr[Ot.id]=Ot,ir.renderbufferCount++;function vr(Tn,Lr){var Pn=0,on=0,ci=Pl;if(typeof Tn=="object"&&Tn){var Rr=Tn;if("shape"in Rr){var wr=Rr.shape;$(Array.isArray(wr)&&wr.length>=2,"invalid renderbuffer shape"),Pn=wr[0]|0,on=wr[1]|0}else"radius"in Rr&&(Pn=on=Rr.radius|0),"width"in Rr&&(Pn=Rr.width|0),"height"in Rr&&(on=Rr.height|0);"format"in Rr&&($.parameter(Rr.format,er,"invalid renderbuffer format"),ci=er[Rr.format])}else typeof Tn=="number"?(Pn=Tn|0,typeof Lr=="number"?on=Lr|0:on=Pn):Tn?$.raise("invalid arguments to renderbuffer constructor"):Pn=on=1;if($(Pn>0&&on>0&&Pn<=Je.maxRenderbufferSize&&on<=Je.maxRenderbufferSize,"invalid renderbuffer size"),!(Pn===Ot.width&&on===Ot.height&&ci===Ot.format))return vr.width=Ot.width=Pn,vr.height=Ot.height=on,Ot.format=ci,U.bindRenderbuffer(po,Ot.renderbuffer),U.renderbufferStorage(po,ci,Pn,on),$(U.getError()===0,"invalid render buffer format"),Fr.profile&&(Ot.stats.size=Ui(Ot.format,Ot.width,Ot.height)),vr.format=Pr[Ot.format],vr}function Jr(Tn,Lr){var Pn=Tn|0,on=Lr|0||Pn;return Pn===Ot.width&&on===Ot.height||($(Pn>0&&on>0&&Pn<=Je.maxRenderbufferSize&&on<=Je.maxRenderbufferSize,"invalid renderbuffer size"),vr.width=Ot.width=Pn,vr.height=Ot.height=on,U.bindRenderbuffer(po,Ot.renderbuffer),U.renderbufferStorage(po,Ot.format,Pn,on),$(U.getError()===0,"invalid render buffer format"),Fr.profile&&(Ot.stats.size=Ui(Ot.format,Ot.width,Ot.height))),vr}return vr($r,nn),vr.resize=Jr,vr._reglType="renderbuffer",vr._renderbuffer=Ot,Fr.profile&&(vr.stats=Ot.stats),vr.destroy=function(){Ot.decRef()},vr}Fr.profile&&(ir.getTotalRenderbufferSize=function(){var $r=0;return Object.keys(Kr).forEach(function(nn){$r+=Kr[nn].stats.size}),$r});function bn(){L(Kr).forEach(function($r){$r.renderbuffer=U.createRenderbuffer(),U.bindRenderbuffer(po,$r.renderbuffer),U.renderbufferStorage(po,$r.format,$r.width,$r.height)}),U.bindRenderbuffer(po,null)}return{create:an,clear:function(){L(Kr).forEach(en)},restore:bn}},Ps=36160,Ml=36161,Ms=3553,Va=34069,ou=36064,xs=36096,Gu=36128,il=33306,Il=36053,rc=36054,al=36055,ol=36057,sl=36061,Cu=36193,Hu=5121,xc=5126,wu=6407,Fs=6408,Nc=6402,nc=[wu,Fs],Bl=[];Bl[Fs]=4,Bl[wu]=3;var ul=[];ul[Hu]=1,ul[xc]=4,ul[Cu]=2;var i=32854,u=32855,o=36194,h=33189,y=36168,b=34041,T=35907,D=34836,V=34842,se=34843,Ce=[i,u,o,T,V,se,D],we={};we[Il]="complete",we[rc]="incomplete attachment",we[ol]="incomplete dimensions",we[al]="incomplete, missing attachment",we[sl]="unsupported";function Pe(U,Me,Je,ir,Fr,er){var Pr={cur:null,next:null,dirty:!1,setFBO:null},Zr=["rgba"],Kr=["rgba4","rgb565","rgb5 a1"];Me.ext_srgb&&Kr.push("srgba"),Me.ext_color_buffer_half_float&&Kr.push("rgba16f","rgb16f"),Me.webgl_color_buffer_float&&Kr.push("rgba32f");var qr=["uint8"];Me.oes_texture_half_float&&qr.push("half float","float16"),Me.oes_texture_float&&qr.push("float","float32");function en(rn,On,Ln){this.target=rn,this.texture=On,this.renderbuffer=Ln;var Vi=0,ki=0;On?(Vi=On.width,ki=On.height):Ln&&(Vi=Ln.width,ki=Ln.height),this.width=Vi,this.height=ki}function an(rn){rn&&(rn.texture&&rn.texture._texture.decRef(),rn.renderbuffer&&rn.renderbuffer._renderbuffer.decRef())}function bn(rn,On,Ln){if(!!rn)if(rn.texture){var Vi=rn.texture._texture,ki=Math.max(1,Vi.width),kn=Math.max(1,Vi.height);$(ki===On&&kn===Ln,"inconsistent width/height for supplied texture"),Vi.refCount+=1}else{var Fn=rn.renderbuffer._renderbuffer;$(Fn.width===On&&Fn.height===Ln,"inconsistent width/height for renderbuffer"),Fn.refCount+=1}}function $r(rn,On){On&&(On.texture?U.framebufferTexture2D(Ps,rn,On.target,On.texture._texture.texture,0):U.framebufferRenderbuffer(Ps,rn,Ml,On.renderbuffer._renderbuffer.renderbuffer))}function nn(rn){var On=Ms,Ln=null,Vi=null,ki=rn;typeof rn=="object"&&(ki=rn.data,"target"in rn&&(On=rn.target|0)),$.type(ki,"function","invalid attachment data");var kn=ki._reglType;return kn==="texture2d"?(Ln=ki,$(On===Ms)):kn==="textureCube"?(Ln=ki,$(On>=Va&&On<Va+6,"invalid cube map target")):kn==="renderbuffer"?(Vi=ki,On=Ml):$.raise("invalid regl object for attachment"),new en(On,Ln,Vi)}function Ot(rn,On,Ln,Vi,ki){if(Ln){var kn=ir.create2D({width:rn,height:On,format:Vi,type:ki});return kn._texture.refCount=0,new en(Ms,kn,null)}else{var Fn=Fr.create({width:rn,height:On,format:Vi});return Fn._renderbuffer.refCount=0,new en(Ml,null,Fn)}}function vr(rn){return rn&&(rn.texture||rn.renderbuffer)}function Jr(rn,On,Ln){rn&&(rn.texture?rn.texture.resize(On,Ln):rn.renderbuffer&&rn.renderbuffer.resize(On,Ln),rn.width=On,rn.height=Ln)}var Tn=0,Lr={};function Pn(){this.id=Tn++,Lr[this.id]=this,this.framebuffer=U.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function on(rn){rn.colorAttachments.forEach(an),an(rn.depthAttachment),an(rn.stencilAttachment),an(rn.depthStencilAttachment)}function ci(rn){var On=rn.framebuffer;$(On,"must not double destroy framebuffer"),U.deleteFramebuffer(On),rn.framebuffer=null,er.framebufferCount--,delete Lr[rn.id]}function Rr(rn){var On;U.bindFramebuffer(Ps,rn.framebuffer);var Ln=rn.colorAttachments;for(On=0;On<Ln.length;++On)$r(ou+On,Ln[On]);for(On=Ln.length;On<Je.maxColorAttachments;++On)U.framebufferTexture2D(Ps,ou+On,Ms,null,0);U.framebufferTexture2D(Ps,il,Ms,null,0),U.framebufferTexture2D(Ps,xs,Ms,null,0),U.framebufferTexture2D(Ps,Gu,Ms,null,0),$r(xs,rn.depthAttachment),$r(Gu,rn.stencilAttachment),$r(il,rn.depthStencilAttachment);var Vi=U.checkFramebufferStatus(Ps);!U.isContextLost()&&Vi!==Il&&$.raise("framebuffer configuration not supported, status = "+we[Vi]),U.bindFramebuffer(Ps,Pr.next?Pr.next.framebuffer:null),Pr.cur=Pr.next,U.getError()}function wr(rn,On){var Ln=new Pn;er.framebufferCount++;function Vi(kn,Fn){var Ti;$(Pr.next!==Ln,"can not update framebuffer which is currently in use");var zi=0,va=0,jo=!0,Vo=!0,la=null,Ss=!0,_o="rgba",Is="uint8",Go=1,os=null,ps=null,Os=null,$o=!1;if(typeof kn=="number")zi=kn|0,va=Fn|0||zi;else if(!kn)zi=va=1;else{$.type(kn,"object","invalid arguments for framebuffer");var Ji=kn;if("shape"in Ji){var Es=Ji.shape;$(Array.isArray(Es)&&Es.length>=2,"invalid shape for framebuffer"),zi=Es[0],va=Es[1]}else"radius"in Ji&&(zi=va=Ji.radius),"width"in Ji&&(zi=Ji.width),"height"in Ji&&(va=Ji.height);("color"in Ji||"colors"in Ji)&&(la=Ji.color||Ji.colors,Array.isArray(la)&&$(la.length===1||Me.webgl_draw_buffers,"multiple render targets not supported")),la||("colorCount"in Ji&&(Go=Ji.colorCount|0,$(Go>0,"invalid color buffer count")),"colorTexture"in Ji&&(Ss=!!Ji.colorTexture,_o="rgba4"),"colorType"in Ji&&(Is=Ji.colorType,Ss?($(Me.oes_texture_float||!(Is==="float"||Is==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),$(Me.oes_texture_half_float||!(Is==="half float"||Is==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Is==="half float"||Is==="float16"?($(Me.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),_o="rgba16f"):(Is==="float"||Is==="float32")&&($(Me.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),_o="rgba32f"),$.oneOf(Is,qr,"invalid color type")),"colorFormat"in Ji&&(_o=Ji.colorFormat,Zr.indexOf(_o)>=0?Ss=!0:Kr.indexOf(_o)>=0?Ss=!1:$.optional(function(){Ss?$.oneOf(Ji.colorFormat,Zr,"invalid color format for texture"):$.oneOf(Ji.colorFormat,Kr,"invalid color format for renderbuffer")}))),("depthTexture"in Ji||"depthStencilTexture"in Ji)&&($o=!!(Ji.depthTexture||Ji.depthStencilTexture),$(!$o||Me.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Ji&&(typeof Ji.depth=="boolean"?jo=Ji.depth:(os=Ji.depth,Vo=!1)),"stencil"in Ji&&(typeof Ji.stencil=="boolean"?Vo=Ji.stencil:(ps=Ji.stencil,jo=!1)),"depthStencil"in Ji&&(typeof Ji.depthStencil=="boolean"?jo=Vo=Ji.depthStencil:(Os=Ji.depthStencil,jo=!1,Vo=!1))}var Fa=null,Oo=null,Mi=null,ca=null;if(Array.isArray(la))Fa=la.map(nn);else if(la)Fa=[nn(la)];else for(Fa=new Array(Go),Ti=0;Ti<Go;++Ti)Fa[Ti]=Ot(zi,va,Ss,_o,Is);$(Me.webgl_draw_buffers||Fa.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),$(Fa.length<=Je.maxColorAttachments,"too many color attachments, not supported"),zi=zi||Fa[0].width,va=va||Fa[0].height,os?Oo=nn(os):jo&&!Vo&&(Oo=Ot(zi,va,$o,"depth","uint32")),ps?Mi=nn(ps):Vo&&!jo&&(Mi=Ot(zi,va,!1,"stencil","uint8")),Os?ca=nn(Os):!os&&!ps&&Vo&&jo&&(ca=Ot(zi,va,$o,"depth stencil","depth stencil")),$(!!os+!!ps+!!Os<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Ha=null;for(Ti=0;Ti<Fa.length;++Ti)if(bn(Fa[Ti],zi,va),$(!Fa[Ti]||Fa[Ti].texture&&nc.indexOf(Fa[Ti].texture._texture.format)>=0||Fa[Ti].renderbuffer&&Ce.indexOf(Fa[Ti].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Ti+" is invalid"),Fa[Ti]&&Fa[Ti].texture){var Lo=Bl[Fa[Ti].texture._texture.format]*ul[Fa[Ti].texture._texture.type];Ha===null?Ha=Lo:$(Ha===Lo,"all color attachments much have the same number of bits per pixel.")}return bn(Oo,zi,va),$(!Oo||Oo.texture&&Oo.texture._texture.format===Nc||Oo.renderbuffer&&Oo.renderbuffer._renderbuffer.format===h,"invalid depth attachment for framebuffer object"),bn(Mi,zi,va),$(!Mi||Mi.renderbuffer&&Mi.renderbuffer._renderbuffer.format===y,"invalid stencil attachment for framebuffer object"),bn(ca,zi,va),$(!ca||ca.texture&&ca.texture._texture.format===b||ca.renderbuffer&&ca.renderbuffer._renderbuffer.format===b,"invalid depth-stencil attachment for framebuffer object"),on(Ln),Ln.width=zi,Ln.height=va,Ln.colorAttachments=Fa,Ln.depthAttachment=Oo,Ln.stencilAttachment=Mi,Ln.depthStencilAttachment=ca,Vi.color=Fa.map(vr),Vi.depth=vr(Oo),Vi.stencil=vr(Mi),Vi.depthStencil=vr(ca),Vi.width=Ln.width,Vi.height=Ln.height,Rr(Ln),Vi}function ki(kn,Fn){$(Pr.next!==Ln,"can not resize a framebuffer which is currently in use");var Ti=Math.max(kn|0,1),zi=Math.max(Fn|0||Ti,1);if(Ti===Ln.width&&zi===Ln.height)return Vi;for(var va=Ln.colorAttachments,jo=0;jo<va.length;++jo)Jr(va[jo],Ti,zi);return Jr(Ln.depthAttachment,Ti,zi),Jr(Ln.stencilAttachment,Ti,zi),Jr(Ln.depthStencilAttachment,Ti,zi),Ln.width=Vi.width=Ti,Ln.height=Vi.height=zi,Rr(Ln),Vi}return Vi(rn,On),d(Vi,{resize:ki,_reglType:"framebuffer",_framebuffer:Ln,destroy:function(){ci(Ln),on(Ln)},use:function(kn){Pr.setFBO({framebuffer:Vi},kn)}})}function Qn(rn){var On=Array(6);function Ln(ki){var kn;$(On.indexOf(Pr.next)<0,"can not update framebuffer which is currently in use");var Fn={color:null},Ti=0,zi=null,va="rgba",jo="uint8",Vo=1;if(typeof ki=="number")Ti=ki|0;else if(!ki)Ti=1;else{$.type(ki,"object","invalid arguments for framebuffer");var la=ki;if("shape"in la){var Ss=la.shape;$(Array.isArray(Ss)&&Ss.length>=2,"invalid shape for framebuffer"),$(Ss[0]===Ss[1],"cube framebuffer must be square"),Ti=Ss[0]}else"radius"in la&&(Ti=la.radius|0),"width"in la?(Ti=la.width|0,"height"in la&&$(la.height===Ti,"must be square")):"height"in la&&(Ti=la.height|0);("color"in la||"colors"in la)&&(zi=la.color||la.colors,Array.isArray(zi)&&$(zi.length===1||Me.webgl_draw_buffers,"multiple render targets not supported")),zi||("colorCount"in la&&(Vo=la.colorCount|0,$(Vo>0,"invalid color buffer count")),"colorType"in la&&($.oneOf(la.colorType,qr,"invalid color type"),jo=la.colorType),"colorFormat"in la&&(va=la.colorFormat,$.oneOf(la.colorFormat,Zr,"invalid color format for texture"))),"depth"in la&&(Fn.depth=la.depth),"stencil"in la&&(Fn.stencil=la.stencil),"depthStencil"in la&&(Fn.depthStencil=la.depthStencil)}var _o;if(zi)if(Array.isArray(zi))for(_o=[],kn=0;kn<zi.length;++kn)_o[kn]=zi[kn];else _o=[zi];else{_o=Array(Vo);var Is={radius:Ti,format:va,type:jo};for(kn=0;kn<Vo;++kn)_o[kn]=ir.createCube(Is)}for(Fn.color=Array(_o.length),kn=0;kn<_o.length;++kn){var Go=_o[kn];$(typeof Go=="function"&&Go._reglType==="textureCube","invalid cube map"),Ti=Ti||Go.width,$(Go.width===Ti&&Go.height===Ti,"invalid cube map shape"),Fn.color[kn]={target:Va,data:_o[kn]}}for(kn=0;kn<6;++kn){for(var os=0;os<_o.length;++os)Fn.color[os].target=Va+kn;kn>0&&(Fn.depth=On[0].depth,Fn.stencil=On[0].stencil,Fn.depthStencil=On[0].depthStencil),On[kn]?On[kn](Fn):On[kn]=wr(Fn)}return d(Ln,{width:Ti,height:Ti,color:_o})}function Vi(ki){var kn,Fn=ki|0;if($(Fn>0&&Fn<=Je.maxCubeMapSize,"invalid radius for cube fbo"),Fn===Ln.width)return Ln;var Ti=Ln.color;for(kn=0;kn<Ti.length;++kn)Ti[kn].resize(Fn);for(kn=0;kn<6;++kn)On[kn].resize(Fn);return Ln.width=Ln.height=Fn,Ln}return Ln(rn),d(Ln,{faces:On,resize:Vi,_reglType:"framebufferCube",destroy:function(){On.forEach(function(ki){ki.destroy()})}})}function Sn(){Pr.cur=null,Pr.next=null,Pr.dirty=!0,L(Lr).forEach(function(rn){rn.framebuffer=U.createFramebuffer(),Rr(rn)})}return d(Pr,{getFramebuffer:function(rn){if(typeof rn=="function"&&rn._reglType==="framebuffer"){var On=rn._framebuffer;if(On instanceof Pn)return On}return null},create:wr,createCube:Qn,clear:function(){L(Lr).forEach(ci)},restore:Sn})}var He=5126,Ge=34962,nt=34963,ze=["attributes","elements","offset","count","primitive","instances"];function it(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=He,this.offset=0,this.stride=0,this.divisor=0}function bt(U,Me,Je,ir,Fr,er,Pr){for(var Zr=Je.maxAttributes,Kr=new Array(Zr),qr=0;qr<Zr;++qr)Kr[qr]=new it;var en=0,an={},bn={Record:it,scope:{},state:Kr,currentVAO:null,targetVAO:null,restore:nn()?on:function(){},createVAO:ci,getVAO:vr,destroyBuffer:$r,setVAO:nn()?Jr:Tn,clear:nn()?Lr:function(){}};function $r(Rr){for(var wr=0;wr<Kr.length;++wr){var Qn=Kr[wr];Qn.buffer===Rr&&(U.disableVertexAttribArray(wr),Qn.buffer=null)}}function nn(){return Me.oes_vertex_array_object}function Ot(){return Me.angle_instanced_arrays}function vr(Rr){return typeof Rr=="function"&&Rr._vao?Rr._vao:null}function Jr(Rr){if(Rr!==bn.currentVAO){var wr=nn();Rr?wr.bindVertexArrayOES(Rr.vao):wr.bindVertexArrayOES(null),bn.currentVAO=Rr}}function Tn(Rr){if(Rr!==bn.currentVAO){if(Rr)Rr.bindAttrs();else{for(var wr=Ot(),Qn=0;Qn<Kr.length;++Qn){var Sn=Kr[Qn];Sn.buffer?(U.enableVertexAttribArray(Qn),Sn.buffer.bind(),U.vertexAttribPointer(Qn,Sn.size,Sn.type,Sn.normalized,Sn.stride,Sn.offfset),wr&&Sn.divisor&&wr.vertexAttribDivisorANGLE(Qn,Sn.divisor)):(U.disableVertexAttribArray(Qn),U.vertexAttrib4f(Qn,Sn.x,Sn.y,Sn.z,Sn.w))}Pr.elements?U.bindBuffer(nt,Pr.elements.buffer.buffer):U.bindBuffer(nt,null)}bn.currentVAO=Rr}}function Lr(){L(an).forEach(function(Rr){Rr.destroy()})}function Pn(){this.id=++en,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Rr=nn();Rr?this.vao=Rr.createVertexArrayOES():this.vao=null,an[this.id]=this,this.buffers=[]}Pn.prototype.bindAttrs=function(){for(var Rr=Ot(),wr=this.attributes,Qn=0;Qn<wr.length;++Qn){var Sn=wr[Qn];Sn.buffer?(U.enableVertexAttribArray(Qn),U.bindBuffer(Ge,Sn.buffer.buffer),U.vertexAttribPointer(Qn,Sn.size,Sn.type,Sn.normalized,Sn.stride,Sn.offset),Rr&&Sn.divisor&&Rr.vertexAttribDivisorANGLE(Qn,Sn.divisor)):(U.disableVertexAttribArray(Qn),U.vertexAttrib4f(Qn,Sn.x,Sn.y,Sn.z,Sn.w))}for(var rn=wr.length;rn<Zr;++rn)U.disableVertexAttribArray(rn);var On=er.getElements(this.elements);On?U.bindBuffer(nt,On.buffer.buffer):U.bindBuffer(nt,null)},Pn.prototype.refresh=function(){var Rr=nn();Rr&&(Rr.bindVertexArrayOES(this.vao),this.bindAttrs(),bn.currentVAO=null,Rr.bindVertexArrayOES(null))},Pn.prototype.destroy=function(){if(this.vao){var Rr=nn();this===bn.currentVAO&&(bn.currentVAO=null,Rr.bindVertexArrayOES(null)),Rr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),an[this.id]&&(delete an[this.id],ir.vaoCount-=1)};function on(){var Rr=nn();Rr&&L(an).forEach(function(wr){wr.refresh()})}function ci(Rr){var wr=new Pn;ir.vaoCount+=1;function Qn(Sn){var rn;if(Array.isArray(Sn))rn=Sn,wr.elements&&wr.ownsElements&&wr.elements.destroy(),wr.elements=null,wr.ownsElements=!1,wr.offset=0,wr.count=0,wr.instances=-1,wr.primitive=4;else{if($(typeof Sn=="object","invalid arguments for create vao"),$("attributes"in Sn,"must specify attributes for vao"),Sn.elements){var On=Sn.elements;wr.ownsElements?typeof On=="function"&&On._reglType==="elements"?(wr.elements.destroy(),wr.ownsElements=!1):(wr.elements(On),wr.ownsElements=!1):er.getElements(Sn.elements)?(wr.elements=Sn.elements,wr.ownsElements=!1):(wr.elements=er.create(Sn.elements),wr.ownsElements=!0)}else wr.elements=null,wr.ownsElements=!1;rn=Sn.attributes,wr.offset=0,wr.count=-1,wr.instances=-1,wr.primitive=4,wr.elements&&(wr.count=wr.elements._elements.vertCount,wr.primitive=wr.elements._elements.primType),"offset"in Sn&&(wr.offset=Sn.offset|0),"count"in Sn&&(wr.count=Sn.count|0),"instances"in Sn&&(wr.instances=Sn.instances|0),"primitive"in Sn&&($(Sn.primitive in Dr,"bad primitive type: "+Sn.primitive),wr.primitive=Dr[Sn.primitive]),$.optional(()=>{for(var jo=Object.keys(Sn),Vo=0;Vo<jo.length;++Vo)$(ze.indexOf(jo[Vo])>=0,'invalid option for vao: "'+jo[Vo]+'" valid options are '+ze)}),$(Array.isArray(rn),"attributes must be an array")}$(rn.length<Zr,"too many attributes"),$(rn.length>0,"must specify at least one attribute");var Ln={},Vi=wr.attributes;Vi.length=rn.length;for(var ki=0;ki<rn.length;++ki){var kn=rn[ki],Fn=Vi[ki]=new it,Ti=kn.data||kn;if(Array.isArray(Ti)||E(Ti)||ft(Ti)){var zi;wr.buffers[ki]&&(zi=wr.buffers[ki],E(Ti)&&zi._buffer.byteLength>=Ti.byteLength?zi.subdata(Ti):(zi.destroy(),wr.buffers[ki]=null)),wr.buffers[ki]||(zi=wr.buffers[ki]=Fr.create(kn,Ge,!1,!0)),Fn.buffer=Fr.getBuffer(zi),Fn.size=Fn.buffer.dimension|0,Fn.normalized=!1,Fn.type=Fn.buffer.dtype,Fn.offset=0,Fn.stride=0,Fn.divisor=0,Fn.state=1,Ln[ki]=1}else Fr.getBuffer(kn)?(Fn.buffer=Fr.getBuffer(kn),Fn.size=Fn.buffer.dimension|0,Fn.normalized=!1,Fn.type=Fn.buffer.dtype,Fn.offset=0,Fn.stride=0,Fn.divisor=0,Fn.state=1):Fr.getBuffer(kn.buffer)?(Fn.buffer=Fr.getBuffer(kn.buffer),Fn.size=(+kn.size||Fn.buffer.dimension)|0,Fn.normalized=!!kn.normalized||!1,"type"in kn?($.parameter(kn.type,$s,"invalid buffer type"),Fn.type=$s[kn.type]):Fn.type=Fn.buffer.dtype,Fn.offset=(kn.offset||0)|0,Fn.stride=(kn.stride||0)|0,Fn.divisor=(kn.divisor||0)|0,Fn.state=1,$(Fn.size>=1&&Fn.size<=4,"size must be between 1 and 4"),$(Fn.offset>=0,"invalid offset"),$(Fn.stride>=0&&Fn.stride<=255,"stride must be between 0 and 255"),$(Fn.divisor>=0,"divisor must be positive"),$(!Fn.divisor||!!Me.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in kn?($(ki>0,"first attribute must not be a constant"),Fn.x=+kn.x||0,Fn.y=+kn.y||0,Fn.z=+kn.z||0,Fn.w=+kn.w||0,Fn.state=2):$(!1,"invalid attribute spec for location "+ki)}for(var va=0;va<wr.buffers.length;++va)!Ln[va]&&wr.buffers[va]&&(wr.buffers[va].destroy(),wr.buffers[va]=null);return wr.refresh(),Qn}return Qn.destroy=function(){for(var Sn=0;Sn<wr.buffers.length;++Sn)wr.buffers[Sn]&&wr.buffers[Sn].destroy();wr.buffers.length=0,wr.ownsElements&&(wr.elements.destroy(),wr.elements=null,wr.ownsElements=!1),wr.destroy()},Qn._vao=wr,Qn._reglType="vao",Qn(Rr)}return bn}var Vt=35632,gr=35633,fr=35718,Er=35721;function jr(U,Me,Je,ir){var Fr={},er={};function Pr(Ot,vr,Jr,Tn){this.name=Ot,this.id=vr,this.location=Jr,this.info=Tn}function Zr(Ot,vr){for(var Jr=0;Jr<Ot.length;++Jr)if(Ot[Jr].id===vr.id){Ot[Jr].location=vr.location;return}Ot.push(vr)}function Kr(Ot,vr,Jr){var Tn=Ot===Vt?Fr:er,Lr=Tn[vr];if(!Lr){var Pn=Me.str(vr);Lr=U.createShader(Ot),U.shaderSource(Lr,Pn),U.compileShader(Lr),$.shaderError(U,Lr,Pn,Ot,Jr),Tn[vr]=Lr}return Lr}var qr={},en=[],an=0;function bn(Ot,vr){this.id=an++,this.fragId=Ot,this.vertId=vr,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,ir.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function $r(Ot,vr,Jr){var Tn,Lr,Pn=Kr(Vt,Ot.fragId),on=Kr(gr,Ot.vertId),ci=Ot.program=U.createProgram();if(U.attachShader(ci,Pn),U.attachShader(ci,on),Jr)for(Tn=0;Tn<Jr.length;++Tn){var Rr=Jr[Tn];U.bindAttribLocation(ci,Rr[0],Rr[1])}U.linkProgram(ci),$.linkError(U,ci,Me.str(Ot.fragId),Me.str(Ot.vertId),vr);var wr=U.getProgramParameter(ci,fr);ir.profile&&(Ot.stats.uniformsCount=wr);var Qn=Ot.uniforms;for(Tn=0;Tn<wr;++Tn)if(Lr=U.getActiveUniform(ci,Tn),Lr)if(Lr.size>1)for(var Sn=0;Sn<Lr.size;++Sn){var rn=Lr.name.replace("[0]","["+Sn+"]");Zr(Qn,new Pr(rn,Me.id(rn),U.getUniformLocation(ci,rn),Lr))}else Zr(Qn,new Pr(Lr.name,Me.id(Lr.name),U.getUniformLocation(ci,Lr.name),Lr));var On=U.getProgramParameter(ci,Er);ir.profile&&(Ot.stats.attributesCount=On);var Ln=Ot.attributes;for(Tn=0;Tn<On;++Tn)Lr=U.getActiveAttrib(ci,Tn),Lr&&Zr(Ln,new Pr(Lr.name,Me.id(Lr.name),U.getAttribLocation(ci,Lr.name),Lr))}ir.profile&&(Je.getMaxUniformsCount=function(){var Ot=0;return en.forEach(function(vr){vr.stats.uniformsCount>Ot&&(Ot=vr.stats.uniformsCount)}),Ot},Je.getMaxAttributesCount=function(){var Ot=0;return en.forEach(function(vr){vr.stats.attributesCount>Ot&&(Ot=vr.stats.attributesCount)}),Ot});function nn(){Fr={},er={};for(var Ot=0;Ot<en.length;++Ot)$r(en[Ot],null,en[Ot].attributes.map(function(vr){return[vr.location,vr.name]}))}return{clear:function(){var Ot=U.deleteShader.bind(U);L(Fr).forEach(Ot),Fr={},L(er).forEach(Ot),er={},en.forEach(function(vr){U.deleteProgram(vr.program)}),en.length=0,qr={},Je.shaderCount=0},program:function(Ot,vr,Jr,Tn){$.command(Ot>=0,"missing vertex shader",Jr),$.command(vr>=0,"missing fragment shader",Jr);var Lr=qr[vr];Lr||(Lr=qr[vr]={});var Pn=Lr[Ot];if(Pn&&(Pn.refCount++,!Tn))return Pn;var on=new bn(vr,Ot);return Je.shaderCount++,$r(on,Jr,Tn),Pn||(Lr[Ot]=on),en.push(on),d(on,{destroy:function(){if(on.refCount--,on.refCount<=0){U.deleteProgram(on.program);var ci=en.indexOf(on);en.splice(ci,1),Je.shaderCount--}Lr[on.vertId].refCount<=0&&(U.deleteShader(er[on.vertId]),delete er[on.vertId],delete qr[on.fragId][on.vertId]),Object.keys(qr[on.fragId]).length||(U.deleteShader(Fr[on.fragId]),delete Fr[on.fragId],delete qr[on.fragId])}})},restore:nn,shader:Kr,frag:-1,vert:-1}}var fn=6408,tn=5121,Zn=3333,si=5126;function ui(U,Me,Je,ir,Fr,er,Pr){function Zr(en){var an;Me.next===null?($(Fr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),an=tn):($(Me.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),an=Me.next.colorAttachments[0].texture._texture.type,$.optional(function(){er.oes_texture_float?($(an===tn||an===si,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),an===si&&$(Pr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):$(an===tn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var bn=0,$r=0,nn=ir.framebufferWidth,Ot=ir.framebufferHeight,vr=null;E(en)?vr=en:en&&($.type(en,"object","invalid arguments to regl.read()"),bn=en.x|0,$r=en.y|0,$(bn>=0&&bn<ir.framebufferWidth,"invalid x offset for regl.read"),$($r>=0&&$r<ir.framebufferHeight,"invalid y offset for regl.read"),nn=(en.width||ir.framebufferWidth-bn)|0,Ot=(en.height||ir.framebufferHeight-$r)|0,vr=en.data||null),vr&&(an===tn?$(vr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):an===si&&$(vr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),$(nn>0&&nn+bn<=ir.framebufferWidth,"invalid width for read pixels"),$(Ot>0&&Ot+$r<=ir.framebufferHeight,"invalid height for read pixels"),Je();var Jr=nn*Ot*4;return vr||(an===tn?vr=new Uint8Array(Jr):an===si&&(vr=vr||new Float32Array(Jr))),$.isTypedArray(vr,"data buffer for regl.read() must be a typedarray"),$(vr.byteLength>=Jr,"data buffer for regl.read() too small"),U.pixelStorei(Zn,4),U.readPixels(bn,$r,nn,Ot,fn,an,vr),vr}function Kr(en){var an;return Me.setFBO({framebuffer:en.framebuffer},function(){an=Zr(en)}),an}function qr(en){return!en||!("framebuffer"in en)?Zr(en):Kr(en)}return qr}function dn(U){return Array.prototype.slice.call(U)}function ia(U){return dn(U).join("")}function Wn(){var U=0,Me=[],Je=[];function ir(an){for(var bn=0;bn<Je.length;++bn)if(Je[bn]===an)return Me[bn];var $r="g"+U++;return Me.push($r),Je.push(an),$r}function Fr(){var an=[];function bn(){an.push.apply(an,dn(arguments))}var $r=[];function nn(){var Ot="v"+U++;return $r.push(Ot),arguments.length>0&&(an.push(Ot,"="),an.push.apply(an,dn(arguments)),an.push(";")),Ot}return d(bn,{def:nn,toString:function(){return ia([$r.length>0?"var "+$r.join(",")+";":"",ia(an)])}})}function er(){var an=Fr(),bn=Fr(),$r=an.toString,nn=bn.toString;function Ot(vr,Jr){bn(vr,Jr,"=",an.def(vr,Jr),";")}return d(function(){an.apply(an,dn(arguments))},{def:an.def,entry:an,exit:bn,save:Ot,set:function(vr,Jr,Tn){Ot(vr,Jr),an(vr,Jr,"=",Tn,";")},toString:function(){return $r()+nn()}})}function Pr(){var an=ia(arguments),bn=er(),$r=er(),nn=bn.toString,Ot=$r.toString;return d(bn,{then:function(){return bn.apply(bn,dn(arguments)),this},else:function(){return $r.apply($r,dn(arguments)),this},toString:function(){var vr=Ot();return vr&&(vr="else{"+vr+"}"),ia(["if(",an,"){",nn(),"}",vr])}})}var Zr=Fr(),Kr={};function qr(an,bn){var $r=[];function nn(){var Lr="a"+$r.length;return $r.push(Lr),Lr}bn=bn||0;for(var Ot=0;Ot<bn;++Ot)nn();var vr=er(),Jr=vr.toString,Tn=Kr[an]=d(vr,{arg:nn,toString:function(){return ia(["function(",$r.join(),"){",Jr(),"}"])}});return Tn}function en(){var an=['"use strict";',Zr,"return {"];Object.keys(Kr).forEach(function(Ot){an.push('"',Ot,'":',Kr[Ot].toString(),",")}),an.push("}");var bn=ia(an).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),$r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",nn=$r?ce.Function.apply(null,Me.concat(bn)):Function.apply(null,Me.concat(bn));return nn.apply(null,Je)}return{global:Zr,link:ir,block:Fr,proc:qr,scope:er,cond:Pr,compile:en}}var xi="xyzw".split(""),ji=5121,vi=1,Ci=2,Q=0,J=1,O=2,F=3,ne=4,xe=5,pt=6,Pt="dither",xt="blend.enable",ur="blend.color",Vr="blend.equation",Jn="blend.func",Xn="depth.enable",li="depth.func",mi="depth.range",Ri="depth.mask",aa="colorMask",pa="cull.enable",ba="cull.face",go="frontFace",Ca="lineWidth",Bo="polygonOffset.enable",ka="polygonOffset.offset",Zi="sample.alpha",da="sample.enable",$a="sample.coverage",yo="stencil.enable",Pi="stencil.mask",oo="stencil.func",Ga="stencil.opFront",Hs="stencil.opBack",Nl="scissor.enable",Bs="scissor.box",Lu="viewport",Ru="profile",zl="framebuffer",ll="vert",Ul="frag",ic="elements",Wu="primitive",hs="count",Uf="offset",yf="instances",_f="vao",ih="Width",ah="Height",tf=zl+ih,bc=zl+ah,pp=Lu+ih,Zf=Lu+ah,oh="drawingBuffer",ac=oh+ih,rf=oh+ah,dp=[Jn,Vr,oo,Ga,Hs,$a,Lu,Bs,ka],nf=34962,sh=34963,Lh=35632,vp=35633,Rh=3553,mp=34067,uh=2884,gp=3042,af=3024,yp=2960,is=2929,jf=3089,lh=32823,Vf=32926,Gf=32928,zc=5126,xf=35664,of=35665,Sc=35666,bf=5124,sf=35667,Hf=35668,Ec=35669,ch=35670,uf=35671,Wf=35672,lf=35673,Cc=35674,Au=35675,Sf=35676,Ef=35678,Cf=35680,fh=4,Uc=1028,mu=1029,Dh=2304,hh=2305,ph=32775,kh=32776,_p=519,wc=7680,Ac=0,Fh=1,wf=32774,cf=513,Xu=36160,Bh=36064,Zl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Nh=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],jl={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},oc={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},zh={frag:Lh,vert:vp},dh={cw:Dh,ccw:hh};function Af(U){return Array.isArray(U)||E(U)||ft(U)}function Uh(U){return U.sort(function(Me,Je){return Me===Lu?-1:Je===Lu?1:Me<Je?-1:1})}function bs(U,Me,Je,ir){this.thisDep=U,this.contextDep=Me,this.propDep=Je,this.append=ir}function Zo(U){return U&&!(U.thisDep||U.contextDep||U.propDep)}function as(U){return new bs(!1,!1,!1,U)}function gu(U,Me){var Je=U.type;if(Je===Q){var ir=U.data.length;return new bs(!0,ir>=1,ir>=2,Me)}else if(Je===ne){var Fr=U.data;return new bs(Fr.thisDep,Fr.contextDep,Fr.propDep,Me)}else{if(Je===xe)return new bs(!1,!1,!1,Me);if(Je===pt){for(var er=!1,Pr=!1,Zr=!1,Kr=0;Kr<U.data.length;++Kr){var qr=U.data[Kr];if(qr.type===J)Zr=!0;else if(qr.type===O)Pr=!0;else if(qr.type===F)er=!0;else if(qr.type===Q){er=!0;var en=qr.data;en>=1&&(Pr=!0),en>=2&&(Zr=!0)}else qr.type===ne&&(er=er||qr.data.thisDep,Pr=Pr||qr.data.contextDep,Zr=Zr||qr.data.propDep)}return new bs(er,Pr,Zr,Me)}else return new bs(Je===F,Je===O,Je===J,Me)}}var Xf=new bs(!1,!1,!1,function(){});function xp(U,Me,Je,ir,Fr,er,Pr,Zr,Kr,qr,en,an,bn,$r,nn){var Ot=qr.Record,vr={add:32774,subtract:32778,"reverse subtract":32779};Je.ext_blend_minmax&&(vr.min=ph,vr.max=kh);var Jr=Je.angle_instanced_arrays,Tn=Je.webgl_draw_buffers,Lr=Je.oes_vertex_array_object,Pn={dirty:!0,profile:nn.profile},on={},ci=[],Rr={},wr={};function Qn(Fe){return Fe.replace(".","_")}function Sn(Fe,Ee,at){var Mt=Qn(Fe);ci.push(Fe),on[Mt]=Pn[Mt]=!!at,Rr[Mt]=Ee}function rn(Fe,Ee,at){var Mt=Qn(Fe);ci.push(Fe),Array.isArray(at)?(Pn[Mt]=at.slice(),on[Mt]=at.slice()):Pn[Mt]=on[Mt]=at,wr[Mt]=Ee}Sn(Pt,af),Sn(xt,gp),rn(ur,"blendColor",[0,0,0,0]),rn(Vr,"blendEquationSeparate",[wf,wf]),rn(Jn,"blendFuncSeparate",[Fh,Ac,Fh,Ac]),Sn(Xn,is,!0),rn(li,"depthFunc",cf),rn(mi,"depthRange",[0,1]),rn(Ri,"depthMask",!0),rn(aa,aa,[!0,!0,!0,!0]),Sn(pa,uh),rn(ba,"cullFace",mu),rn(go,go,hh),rn(Ca,Ca,1),Sn(Bo,lh),rn(ka,"polygonOffset",[0,0]),Sn(Zi,Vf),Sn(da,Gf),rn($a,"sampleCoverage",[1,!1]),Sn(yo,yp),rn(Pi,"stencilMask",-1),rn(oo,"stencilFunc",[_p,0,-1]),rn(Ga,"stencilOpSeparate",[Uc,wc,wc,wc]),rn(Hs,"stencilOpSeparate",[mu,wc,wc,wc]),Sn(Nl,jf),rn(Bs,"scissor",[0,0,U.drawingBufferWidth,U.drawingBufferHeight]),rn(Lu,Lu,[0,0,U.drawingBufferWidth,U.drawingBufferHeight]);var On={gl:U,context:bn,strings:Me,next:on,current:Pn,draw:an,elements:er,buffer:Fr,shader:en,attributes:qr.state,vao:qr,uniforms:Kr,framebuffer:Zr,extensions:Je,timer:$r,isBufferArgs:Af},Ln={primTypes:Dr,compareFuncs:jl,blendFuncs:Zl,blendEquations:vr,stencilOps:oc,glTypes:$s,orientationType:dh};$.optional(function(){On.isArrayLike=Ma}),Tn&&(Ln.backBuffer=[mu],Ln.drawBuffer=de(ir.maxDrawbuffers,function(Fe){return Fe===0?[0]:de(Fe,function(Ee){return Bh+Ee})}));var Vi=0;function ki(){var Fe=Wn(),Ee=Fe.link,at=Fe.global;Fe.id=Vi++,Fe.batchId="0";var Mt=Ee(On),tr=Fe.shared={props:"a0"};Object.keys(On).forEach(function(qe){tr[qe]=at.def(Mt,".",qe)}),$.optional(function(){Fe.CHECK=Ee($),Fe.commandStr=$.guessCommand(),Fe.command=Ee(Fe.commandStr),Fe.assert=function(qe,Be,kt){qe("if(!(",Be,"))",this.CHECK,".commandRaise(",Ee(kt),",",this.command,");")},Ln.invalidBlendCombinations=Nh});var yt=Fe.next={},ht=Fe.current={};Object.keys(wr).forEach(function(qe){Array.isArray(Pn[qe])&&(yt[qe]=at.def(tr.next,".",qe),ht[qe]=at.def(tr.current,".",qe))});var ot=Fe.constants={};Object.keys(Ln).forEach(function(qe){ot[qe]=at.def(JSON.stringify(Ln[qe]))}),Fe.invoke=function(qe,Be){switch(Be.type){case Q:var kt=["this",tr.context,tr.props,Fe.batchId];return qe.def(Ee(Be.data),".call(",kt.slice(0,Math.max(Be.data.length+1,4)),")");case J:return qe.def(tr.props,Be.data);case O:return qe.def(tr.context,Be.data);case F:return qe.def("this",Be.data);case ne:return Be.data.append(Fe,qe),Be.data.ref;case xe:return Be.data.toString();case pt:return Be.data.map(function(Yt){return Fe.invoke(qe,Yt)})}},Fe.attribCache={};var Le={};return Fe.scopeAttrib=function(qe){var Be=Me.id(qe);if(Be in Le)return Le[Be];var kt=qr.scope[Be];kt||(kt=qr.scope[Be]=new Ot);var Yt=Le[Be]=Ee(kt);return Yt},Fe}function kn(Fe){var Ee=Fe.static,at=Fe.dynamic,Mt;if(Ru in Ee){var tr=!!Ee[Ru];Mt=as(function(ht,ot){return tr}),Mt.enable=tr}else if(Ru in at){var yt=at[Ru];Mt=gu(yt,function(ht,ot){return ht.invoke(ot,yt)})}return Mt}function Fn(Fe,Ee){var at=Fe.static,Mt=Fe.dynamic;if(zl in at){var tr=at[zl];return tr?(tr=Zr.getFramebuffer(tr),$.command(tr,"invalid framebuffer object"),as(function(ht,ot){var Le=ht.link(tr),qe=ht.shared;ot.set(qe.framebuffer,".next",Le);var Be=qe.context;return ot.set(Be,"."+tf,Le+".width"),ot.set(Be,"."+bc,Le+".height"),Le})):as(function(ht,ot){var Le=ht.shared;ot.set(Le.framebuffer,".next","null");var qe=Le.context;return ot.set(qe,"."+tf,qe+"."+ac),ot.set(qe,"."+bc,qe+"."+rf),"null"})}else if(zl in Mt){var yt=Mt[zl];return gu(yt,function(ht,ot){var Le=ht.invoke(ot,yt),qe=ht.shared,Be=qe.framebuffer,kt=ot.def(Be,".getFramebuffer(",Le,")");$.optional(function(){ht.assert(ot,"!"+Le+"||"+kt,"invalid framebuffer object")}),ot.set(Be,".next",kt);var Yt=qe.context;return ot.set(Yt,"."+tf,kt+"?"+kt+".width:"+Yt+"."+ac),ot.set(Yt,"."+bc,kt+"?"+kt+".height:"+Yt+"."+rf),kt})}else return null}function Ti(Fe,Ee,at){var Mt=Fe.static,tr=Fe.dynamic;function yt(Le){if(Le in Mt){var qe=Mt[Le];$.commandType(qe,"object","invalid "+Le,at.commandStr);var Be=!0,kt=qe.x|0,Yt=qe.y|0,Gr,gn;return"width"in qe?(Gr=qe.width|0,$.command(Gr>=0,"invalid "+Le,at.commandStr)):Be=!1,"height"in qe?(gn=qe.height|0,$.command(gn>=0,"invalid "+Le,at.commandStr)):Be=!1,new bs(!Be&&Ee&&Ee.thisDep,!Be&&Ee&&Ee.contextDep,!Be&&Ee&&Ee.propDep,function(pn,qn){var Rn=pn.shared.context,ri=Gr;"width"in qe||(ri=qn.def(Rn,".",tf,"-",kt));var ii=gn;return"height"in qe||(ii=qn.def(Rn,".",bc,"-",Yt)),[kt,Yt,ri,ii]})}else if(Le in tr){var yn=tr[Le],Bn=gu(yn,function(pn,qn){var Rn=pn.invoke(qn,yn);$.optional(function(){pn.assert(qn,Rn+"&&typeof "+Rn+'==="object"',"invalid "+Le)});var ri=pn.shared.context,ii=qn.def(Rn,".x|0"),ei=qn.def(Rn,".y|0"),pi=qn.def('"width" in ',Rn,"?",Rn,".width|0:","(",ri,".",tf,"-",ii,")"),Oa=qn.def('"height" in ',Rn,"?",Rn,".height|0:","(",ri,".",bc,"-",ei,")");return $.optional(function(){pn.assert(qn,pi+">=0&&"+Oa+">=0","invalid "+Le)}),[ii,ei,pi,Oa]});return Ee&&(Bn.thisDep=Bn.thisDep||Ee.thisDep,Bn.contextDep=Bn.contextDep||Ee.contextDep,Bn.propDep=Bn.propDep||Ee.propDep),Bn}else return Ee?new bs(Ee.thisDep,Ee.contextDep,Ee.propDep,function(pn,qn){var Rn=pn.shared.context;return[0,0,qn.def(Rn,".",tf),qn.def(Rn,".",bc)]}):null}var ht=yt(Lu);if(ht){var ot=ht;ht=new bs(ht.thisDep,ht.contextDep,ht.propDep,function(Le,qe){var Be=ot.append(Le,qe),kt=Le.shared.context;return qe.set(kt,"."+pp,Be[2]),qe.set(kt,"."+Zf,Be[3]),Be})}return{viewport:ht,scissor_box:yt(Bs)}}function zi(Fe,Ee){var at=Fe.static,Mt=typeof at[Ul]=="string"&&typeof at[ll]=="string";if(Mt){if(Object.keys(Ee.dynamic).length>0)return null;var tr=Ee.static,yt=Object.keys(tr);if(yt.length>0&&typeof tr[yt[0]]=="number"){for(var ht=[],ot=0;ot<yt.length;++ot)$(typeof tr[yt[ot]]=="number","must specify all vertex attribute locations when using vaos"),ht.push([tr[yt[ot]]|0,yt[ot]]);return ht}}return null}function va(Fe,Ee,at){var Mt=Fe.static,tr=Fe.dynamic;function yt(Be){if(Be in Mt){var kt=Me.id(Mt[Be]);$.optional(function(){en.shader(zh[Be],kt,$.guessCommand())});var Yt=as(function(){return kt});return Yt.id=kt,Yt}else if(Be in tr){var Gr=tr[Be];return gu(Gr,function(gn,yn){var Bn=gn.invoke(yn,Gr),pn=yn.def(gn.shared.strings,".id(",Bn,")");return $.optional(function(){yn(gn.shared.shader,".shader(",zh[Be],",",pn,",",gn.command,");")}),pn})}return null}var ht=yt(Ul),ot=yt(ll),Le=null,qe;return Zo(ht)&&Zo(ot)?(Le=en.program(ot.id,ht.id,null,at),qe=as(function(Be,kt){return Be.link(Le)})):qe=new bs(ht&&ht.thisDep||ot&&ot.thisDep,ht&&ht.contextDep||ot&&ot.contextDep,ht&&ht.propDep||ot&&ot.propDep,function(Be,kt){var Yt=Be.shared.shader,Gr;ht?Gr=ht.append(Be,kt):Gr=kt.def(Yt,".",Ul);var gn;ot?gn=ot.append(Be,kt):gn=kt.def(Yt,".",ll);var yn=Yt+".program("+gn+","+Gr;return $.optional(function(){yn+=","+Be.command}),kt.def(yn+")")}),{frag:ht,vert:ot,progVar:qe,program:Le}}function jo(Fe,Ee){var at=Fe.static,Mt=Fe.dynamic,tr={},yt=!1;function ht(){if(_f in at){var qn=at[_f];return qn!==null&&qr.getVAO(qn)===null&&(qn=qr.createVAO(qn)),yt=!0,tr.vao=qn,as(function(ri){var ii=qr.getVAO(qn);return ii?ri.link(ii):"null"})}else if(_f in Mt){yt=!0;var Rn=Mt[_f];return gu(Rn,function(ri,ii){var ei=ri.invoke(ii,Rn);return ii.def(ri.shared.vao+".getVAO("+ei+")")})}return null}var ot=ht(),Le=!1;function qe(){if(ic in at){var qn=at[ic];if(tr.elements=qn,Af(qn)){var Rn=tr.elements=er.create(qn,!0);qn=er.getElements(Rn),Le=!0}else qn&&(qn=er.getElements(qn),Le=!0,$.command(qn,"invalid elements",Ee.commandStr));var ri=as(function(ei,pi){if(qn){var Oa=ei.link(qn);return ei.ELEMENTS=Oa,Oa}return ei.ELEMENTS=null,null});return ri.value=qn,ri}else if(ic in Mt){Le=!0;var ii=Mt[ic];return gu(ii,function(ei,pi){var Oa=ei.shared,so=Oa.isBufferArgs,uc=Oa.elements,Qa=ei.invoke(pi,ii),wa=pi.def("null"),Ws=pi.def(so,"(",Qa,")"),cl=ei.cond(Ws).then(wa,"=",uc,".createStream(",Qa,");").else(wa,"=",uc,".getElements(",Qa,");");return $.optional(function(){ei.assert(cl.else,"!"+Qa+"||"+wa,"invalid elements")}),pi.entry(cl),pi.exit(ei.cond(Ws).then(uc,".destroyStream(",wa,");")),ei.ELEMENTS=wa,wa})}else if(yt)return new bs(ot.thisDep,ot.contextDep,ot.propDep,function(ei,pi){return pi.def(ei.shared.vao+".currentVAO?"+ei.shared.elements+".getElements("+ei.shared.vao+".currentVAO.elements):null")});return null}var Be=qe();function kt(){if(Wu in at){var qn=at[Wu];return tr.primitive=qn,$.commandParameter(qn,Dr,"invalid primitve",Ee.commandStr),as(function(ri,ii){return Dr[qn]})}else if(Wu in Mt){var Rn=Mt[Wu];return gu(Rn,function(ri,ii){var ei=ri.constants.primTypes,pi=ri.invoke(ii,Rn);return $.optional(function(){ri.assert(ii,pi+" in "+ei,"invalid primitive, must be one of "+Object.keys(Dr))}),ii.def(ei,"[",pi,"]")})}else{if(Le)return Zo(Be)?Be.value?as(function(ri,ii){return ii.def(ri.ELEMENTS,".primType")}):as(function(){return fh}):new bs(Be.thisDep,Be.contextDep,Be.propDep,function(ri,ii){var ei=ri.ELEMENTS;return ii.def(ei,"?",ei,".primType:",fh)});if(yt)return new bs(ot.thisDep,ot.contextDep,ot.propDep,function(ri,ii){return ii.def(ri.shared.vao+".currentVAO?"+ri.shared.vao+".currentVAO.primitive:"+fh)})}return null}function Yt(qn,Rn){if(qn in at){var ri=at[qn]|0;return Rn?tr.offset=ri:tr.instances=ri,$.command(!Rn||ri>=0,"invalid "+qn,Ee.commandStr),as(function(ei,pi){return Rn&&(ei.OFFSET=ri),ri})}else if(qn in Mt){var ii=Mt[qn];return gu(ii,function(ei,pi){var Oa=ei.invoke(pi,ii);return Rn&&(ei.OFFSET=Oa,$.optional(function(){ei.assert(pi,Oa+">=0","invalid "+qn)})),Oa})}else if(Rn){if(Le)return as(function(ei,pi){return ei.OFFSET=0,0});if(yt)return new bs(ot.thisDep,ot.contextDep,ot.propDep,function(ei,pi){return pi.def(ei.shared.vao+".currentVAO?"+ei.shared.vao+".currentVAO.offset:0")})}else if(yt)return new bs(ot.thisDep,ot.contextDep,ot.propDep,function(ei,pi){return pi.def(ei.shared.vao+".currentVAO?"+ei.shared.vao+".currentVAO.instances:-1")});return null}var Gr=Yt(Uf,!0);function gn(){if(hs in at){var qn=at[hs]|0;return tr.count=qn,$.command(typeof qn=="number"&&qn>=0,"invalid vertex count",Ee.commandStr),as(function(){return qn})}else if(hs in Mt){var Rn=Mt[hs];return gu(Rn,function(pi,Oa){var so=pi.invoke(Oa,Rn);return $.optional(function(){pi.assert(Oa,"typeof "+so+'==="number"&&'+so+">=0&&"+so+"===("+so+"|0)","invalid vertex count")}),so})}else if(Le)if(Zo(Be)){if(Be)return Gr?new bs(Gr.thisDep,Gr.contextDep,Gr.propDep,function(pi,Oa){var so=Oa.def(pi.ELEMENTS,".vertCount-",pi.OFFSET);return $.optional(function(){pi.assert(Oa,so+">=0","invalid vertex offset/element buffer too small")}),so}):as(function(pi,Oa){return Oa.def(pi.ELEMENTS,".vertCount")});var ri=as(function(){return-1});return $.optional(function(){ri.MISSING=!0}),ri}else{var ii=new bs(Be.thisDep||Gr.thisDep,Be.contextDep||Gr.contextDep,Be.propDep||Gr.propDep,function(pi,Oa){var so=pi.ELEMENTS;return pi.OFFSET?Oa.def(so,"?",so,".vertCount-",pi.OFFSET,":-1"):Oa.def(so,"?",so,".vertCount:-1")});return $.optional(function(){ii.DYNAMIC=!0}),ii}else if(yt){var ei=new bs(ot.thisDep,ot.contextDep,ot.propDep,function(pi,Oa){return Oa.def(pi.shared.vao,".currentVAO?",pi.shared.vao,".currentVAO.count:-1")});return ei}return null}var yn=kt(),Bn=gn(),pn=Yt(yf,!1);return{elements:Be,primitive:yn,count:Bn,instances:pn,offset:Gr,vao:ot,vaoActive:yt,elementsActive:Le,static:tr}}function Vo(Fe,Ee){var at=Fe.static,Mt=Fe.dynamic,tr={};return ci.forEach(function(yt){var ht=Qn(yt);function ot(Le,qe){if(yt in at){var Be=Le(at[yt]);tr[ht]=as(function(){return Be})}else if(yt in Mt){var kt=Mt[yt];tr[ht]=gu(kt,function(Yt,Gr){return qe(Yt,Gr,Yt.invoke(Gr,kt))})}}switch(yt){case pa:case xt:case Pt:case yo:case Xn:case Nl:case Bo:case Zi:case da:case Ri:return ot(function(Le){return $.commandType(Le,"boolean",yt,Ee.commandStr),Le},function(Le,qe,Be){return $.optional(function(){Le.assert(qe,"typeof "+Be+'==="boolean"',"invalid flag "+yt,Le.commandStr)}),Be});case li:return ot(function(Le){return $.commandParameter(Le,jl,"invalid "+yt,Ee.commandStr),jl[Le]},function(Le,qe,Be){var kt=Le.constants.compareFuncs;return $.optional(function(){Le.assert(qe,Be+" in "+kt,"invalid "+yt+", must be one of "+Object.keys(jl))}),qe.def(kt,"[",Be,"]")});case mi:return ot(function(Le){return $.command(Ma(Le)&&Le.length===2&&typeof Le[0]=="number"&&typeof Le[1]=="number"&&Le[0]<=Le[1],"depth range is 2d array",Ee.commandStr),Le},function(Le,qe,Be){$.optional(function(){Le.assert(qe,Le.shared.isArrayLike+"("+Be+")&&"+Be+".length===2&&typeof "+Be+'[0]==="number"&&typeof '+Be+'[1]==="number"&&'+Be+"[0]<="+Be+"[1]","depth range must be a 2d array")});var kt=qe.def("+",Be,"[0]"),Yt=qe.def("+",Be,"[1]");return[kt,Yt]});case Jn:return ot(function(Le){$.commandType(Le,"object","blend.func",Ee.commandStr);var qe="srcRGB"in Le?Le.srcRGB:Le.src,Be="srcAlpha"in Le?Le.srcAlpha:Le.src,kt="dstRGB"in Le?Le.dstRGB:Le.dst,Yt="dstAlpha"in Le?Le.dstAlpha:Le.dst;return $.commandParameter(qe,Zl,ht+".srcRGB",Ee.commandStr),$.commandParameter(Be,Zl,ht+".srcAlpha",Ee.commandStr),$.commandParameter(kt,Zl,ht+".dstRGB",Ee.commandStr),$.commandParameter(Yt,Zl,ht+".dstAlpha",Ee.commandStr),$.command(Nh.indexOf(qe+", "+kt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+qe+", "+kt+")",Ee.commandStr),[Zl[qe],Zl[kt],Zl[Be],Zl[Yt]]},function(Le,qe,Be){var kt=Le.constants.blendFuncs;$.optional(function(){Le.assert(qe,Be+"&&typeof "+Be+'==="object"',"invalid blend func, must be an object")});function Yt(Rn,ri){var ii=qe.def('"',Rn,ri,'" in ',Be,"?",Be,".",Rn,ri,":",Be,".",Rn);return $.optional(function(){Le.assert(qe,ii+" in "+kt,"invalid "+yt+"."+Rn+ri+", must be one of "+Object.keys(Zl))}),ii}var Gr=Yt("src","RGB"),gn=Yt("dst","RGB");$.optional(function(){var Rn=Le.constants.invalidBlendCombinations;Le.assert(qe,Rn+".indexOf("+Gr+'+", "+'+gn+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var yn=qe.def(kt,"[",Gr,"]"),Bn=qe.def(kt,"[",Yt("src","Alpha"),"]"),pn=qe.def(kt,"[",gn,"]"),qn=qe.def(kt,"[",Yt("dst","Alpha"),"]");return[yn,pn,Bn,qn]});case Vr:return ot(function(Le){if(typeof Le=="string")return $.commandParameter(Le,vr,"invalid "+yt,Ee.commandStr),[vr[Le],vr[Le]];if(typeof Le=="object")return $.commandParameter(Le.rgb,vr,yt+".rgb",Ee.commandStr),$.commandParameter(Le.alpha,vr,yt+".alpha",Ee.commandStr),[vr[Le.rgb],vr[Le.alpha]];$.commandRaise("invalid blend.equation",Ee.commandStr)},function(Le,qe,Be){var kt=Le.constants.blendEquations,Yt=qe.def(),Gr=qe.def(),gn=Le.cond("typeof ",Be,'==="string"');return $.optional(function(){function yn(Bn,pn,qn){Le.assert(Bn,qn+" in "+kt,"invalid "+pn+", must be one of "+Object.keys(vr))}yn(gn.then,yt,Be),Le.assert(gn.else,Be+"&&typeof "+Be+'==="object"',"invalid "+yt),yn(gn.else,yt+".rgb",Be+".rgb"),yn(gn.else,yt+".alpha",Be+".alpha")}),gn.then(Yt,"=",Gr,"=",kt,"[",Be,"];"),gn.else(Yt,"=",kt,"[",Be,".rgb];",Gr,"=",kt,"[",Be,".alpha];"),qe(gn),[Yt,Gr]});case ur:return ot(function(Le){return $.command(Ma(Le)&&Le.length===4,"blend.color must be a 4d array",Ee.commandStr),de(4,function(qe){return+Le[qe]})},function(Le,qe,Be){return $.optional(function(){Le.assert(qe,Le.shared.isArrayLike+"("+Be+")&&"+Be+".length===4","blend.color must be a 4d array")}),de(4,function(kt){return qe.def("+",Be,"[",kt,"]")})});case Pi:return ot(function(Le){return $.commandType(Le,"number",ht,Ee.commandStr),Le|0},function(Le,qe,Be){return $.optional(function(){Le.assert(qe,"typeof "+Be+'==="number"',"invalid stencil.mask")}),qe.def(Be,"|0")});case oo:return ot(function(Le){$.commandType(Le,"object",ht,Ee.commandStr);var qe=Le.cmp||"keep",Be=Le.ref||0,kt="mask"in Le?Le.mask:-1;return $.commandParameter(qe,jl,yt+".cmp",Ee.commandStr),$.commandType(Be,"number",yt+".ref",Ee.commandStr),$.commandType(kt,"number",yt+".mask",Ee.commandStr),[jl[qe],Be,kt]},function(Le,qe,Be){var kt=Le.constants.compareFuncs;$.optional(function(){function yn(){Le.assert(qe,Array.prototype.join.call(arguments,""),"invalid stencil.func")}yn(Be+"&&typeof ",Be,'==="object"'),yn('!("cmp" in ',Be,")||(",Be,".cmp in ",kt,")")});var Yt=qe.def('"cmp" in ',Be,"?",kt,"[",Be,".cmp]",":",wc),Gr=qe.def(Be,".ref|0"),gn=qe.def('"mask" in ',Be,"?",Be,".mask|0:-1");return[Yt,Gr,gn]});case Ga:case Hs:return ot(function(Le){$.commandType(Le,"object",ht,Ee.commandStr);var qe=Le.fail||"keep",Be=Le.zfail||"keep",kt=Le.zpass||"keep";return $.commandParameter(qe,oc,yt+".fail",Ee.commandStr),$.commandParameter(Be,oc,yt+".zfail",Ee.commandStr),$.commandParameter(kt,oc,yt+".zpass",Ee.commandStr),[yt===Hs?mu:Uc,oc[qe],oc[Be],oc[kt]]},function(Le,qe,Be){var kt=Le.constants.stencilOps;$.optional(function(){Le.assert(qe,Be+"&&typeof "+Be+'==="object"',"invalid "+yt)});function Yt(Gr){return $.optional(function(){Le.assert(qe,'!("'+Gr+'" in '+Be+")||("+Be+"."+Gr+" in "+kt+")","invalid "+yt+"."+Gr+", must be one of "+Object.keys(oc))}),qe.def('"',Gr,'" in ',Be,"?",kt,"[",Be,".",Gr,"]:",wc)}return[yt===Hs?mu:Uc,Yt("fail"),Yt("zfail"),Yt("zpass")]});case ka:return ot(function(Le){$.commandType(Le,"object",ht,Ee.commandStr);var qe=Le.factor|0,Be=Le.units|0;return $.commandType(qe,"number",ht+".factor",Ee.commandStr),$.commandType(Be,"number",ht+".units",Ee.commandStr),[qe,Be]},function(Le,qe,Be){$.optional(function(){Le.assert(qe,Be+"&&typeof "+Be+'==="object"',"invalid "+yt)});var kt=qe.def(Be,".factor|0"),Yt=qe.def(Be,".units|0");return[kt,Yt]});case ba:return ot(function(Le){var qe=0;return Le==="front"?qe=Uc:Le==="back"&&(qe=mu),$.command(!!qe,ht,Ee.commandStr),qe},function(Le,qe,Be){return $.optional(function(){Le.assert(qe,Be+'==="front"||'+Be+'==="back"',"invalid cull.face")}),qe.def(Be,'==="front"?',Uc,":",mu)});case Ca:return ot(function(Le){return $.command(typeof Le=="number"&&Le>=ir.lineWidthDims[0]&&Le<=ir.lineWidthDims[1],"invalid line width, must be a positive number between "+ir.lineWidthDims[0]+" and "+ir.lineWidthDims[1],Ee.commandStr),Le},function(Le,qe,Be){return $.optional(function(){Le.assert(qe,"typeof "+Be+'==="number"&&'+Be+">="+ir.lineWidthDims[0]+"&&"+Be+"<="+ir.lineWidthDims[1],"invalid line width")}),Be});case go:return ot(function(Le){return $.commandParameter(Le,dh,ht,Ee.commandStr),dh[Le]},function(Le,qe,Be){return $.optional(function(){Le.assert(qe,Be+'==="cw"||'+Be+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),qe.def(Be+'==="cw"?'+Dh+":"+hh)});case aa:return ot(function(Le){return $.command(Ma(Le)&&Le.length===4,"color.mask must be length 4 array",Ee.commandStr),Le.map(function(qe){return!!qe})},function(Le,qe,Be){return $.optional(function(){Le.assert(qe,Le.shared.isArrayLike+"("+Be+")&&"+Be+".length===4","invalid color.mask")}),de(4,function(kt){return"!!"+Be+"["+kt+"]"})});case $a:return ot(function(Le){$.command(typeof Le=="object"&&Le,ht,Ee.commandStr);var qe="value"in Le?Le.value:1,Be=!!Le.invert;return $.command(typeof qe=="number"&&qe>=0&&qe<=1,"sample.coverage.value must be a number between 0 and 1",Ee.commandStr),[qe,Be]},function(Le,qe,Be){$.optional(function(){Le.assert(qe,Be+"&&typeof "+Be+'==="object"',"invalid sample.coverage")});var kt=qe.def('"value" in ',Be,"?+",Be,".value:1"),Yt=qe.def("!!",Be,".invert");return[kt,Yt]})}}),tr}function la(Fe,Ee){var at=Fe.static,Mt=Fe.dynamic,tr={};return Object.keys(at).forEach(function(yt){var ht=at[yt],ot;if(typeof ht=="number"||typeof ht=="boolean")ot=as(function(){return ht});else if(typeof ht=="function"){var Le=ht._reglType;Le==="texture2d"||Le==="textureCube"?ot=as(function(qe){return qe.link(ht)}):Le==="framebuffer"||Le==="framebufferCube"?($.command(ht.color.length>0,'missing color attachment for framebuffer sent to uniform "'+yt+'"',Ee.commandStr),ot=as(function(qe){return qe.link(ht.color[0])})):$.commandRaise('invalid data for uniform "'+yt+'"',Ee.commandStr)}else Ma(ht)?ot=as(function(qe){var Be=qe.global.def("[",de(ht.length,function(kt){return $.command(typeof ht[kt]=="number"||typeof ht[kt]=="boolean","invalid uniform "+yt,qe.commandStr),ht[kt]}),"]");return Be}):$.commandRaise('invalid or missing data for uniform "'+yt+'"',Ee.commandStr);ot.value=ht,tr[yt]=ot}),Object.keys(Mt).forEach(function(yt){var ht=Mt[yt];tr[yt]=gu(ht,function(ot,Le){return ot.invoke(Le,ht)})}),tr}function Ss(Fe,Ee){var at=Fe.static,Mt=Fe.dynamic,tr={};return Object.keys(at).forEach(function(yt){var ht=at[yt],ot=Me.id(yt),Le=new Ot;if(Af(ht))Le.state=vi,Le.buffer=Fr.getBuffer(Fr.create(ht,nf,!1,!0)),Le.type=0;else{var qe=Fr.getBuffer(ht);if(qe)Le.state=vi,Le.buffer=qe,Le.type=0;else if($.command(typeof ht=="object"&&ht,"invalid data for attribute "+yt,Ee.commandStr),"constant"in ht){var Be=ht.constant;Le.buffer="null",Le.state=Ci,typeof Be=="number"?Le.x=Be:($.command(Ma(Be)&&Be.length>0&&Be.length<=4,"invalid constant for attribute "+yt,Ee.commandStr),xi.forEach(function(pn,qn){qn<Be.length&&(Le[pn]=Be[qn])}))}else{Af(ht.buffer)?qe=Fr.getBuffer(Fr.create(ht.buffer,nf,!1,!0)):qe=Fr.getBuffer(ht.buffer),$.command(!!qe,'missing buffer for attribute "'+yt+'"',Ee.commandStr);var kt=ht.offset|0;$.command(kt>=0,'invalid offset for attribute "'+yt+'"',Ee.commandStr);var Yt=ht.stride|0;$.command(Yt>=0&&Yt<256,'invalid stride for attribute "'+yt+'", must be integer betweeen [0, 255]',Ee.commandStr);var Gr=ht.size|0;$.command(!("size"in ht)||Gr>0&&Gr<=4,'invalid size for attribute "'+yt+'", must be 1,2,3,4',Ee.commandStr);var gn=!!ht.normalized,yn=0;"type"in ht&&($.commandParameter(ht.type,$s,"invalid type for attribute "+yt,Ee.commandStr),yn=$s[ht.type]);var Bn=ht.divisor|0;$.optional(function(){"divisor"in ht&&($.command(Bn===0||Jr,'cannot specify divisor for attribute "'+yt+'", instancing not supported',Ee.commandStr),$.command(Bn>=0,'invalid divisor for attribute "'+yt+'"',Ee.commandStr));var pn=Ee.commandStr,qn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(ht).forEach(function(Rn){$.command(qn.indexOf(Rn)>=0,'unknown parameter "'+Rn+'" for attribute pointer "'+yt+'" (valid parameters are '+qn+")",pn)})}),Le.buffer=qe,Le.state=vi,Le.size=Gr,Le.normalized=gn,Le.type=yn||qe.dtype,Le.offset=kt,Le.stride=Yt,Le.divisor=Bn}}tr[yt]=as(function(pn,qn){var Rn=pn.attribCache;if(ot in Rn)return Rn[ot];var ri={isStream:!1};return Object.keys(Le).forEach(function(ii){ri[ii]=Le[ii]}),Le.buffer&&(ri.buffer=pn.link(Le.buffer),ri.type=ri.type||ri.buffer+".dtype"),Rn[ot]=ri,ri})}),Object.keys(Mt).forEach(function(yt){var ht=Mt[yt];function ot(Le,qe){var Be=Le.invoke(qe,ht),kt=Le.shared,Yt=Le.constants,Gr=kt.isBufferArgs,gn=kt.buffer;$.optional(function(){Le.assert(qe,Be+"&&(typeof "+Be+'==="object"||typeof '+Be+'==="function")&&('+Gr+"("+Be+")||"+gn+".getBuffer("+Be+")||"+gn+".getBuffer("+Be+".buffer)||"+Gr+"("+Be+'.buffer)||("constant" in '+Be+"&&(typeof "+Be+'.constant==="number"||'+kt.isArrayLike+"("+Be+".constant))))",'invalid dynamic attribute "'+yt+'"')});var yn={isStream:qe.def(!1)},Bn=new Ot;Bn.state=vi,Object.keys(Bn).forEach(function(ri){yn[ri]=qe.def(""+Bn[ri])});var pn=yn.buffer,qn=yn.type;qe("if(",Gr,"(",Be,")){",yn.isStream,"=true;",pn,"=",gn,".createStream(",nf,",",Be,");",qn,"=",pn,".dtype;","}else{",pn,"=",gn,".getBuffer(",Be,");","if(",pn,"){",qn,"=",pn,".dtype;",'}else if("constant" in ',Be,"){",yn.state,"=",Ci,";","if(typeof "+Be+'.constant === "number"){',yn[xi[0]],"=",Be,".constant;",xi.slice(1).map(function(ri){return yn[ri]}).join("="),"=0;","}else{",xi.map(function(ri,ii){return yn[ri]+"="+Be+".constant.length>"+ii+"?"+Be+".constant["+ii+"]:0;"}).join(""),"}}else{","if(",Gr,"(",Be,".buffer)){",pn,"=",gn,".createStream(",nf,",",Be,".buffer);","}else{",pn,"=",gn,".getBuffer(",Be,".buffer);","}",qn,'="type" in ',Be,"?",Yt.glTypes,"[",Be,".type]:",pn,".dtype;",yn.normalized,"=!!",Be,".normalized;");function Rn(ri){qe(yn[ri],"=",Be,".",ri,"|0;")}return Rn("size"),Rn("offset"),Rn("stride"),Rn("divisor"),qe("}}"),qe.exit("if(",yn.isStream,"){",gn,".destroyStream(",pn,");","}"),yn}tr[yt]=gu(ht,ot)}),tr}function _o(Fe){var Ee=Fe.static,at=Fe.dynamic,Mt={};return Object.keys(Ee).forEach(function(tr){var yt=Ee[tr];Mt[tr]=as(function(ht,ot){return typeof yt=="number"||typeof yt=="boolean"?""+yt:ht.link(yt)})}),Object.keys(at).forEach(function(tr){var yt=at[tr];Mt[tr]=gu(yt,function(ht,ot){return ht.invoke(ot,yt)})}),Mt}function Is(Fe,Ee,at,Mt,tr){var yt=Fe.static,ht=Fe.dynamic;$.optional(function(){var Rn=[zl,ll,Ul,ic,Wu,Uf,hs,yf,Ru,_f].concat(ci);function ri(ii){Object.keys(ii).forEach(function(ei){$.command(Rn.indexOf(ei)>=0,'unknown parameter "'+ei+'"',tr.commandStr)})}ri(yt),ri(ht)});var ot=zi(Fe,Ee),Le=Fn(Fe,tr),qe=Ti(Fe,Le,tr),Be=jo(Fe,tr),kt=Vo(Fe,tr),Yt=va(Fe,tr,ot);function Gr(Rn){var ri=qe[Rn];ri&&(kt[Rn]=ri)}Gr(Lu),Gr(Qn(Bs));var gn=Object.keys(kt).length>0,yn={framebuffer:Le,draw:Be,shader:Yt,state:kt,dirty:gn,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(yn.profile=kn(Fe,tr),yn.uniforms=la(at,tr),yn.drawVAO=yn.scopeVAO=Be.vao,!yn.drawVAO&&Yt.program&&!ot&&Je.angle_instanced_arrays&&Be.static.elements){var Bn=!0,pn=Yt.program.attributes.map(function(Rn){var ri=Ee.static[Rn];return Bn=Bn&&!!ri,ri});if(Bn&&pn.length>0){var qn=qr.getVAO(qr.createVAO({attributes:pn,elements:Be.static.elements}));yn.drawVAO=new bs(null,null,null,function(Rn,ri){return Rn.link(qn)}),yn.useVAO=!0}}return ot?yn.useVAO=!0:yn.attributes=Ss(Ee,tr),yn.context=_o(Mt,tr),yn}function Go(Fe,Ee,at){var Mt=Fe.shared,tr=Mt.context,yt=Fe.scope();Object.keys(at).forEach(function(ht){Ee.save(tr,"."+ht);var ot=at[ht],Le=ot.append(Fe,Ee);Array.isArray(Le)?yt(tr,".",ht,"=[",Le.join(),"];"):yt(tr,".",ht,"=",Le,";")}),Ee(yt)}function os(Fe,Ee,at,Mt){var tr=Fe.shared,yt=tr.gl,ht=tr.framebuffer,ot;Tn&&(ot=Ee.def(tr.extensions,".webgl_draw_buffers"));var Le=Fe.constants,qe=Le.drawBuffer,Be=Le.backBuffer,kt;at?kt=at.append(Fe,Ee):kt=Ee.def(ht,".next"),Mt||Ee("if(",kt,"!==",ht,".cur){"),Ee("if(",kt,"){",yt,".bindFramebuffer(",Xu,",",kt,".framebuffer);"),Tn&&Ee(ot,".drawBuffersWEBGL(",qe,"[",kt,".colorAttachments.length]);"),Ee("}else{",yt,".bindFramebuffer(",Xu,",null);"),Tn&&Ee(ot,".drawBuffersWEBGL(",Be,");"),Ee("}",ht,".cur=",kt,";"),Mt||Ee("}")}function ps(Fe,Ee,at){var Mt=Fe.shared,tr=Mt.gl,yt=Fe.current,ht=Fe.next,ot=Mt.current,Le=Mt.next,qe=Fe.cond(ot,".dirty");ci.forEach(function(Be){var kt=Qn(Be);if(!(kt in at.state)){var Yt,Gr;if(kt in ht){Yt=ht[kt],Gr=yt[kt];var gn=de(Pn[kt].length,function(Bn){return qe.def(Yt,"[",Bn,"]")});qe(Fe.cond(gn.map(function(Bn,pn){return Bn+"!=="+Gr+"["+pn+"]"}).join("||")).then(tr,".",wr[kt],"(",gn,");",gn.map(function(Bn,pn){return Gr+"["+pn+"]="+Bn}).join(";"),";"))}else{Yt=qe.def(Le,".",kt);var yn=Fe.cond(Yt,"!==",ot,".",kt);qe(yn),kt in Rr?yn(Fe.cond(Yt).then(tr,".enable(",Rr[kt],");").else(tr,".disable(",Rr[kt],");"),ot,".",kt,"=",Yt,";"):yn(tr,".",wr[kt],"(",Yt,");",ot,".",kt,"=",Yt,";")}}}),Object.keys(at.state).length===0&&qe(ot,".dirty=false;"),Ee(qe)}function Os(Fe,Ee,at,Mt){var tr=Fe.shared,yt=Fe.current,ht=tr.current,ot=tr.gl;Uh(Object.keys(at)).forEach(function(Le){var qe=at[Le];if(!(Mt&&!Mt(qe))){var Be=qe.append(Fe,Ee);if(Rr[Le]){var kt=Rr[Le];Zo(qe)?Be?Ee(ot,".enable(",kt,");"):Ee(ot,".disable(",kt,");"):Ee(Fe.cond(Be).then(ot,".enable(",kt,");").else(ot,".disable(",kt,");")),Ee(ht,".",Le,"=",Be,";")}else if(Ma(Be)){var Yt=yt[Le];Ee(ot,".",wr[Le],"(",Be,");",Be.map(function(Gr,gn){return Yt+"["+gn+"]="+Gr}).join(";"),";")}else Ee(ot,".",wr[Le],"(",Be,");",ht,".",Le,"=",Be,";")}})}function $o(Fe,Ee){Jr&&(Fe.instancing=Ee.def(Fe.shared.extensions,".angle_instanced_arrays"))}function Ji(Fe,Ee,at,Mt,tr){var yt=Fe.shared,ht=Fe.stats,ot=yt.current,Le=yt.timer,qe=at.profile;function Be(){var Rn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return Rn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var kt,Yt;function Gr(Rn){kt=Ee.def(),Rn(kt,"=",Be(),";"),typeof tr=="string"?Rn(ht,".count+=",tr,";"):Rn(ht,".count++;"),$r&&(Mt?(Yt=Ee.def(),Rn(Yt,"=",Le,".getNumPendingQueries();")):Rn(Le,".beginQuery(",ht,");"))}function gn(Rn){Rn(ht,".cpuTime+=",Be(),"-",kt,";"),$r&&(Mt?Rn(Le,".pushScopeStats(",Yt,",",Le,".getNumPendingQueries(),",ht,");"):Rn(Le,".endQuery();"))}function yn(Rn){var ri=Ee.def(ot,".profile");Ee(ot,".profile=",Rn,";"),Ee.exit(ot,".profile=",ri,";")}var Bn;if(qe){if(Zo(qe)){qe.enable?(Gr(Ee),gn(Ee.exit),yn("true")):yn("false");return}Bn=qe.append(Fe,Ee),yn(Bn)}else Bn=Ee.def(ot,".profile");var pn=Fe.block();Gr(pn),Ee("if(",Bn,"){",pn,"}");var qn=Fe.block();gn(qn),Ee.exit("if(",Bn,"){",qn,"}")}function Es(Fe,Ee,at,Mt,tr){var yt=Fe.shared;function ht(Le){switch(Le){case xf:case sf:case uf:return 2;case of:case Hf:case Wf:return 3;case Sc:case Ec:case lf:return 4;default:return 1}}function ot(Le,qe,Be){var kt=yt.gl,Yt=Ee.def(Le,".location"),Gr=Ee.def(yt.attributes,"[",Yt,"]"),gn=Be.state,yn=Be.buffer,Bn=[Be.x,Be.y,Be.z,Be.w],pn=["buffer","normalized","offset","stride"];function qn(){Ee("if(!",Gr,".buffer){",kt,".enableVertexAttribArray(",Yt,");}");var ri=Be.type,ii;if(Be.size?ii=Ee.def(Be.size,"||",qe):ii=qe,Ee("if(",Gr,".type!==",ri,"||",Gr,".size!==",ii,"||",pn.map(function(pi){return Gr+"."+pi+"!=="+Be[pi]}).join("||"),"){",kt,".bindBuffer(",nf,",",yn,".buffer);",kt,".vertexAttribPointer(",[Yt,ii,ri,Be.normalized,Be.stride,Be.offset],");",Gr,".type=",ri,";",Gr,".size=",ii,";",pn.map(function(pi){return Gr+"."+pi+"="+Be[pi]+";"}).join(""),"}"),Jr){var ei=Be.divisor;Ee("if(",Gr,".divisor!==",ei,"){",Fe.instancing,".vertexAttribDivisorANGLE(",[Yt,ei],");",Gr,".divisor=",ei,";}")}}function Rn(){Ee("if(",Gr,".buffer){",kt,".disableVertexAttribArray(",Yt,");",Gr,".buffer=null;","}if(",xi.map(function(ri,ii){return Gr+"."+ri+"!=="+Bn[ii]}).join("||"),"){",kt,".vertexAttrib4f(",Yt,",",Bn,");",xi.map(function(ri,ii){return Gr+"."+ri+"="+Bn[ii]+";"}).join(""),"}")}gn===vi?qn():gn===Ci?Rn():(Ee("if(",gn,"===",vi,"){"),qn(),Ee("}else{"),Rn(),Ee("}"))}Mt.forEach(function(Le){var qe=Le.name,Be=at.attributes[qe],kt;if(Be){if(!tr(Be))return;kt=Be.append(Fe,Ee)}else{if(!tr(Xf))return;var Yt=Fe.scopeAttrib(qe);$.optional(function(){Fe.assert(Ee,Yt+".state","missing attribute "+qe)}),kt={},Object.keys(new Ot).forEach(function(Gr){kt[Gr]=Ee.def(Yt,".",Gr)})}ot(Fe.link(Le),ht(Le.info.type),kt)})}function Fa(Fe,Ee,at,Mt,tr,yt){for(var ht=Fe.shared,ot=ht.gl,Le,qe=0;qe<Mt.length;++qe){var Be=Mt[qe],kt=Be.name,Yt=Be.info.type,Gr=at.uniforms[kt],gn=Fe.link(Be),yn=gn+".location",Bn;if(Gr){if(!tr(Gr))continue;if(Zo(Gr)){var pn=Gr.value;if($.command(pn!==null&&typeof pn!="undefined",'missing uniform "'+kt+'"',Fe.commandStr),Yt===Ef||Yt===Cf){$.command(typeof pn=="function"&&(Yt===Ef&&(pn._reglType==="texture2d"||pn._reglType==="framebuffer")||Yt===Cf&&(pn._reglType==="textureCube"||pn._reglType==="framebufferCube")),"invalid texture for uniform "+kt,Fe.commandStr);var qn=Fe.link(pn._texture||pn.color[0]._texture);Ee(ot,".uniform1i(",yn,",",qn+".bind());"),Ee.exit(qn,".unbind();")}else if(Yt===Cc||Yt===Au||Yt===Sf){$.optional(function(){$.command(Ma(pn),"invalid matrix for uniform "+kt,Fe.commandStr),$.command(Yt===Cc&&pn.length===4||Yt===Au&&pn.length===9||Yt===Sf&&pn.length===16,"invalid length for matrix uniform "+kt,Fe.commandStr)});var Rn=Fe.global.def("new Float32Array(["+Array.prototype.slice.call(pn)+"])"),ri=2;Yt===Au?ri=3:Yt===Sf&&(ri=4),Ee(ot,".uniformMatrix",ri,"fv(",yn,",false,",Rn,");")}else{switch(Yt){case zc:$.commandType(pn,"number","uniform "+kt,Fe.commandStr),Le="1f";break;case xf:$.command(Ma(pn)&&pn.length===2,"uniform "+kt,Fe.commandStr),Le="2f";break;case of:$.command(Ma(pn)&&pn.length===3,"uniform "+kt,Fe.commandStr),Le="3f";break;case Sc:$.command(Ma(pn)&&pn.length===4,"uniform "+kt,Fe.commandStr),Le="4f";break;case ch:$.commandType(pn,"boolean","uniform "+kt,Fe.commandStr),Le="1i";break;case bf:$.commandType(pn,"number","uniform "+kt,Fe.commandStr),Le="1i";break;case uf:$.command(Ma(pn)&&pn.length===2,"uniform "+kt,Fe.commandStr),Le="2i";break;case sf:$.command(Ma(pn)&&pn.length===2,"uniform "+kt,Fe.commandStr),Le="2i";break;case Wf:$.command(Ma(pn)&&pn.length===3,"uniform "+kt,Fe.commandStr),Le="3i";break;case Hf:$.command(Ma(pn)&&pn.length===3,"uniform "+kt,Fe.commandStr),Le="3i";break;case lf:$.command(Ma(pn)&&pn.length===4,"uniform "+kt,Fe.commandStr),Le="4i";break;case Ec:$.command(Ma(pn)&&pn.length===4,"uniform "+kt,Fe.commandStr),Le="4i";break}Ee(ot,".uniform",Le,"(",yn,",",Ma(pn)?Array.prototype.slice.call(pn):pn,");")}continue}else Bn=Gr.append(Fe,Ee)}else{if(!tr(Xf))continue;Bn=Ee.def(ht.uniforms,"[",Me.id(kt),"]")}Yt===Ef?($(!Array.isArray(Bn),"must specify a scalar prop for textures"),Ee("if(",Bn,"&&",Bn,'._reglType==="framebuffer"){',Bn,"=",Bn,".color[0];","}")):Yt===Cf&&($(!Array.isArray(Bn),"must specify a scalar prop for cube maps"),Ee("if(",Bn,"&&",Bn,'._reglType==="framebufferCube"){',Bn,"=",Bn,".color[0];","}")),$.optional(function(){function Ws(hl,Yf){Fe.assert(Ee,hl,'bad data or missing for uniform "'+kt+'".  '+Yf)}function cl(hl){$(!Array.isArray(Bn),"must not specify an array type for uniform"),Ws("typeof "+Bn+'==="'+hl+'"',"invalid type, expected "+hl)}function fl(hl,Yf){Array.isArray(Bn)?$(Bn.length===hl,"must have length "+hl):Ws(ht.isArrayLike+"("+Bn+")&&"+Bn+".length==="+hl,"invalid vector, should have length "+hl,Fe.commandStr)}function mh(hl){$(!Array.isArray(Bn),"must not specify a value type"),Ws("typeof "+Bn+'==="function"&&'+Bn+'._reglType==="texture'+(hl===Rh?"2d":"Cube")+'"',"invalid texture type",Fe.commandStr)}switch(Yt){case bf:cl("number");break;case sf:fl(2,"number");break;case Hf:fl(3,"number");break;case Ec:fl(4,"number");break;case zc:cl("number");break;case xf:fl(2,"number");break;case of:fl(3,"number");break;case Sc:fl(4,"number");break;case ch:cl("boolean");break;case uf:fl(2,"boolean");break;case Wf:fl(3,"boolean");break;case lf:fl(4,"boolean");break;case Cc:fl(4,"number");break;case Au:fl(9,"number");break;case Sf:fl(16,"number");break;case Ef:mh(Rh);break;case Cf:mh(mp);break}});var ii=1;switch(Yt){case Ef:case Cf:var ei=Ee.def(Bn,"._texture");Ee(ot,".uniform1i(",yn,",",ei,".bind());"),Ee.exit(ei,".unbind();");continue;case bf:case ch:Le="1i";break;case sf:case uf:Le="2i",ii=2;break;case Hf:case Wf:Le="3i",ii=3;break;case Ec:case lf:Le="4i",ii=4;break;case zc:Le="1f";break;case xf:Le="2f",ii=2;break;case of:Le="3f",ii=3;break;case Sc:Le="4f",ii=4;break;case Cc:Le="Matrix2fv";break;case Au:Le="Matrix3fv";break;case Sf:Le="Matrix4fv";break}if(Le.charAt(0)==="M"){Ee(ot,".uniform",Le,"(",yn,",");var pi=Math.pow(Yt-Cc+2,2),Oa=Fe.global.def("new Float32Array(",pi,")");Array.isArray(Bn)?Ee("false,(",de(pi,function(Ws){return Oa+"["+Ws+"]="+Bn[Ws]}),",",Oa,")"):Ee("false,(Array.isArray(",Bn,")||",Bn," instanceof Float32Array)?",Bn,":(",de(pi,function(Ws){return Oa+"["+Ws+"]="+Bn+"["+Ws+"]"}),",",Oa,")"),Ee(");")}else if(ii>1){for(var so=[],uc=[],Qa=0;Qa<ii;++Qa)Array.isArray(Bn)?uc.push(Bn[Qa]):uc.push(Ee.def(Bn+"["+Qa+"]")),yt&&so.push(Ee.def());yt&&Ee("if(!",Fe.batchId,"||",so.map(function(Ws,cl){return Ws+"!=="+uc[cl]}).join("||"),"){",so.map(function(Ws,cl){return Ws+"="+uc[cl]+";"}).join("")),Ee(ot,".uniform",Le,"(",yn,",",uc.join(","),");"),yt&&Ee("}")}else{if($(!Array.isArray(Bn),"uniform value must not be an array"),yt){var wa=Ee.def();Ee("if(!",Fe.batchId,"||",wa,"!==",Bn,"){",wa,"=",Bn,";")}Ee(ot,".uniform",Le,"(",yn,",",Bn,");"),yt&&Ee("}")}}}function Oo(Fe,Ee,at,Mt){var tr=Fe.shared,yt=tr.gl,ht=tr.draw,ot=Mt.draw;function Le(){var ii=ot.elements,ei,pi=Ee;return ii?((ii.contextDep&&Mt.contextDynamic||ii.propDep)&&(pi=at),ei=ii.append(Fe,pi),ot.elementsActive&&pi("if("+ei+")"+yt+".bindBuffer("+sh+","+ei+".buffer.buffer);")):(ei=pi.def(),pi(ei,"=",ht,".",ic,";","if(",ei,"){",yt,".bindBuffer(",sh,",",ei,".buffer.buffer);}","else if(",tr.vao,".currentVAO){",ei,"=",Fe.shared.elements+".getElements("+tr.vao,".currentVAO.elements);",Lr?"":"if("+ei+")"+yt+".bindBuffer("+sh+","+ei+".buffer.buffer);","}")),ei}function qe(){var ii=ot.count,ei,pi=Ee;return ii?((ii.contextDep&&Mt.contextDynamic||ii.propDep)&&(pi=at),ei=ii.append(Fe,pi),$.optional(function(){ii.MISSING&&Fe.assert(Ee,"false","missing vertex count"),ii.DYNAMIC&&Fe.assert(pi,ei+">=0","missing vertex count")})):(ei=pi.def(ht,".",hs),$.optional(function(){Fe.assert(pi,ei+">=0","missing vertex count")})),ei}var Be=Le();function kt(ii){var ei=ot[ii];return ei?ei.contextDep&&Mt.contextDynamic||ei.propDep?ei.append(Fe,at):ei.append(Fe,Ee):Ee.def(ht,".",ii)}var Yt=kt(Wu),Gr=kt(Uf),gn=qe();if(typeof gn=="number"){if(gn===0)return}else at("if(",gn,"){"),at.exit("}");var yn,Bn;Jr&&(yn=kt(yf),Bn=Fe.instancing);var pn=Be+".type",qn=ot.elements&&Zo(ot.elements)&&!ot.vaoActive;function Rn(){function ii(){at(Bn,".drawElementsInstancedANGLE(",[Yt,gn,pn,Gr+"<<(("+pn+"-"+ji+")>>1)",yn],");")}function ei(){at(Bn,".drawArraysInstancedANGLE(",[Yt,Gr,gn,yn],");")}Be&&Be!=="null"?qn?ii():(at("if(",Be,"){"),ii(),at("}else{"),ei(),at("}")):ei()}function ri(){function ii(){at(yt+".drawElements("+[Yt,gn,pn,Gr+"<<(("+pn+"-"+ji+")>>1)"]+");")}function ei(){at(yt+".drawArrays("+[Yt,Gr,gn]+");")}Be&&Be!=="null"?qn?ii():(at("if(",Be,"){"),ii(),at("}else{"),ei(),at("}")):ei()}Jr&&(typeof yn!="number"||yn>=0)?typeof yn=="string"?(at("if(",yn,">0){"),Rn(),at("}else if(",yn,"<0){"),ri(),at("}")):Rn():ri()}function Mi(Fe,Ee,at,Mt,tr){var yt=ki(),ht=yt.proc("body",tr);return $.optional(function(){yt.commandStr=Ee.commandStr,yt.command=yt.link(Ee.commandStr)}),Jr&&(yt.instancing=ht.def(yt.shared.extensions,".angle_instanced_arrays")),Fe(yt,ht,at,Mt),yt.compile().body}function ca(Fe,Ee,at,Mt){$o(Fe,Ee),at.useVAO?at.drawVAO?Ee(Fe.shared.vao,".setVAO(",at.drawVAO.append(Fe,Ee),");"):Ee(Fe.shared.vao,".setVAO(",Fe.shared.vao,".targetVAO);"):(Ee(Fe.shared.vao,".setVAO(null);"),Es(Fe,Ee,at,Mt.attributes,function(){return!0})),Fa(Fe,Ee,at,Mt.uniforms,function(){return!0},!1),Oo(Fe,Ee,Ee,at)}function Ha(Fe,Ee){var at=Fe.proc("draw",1);$o(Fe,at),Go(Fe,at,Ee.context),os(Fe,at,Ee.framebuffer),ps(Fe,at,Ee),Os(Fe,at,Ee.state),Ji(Fe,at,Ee,!1,!0);var Mt=Ee.shader.progVar.append(Fe,at);if(at(Fe.shared.gl,".useProgram(",Mt,".program);"),Ee.shader.program)ca(Fe,at,Ee,Ee.shader.program);else{at(Fe.shared.vao,".setVAO(null);");var tr=Fe.global.def("{}"),yt=at.def(Mt,".id"),ht=at.def(tr,"[",yt,"]");at(Fe.cond(ht).then(ht,".call(this,a0);").else(ht,"=",tr,"[",yt,"]=",Fe.link(function(ot){return Mi(ca,Fe,Ee,ot,1)}),"(",Mt,");",ht,".call(this,a0);"))}Object.keys(Ee.state).length>0&&at(Fe.shared.current,".dirty=true;"),Fe.shared.vao&&at(Fe.shared.vao,".setVAO(null);")}function Lo(Fe,Ee,at,Mt){Fe.batchId="a1",$o(Fe,Ee);function tr(){return!0}Es(Fe,Ee,at,Mt.attributes,tr),Fa(Fe,Ee,at,Mt.uniforms,tr,!1),Oo(Fe,Ee,Ee,at)}function Vl(Fe,Ee,at,Mt){$o(Fe,Ee);var tr=at.contextDep,yt=Ee.def(),ht="a0",ot="a1",Le=Ee.def();Fe.shared.props=Le,Fe.batchId=yt;var qe=Fe.scope(),Be=Fe.scope();Ee(qe.entry,"for(",yt,"=0;",yt,"<",ot,";++",yt,"){",Le,"=",ht,"[",yt,"];",Be,"}",qe.exit);function kt(pn){return pn.contextDep&&tr||pn.propDep}function Yt(pn){return!kt(pn)}if(at.needsContext&&Go(Fe,Be,at.context),at.needsFramebuffer&&os(Fe,Be,at.framebuffer),Os(Fe,Be,at.state,kt),at.profile&&kt(at.profile)&&Ji(Fe,Be,at,!1,!0),Mt)at.useVAO?at.drawVAO?kt(at.drawVAO)?Be(Fe.shared.vao,".setVAO(",at.drawVAO.append(Fe,Be),");"):qe(Fe.shared.vao,".setVAO(",at.drawVAO.append(Fe,qe),");"):qe(Fe.shared.vao,".setVAO(",Fe.shared.vao,".targetVAO);"):(qe(Fe.shared.vao,".setVAO(null);"),Es(Fe,qe,at,Mt.attributes,Yt),Es(Fe,Be,at,Mt.attributes,kt)),Fa(Fe,qe,at,Mt.uniforms,Yt,!1),Fa(Fe,Be,at,Mt.uniforms,kt,!0),Oo(Fe,qe,Be,at);else{var Gr=Fe.global.def("{}"),gn=at.shader.progVar.append(Fe,Be),yn=Be.def(gn,".id"),Bn=Be.def(Gr,"[",yn,"]");Be(Fe.shared.gl,".useProgram(",gn,".program);","if(!",Bn,"){",Bn,"=",Gr,"[",yn,"]=",Fe.link(function(pn){return Mi(Lo,Fe,at,pn,2)}),"(",gn,");}",Bn,".call(this,a0[",yt,"],",yt,");")}}function je(Fe,Ee){var at=Fe.proc("batch",2);Fe.batchId="0",$o(Fe,at);var Mt=!1,tr=!0;Object.keys(Ee.context).forEach(function(Gr){Mt=Mt||Ee.context[Gr].propDep}),Mt||(Go(Fe,at,Ee.context),tr=!1);var yt=Ee.framebuffer,ht=!1;yt?(yt.propDep?Mt=ht=!0:yt.contextDep&&Mt&&(ht=!0),ht||os(Fe,at,yt)):os(Fe,at,null),Ee.state.viewport&&Ee.state.viewport.propDep&&(Mt=!0);function ot(Gr){return Gr.contextDep&&Mt||Gr.propDep}ps(Fe,at,Ee),Os(Fe,at,Ee.state,function(Gr){return!ot(Gr)}),(!Ee.profile||!ot(Ee.profile))&&Ji(Fe,at,Ee,!1,"a1"),Ee.contextDep=Mt,Ee.needsContext=tr,Ee.needsFramebuffer=ht;var Le=Ee.shader.progVar;if(Le.contextDep&&Mt||Le.propDep)Vl(Fe,at,Ee,null);else{var qe=Le.append(Fe,at);if(at(Fe.shared.gl,".useProgram(",qe,".program);"),Ee.shader.program)Vl(Fe,at,Ee,Ee.shader.program);else{at(Fe.shared.vao,".setVAO(null);");var Be=Fe.global.def("{}"),kt=at.def(qe,".id"),Yt=at.def(Be,"[",kt,"]");at(Fe.cond(Yt).then(Yt,".call(this,a0,a1);").else(Yt,"=",Be,"[",kt,"]=",Fe.link(function(Gr){return Mi(Vl,Fe,Ee,Gr,2)}),"(",qe,");",Yt,".call(this,a0,a1);"))}}Object.keys(Ee.state).length>0&&at(Fe.shared.current,".dirty=true;"),Fe.shared.vao&&at(Fe.shared.vao,".setVAO(null);")}function or(Fe,Ee){var at=Fe.proc("scope",3);Fe.batchId="a2";var Mt=Fe.shared,tr=Mt.current;Go(Fe,at,Ee.context),Ee.framebuffer&&Ee.framebuffer.append(Fe,at),Uh(Object.keys(Ee.state)).forEach(function(ht){var ot=Ee.state[ht],Le=ot.append(Fe,at);Ma(Le)?Le.forEach(function(qe,Be){at.set(Fe.next[ht],"["+Be+"]",qe)}):at.set(Mt.next,"."+ht,Le)}),Ji(Fe,at,Ee,!0,!0),[ic,Uf,hs,yf,Wu].forEach(function(ht){var ot=Ee.draw[ht];!ot||at.set(Mt.draw,"."+ht,""+ot.append(Fe,at))}),Object.keys(Ee.uniforms).forEach(function(ht){var ot=Ee.uniforms[ht].append(Fe,at);Array.isArray(ot)&&(ot="["+ot.join()+"]"),at.set(Mt.uniforms,"["+Me.id(ht)+"]",ot)}),Object.keys(Ee.attributes).forEach(function(ht){var ot=Ee.attributes[ht].append(Fe,at),Le=Fe.scopeAttrib(ht);Object.keys(new Ot).forEach(function(qe){at.set(Le,"."+qe,ot[qe])})}),Ee.scopeVAO&&at.set(Mt.vao,".targetVAO",Ee.scopeVAO.append(Fe,at));function yt(ht){var ot=Ee.shader[ht];ot&&at.set(Mt.shader,"."+ht,ot.append(Fe,at))}yt(ll),yt(Ul),Object.keys(Ee.state).length>0&&(at(tr,".dirty=true;"),at.exit(tr,".dirty=true;")),at("a1(",Fe.shared.context,",a0,",Fe.batchId,");")}function $t(Fe){if(!(typeof Fe!="object"||Ma(Fe))){for(var Ee=Object.keys(Fe),at=0;at<Ee.length;++at)if(Yr.isDynamic(Fe[Ee[at]]))return!0;return!1}}function Yn(Fe,Ee,at){var Mt=Ee.static[at];if(!Mt||!$t(Mt))return;var tr=Fe.global,yt=Object.keys(Mt),ht=!1,ot=!1,Le=!1,qe=Fe.global.def("{}");yt.forEach(function(kt){var Yt=Mt[kt];if(Yr.isDynamic(Yt)){typeof Yt=="function"&&(Yt=Mt[kt]=Yr.unbox(Yt));var Gr=gu(Yt,null);ht=ht||Gr.thisDep,Le=Le||Gr.propDep,ot=ot||Gr.contextDep}else{switch(tr(qe,".",kt,"="),typeof Yt){case"number":tr(Yt);break;case"string":tr('"',Yt,'"');break;case"object":Array.isArray(Yt)&&tr("[",Yt.join(),"]");break;default:tr(Fe.link(Yt));break}tr(";")}});function Be(kt,Yt){yt.forEach(function(Gr){var gn=Mt[Gr];if(!!Yr.isDynamic(gn)){var yn=kt.invoke(Yt,gn);Yt(qe,".",Gr,"=",yn,";")}})}Ee.dynamic[at]=new Yr.DynamicVariable(ne,{thisDep:ht,contextDep:ot,propDep:Le,ref:qe,append:Be}),delete Ee.static[at]}function ua(Fe,Ee,at,Mt,tr){var yt=ki();yt.stats=yt.link(tr),Object.keys(Ee.static).forEach(function(ot){Yn(yt,Ee,ot)}),dp.forEach(function(ot){Yn(yt,Fe,ot)});var ht=Is(Fe,Ee,at,Mt,yt);return Ha(yt,ht),or(yt,ht),je(yt,ht),d(yt.compile(),{destroy:function(){ht.shader.program.destroy()}})}return{next:on,current:Pn,procs:function(){var Fe=ki(),Ee=Fe.proc("poll"),at=Fe.proc("refresh"),Mt=Fe.block();Ee(Mt),at(Mt);var tr=Fe.shared,yt=tr.gl,ht=tr.next,ot=tr.current;Mt(ot,".dirty=false;"),os(Fe,Ee),os(Fe,at,null,!0);var Le;Jr&&(Le=Fe.link(Jr)),Je.oes_vertex_array_object&&at(Fe.link(Je.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var qe=0;qe<ir.maxAttributes;++qe){var Be=at.def(tr.attributes,"[",qe,"]"),kt=Fe.cond(Be,".buffer");kt.then(yt,".enableVertexAttribArray(",qe,");",yt,".bindBuffer(",nf,",",Be,".buffer.buffer);",yt,".vertexAttribPointer(",qe,",",Be,".size,",Be,".type,",Be,".normalized,",Be,".stride,",Be,".offset);").else(yt,".disableVertexAttribArray(",qe,");",yt,".vertexAttrib4f(",qe,",",Be,".x,",Be,".y,",Be,".z,",Be,".w);",Be,".buffer=null;"),at(kt),Jr&&at(Le,".vertexAttribDivisorANGLE(",qe,",",Be,".divisor);")}return at(Fe.shared.vao,".currentVAO=null;",Fe.shared.vao,".setVAO(",Fe.shared.vao,".targetVAO);"),Object.keys(Rr).forEach(function(Yt){var Gr=Rr[Yt],gn=Mt.def(ht,".",Yt),yn=Fe.block();yn("if(",gn,"){",yt,".enable(",Gr,")}else{",yt,".disable(",Gr,")}",ot,".",Yt,"=",gn,";"),at(yn),Ee("if(",gn,"!==",ot,".",Yt,"){",yn,"}")}),Object.keys(wr).forEach(function(Yt){var Gr=wr[Yt],gn=Pn[Yt],yn,Bn,pn=Fe.block();if(pn(yt,".",Gr,"("),Ma(gn)){var qn=gn.length;yn=Fe.global.def(ht,".",Yt),Bn=Fe.global.def(ot,".",Yt),pn(de(qn,function(Rn){return yn+"["+Rn+"]"}),");",de(qn,function(Rn){return Bn+"["+Rn+"]="+yn+"["+Rn+"];"}).join("")),Ee("if(",de(qn,function(Rn){return yn+"["+Rn+"]!=="+Bn+"["+Rn+"]"}).join("||"),"){",pn,"}")}else yn=Mt.def(ht,".",Yt),Bn=Mt.def(ot,".",Yt),pn(yn,");",ot,".",Yt,"=",yn,";"),Ee("if(",yn,"!==",Bn,"){",pn,"}");at(pn)}),Fe.compile()}(),compile:ua}}function Zh(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var bp=34918,Sp=34919,jh=35007,Vh=function(U,Me){if(!Me.ext_disjoint_timer_query)return null;var Je=[];function ir(){return Je.pop()||Me.ext_disjoint_timer_query.createQueryEXT()}function Fr(Jr){Je.push(Jr)}var er=[];function Pr(Jr){var Tn=ir();Me.ext_disjoint_timer_query.beginQueryEXT(jh,Tn),er.push(Tn),$r(er.length-1,er.length,Jr)}function Zr(){Me.ext_disjoint_timer_query.endQueryEXT(jh)}function Kr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var qr=[];function en(){return qr.pop()||new Kr}function an(Jr){qr.push(Jr)}var bn=[];function $r(Jr,Tn,Lr){var Pn=en();Pn.startQueryIndex=Jr,Pn.endQueryIndex=Tn,Pn.sum=0,Pn.stats=Lr,bn.push(Pn)}var nn=[],Ot=[];function vr(){var Jr,Tn,Lr=er.length;if(Lr!==0){Ot.length=Math.max(Ot.length,Lr+1),nn.length=Math.max(nn.length,Lr+1),nn[0]=0,Ot[0]=0;var Pn=0;for(Jr=0,Tn=0;Tn<er.length;++Tn){var on=er[Tn];Me.ext_disjoint_timer_query.getQueryObjectEXT(on,Sp)?(Pn+=Me.ext_disjoint_timer_query.getQueryObjectEXT(on,bp),Fr(on)):er[Jr++]=on,nn[Tn+1]=Pn,Ot[Tn+1]=Jr}for(er.length=Jr,Jr=0,Tn=0;Tn<bn.length;++Tn){var ci=bn[Tn],Rr=ci.startQueryIndex,wr=ci.endQueryIndex;ci.sum+=nn[wr]-nn[Rr];var Qn=Ot[Rr],Sn=Ot[wr];Sn===Qn?(ci.stats.gpuTime+=ci.sum/1e6,an(ci)):(ci.startQueryIndex=Qn,ci.endQueryIndex=Sn,bn[Jr++]=ci)}bn.length=Jr}}return{beginQuery:Pr,endQuery:Zr,pushScopeStats:$r,update:vr,getNumPendingQueries:function(){return er.length},clear:function(){Je.push.apply(Je,er);for(var Jr=0;Jr<Je.length;Jr++)Me.ext_disjoint_timer_query.deleteQueryEXT(Je[Jr]);er.length=0,Je.length=0},restore:function(){er.length=0,Je.length=0}}},Ep=16384,Cp=256,Tf=1024,Gh=34962,vh="webglcontextlost",Pf="webglcontextrestored",Ja=1,Hh=2,sc=3;function Zc(U,Me){for(var Je=0;Je<U.length;++Je)if(U[Je]===Me)return Je;return-1}function Wh(U){var Me=B(U);if(!Me)return null;var Je=Me.gl,ir=Je.getContextAttributes(),Fr=Je.isContextLost(),er=ee(Je,Me);if(!er)return null;var Pr=gt(),Zr=Zh(),Kr=er.extensions,qr=Vh(Je,Kr),en=Mr(),an=Je.drawingBufferWidth,bn=Je.drawingBufferHeight,$r={tick:0,time:0,viewportWidth:an,viewportHeight:bn,framebufferWidth:an,framebufferHeight:bn,drawingBufferWidth:an,drawingBufferHeight:bn,pixelRatio:Me.pixelRatio},nn={},Ot={elements:null,primitive:4,count:-1,offset:0,instances:-1},vr=ke(Je,Kr),Jr=z(Je,Zr,Me,Pn),Tn=Qs(Je,Kr,Jr,Zr),Lr=bt(Je,Kr,vr,Zr,Jr,Tn,Ot);function Pn(Mi){return Lr.destroyBuffer(Mi)}var on=jr(Je,Pr,Zr,Me),ci=bi(Je,Kr,vr,function(){Qn.procs.poll()},$r,Zr,Me),Rr=ef(Je,Kr,vr,Zr,Me),wr=Pe(Je,Kr,vr,ci,Rr,Zr),Qn=xp(Je,Pr,Kr,vr,Jr,Tn,ci,wr,nn,Lr,on,Ot,$r,qr,Me),Sn=ui(Je,wr,Qn.procs.poll,$r,ir,Kr,vr),rn=Qn.next,On=Je.canvas,Ln=[],Vi=[],ki=[],kn=[Me.onDestroy],Fn=null;function Ti(){if(Ln.length===0){qr&&qr.update(),Fn=null;return}Fn=wn.next(Ti),$o();for(var Mi=Ln.length-1;Mi>=0;--Mi){var ca=Ln[Mi];ca&&ca($r,null,0)}Je.flush(),qr&&qr.update()}function zi(){!Fn&&Ln.length>0&&(Fn=wn.next(Ti))}function va(){Fn&&(wn.cancel(Ti),Fn=null)}function jo(Mi){Mi.preventDefault(),Fr=!0,va(),Vi.forEach(function(ca){ca()})}function Vo(Mi){Je.getError(),Fr=!1,er.restore(),on.restore(),Jr.restore(),ci.restore(),Rr.restore(),wr.restore(),Lr.restore(),qr&&qr.restore(),Qn.procs.refresh(),zi(),ki.forEach(function(ca){ca()})}var la=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";!la&&On&&(On.addEventListener(vh,jo,!1),On.addEventListener(Pf,Vo,!1));function Ss(){Ln.length=0,va(),!la&&On&&(On.removeEventListener(vh,jo),On.removeEventListener(Pf,Vo)),on.clear(),wr.clear(),Rr.clear(),Lr.clear(),ci.clear(),Tn.clear(),Jr.clear(),qr&&qr.clear(),kn.forEach(function(Mi){Mi()})}function _o(Mi){$(!!Mi,"invalid args to regl({...})"),$.type(Mi,"object","invalid args to regl({...})");function ca(yt){var ht=d({},yt);delete ht.uniforms,delete ht.attributes,delete ht.context,delete ht.vao,"stencil"in ht&&ht.stencil.op&&(ht.stencil.opBack=ht.stencil.opFront=ht.stencil.op,delete ht.stencil.op);function ot(Le){if(Le in ht){var qe=ht[Le];delete ht[Le],Object.keys(qe).forEach(function(Be){ht[Le+"."+Be]=qe[Be]})}}return ot("blend"),ot("depth"),ot("cull"),ot("stencil"),ot("polygonOffset"),ot("scissor"),ot("sample"),"vao"in yt&&(ht.vao=yt.vao),ht}function Ha(yt,ht){var ot={},Le={};return Object.keys(yt).forEach(function(qe){var Be=yt[qe];if(Yr.isDynamic(Be)){Le[qe]=Yr.unbox(Be,qe);return}else if(ht&&Array.isArray(Be)){for(var kt=0;kt<Be.length;++kt)if(Yr.isDynamic(Be[kt])){Le[qe]=Yr.unbox(Be,qe);return}}ot[qe]=Be}),{dynamic:Le,static:ot}}var Lo=Ha(Mi.context||{},!0),Vl=Ha(Mi.uniforms||{},!0),je=Ha(Mi.attributes||{},!1),or=Ha(ca(Mi),!1),$t={gpuTime:0,cpuTime:0,count:0},Yn=Qn.compile(or,je,Vl,Lo,$t),ua=Yn.draw,Fe=Yn.batch,Ee=Yn.scope,at=[];function Mt(yt){for(;at.length<yt;)at.push(null);return at}function tr(yt,ht){var ot;if(Fr&&$.raise("context lost"),typeof yt=="function")return Ee.call(this,null,yt,0);if(typeof ht=="function")if(typeof yt=="number")for(ot=0;ot<yt;++ot)Ee.call(this,null,ht,ot);else if(Array.isArray(yt))for(ot=0;ot<yt.length;++ot)Ee.call(this,yt[ot],ht,ot);else return Ee.call(this,yt,ht,0);else if(typeof yt=="number"){if(yt>0)return Fe.call(this,Mt(yt|0),yt|0)}else if(Array.isArray(yt)){if(yt.length)return Fe.call(this,yt,yt.length)}else return ua.call(this,yt)}return d(tr,{stats:$t,destroy:function(){Yn.destroy()}})}var Is=wr.setFBO=_o({framebuffer:Yr.define.call(null,Ja,"framebuffer")});function Go(Mi,ca){var Ha=0;Qn.procs.poll();var Lo=ca.color;Lo&&(Je.clearColor(+Lo[0]||0,+Lo[1]||0,+Lo[2]||0,+Lo[3]||0),Ha|=Ep),"depth"in ca&&(Je.clearDepth(+ca.depth),Ha|=Cp),"stencil"in ca&&(Je.clearStencil(ca.stencil|0),Ha|=Tf),$(!!Ha,"called regl.clear with no buffer specified"),Je.clear(Ha)}function os(Mi){if($(typeof Mi=="object"&&Mi,"regl.clear() takes an object as input"),"framebuffer"in Mi)if(Mi.framebuffer&&Mi.framebuffer_reglType==="framebufferCube")for(var ca=0;ca<6;++ca)Is(d({framebuffer:Mi.framebuffer.faces[ca]},Mi),Go);else Is(Mi,Go);else Go(null,Mi)}function ps(Mi){$.type(Mi,"function","regl.frame() callback must be a function"),Ln.push(Mi);function ca(){var Ha=Zc(Ln,Mi);$(Ha>=0,"cannot cancel a frame twice");function Lo(){var Vl=Zc(Ln,Lo);Ln[Vl]=Ln[Ln.length-1],Ln.length-=1,Ln.length<=0&&va()}Ln[Ha]=Lo}return zi(),{cancel:ca}}function Os(){var Mi=rn.viewport,ca=rn.scissor_box;Mi[0]=Mi[1]=ca[0]=ca[1]=0,$r.viewportWidth=$r.framebufferWidth=$r.drawingBufferWidth=Mi[2]=ca[2]=Je.drawingBufferWidth,$r.viewportHeight=$r.framebufferHeight=$r.drawingBufferHeight=Mi[3]=ca[3]=Je.drawingBufferHeight}function $o(){$r.tick+=1,$r.time=Es(),Os(),Qn.procs.poll()}function Ji(){ci.refresh(),Os(),Qn.procs.refresh(),qr&&qr.update()}function Es(){return(Mr()-en)/1e3}Ji();function Fa(Mi,ca){$.type(ca,"function","listener callback must be a function");var Ha;switch(Mi){case"frame":return ps(ca);case"lost":Ha=Vi;break;case"restore":Ha=ki;break;case"destroy":Ha=kn;break;default:$.raise("invalid event, must be one of frame,lost,restore,destroy")}return Ha.push(ca),{cancel:function(){for(var Lo=0;Lo<Ha.length;++Lo)if(Ha[Lo]===ca){Ha[Lo]=Ha[Ha.length-1],Ha.pop();return}}}}var Oo=d(_o,{clear:os,prop:Yr.define.bind(null,Ja),context:Yr.define.bind(null,Hh),this:Yr.define.bind(null,sc),draw:_o({}),buffer:function(Mi){return Jr.create(Mi,Gh,!1,!1)},elements:function(Mi){return Tn.create(Mi,!1)},texture:ci.create2D,cube:ci.createCube,renderbuffer:Rr.create,framebuffer:wr.create,framebufferCube:wr.createCube,vao:Lr.createVAO,attributes:ir,frame:ps,on:Fa,limits:vr,hasExtension:function(Mi){return vr.extensions.indexOf(Mi.toLowerCase())>=0},read:Sn,destroy:Ss,_gl:Je,_refresh:Ji,poll:function(){$o(),qr&&qr.update()},now:Es,stats:Zr});return Me.onDone(null,Oo),Oo}return Wh})},49029:function(zr){var N=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function S(ce){return ce.match(N)||[]}zr.exports=S},29750:function(zr){function N(S,ce,E){return S===S&&(E!==void 0&&(S=S<=E?S:E),ce!==void 0&&(S=S>=ce?S:ce)),S}zr.exports=N},18674:function(zr){function N(S){return function(ce){return S==null?void 0:S[ce]}}zr.exports=N},98805:function(zr,N,S){var ce=S(40180),E=S(62689),d=S(83140),me=S(79833);function te(ue){return function(oe){oe=me(oe);var Ne=E(oe)?d(oe):void 0,K=Ne?Ne[0]:oe.charAt(0),Qe=Ne?ce(Ne,1).join(""):oe.slice(1);return K[ue]()+Qe}}zr.exports=te},35393:function(zr,N,S){var ce=S(62663),E=S(53816),d=S(58748),me="['\u2019]",te=RegExp(me,"g");function ue(oe){return function(Ne){return ce(d(E(Ne).replace(te,"")),oe,"")}}zr.exports=ue},69389:function(zr,N,S){var ce=S(18674),E={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},d=ce(E);zr.exports=d},93157:function(zr){var N=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function S(ce){return N.test(ce)}zr.exports=S},2757:function(zr){var N="\\ud800-\\udfff",S="\\u0300-\\u036f",ce="\\ufe20-\\ufe2f",E="\\u20d0-\\u20ff",d=S+ce+E,me="\\u2700-\\u27bf",te="a-z\\xdf-\\xf6\\xf8-\\xff",ue="\\xac\\xb1\\xd7\\xf7",oe="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ne="\\u2000-\\u206f",K=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Qe="A-Z\\xc0-\\xd6\\xd8-\\xde",mt="\\ufe0e\\ufe0f",Zt=ue+oe+Ne+K,Cr="['\u2019]",Qt="["+Zt+"]",Xt="["+d+"]",rr="\\d+",Ut="["+me+"]",St="["+te+"]",Et="[^"+N+Zt+rr+me+te+Qe+"]",yr="\\ud83c[\\udffb-\\udfff]",q="(?:"+Xt+"|"+yr+")",hr="[^"+N+"]",wt="(?:\\ud83c[\\udde6-\\uddff]){2}",$e="[\\ud800-\\udbff][\\udc00-\\udfff]",Ft="["+Qe+"]",Xe="\\u200d",jt="(?:"+St+"|"+Et+")",br="(?:"+Ft+"|"+Et+")",sr="(?:"+Cr+"(?:d|ll|m|re|s|t|ve))?",j="(?:"+Cr+"(?:D|LL|M|RE|S|T|VE))?",ie=q+"?",Re="["+mt+"]?",ye="(?:"+Xe+"(?:"+[hr,wt,$e].join("|")+")"+Re+ie+")*",_t="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",dt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",zt=Re+ie+ye,Bt="(?:"+[Ut,wt,$e].join("|")+")"+zt,Ur=RegExp([Ft+"?"+St+"+"+sr+"(?="+[Qt,Ft,"$"].join("|")+")",br+"+"+j+"(?="+[Qt,Ft+jt,"$"].join("|")+")",Ft+"?"+jt+"+"+sr,Ft+"+"+j,dt,_t,rr,Bt].join("|"),"g");function vn(En){return En.match(Ur)||[]}zr.exports=vn},68929:function(zr,N,S){var ce=S(48403),E=S(35393),d=E(function(me,te,ue){return te=te.toLowerCase(),me+(ue?ce(te):te)});zr.exports=d},48403:function(zr,N,S){var ce=S(79833),E=S(11700);function d(me){return E(ce(me).toLowerCase())}zr.exports=d},74691:function(zr,N,S){var ce=S(29750),E=S(14841);function d(me,te,ue){return ue===void 0&&(ue=te,te=void 0),ue!==void 0&&(ue=E(ue),ue=ue===ue?ue:0),te!==void 0&&(te=E(te),te=te===te?te:0),ce(E(me),te,ue)}zr.exports=d},53816:function(zr,N,S){var ce=S(69389),E=S(79833),d=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,me="\\u0300-\\u036f",te="\\ufe20-\\ufe2f",ue="\\u20d0-\\u20ff",oe=me+te+ue,Ne="["+oe+"]",K=RegExp(Ne,"g");function Qe(mt){return mt=E(mt),mt&&mt.replace(d,ce).replace(K,"")}zr.exports=Qe},14293:function(zr){function N(S){return S==null}zr.exports=N},81763:function(zr,N,S){var ce=S(44239),E=S(37005),d="[object Number]";function me(te){return typeof te=="number"||E(te)&&ce(te)==d}zr.exports=me},30236:function(zr,N,S){var ce=S(42980),E=S(21463),d=E(function(me,te,ue,oe){ce(me,te,ue,oe)});zr.exports=d},44908:function(zr,N,S){var ce=S(45652);function E(d){return d&&d.length?ce(d):[]}zr.exports=E},11700:function(zr,N,S){var ce=S(98805),E=ce("toUpperCase");zr.exports=E},58748:function(zr,N,S){var ce=S(49029),E=S(93157),d=S(79833),me=S(2757);function te(ue,oe,Ne){return ue=d(ue),oe=Ne?void 0:oe,oe===void 0?E(ue)?me(ue):ce(ue):ue.match(oe)||[]}zr.exports=te},6158:function(zr){(function(N,S){zr.exports=S()})(this,function(){"use strict";var N,S,ce;function E(d,me){if(!N)N=me;else if(!S)S=me;else{var te="var sharedChunk = {}; ("+N+")(sharedChunk); ("+S+")(sharedChunk);",ue={};N(ue),ce=me(ue),typeof window!="undefined"&&(ce.workerUrl=window.URL.createObjectURL(new Blob([te],{type:"text/javascript"})))}}return E(["exports"],function(d){"use strict";function me(e,t){return e(t={exports:{}},t.exports),t.exports}var te=ue;function ue(e,t,r,f){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(f-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=f,this.p2x=r,this.p2y=f}ue.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},ue.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},ue.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},ue.prototype.solveCurveX=function(e,t){var r,f,v,g,x;for(t===void 0&&(t=1e-6),v=e,x=0;x<8;x++){if(g=this.sampleCurveX(v)-e,Math.abs(g)<t)return v;var P=this.sampleCurveDerivativeX(v);if(Math.abs(P)<1e-6)break;v-=g/P}if((v=e)<(r=0))return r;if(v>(f=1))return f;for(;r<f;){if(g=this.sampleCurveX(v),Math.abs(g-e)<t)return v;e>g?r=v:f=v,v=.5*(f-r)+r}return v},ue.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var oe=Ne;function Ne(e,t){this.x=e,this.y=t}Ne.prototype={clone:function(){return new Ne(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),f=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=f,this},_rotateAround:function(e,t){var r=Math.cos(e),f=Math.sin(e),v=t.y+f*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-f*(this.y-t.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ne.convert=function(e){return e instanceof Ne?e:Array.isArray(e)?new Ne(e[0],e[1]):e};var K=typeof self!="undefined"?self:{},Qe=Math.pow(2,53)-1;function mt(e,t,r,f){var v=new te(e,t,r,f);return function(g){return v.solve(g)}}var Zt=mt(.25,.1,.25,1);function Cr(e,t,r){return Math.min(r,Math.max(t,e))}function Qt(e,t,r){var f=r-t,v=((e-t)%f+f)%f+t;return v===t?r:v}function Xt(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var g=v[f];for(var x in g)e[x]=g[x]}return e}var rr=1;function Ut(){return rr++}function St(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function Et(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function yr(e,t){e.forEach(function(r){t[r]&&(t[r]=t[r].bind(t))})}function q(e,t){return e.indexOf(t,e.length-t.length)!==-1}function hr(e,t,r){var f={};for(var v in e)f[v]=t.call(r||this,e[v],v,e);return f}function wt(e,t,r){var f={};for(var v in e)t.call(r||this,e[v],v,e)&&(f[v]=e[v]);return f}function $e(e){return Array.isArray(e)?e.map($e):typeof e=="object"&&e?hr(e,$e):e}var Ft={};function Xe(e){Ft[e]||(typeof console!="undefined"&&console.warn(e),Ft[e]=!0)}function jt(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function br(e){for(var t=0,r=0,f=e.length,v=f-1,g=void 0,x=void 0;r<f;v=r++)t+=((x=e[v]).x-(g=e[r]).x)*(g.y+x.y);return t}function sr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function j(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(f,v,g,x){var P=g||x;return t[v]=!P||P.toLowerCase(),""}),t["max-age"]){var r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}var ie=null;function Re(e){if(ie==null){var t=e.navigator?e.navigator.userAgent:null;ie=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return ie}function ye(e){try{var t=K[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(r){return!1}}var _t,dt,zt,Bt,Ur=K.performance&&K.performance.now?K.performance.now.bind(K.performance):Date.now.bind(Date),vn=K.requestAnimationFrame||K.mozRequestAnimationFrame||K.webkitRequestAnimationFrame||K.msRequestAnimationFrame,En=K.cancelAnimationFrame||K.mozCancelAnimationFrame||K.webkitCancelAnimationFrame||K.msCancelAnimationFrame,ea={now:Ur,frame:function(e){var t=vn(e);return{cancel:function(){return En(t)}}},getImageData:function(e,t){t===void 0&&(t=0);var r=K.document.createElement("canvas"),f=r.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return r.width=e.width,r.height=e.height,f.drawImage(e,0,0,e.width,e.height),f.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:function(e){return _t||(_t=K.document.createElement("a")),_t.href=e,_t.href},hardwareConcurrency:K.navigator&&K.navigator.hardwareConcurrency||4,get devicePixelRatio(){return K.devicePixelRatio},get prefersReducedMotion(){return!!K.matchMedia&&(dt==null&&(dt=K.matchMedia("(prefers-reduced-motion: reduce)")),dt.matches)}},ar={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ge={supported:!1,testSupport:function(e){!Te&&Bt&&(Ze?Oe(e):zt=e)}},Te=!1,Ze=!1;function Oe(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Bt),e.isContextLost())return;ge.supported=!0}catch(r){}e.deleteTexture(t),Te=!0}K.document&&((Bt=K.document.createElement("img")).onload=function(){zt&&Oe(zt),zt=null,Ze=!0},Bt.onerror=function(){Te=!0,zt=null},Bt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Lt="01",nr=function(e,t){this._transformRequestFn=e,this._customAccessToken=t,this._createSkuToken()};function dr(e){return e.indexOf("mapbox:")===0}nr.prototype._createSkuToken=function(){var e=function(){for(var t="",r=0;r<10;r++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Lt,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},nr.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},nr.prototype.transformRequest=function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}},nr.prototype.normalizeStyleURL=function(e,t){if(!dr(e))return e;var r=w(e);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},nr.prototype.normalizeGlyphsURL=function(e,t){if(!dr(e))return e;var r=w(e);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},nr.prototype.normalizeSourceURL=function(e,t){if(!dr(e))return e;var r=w(e);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||t)},nr.prototype.normalizeSpriteURL=function(e,t,r,f){var v=w(e);return dr(e)?(v.path="/styles/v1"+v.path+"/sprite"+t+r,this._makeAPIURL(v,this._customAccessToken||f)):(v.path+=""+t+r,H(v))},nr.prototype.normalizeTileURL=function(e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!dr(e))return e;var r=w(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,(ea.devicePixelRatio>=2||t===512?"@2x":"")+(ge.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var f=this._customAccessToken||function(v){for(var g=0,x=v;g<x.length;g+=1){var P=x[g].match(/^access_token=(.*)$/);if(P)return P[1]}return null}(r.params)||ar.ACCESS_TOKEN;return ar.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,f)},nr.prototype.canonicalizeTileURL=function(e,t){var r=w(e);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return e;var f="mapbox://tiles/";f+=r.path.replace("/v4/","");var v=r.params;return t&&(v=v.filter(function(g){return!g.match(/^access_token=/)})),v.length&&(f+="?"+v.join("&")),f},nr.prototype.canonicalizeTileset=function(e,t){for(var r=!!t&&dr(t),f=[],v=0,g=e.tiles||[];v<g.length;v+=1){var x=g[v];lr(x)?f.push(this.canonicalizeTileURL(x,r)):f.push(x)}return f},nr.prototype._makeAPIURL=function(e,t){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",f=w(ar.API_URL);if(e.protocol=f.protocol,e.authority=f.authority,e.protocol==="http"){var v=e.params.indexOf("secure");v>=0&&e.params.splice(v,1)}if(f.path!=="/"&&(e.path=""+f.path+e.path),!ar.REQUIRE_ACCESS_TOKEN)return H(e);if(!(t=t||ar.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if(t[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return e.params=e.params.filter(function(g){return g.indexOf("access_token")===-1}),e.params.push("access_token="+t),H(e)};var Or=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function lr(e){return Or.test(e)}var un=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function w(e){var t=e.match(un);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function H(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+t}function Ue(e){if(!e)return null;var t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(K.atob(t[1]).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(r){return null}}var et=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};et.prototype.getStorageKey=function(e){var t,r=Ue(ar.ACCESS_TOKEN);return t=r&&r.u?K.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,function(f,v){return String.fromCharCode(Number("0x"+v))})):ar.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+t:"mapbox.eventData:"+t},et.prototype.fetchEventData=function(){var e=ye("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{var f=K.localStorage.getItem(t);f&&(this.eventData=JSON.parse(f));var v=K.localStorage.getItem(r);v&&(this.anonId=v)}catch(g){Xe("Unable to read from LocalStorage")}},et.prototype.saveEventData=function(){var e=ye("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{K.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&K.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(f){Xe("Unable to write to LocalStorage")}},et.prototype.processRequests=function(e){},et.prototype.postEvent=function(e,t,r,f){var v=this;if(ar.EVENTS_URL){var g=w(ar.EVENTS_URL);g.params.push("access_token="+(f||ar.ACCESS_TOKEN||""));var x={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:Lt,userId:this.anonId},P=t?Xt(x,t):x,k={url:H(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=kr(k,function(Z){v.pendingRequest=null,r(Z),v.saveEventData(),v.processRequests(f)})}},et.prototype.queueRequest=function(e,t){this.queue.push(e),this.processRequests(t)};var st,Ct,$=function(e){function t(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postMapLoadEvent=function(r,f,v,g){this.skuToken=v,(ar.EVENTS_URL&&g||ar.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(x){return dr(x)||lr(x)}))&&this.queueRequest({id:f,timestamp:Date.now()},g)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){var v=this.queue.shift(),g=v.id,x=v.timestamp;g&&this.success[g]||(this.anonId||this.fetchEventData(),Et(this.anonId)||(this.anonId=St()),this.postEvent(x,{skuToken:this.skuToken},function(P){P||g&&(f.success[g]=!0)},r))}},t}(et),Gt=new(function(e){function t(r){e.call(this,"appUserTurnstile"),this._customAccessToken=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postTurnstileEvent=function(r,f){ar.EVENTS_URL&&ar.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(v){return dr(v)||lr(v)})&&this.queueRequest(Date.now(),f)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var v=Ue(ar.ACCESS_TOKEN),g=v?v.u:ar.ACCESS_TOKEN,x=g!==this.eventData.tokenU;Et(this.anonId)||(this.anonId=St(),x=!0);var P=this.queue.shift();if(this.eventData.lastSuccess){var k=new Date(this.eventData.lastSuccess),Z=new Date(P),X=(P-this.eventData.lastSuccess)/864e5;x=x||X>=1||X<-1||k.getDate()!==Z.getDate()}else x=!0;if(!x)return this.processRequests();this.postEvent(P,{"enabled.telemetry":!1},function(re){re||(f.eventData.lastSuccess=P,f.eventData.tokenU=g)},r)}},t}(et)),Tr=Gt.postTurnstileEvent.bind(Gt),Ir=new $,Ye=Ir.postMapLoadEvent.bind(Ir),ut=500,At=50;function Rt(){K.caches&&!st&&(st=K.caches.open("mapbox-tiles"))}function xr(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}var Ar,Ke=1/0;function Xr(){return Ar==null&&(Ar=K.OffscreenCanvas&&new K.OffscreenCanvas(1,1).getContext("2d")&&typeof K.createImageBitmap=="function"),Ar}var Yr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Yr);var wn=function(e){function t(r,f,v){f===401&&lr(v)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,r),this.status=f,this.url=v,this.name=this.constructor.name,this.message=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},t}(Error),cr=sr()?function(){return self.worker&&self.worker.referrer}:function(){return(K.location.protocol==="blob:"?K.parent:K).location.href},Mr,gt,Gn=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(cr())&&!/^\w+:/.test(r))){if(K.fetch&&K.Request&&K.AbortController&&K.Request.prototype.hasOwnProperty("signal"))return function(f,v){var g,x=new K.AbortController,P=new K.Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:cr(),signal:x.signal}),k=!1,Z=!1,X=(g=P.url).indexOf("sku=")>0&&lr(g);f.type==="json"&&P.headers.set("Accept","application/json");var re=function(be,Ve,We){if(!Z){if(be&&be.message!=="SecurityError"&&Xe(be),Ve&&We)return he(Ve);var vt=Date.now();K.fetch(P).then(function(tt){if(tt.ok){var It=X?tt.clone():null;return he(tt,It,vt)}return v(new wn(tt.statusText,tt.status,f.url))}).catch(function(tt){tt.code!==20&&v(new Error(tt.message))})}},he=function(be,Ve,We){(f.type==="arrayBuffer"?be.arrayBuffer():f.type==="json"?be.json():be.text()).then(function(vt){Z||(Ve&&We&&function(tt,It,Wt){if(Rt(),st){var pr={status:It.status,statusText:It.statusText,headers:new K.Headers};It.headers.forEach(function(Br,sn){return pr.headers.set(sn,Br)});var mr=j(It.headers.get("Cache-Control")||"");mr["no-store"]||(mr["max-age"]&&pr.headers.set("Expires",new Date(Wt+1e3*mr["max-age"]).toUTCString()),new Date(pr.headers.get("Expires")).getTime()-Wt<42e4||function(Br,sn){if(Ct===void 0)try{new Response(new ReadableStream),Ct=!0}catch(Cn){Ct=!1}Ct?sn(Br.body):Br.blob().then(sn)}(It,function(Br){var sn=new K.Response(Br,pr);Rt(),st&&st.then(function(Cn){return Cn.put(xr(tt.url),sn)}).catch(function(Cn){return Xe(Cn.message)})}))}}(P,Ve,We),k=!0,v(null,vt,be.headers.get("Cache-Control"),be.headers.get("Expires")))}).catch(function(vt){Z||v(new Error(vt.message))})};return X?function(be,Ve){if(Rt(),!st)return Ve(null);var We=xr(be.url);st.then(function(vt){vt.match(We).then(function(tt){var It=function(Wt){if(!Wt)return!1;var pr=new Date(Wt.headers.get("Expires")||0),mr=j(Wt.headers.get("Cache-Control")||"");return pr>Date.now()&&!mr["no-cache"]}(tt);vt.delete(We),It&&vt.put(We,tt.clone()),Ve(null,tt,It)}).catch(Ve)}).catch(Ve)}(P,re):re(null,null),{cancel:function(){Z=!0,k||x.abort()}}}(e,t);if(sr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(f,v){var g=new K.XMLHttpRequest;for(var x in g.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(g.responseType="arraybuffer"),f.headers)g.setRequestHeader(x,f.headers[x]);return f.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=f.credentials==="include",g.onerror=function(){v(new Error(g.statusText))},g.onload=function(){if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){var P=g.response;if(f.type==="json")try{P=JSON.parse(g.response)}catch(k){return v(k)}v(null,P,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else v(new wn(g.statusText,g.status,f.url))},g.send(f.body),{cancel:function(){return g.abort()}}}(e,t)},Mn=function(e,t){return Gn(Xt(e,{type:"arrayBuffer"}),t)},kr=function(e,t){return Gn(Xt(e,{method:"POST"}),t)},Y="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Mr=[],gt=0;var le=function(e,t){if(ge.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),gt>=ar.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:e,callback:t,cancelled:!1,cancel:function(){this.cancelled=!0}};return Mr.push(r),r}gt++;var f=!1,v=function(){if(!f)for(f=!0,gt--;Mr.length&&gt<ar.MAX_PARALLEL_IMAGE_REQUESTS;){var x=Mr.shift();x.cancelled||(x.cancel=le(x.requestParameters,x.callback).cancel)}},g=Mn(e,function(x,P,k,Z){v(),x?t(x):P&&(Xr()?function(X,re){var he=new K.Blob([new Uint8Array(X)],{type:"image/png"});K.createImageBitmap(he).then(function(be){re(null,be)}).catch(function(be){re(new Error("Could not load image because of "+be.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(P,t):function(X,re,he,be){var Ve=new K.Image,We=K.URL;Ve.onload=function(){re(null,Ve),We.revokeObjectURL(Ve.src),Ve.onload=null,K.requestAnimationFrame(function(){Ve.src=Y})},Ve.onerror=function(){return re(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var vt=new K.Blob([new Uint8Array(X)],{type:"image/png"});Ve.cacheControl=he,Ve.expires=be,Ve.src=X.byteLength?We.createObjectURL(vt):Y}(P,t,k,Z))});return{cancel:function(){g.cancel(),v()}}};function ve(e,t,r){r[e]&&r[e].indexOf(t)!==-1||(r[e]=r[e]||[],r[e].push(t))}function B(e,t,r){if(r&&r[e]){var f=r[e].indexOf(t);f!==-1&&r[e].splice(f,1)}}var ee=function(e,t){t===void 0&&(t={}),Xt(this,t),this.type=e},de=function(e){function t(r,f){f===void 0&&(f={}),e.call(this,"error",Xt({error:r},f))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ee),Ae=function(){};Ae.prototype.on=function(e,t){return this._listeners=this._listeners||{},ve(e,t,this._listeners),this},Ae.prototype.off=function(e,t){return B(e,t,this._listeners),B(e,t,this._oneTimeListeners),this},Ae.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},ve(e,t,this._oneTimeListeners),this},Ae.prototype.fire=function(e,t){typeof e=="string"&&(e=new ee(e,t||{}));var r=e.type;if(this.listens(r)){e.target=this;for(var f=0,v=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];f<v.length;f+=1)v[f].call(this,e);for(var g=0,x=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];g<x.length;g+=1){var P=x[g];B(r,P,this._oneTimeListeners),P.call(this,e)}var k=this._eventedParent;k&&(Xt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),k.fire(e))}else e instanceof de&&console.error(e.error);return this},Ae.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},Ae.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this};var ae={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},_e=function(e,t,r,f){this.message=(e?e+": ":"")+r,f&&(this.identifier=f),t!=null&&t.__line__&&(this.line=t.__line__)};function ct(e){var t=e.value;return t?[new _e(e.key,t,"constants have been deprecated as of v8")]:[]}function Sr(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var g=v[f];for(var x in g)e[x]=g[x]}return e}function Ht(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Jt(e){if(Array.isArray(e))return e.map(Jt);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var r in e)t[r]=Jt(e[r]);return t}return Ht(e)}var Nr=function(e){function t(r,f){e.call(this,f),this.message=f,this.key=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Error),zn=function(e,t){t===void 0&&(t=[]),this.parent=e,this.bindings={};for(var r=0,f=t;r<f.length;r+=1){var v=f[r];this.bindings[v[0]]=v[1]}};zn.prototype.concat=function(e){return new zn(this,e)},zn.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},zn.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var Nn={kind:"null"},Kt={kind:"number"},In={kind:"string"},hn={kind:"boolean"},mn={kind:"color"},Bi={kind:"object"},An={kind:"value"},Di={kind:"collator"},ra={kind:"formatted"},hi={kind:"resolvedImage"};function na(e,t){return{kind:"array",itemType:e,N:t}}function Hi(e){if(e.kind==="array"){var t=Hi(e.itemType);return typeof e.N=="number"?"array<"+t+", "+e.N+">":e.itemType.kind==="value"?"array":"array<"+t+">"}return e.kind}var Oi=[Nn,Kt,In,hn,mn,ra,Bi,na(An),hi];function ga(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ga(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(var r=0,f=Oi;r<f.length;r+=1)if(!ga(f[r],t))return null}}return"Expected "+Hi(e)+" but found "+Hi(t)+" instead."}function Ra(e,t){return t.some(function(r){return r.kind===e.kind})}function Wi(e,t){return t.some(function(r){return r==="null"?e===null:r==="array"?Array.isArray(e):r==="object"?e&&!Array.isArray(e)&&typeof e=="object":r===typeof e})}var Ni=me(function(e,t){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function f(P){return(P=Math.round(P))<0?0:P>255?255:P}function v(P){return f(P[P.length-1]==="%"?parseFloat(P)/100*255:parseInt(P))}function g(P){return(k=P[P.length-1]==="%"?parseFloat(P)/100:parseFloat(P))<0?0:k>1?1:k;var k}function x(P,k,Z){return Z<0?Z+=1:Z>1&&(Z-=1),6*Z<1?P+(k-P)*Z*6:2*Z<1?k:3*Z<2?P+(k-P)*(2/3-Z)*6:P}try{t.parseCSSColor=function(P){var k,Z=P.replace(/ /g,"").toLowerCase();if(Z in r)return r[Z].slice();if(Z[0]==="#")return Z.length===4?(k=parseInt(Z.substr(1),16))>=0&&k<=4095?[(3840&k)>>4|(3840&k)>>8,240&k|(240&k)>>4,15&k|(15&k)<<4,1]:null:Z.length===7&&(k=parseInt(Z.substr(1),16))>=0&&k<=16777215?[(16711680&k)>>16,(65280&k)>>8,255&k,1]:null;var X=Z.indexOf("("),re=Z.indexOf(")");if(X!==-1&&re+1===Z.length){var he=Z.substr(0,X),be=Z.substr(X+1,re-(X+1)).split(","),Ve=1;switch(he){case"rgba":if(be.length!==4)return null;Ve=g(be.pop());case"rgb":return be.length!==3?null:[v(be[0]),v(be[1]),v(be[2]),Ve];case"hsla":if(be.length!==4)return null;Ve=g(be.pop());case"hsl":if(be.length!==3)return null;var We=(parseFloat(be[0])%360+360)%360/360,vt=g(be[1]),tt=g(be[2]),It=tt<=.5?tt*(vt+1):tt+vt-tt*vt,Wt=2*tt-It;return[f(255*x(Wt,It,We+1/3)),f(255*x(Wt,It,We)),f(255*x(Wt,It,We-1/3)),Ve];default:return null}}return null}}catch(P){}}).parseCSSColor,Xi=function(e,t,r,f){f===void 0&&(f=1),this.r=e,this.g=t,this.b=r,this.a=f};Xi.parse=function(e){if(e){if(e instanceof Xi)return e;if(typeof e=="string"){var t=Ni(e);if(t)return new Xi(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}}},Xi.prototype.toString=function(){var e=this.toArray(),t=e[1],r=e[2],f=e[3];return"rgba("+Math.round(e[0])+","+Math.round(t)+","+Math.round(r)+","+f+")"},Xi.prototype.toArray=function(){var e=this.a;return e===0?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},Xi.black=new Xi(0,0,0,1),Xi.white=new Xi(1,1,1,1),Xi.transparent=new Xi(0,0,0,0),Xi.red=new Xi(1,0,0,1);var ro=function(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ro.prototype.compare=function(e,t){return this.collator.compare(e,t)},ro.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Qo=function(e,t,r,f,v){this.text=e,this.image=t,this.scale=r,this.fontStack=f,this.textColor=v},za=function(e){this.sections=e};za.fromString=function(e){return new za([new Qo(e,null,null,null,null)])},za.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(e){return e.text.length!==0||e.image&&e.image.name.length!==0})},za.factory=function(e){return e instanceof za?e:za.fromString(e)},za.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(e){return e.text}).join("")},za.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];if(f.image)e.push(["image",f.image.name]);else{e.push(f.text);var v={};f.fontStack&&(v["text-font"]=["literal",f.fontStack.split(",")]),f.scale&&(v["font-scale"]=f.scale),f.textColor&&(v["text-color"]=["rgba"].concat(f.textColor.toArray())),e.push(v)}}return e};var $i=function(e){this.name=e.name,this.available=e.available};function cu(e,t,r,f){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:"Invalid rgba value ["+[e,t,r,f].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof f=="number"?[e,t,r,f]:[e,t,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Pu(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof Xi||e instanceof ro||e instanceof za||e instanceof $i)return!0;if(Array.isArray(e)){for(var t=0,r=e;t<r.length;t+=1)if(!Pu(r[t]))return!1;return!0}if(typeof e=="object"){for(var f in e)if(!Pu(e[f]))return!1;return!0}return!1}function Yi(e){if(e===null)return Nn;if(typeof e=="string")return In;if(typeof e=="boolean")return hn;if(typeof e=="number")return Kt;if(e instanceof Xi)return mn;if(e instanceof ro)return Di;if(e instanceof za)return ra;if(e instanceof $i)return hi;if(Array.isArray(e)){for(var t,r=e.length,f=0,v=e;f<v.length;f+=1){var g=Yi(v[f]);if(t){if(t===g)continue;t=An;break}t=g}return na(t||An,r)}return Bi}function xo(e){var t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof Xi||e instanceof za||e instanceof $i?e.toString():JSON.stringify(e)}$i.prototype.toString=function(){return this.name},$i.fromString=function(e){return e?new $i({name:e,available:!1}):null},$i.prototype.serialize=function(){return["image",this.name]};var Ki=function(e,t){this.type=e,this.value=t};Ki.parse=function(e,t){if(e.length!==2)return t.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!Pu(e[1]))return t.error("invalid value");var r=e[1],f=Yi(r),v=t.expectedType;return f.kind!=="array"||f.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(f=v),new Ki(f,r)},Ki.prototype.evaluate=function(){return this.value},Ki.prototype.eachChild=function(){},Ki.prototype.outputDefined=function(){return!0},Ki.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Xi?["rgba"].concat(this.value.toArray()):this.value instanceof za?this.value.serialize():this.value};var Xa=function(e){this.name="ExpressionEvaluationError",this.message=e};Xa.prototype.toJSON=function(){return this.message};var qo={string:In,number:Kt,boolean:hn,object:Bi},xa=function(e,t){this.type=e,this.args=t};xa.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r,f=1,v=e[0];if(v==="array"){var g,x;if(e.length>2){var P=e[1];if(typeof P!="string"||!(P in qo)||P==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);g=qo[P],f++}else g=An;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);x=e[2],f++}r=na(g,x)}else r=qo[v];for(var k=[];f<e.length;f++){var Z=t.parse(e[f],f,An);if(!Z)return null;k.push(Z)}return new xa(r,k)},xa.prototype.evaluate=function(e){for(var t=0;t<this.args.length;t++){var r=this.args[t].evaluate(e);if(!ga(this.type,Yi(r)))return r;if(t===this.args.length-1)throw new Xa("Expected value to be of type "+Hi(this.type)+", but found "+Hi(Yi(r))+" instead.")}return null},xa.prototype.eachChild=function(e){this.args.forEach(e)},xa.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},xa.prototype.serialize=function(){var e=this.type,t=[e.kind];if(e.kind==="array"){var r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){t.push(r.kind);var f=e.N;(typeof f=="number"||this.args.length>1)&&t.push(f)}}return t.concat(this.args.map(function(v){return v.serialize()}))};var Do=function(e){this.type=ra,this.sections=e};Do.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[1];if(!Array.isArray(r)&&typeof r=="object")return t.error("First argument must be an image or text section.");for(var f=[],v=!1,g=1;g<=e.length-1;++g){var x=e[g];if(v&&typeof x=="object"&&!Array.isArray(x)){v=!1;var P=null;if(x["font-scale"]&&!(P=t.parse(x["font-scale"],1,Kt)))return null;var k=null;if(x["text-font"]&&!(k=t.parse(x["text-font"],1,na(In))))return null;var Z=null;if(x["text-color"]&&!(Z=t.parse(x["text-color"],1,mn)))return null;var X=f[f.length-1];X.scale=P,X.font=k,X.textColor=Z}else{var re=t.parse(e[g],1,An);if(!re)return null;var he=re.type.kind;if(he!=="string"&&he!=="value"&&he!=="null"&&he!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,f.push({content:re,scale:null,font:null,textColor:null})}}return new Do(f)},Do.prototype.evaluate=function(e){return new za(this.sections.map(function(t){var r=t.content.evaluate(e);return Yi(r)===hi?new Qo("",r,null,null,null):new Qo(xo(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))},Do.prototype.eachChild=function(e){for(var t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e(f.content),f.scale&&e(f.scale),f.font&&e(f.font),f.textColor&&e(f.textColor)}},Do.prototype.outputDefined=function(){return!1},Do.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e.push(f.content.serialize());var v={};f.scale&&(v["font-scale"]=f.scale.serialize()),f.font&&(v["text-font"]=f.font.serialize()),f.textColor&&(v["text-color"]=f.textColor.serialize()),e.push(v)}return e};var ko=function(e){this.type=hi,this.input=e};ko.parse=function(e,t){if(e.length!==2)return t.error("Expected two arguments.");var r=t.parse(e[1],1,In);return r?new ko(r):t.error("No image name provided.")},ko.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=$i.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r},ko.prototype.eachChild=function(e){e(this.input)},ko.prototype.outputDefined=function(){return!1},ko.prototype.serialize=function(){return["image",this.input.serialize()]};var Rs={"to-boolean":hn,"to-color":mn,"to-number":Kt,"to-string":In},vo=function(e,t){this.type=e,this.args=t};vo.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return t.error("Expected one argument.");for(var f=Rs[r],v=[],g=1;g<e.length;g++){var x=t.parse(e[g],g,An);if(!x)return null;v.push(x)}return new vo(f,v)},vo.prototype.evaluate=function(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){for(var t,r,f=0,v=this.args;f<v.length;f+=1){if(r=null,(t=v[f].evaluate(e))instanceof Xi)return t;if(typeof t=="string"){var g=e.parseColor(t);if(g)return g}else if(Array.isArray(t)&&!(r=t.length<3||t.length>4?"Invalid rbga value "+JSON.stringify(t)+": expected an array containing either three or four numeric values.":cu(t[0],t[1],t[2],t[3])))return new Xi(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Xa(r||"Could not parse color from value '"+(typeof t=="string"?t:String(JSON.stringify(t)))+"'")}if(this.type.kind==="number"){for(var x=null,P=0,k=this.args;P<k.length;P+=1){if((x=k[P].evaluate(e))===null)return 0;var Z=Number(x);if(!isNaN(Z))return Z}throw new Xa("Could not convert "+JSON.stringify(x)+" to number.")}return this.type.kind==="formatted"?za.fromString(xo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?$i.fromString(xo(this.args[0].evaluate(e))):xo(this.args[0].evaluate(e))},vo.prototype.eachChild=function(e){this.args.forEach(e)},vo.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},vo.prototype.serialize=function(){if(this.type.kind==="formatted")return new Do([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ko(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild(function(t){e.push(t.serialize())}),e};var Xo=["Unknown","Point","LineString","Polygon"],Da=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Da.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Da.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Xo[this.feature.type]:this.feature.type:null},Da.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Da.prototype.canonicalID=function(){return this.canonical},Da.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Da.prototype.parseColor=function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Xi.parse(e)),t};var co=function(e,t,r,f){this.name=e,this.type=t,this._evaluate=r,this.args=f};co.prototype.evaluate=function(e){return this._evaluate(e,this.args)},co.prototype.eachChild=function(e){this.args.forEach(e)},co.prototype.outputDefined=function(){return!1},co.prototype.serialize=function(){return[this.name].concat(this.args.map(function(e){return e.serialize()}))},co.parse=function(e,t){var r,f=e[0],v=co.definitions[f];if(!v)return t.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0);for(var g=Array.isArray(v)?v[0]:v.type,x=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,P=x.filter(function(di){var Kn=di[0];return!Array.isArray(Kn)||Kn.length===e.length-1}),k=null,Z=0,X=P;Z<X.length;Z+=1){var re=X[Z],he=re[0],be=re[1];k=new Us(t.registry,t.path,null,t.scope);for(var Ve=[],We=!1,vt=1;vt<e.length;vt++){var tt=e[vt],It=Array.isArray(he)?he[vt-1]:he.type,Wt=k.parse(tt,1+Ve.length,It);if(!Wt){We=!0;break}Ve.push(Wt)}if(!We)if(Array.isArray(he)&&he.length!==Ve.length)k.error("Expected "+he.length+" arguments, but found "+Ve.length+" instead.");else{for(var pr=0;pr<Ve.length;pr++){var mr=Array.isArray(he)?he[pr]:he.type,Br=Ve[pr];k.concat(pr+1).checkSubtype(mr,Br.type)}if(k.errors.length===0)return new co(f,g,be,Ve)}}if(P.length===1)(r=t.errors).push.apply(r,k.errors);else{for(var sn=(P.length?P:x).map(function(di){var Kn;return Kn=di[0],Array.isArray(Kn)?"("+Kn.map(Hi).join(", ")+")":"("+Hi(Kn.type)+"...)"}).join(" | "),Cn=[],fi=1;fi<e.length;fi++){var Vn=t.parse(e[fi],1+Cn.length);if(!Vn)return null;Cn.push(Hi(Vn.type))}t.error("Expected arguments of type "+sn+", but found ("+Cn.join(", ")+") instead.")}return null},co.register=function(e,t){for(var r in co.definitions=t,t)e[r]=co};var ss=function(e,t,r){this.type=Di,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t};function Fo(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Se(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function ke(e,t){var r=(180+e[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,v=Math.pow(2,t.z);return[Math.round(r*v*8192),Math.round(f*v*8192)]}function ft(e,t,r){return t[1]>e[1]!=r[1]>e[1]&&e[0]<(r[0]-t[0])*(e[1]-t[1])/(r[1]-t[1])+t[0]}function L(e,t){for(var r,f,v,g,x,P,k,Z=!1,X=0,re=t.length;X<re;X++)for(var he=t[X],be=0,Ve=he.length;be<Ve-1;be++){if((g=(r=e)[0]-(f=he[be])[0])*(k=r[1]-(v=he[be+1])[1])-(P=r[0]-v[0])*(x=r[1]-f[1])==0&&g*P<=0&&x*k<=0)return!1;ft(e,he[be],he[be+1])&&(Z=!Z)}return Z}function Qr(e,t){for(var r=0;r<t.length;r++)if(L(e,t[r]))return!0;return!1}function ai(e,t,r,f){var v=f[0]-r[0],g=f[1]-r[1],x=(e[0]-r[0])*g-v*(e[1]-r[1]),P=(t[0]-r[0])*g-v*(t[1]-r[1]);return x>0&&P<0||x<0&&P>0}function wi(e,t,r){for(var f=0,v=r;f<v.length;f+=1)for(var g=v[f],x=0;x<g.length-1;++x)if((re=[(X=g[x+1])[0]-(Z=g[x])[0],X[1]-Z[1]])[0]*(he=[(k=t)[0]-(P=e)[0],k[1]-P[1]])[1]-re[1]*he[0]!=0&&ai(P,k,Z,X)&&ai(Z,X,P,k))return!0;var P,k,Z,X,re,he;return!1}function fo(e,t){for(var r=0;r<e.length;++r)if(!L(e[r],t))return!1;for(var f=0;f<e.length-1;++f)if(wi(e[f],e[f+1],t))return!1;return!0}function Ya(e,t){for(var r=0;r<t.length;r++)if(fo(e,t[r]))return!0;return!1}function ja(e,t,r){for(var f=[],v=0;v<e.length;v++){for(var g=[],x=0;x<e[v].length;x++){var P=ke(e[v][x],r);Fo(t,P),g.push(P)}f.push(g)}return f}function us(e,t,r){for(var f=[],v=0;v<e.length;v++){var g=ja(e[v],t,r);f.push(g)}return f}function fu(e,t,r,f){if(e[0]<r[0]||e[0]>r[2]){var v=.5*f,g=e[0]-r[0]>v?-f:r[0]-e[0]>v?f:0;g===0&&(g=e[0]-r[2]>v?-f:r[2]-e[0]>v?f:0),e[0]+=g}Fo(t,e)}function Mu(e,t,r,f){for(var v=8192*Math.pow(2,f.z),g=[8192*f.x,8192*f.y],x=[],P=0,k=e;P<k.length;P+=1)for(var Z=0,X=k[P];Z<X.length;Z+=1){var re=X[Z],he=[re.x+g[0],re.y+g[1]];fu(he,t,r,v),x.push(he)}return x}function Yu(e,t,r,f){for(var v,g=8192*Math.pow(2,f.z),x=[8192*f.x,8192*f.y],P=[],k=0,Z=e;k<Z.length;k+=1){for(var X=[],re=0,he=Z[k];re<he.length;re+=1){var be=he[re],Ve=[be.x+x[0],be.y+x[1]];Fo(t,Ve),X.push(Ve)}P.push(X)}if(t[2]-t[0]<=g/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(var We=0,vt=P;We<vt.length;We+=1)for(var tt=0,It=vt[We];tt<It.length;tt+=1)fu(It[tt],t,r,g)}return P}ss.parse=function(e,t){if(e.length!==2)return t.error("Expected one argument.");var r=e[1];if(typeof r!="object"||Array.isArray(r))return t.error("Collator options argument must be an object.");var f=t.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,hn);if(!f)return null;var v=t.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,hn);if(!v)return null;var g=null;return r.locale&&!(g=t.parse(r.locale,1,In))?null:new ss(f,v,g)},ss.prototype.evaluate=function(e){return new ro(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},ss.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},ss.prototype.outputDefined=function(){return!1},ss.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var es=function(e,t){this.type=hn,this.geojson=e,this.geometries=t};function ts(e){if(e instanceof co&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof es)return!1;var t=!0;return e.eachChild(function(r){t&&!ts(r)&&(t=!1)}),t}function ls(e){if(e instanceof co&&e.name==="feature-state")return!1;var t=!0;return e.eachChild(function(r){t&&!ls(r)&&(t=!1)}),t}function ws(e,t){if(e instanceof co&&t.indexOf(e.name)>=0)return!1;var r=!0;return e.eachChild(function(f){r&&!ws(f,t)&&(r=!1)}),r}es.parse=function(e,t){if(e.length!==2)return t.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(Pu(e[1])){var r=e[1];if(r.type==="FeatureCollection")for(var f=0;f<r.features.length;++f){var v=r.features[f].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new es(r,r.features[f].geometry)}else if(r.type==="Feature"){var g=r.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new es(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new es(r,r)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")},es.prototype.evaluate=function(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],g=t.canonicalID();if(r.type==="Polygon"){var x=ja(r.coordinates,v,g),P=Mu(t.geometry(),f,v,g);if(!Se(f,v))return!1;for(var k=0,Z=P;k<Z.length;k+=1)if(!L(Z[k],x))return!1}if(r.type==="MultiPolygon"){var X=us(r.coordinates,v,g),re=Mu(t.geometry(),f,v,g);if(!Se(f,v))return!1;for(var he=0,be=re;he<be.length;he+=1)if(!Qr(be[he],X))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],g=t.canonicalID();if(r.type==="Polygon"){var x=ja(r.coordinates,v,g),P=Yu(t.geometry(),f,v,g);if(!Se(f,v))return!1;for(var k=0,Z=P;k<Z.length;k+=1)if(!fo(Z[k],x))return!1}if(r.type==="MultiPolygon"){var X=us(r.coordinates,v,g),re=Yu(t.geometry(),f,v,g);if(!Se(f,v))return!1;for(var he=0,be=re;he<be.length;he+=1)if(!Ya(be[he],X))return!1}return!0}(e,this.geometries)}return!1},es.prototype.eachChild=function(){},es.prototype.outputDefined=function(){return!0},es.prototype.serialize=function(){return["within",this.geojson]};var cs=function(e,t){this.type=t.type,this.name=e,this.boundExpression=t};cs.parse=function(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");var r=e[1];return t.scope.has(r)?new cs(r,t.scope.get(r)):t.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},cs.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},cs.prototype.eachChild=function(){},cs.prototype.outputDefined=function(){return!1},cs.prototype.serialize=function(){return["var",this.name]};var Us=function(e,t,r,f,v){t===void 0&&(t=[]),f===void 0&&(f=new zn),v===void 0&&(v=[]),this.registry=e,this.path=t,this.key=t.map(function(g){return"["+g+"]"}).join(""),this.scope=f,this.errors=v,this.expectedType=r};function $s(e,t){for(var r,f=e.length-1,v=0,g=f,x=0;v<=g;)if((r=e[x=Math.floor((v+g)/2)])<=t){if(x===f||t<e[x+1])return x;v=x+1}else{if(!(r>t))throw new Xa("Input is not a number.");g=x-1}return 0}Us.prototype.parse=function(e,t,r,f,v){return v===void 0&&(v={}),t?this.concat(t,r,f)._parse(e,v):this._parse(e,v)},Us.prototype._parse=function(e,t){function r(Z,X,re){return re==="assert"?new xa(X,[Z]):re==="coerce"?new vo(X,[Z]):Z}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var f=e[0];if(typeof f!="string")return this.error("Expression name must be a string, but found "+typeof f+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var v=this.registry[f];if(v){var g=v.parse(e,this);if(!g)return null;if(this.expectedType){var x=this.expectedType,P=g.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||P.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(x,P))return null}else g=r(g,x,t.typeAnnotation||"coerce");else g=r(g,x,t.typeAnnotation||"assert")}if(!(g instanceof Ki)&&g.type.kind!=="resolvedImage"&&function Z(X){if(X instanceof cs)return Z(X.boundExpression);if(X instanceof co&&X.name==="error"||X instanceof ss||X instanceof es)return!1;var re=X instanceof vo||X instanceof xa,he=!0;return X.eachChild(function(be){he=re?he&&Z(be):he&&be instanceof Ki}),!!he&&ts(X)&&ws(X,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(g)){var k=new Da;try{g=new Ki(g.type,g.evaluate(k))}catch(Z){return this.error(Z.message),null}}return g}return this.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},Us.prototype.concat=function(e,t,r){var f=typeof e=="number"?this.path.concat(e):this.path,v=r?this.scope.concat(r):this.scope;return new Us(this.registry,f,t||null,v,this.errors)},Us.prototype.error=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var f=""+this.key+t.map(function(v){return"["+v+"]"}).join("");this.errors.push(new Nr(f,e))},Us.prototype.checkSubtype=function(e,t){var r=ga(e,t);return r&&this.error(r),r};var As=function(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(var f=0,v=r;f<v.length;f+=1){var g=v[f],x=g[1];this.labels.push(g[0]),this.outputs.push(x)}};function Ea(e,t,r){return e*(1-r)+t*r}As.parse=function(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");var r=t.parse(e[1],1,Kt);if(!r)return null;var f=[],v=null;t.expectedType&&t.expectedType.kind!=="value"&&(v=t.expectedType);for(var g=1;g<e.length;g+=2){var x=g===1?-1/0:e[g],P=e[g+1],k=g,Z=g+1;if(typeof x!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(f.length&&f[f.length-1][0]>=x)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);var X=t.parse(P,Z,v);if(!X)return null;v=v||X.type,f.push([x,X])}return new As(v,r,f)},As.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;return f>=t[v-1]?r[v-1].evaluate(e):r[$s(t,f)].evaluate(e)},As.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},As.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},As.prototype.serialize=function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e};var Co=Object.freeze({__proto__:null,number:Ea,color:function(e,t,r){return new Xi(Ea(e.r,t.r,r),Ea(e.g,t.g,r),Ea(e.b,t.b,r),Ea(e.a,t.a,r))},array:function(e,t,r){return e.map(function(f,v){return Ea(f,t[v],r)})}}),dl=6/29*3*(6/29),vl=Math.PI/180,Ku=180/Math.PI;function Xl(e){return e>.008856451679035631?Math.pow(e,1/3):e/dl+4/29}function ml(e){return e>6/29?e*e*e:dl*(e-4/29)}function Du(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Zs(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function gl(e){var t=Zs(e.r),r=Zs(e.g),f=Zs(e.b),v=Xl((.4124564*t+.3575761*r+.1804375*f)/.95047),g=Xl((.2126729*t+.7151522*r+.072175*f)/1);return{l:116*g-16,a:500*(v-g),b:200*(g-Xl((.0193339*t+.119192*r+.9503041*f)/1.08883)),alpha:e.a}}function m(e){var t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,f=isNaN(e.b)?t:t-e.b/200;return t=1*ml(t),r=.95047*ml(r),f=1.08883*ml(f),new Xi(Du(3.2404542*r-1.5371385*t-.4985314*f),Du(-.969266*r+1.8760108*t+.041556*f),Du(.0556434*r-.2040259*t+1.0572252*f),e.alpha)}function A(e,t,r){var f=t-e;return e+r*(f>180||f<-180?f-360*Math.round(f/360):f)}var z={forward:gl,reverse:m,interpolate:function(e,t,r){return{l:Ea(e.l,t.l,r),a:Ea(e.a,t.a,r),b:Ea(e.b,t.b,r),alpha:Ea(e.alpha,t.alpha,r)}}},I={forward:function(e){var t=gl(e),r=t.l,f=t.a,v=t.b,g=Math.atan2(v,f)*Ku;return{h:g<0?g+360:g,c:Math.sqrt(f*f+v*v),l:r,alpha:e.a}},reverse:function(e){var t=e.h*vl,r=e.c;return m({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:A(e.h,t.h,r),c:Ea(e.c,t.c,r),l:Ea(e.l,t.l,r),alpha:Ea(e.alpha,t.alpha,r)}}},fe=Object.freeze({__proto__:null,lab:z,hcl:I}),Ie=function(e,t,r,f,v){this.type=e,this.operator=t,this.interpolation=r,this.input=f,this.labels=[],this.outputs=[];for(var g=0,x=v;g<x.length;g+=1){var P=x[g],k=P[1];this.labels.push(P[0]),this.outputs.push(k)}};function lt(e,t,r,f){var v=f-r,g=e-r;return v===0?0:t===1?g/v:(Math.pow(t,g)-1)/(Math.pow(t,v)-1)}Ie.interpolationFactor=function(e,t,r,f){var v=0;if(e.name==="exponential")v=lt(t,e.base,r,f);else if(e.name==="linear")v=lt(t,1,r,f);else if(e.name==="cubic-bezier"){var g=e.controlPoints;v=new te(g[0],g[1],g[2],g[3]).solve(lt(t,1,r,f))}return v},Ie.parse=function(e,t){var r=e[0],f=e[1],v=e[2],g=e.slice(3);if(!Array.isArray(f)||f.length===0)return t.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){var x=f[1];if(typeof x!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:x}}else{if(f[0]!=="cubic-bezier")return t.error("Unknown interpolation type "+String(f[0]),1,0);var P=f.slice(1);if(P.length!==4||P.some(function(vt){return typeof vt!="number"||vt<0||vt>1}))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:P}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(v=t.parse(v,2,Kt)))return null;var k=[],Z=null;r==="interpolate-hcl"||r==="interpolate-lab"?Z=mn:t.expectedType&&t.expectedType.kind!=="value"&&(Z=t.expectedType);for(var X=0;X<g.length;X+=2){var re=g[X],he=g[X+1],be=X+3,Ve=X+4;if(typeof re!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',be);if(k.length&&k[k.length-1][0]>=re)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',be);var We=t.parse(he,Ve,Z);if(!We)return null;Z=Z||We.type,k.push([re,We])}return Z.kind==="number"||Z.kind==="color"||Z.kind==="array"&&Z.itemType.kind==="number"&&typeof Z.N=="number"?new Ie(Z,r,f,v,k):t.error("Type "+Hi(Z)+" is not interpolatable.")},Ie.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;if(f>=t[v-1])return r[v-1].evaluate(e);var g=$s(t,f),x=Ie.interpolationFactor(this.interpolation,f,t[g],t[g+1]),P=r[g].evaluate(e),k=r[g+1].evaluate(e);return this.operator==="interpolate"?Co[this.type.kind.toLowerCase()](P,k,x):this.operator==="interpolate-hcl"?I.reverse(I.interpolate(I.forward(P),I.forward(k),x)):z.reverse(z.interpolate(z.forward(P),z.forward(k),x))},Ie.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},Ie.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},Ie.prototype.serialize=function(){var e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t};var Dt=function(e,t){this.type=e,this.args=t};Dt.parse=function(e,t){if(e.length<2)return t.error("Expectected at least one argument.");var r=null,f=t.expectedType;f&&f.kind!=="value"&&(r=f);for(var v=[],g=0,x=e.slice(1);g<x.length;g+=1){var P=t.parse(x[g],1+v.length,r,void 0,{typeAnnotation:"omit"});if(!P)return null;r=r||P.type,v.push(P)}var k=f&&v.some(function(Z){return ga(f,Z.type)});return new Dt(k?An:r,v)},Dt.prototype.evaluate=function(e){for(var t,r=null,f=0,v=0,g=this.args;v<g.length&&(f++,(r=g[v].evaluate(e))&&r instanceof $i&&!r.available&&(t||(t=r.name),r=null,f===this.args.length&&(r=t)),r===null);v+=1);return r},Dt.prototype.eachChild=function(e){this.args.forEach(e)},Dt.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Dt.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Nt=function(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t};Nt.prototype.evaluate=function(e){return this.result.evaluate(e)},Nt.prototype.eachChild=function(e){for(var t=0,r=this.bindings;t<r.length;t+=1)e(r[t][1]);e(this.result)},Nt.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var r=[],f=1;f<e.length-1;f+=2){var v=e[f];if(typeof v!="string")return t.error("Expected string, but found "+typeof v+" instead.",f);if(/[^a-zA-Z0-9_]/.test(v))return t.error("Variable names must contain only alphanumeric characters or '_'.",f);var g=t.parse(e[f+1],f+1);if(!g)return null;r.push([v,g])}var x=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return x?new Nt(r,x):null},Nt.prototype.outputDefined=function(){return this.result.outputDefined()},Nt.prototype.serialize=function(){for(var e=["let"],t=0,r=this.bindings;t<r.length;t+=1){var f=r[t];e.push(f[0],f[1].serialize())}return e.push(this.result.serialize()),e};var Dr=function(e,t,r){this.type=e,this.index=t,this.input=r};Dr.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,Kt),f=t.parse(e[2],2,na(t.expectedType||An));return r&&f?new Dr(f.type.itemType,r,f):null},Dr.prototype.evaluate=function(e){var t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new Xa("Array index out of bounds: "+t+" < 0.");if(t>=r.length)throw new Xa("Array index out of bounds: "+t+" > "+(r.length-1)+".");if(t!==Math.floor(t))throw new Xa("Array index must be an integer, but found "+t+" instead.");return r[t]},Dr.prototype.eachChild=function(e){e(this.index),e(this.input)},Dr.prototype.outputDefined=function(){return!1},Dr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Wr=function(e,t){this.type=hn,this.needle=e,this.haystack=t};Wr.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,An),f=t.parse(e[2],2,An);return r&&f?Ra(r.type,[hn,In,Kt,Nn,An])?new Wr(r,f):t.error("Expected first argument to be of type boolean, string, number or null, but found "+Hi(r.type)+" instead"):null},Wr.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!Wi(t,["boolean","string","number","null"]))throw new Xa("Expected first argument to be of type boolean, string, number or null, but found "+Hi(Yi(t))+" instead.");if(!Wi(r,["string","array"]))throw new Xa("Expected second argument to be of type array or string, but found "+Hi(Yi(r))+" instead.");return r.indexOf(t)>=0},Wr.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},Wr.prototype.outputDefined=function(){return!0},Wr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var ln=function(e,t,r){this.type=Kt,this.needle=e,this.haystack=t,this.fromIndex=r};ln.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,An),f=t.parse(e[2],2,An);if(!r||!f)return null;if(!Ra(r.type,[hn,In,Kt,Nn,An]))return t.error("Expected first argument to be of type boolean, string, number or null, but found "+Hi(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,Kt);return v?new ln(r,f,v):null}return new ln(r,f)},ln.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Wi(t,["boolean","string","number","null"]))throw new Xa("Expected first argument to be of type boolean, string, number or null, but found "+Hi(Yi(t))+" instead.");if(!Wi(r,["string","array"]))throw new Xa("Expected second argument to be of type array or string, but found "+Hi(Yi(r))+" instead.");if(this.fromIndex){var f=this.fromIndex.evaluate(e);return r.indexOf(t,f)}return r.indexOf(t)},ln.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},ln.prototype.outputDefined=function(){return!1},ln.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Li=function(e,t,r,f,v,g){this.inputType=e,this.type=t,this.input=r,this.cases=f,this.outputs=v,this.otherwise=g};Li.parse=function(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return t.error("Expected an even number of arguments.");var r,f;t.expectedType&&t.expectedType.kind!=="value"&&(f=t.expectedType);for(var v={},g=[],x=2;x<e.length-1;x+=2){var P=e[x],k=e[x+1];Array.isArray(P)||(P=[P]);var Z=t.concat(x);if(P.length===0)return Z.error("Expected at least one branch label.");for(var X=0,re=P;X<re.length;X+=1){var he=re[X];if(typeof he!="number"&&typeof he!="string")return Z.error("Branch labels must be numbers or strings.");if(typeof he=="number"&&Math.abs(he)>Number.MAX_SAFE_INTEGER)return Z.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof he=="number"&&Math.floor(he)!==he)return Z.error("Numeric branch labels must be integer values.");if(r){if(Z.checkSubtype(r,Yi(he)))return null}else r=Yi(he);if(v[String(he)]!==void 0)return Z.error("Branch labels must be unique.");v[String(he)]=g.length}var be=t.parse(k,x,f);if(!be)return null;f=f||be.type,g.push(be)}var Ve=t.parse(e[1],1,An);if(!Ve)return null;var We=t.parse(e[e.length-1],e.length-1,f);return We?Ve.type.kind!=="value"&&t.concat(1).checkSubtype(r,Ve.type)?null:new Li(r,f,Ve,v,g,We):null},Li.prototype.evaluate=function(e){var t=this.input.evaluate(e);return(Yi(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)},Li.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},Li.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})&&this.otherwise.outputDefined()},Li.prototype.serialize=function(){for(var e=this,t=["match",this.input.serialize()],r=[],f={},v=0,g=Object.keys(this.cases).sort();v<g.length;v+=1){var x=g[v];(re=f[this.cases[x]])===void 0?(f[this.cases[x]]=r.length,r.push([this.cases[x],[x]])):r[re][1].push(x)}for(var P=function(be){return e.inputType.kind==="number"?Number(be):be},k=0,Z=r;k<Z.length;k+=1){var X=Z[k],re=X[0],he=X[1];t.push(he.length===1?P(he[0]):he.map(P)),t.push(this.outputs[outputIndex$1].serialize())}return t.push(this.otherwise.serialize()),t};var Ei=function(e,t,r){this.type=e,this.branches=t,this.otherwise=r};Ei.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return t.error("Expected an odd number of arguments.");var r;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);for(var f=[],v=1;v<e.length-1;v+=2){var g=t.parse(e[v],v,hn);if(!g)return null;var x=t.parse(e[v+1],v+1,r);if(!x)return null;f.push([g,x]),r=r||x.type}var P=t.parse(e[e.length-1],e.length-1,r);return P?new Ei(r,f,P):null},Ei.prototype.evaluate=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];if(f[0].evaluate(e))return v.evaluate(e)}return this.otherwise.evaluate(e)},Ei.prototype.eachChild=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];e(f[0]),e(v)}e(this.otherwise)},Ei.prototype.outputDefined=function(){return this.branches.every(function(e){return e[1].outputDefined()})&&this.otherwise.outputDefined()},Ei.prototype.serialize=function(){var e=["case"];return this.eachChild(function(t){e.push(t.serialize())}),e};var ha=function(e,t,r,f){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=f};function Pa(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function ya(e,t,r,f){return f.compare(t,r)===0}function _i(e,t,r){var f=e!=="=="&&e!=="!=";return function(){function v(g,x,P){this.type=hn,this.lhs=g,this.rhs=x,this.collator=P,this.hasUntypedArgument=g.type.kind==="value"||x.type.kind==="value"}return v.parse=function(g,x){if(g.length!==3&&g.length!==4)return x.error("Expected two or three arguments.");var P=g[0],k=x.parse(g[1],1,An);if(!k)return null;if(!Pa(P,k.type))return x.concat(1).error('"'+P+`" comparisons are not supported for type '`+Hi(k.type)+"'.");var Z=x.parse(g[2],2,An);if(!Z)return null;if(!Pa(P,Z.type))return x.concat(2).error('"'+P+`" comparisons are not supported for type '`+Hi(Z.type)+"'.");if(k.type.kind!==Z.type.kind&&k.type.kind!=="value"&&Z.type.kind!=="value")return x.error("Cannot compare types '"+Hi(k.type)+"' and '"+Hi(Z.type)+"'.");f&&(k.type.kind==="value"&&Z.type.kind!=="value"?k=new xa(Z.type,[k]):k.type.kind!=="value"&&Z.type.kind==="value"&&(Z=new xa(k.type,[Z])));var X=null;if(g.length===4){if(k.type.kind!=="string"&&Z.type.kind!=="string"&&k.type.kind!=="value"&&Z.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(!(X=x.parse(g[3],3,Di)))return null}return new v(k,Z,X)},v.prototype.evaluate=function(g){var x=this.lhs.evaluate(g),P=this.rhs.evaluate(g);if(f&&this.hasUntypedArgument){var k=Yi(x),Z=Yi(P);if(k.kind!==Z.kind||k.kind!=="string"&&k.kind!=="number")throw new Xa('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+k.kind+", "+Z.kind+") instead.")}if(this.collator&&!f&&this.hasUntypedArgument){var X=Yi(x),re=Yi(P);if(X.kind!=="string"||re.kind!=="string")return t(g,x,P)}return this.collator?r(g,x,P,this.collator.evaluate(g)):t(g,x,P)},v.prototype.eachChild=function(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)},v.prototype.outputDefined=function(){return!0},v.prototype.serialize=function(){var g=[e];return this.eachChild(function(x){g.push(x.serialize())}),g},v}()}ha.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,An),f=t.parse(e[2],2,Kt);if(!r||!f)return null;if(!Ra(r.type,[na(An),In,An]))return t.error("Expected first argument to be of type array or string, but found "+Hi(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,Kt);return v?new ha(r.type,r,f,v):null}return new ha(r.type,r,f)},ha.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!Wi(t,["string","array"]))throw new Xa("Expected first argument to be of type array or string, but found "+Hi(Yi(t))+" instead.");if(this.endIndex){var f=this.endIndex.evaluate(e);return t.slice(r,f)}return t.slice(r)},ha.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},ha.prototype.outputDefined=function(){return!1},ha.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var mo=_i("==",function(e,t,r){return t===r},ya),wo=_i("!=",function(e,t,r){return t!==r},function(e,t,r,f){return!ya(0,t,r,f)}),Js=_i("<",function(e,t,r){return t<r},function(e,t,r,f){return f.compare(t,r)<0}),hu=_i(">",function(e,t,r){return t>r},function(e,t,r,f){return f.compare(t,r)>0}),Qs=_i("<=",function(e,t,r){return t<=r},function(e,t,r,f){return f.compare(t,r)<=0}),ku=_i(">=",function(e,t,r){return t>=r},function(e,t,r,f){return f.compare(t,r)>=0}),Yo=function(e,t,r,f,v){this.type=In,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=f,this.maxFractionDigits=v};Yo.parse=function(e,t){if(e.length!==3)return t.error("Expected two arguments.");var r=t.parse(e[1],1,Kt);if(!r)return null;var f=e[2];if(typeof f!="object"||Array.isArray(f))return t.error("NumberFormat options argument must be an object.");var v=null;if(f.locale&&!(v=t.parse(f.locale,1,In)))return null;var g=null;if(f.currency&&!(g=t.parse(f.currency,1,In)))return null;var x=null;if(f["min-fraction-digits"]&&!(x=t.parse(f["min-fraction-digits"],1,Kt)))return null;var P=null;return f["max-fraction-digits"]&&!(P=t.parse(f["max-fraction-digits"],1,Kt))?null:new Yo(r,v,g,x,P)},Yo.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},Yo.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},Yo.prototype.outputDefined=function(){return!1},Yo.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var ms=function(e){this.type=Kt,this.input=e};ms.parse=function(e,t){if(e.length!==2)return t.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?t.error("Expected argument of type string or array, but found "+Hi(r.type)+" instead."):new ms(r):null},ms.prototype.evaluate=function(e){var t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new Xa("Expected value to be of type string or array, but found "+Hi(Yi(t))+" instead.")},ms.prototype.eachChild=function(e){e(this.input)},ms.prototype.outputDefined=function(){return!1},ms.prototype.serialize=function(){var e=["length"];return this.eachChild(function(t){e.push(t.serialize())}),e};var no={"==":mo,"!=":wo,">":hu,"<":Js,">=":ku,"<=":Qs,array:xa,at:Dr,boolean:xa,case:Ei,coalesce:Dt,collator:ss,format:Do,image:ko,in:Wr,"index-of":ln,interpolate:Ie,"interpolate-hcl":Ie,"interpolate-lab":Ie,length:ms,let:Nt,literal:Ki,match:Li,number:xa,"number-format":Yo,object:xa,slice:ha,step:As,string:xa,"to-boolean":vo,"to-color":vo,"to-number":vo,"to-string":vo,var:cs,within:es};function Ma(e,t){var r=t[0],f=t[1],v=t[2],g=t[3];r=r.evaluate(e),f=f.evaluate(e),v=v.evaluate(e);var x=g?g.evaluate(e):1,P=cu(r,f,v,x);if(P)throw new Xa(P);return new Xi(r/255*x,f/255*x,v/255*x,x)}function qs(e,t){return e in t}function yl(e,t){var r=t[e];return r===void 0?null:r}function gs(e){return{type:e}}function Ol(e){return{result:"success",value:e}}function eu(e){return{result:"error",value:e}}function tu(e){return e["property-type"]==="data-driven"||e["property-type"]==="cross-faded-data-driven"}function mc(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Fu(e){return!!e.expression&&e.expression.interpolated}function Ia(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function _l(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function $c(e){return e}function Bu(e,t,r){return e!==void 0?e:t!==void 0?t:r!==void 0?r:void 0}function xl(e,t,r,f,v){return Bu(typeof r===v?f[r]:void 0,e.default,t.default)}function Jc(e,t,r){if(Ia(r)!=="number")return Bu(e.default,t.default);var f=e.stops.length;if(f===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[f-1][0])return e.stops[f-1][1];var v=$s(e.stops.map(function(g){return g[0]}),r);return e.stops[v][1]}function $u(e,t,r){var f=e.base!==void 0?e.base:1;if(Ia(r)!=="number")return Bu(e.default,t.default);var v=e.stops.length;if(v===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[v-1][0])return e.stops[v-1][1];var g=$s(e.stops.map(function(re){return re[0]}),r),x=function(re,he,be,Ve){var We=Ve-be,vt=re-be;return We===0?0:he===1?vt/We:(Math.pow(he,vt)-1)/(Math.pow(he,We)-1)}(r,f,e.stops[g][0],e.stops[g+1][0]),P=e.stops[g][1],k=e.stops[g+1][1],Z=Co[t.type]||$c;if(e.colorSpace&&e.colorSpace!=="rgb"){var X=fe[e.colorSpace];Z=function(re,he){return X.reverse(X.interpolate(X.forward(re),X.forward(he),x))}}return typeof P.evaluate=="function"?{evaluate:function(){for(var re=[],he=arguments.length;he--;)re[he]=arguments[he];var be=P.evaluate.apply(void 0,re),Ve=k.evaluate.apply(void 0,re);if(be!==void 0&&Ve!==void 0)return Z(be,Ve,x)}}:Z(P,k,x)}function Yl(e,t,r){return t.type==="color"?r=Xi.parse(r):t.type==="formatted"?r=za.fromString(r.toString()):t.type==="resolvedImage"?r=$i.fromString(r.toString()):Ia(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),Bu(r,e.default,t.default)}co.register(no,{error:[{kind:"error"},[In],function(e,t){throw new Xa(t[0].evaluate(e))}],typeof:[In,[An],function(e,t){return Hi(Yi(t[0].evaluate(e)))}],"to-rgba":[na(Kt,4),[mn],function(e,t){return t[0].evaluate(e).toArray()}],rgb:[mn,[Kt,Kt,Kt],Ma],rgba:[mn,[Kt,Kt,Kt,Kt],Ma],has:{type:hn,overloads:[[[In],function(e,t){return qs(t[0].evaluate(e),e.properties())}],[[In,Bi],function(e,t){var r=t[1];return qs(t[0].evaluate(e),r.evaluate(e))}]]},get:{type:An,overloads:[[[In],function(e,t){return yl(t[0].evaluate(e),e.properties())}],[[In,Bi],function(e,t){var r=t[1];return yl(t[0].evaluate(e),r.evaluate(e))}]]},"feature-state":[An,[In],function(e,t){return yl(t[0].evaluate(e),e.featureState||{})}],properties:[Bi,[],function(e){return e.properties()}],"geometry-type":[In,[],function(e){return e.geometryType()}],id:[An,[],function(e){return e.id()}],zoom:[Kt,[],function(e){return e.globals.zoom}],"heatmap-density":[Kt,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[Kt,[],function(e){return e.globals.lineProgress||0}],accumulated:[An,[],function(e){return e.globals.accumulated===void 0?null:e.globals.accumulated}],"+":[Kt,gs(Kt),function(e,t){for(var r=0,f=0,v=t;f<v.length;f+=1)r+=v[f].evaluate(e);return r}],"*":[Kt,gs(Kt),function(e,t){for(var r=1,f=0,v=t;f<v.length;f+=1)r*=v[f].evaluate(e);return r}],"-":{type:Kt,overloads:[[[Kt,Kt],function(e,t){var r=t[1];return t[0].evaluate(e)-r.evaluate(e)}],[[Kt],function(e,t){return-t[0].evaluate(e)}]]},"/":[Kt,[Kt,Kt],function(e,t){var r=t[1];return t[0].evaluate(e)/r.evaluate(e)}],"%":[Kt,[Kt,Kt],function(e,t){var r=t[1];return t[0].evaluate(e)%r.evaluate(e)}],ln2:[Kt,[],function(){return Math.LN2}],pi:[Kt,[],function(){return Math.PI}],e:[Kt,[],function(){return Math.E}],"^":[Kt,[Kt,Kt],function(e,t){var r=t[1];return Math.pow(t[0].evaluate(e),r.evaluate(e))}],sqrt:[Kt,[Kt],function(e,t){return Math.sqrt(t[0].evaluate(e))}],log10:[Kt,[Kt],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN10}],ln:[Kt,[Kt],function(e,t){return Math.log(t[0].evaluate(e))}],log2:[Kt,[Kt],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN2}],sin:[Kt,[Kt],function(e,t){return Math.sin(t[0].evaluate(e))}],cos:[Kt,[Kt],function(e,t){return Math.cos(t[0].evaluate(e))}],tan:[Kt,[Kt],function(e,t){return Math.tan(t[0].evaluate(e))}],asin:[Kt,[Kt],function(e,t){return Math.asin(t[0].evaluate(e))}],acos:[Kt,[Kt],function(e,t){return Math.acos(t[0].evaluate(e))}],atan:[Kt,[Kt],function(e,t){return Math.atan(t[0].evaluate(e))}],min:[Kt,gs(Kt),function(e,t){return Math.min.apply(Math,t.map(function(r){return r.evaluate(e)}))}],max:[Kt,gs(Kt),function(e,t){return Math.max.apply(Math,t.map(function(r){return r.evaluate(e)}))}],abs:[Kt,[Kt],function(e,t){return Math.abs(t[0].evaluate(e))}],round:[Kt,[Kt],function(e,t){var r=t[0].evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[Kt,[Kt],function(e,t){return Math.floor(t[0].evaluate(e))}],ceil:[Kt,[Kt],function(e,t){return Math.ceil(t[0].evaluate(e))}],"filter-==":[hn,[In,An],function(e,t){var r=t[0],f=t[1];return e.properties()[r.value]===f.value}],"filter-id-==":[hn,[An],function(e,t){var r=t[0];return e.id()===r.value}],"filter-type-==":[hn,[In],function(e,t){var r=t[0];return e.geometryType()===r.value}],"filter-<":[hn,[In,An],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],g=f.value;return typeof v==typeof g&&v<g}],"filter-id-<":[hn,[An],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<v}],"filter->":[hn,[In,An],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],g=f.value;return typeof v==typeof g&&v>g}],"filter-id->":[hn,[An],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>v}],"filter-<=":[hn,[In,An],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],g=f.value;return typeof v==typeof g&&v<=g}],"filter-id-<=":[hn,[An],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<=v}],"filter->=":[hn,[In,An],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],g=f.value;return typeof v==typeof g&&v>=g}],"filter-id->=":[hn,[An],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>=v}],"filter-has":[hn,[An],function(e,t){return t[0].value in e.properties()}],"filter-has-id":[hn,[],function(e){return e.id()!==null&&e.id()!==void 0}],"filter-type-in":[hn,[na(In)],function(e,t){return t[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[hn,[na(An)],function(e,t){return t[0].value.indexOf(e.id())>=0}],"filter-in-small":[hn,[In,na(An)],function(e,t){var r=t[0];return t[1].value.indexOf(e.properties()[r.value])>=0}],"filter-in-large":[hn,[In,na(An)],function(e,t){var r=t[0],f=t[1];return function(v,g,x,P){for(;x<=P;){var k=x+P>>1;if(g[k]===v)return!0;g[k]>v?P=k-1:x=k+1}return!1}(e.properties()[r.value],f.value,0,f.value.length-1)}],all:{type:hn,overloads:[[[hn,hn],function(e,t){var r=t[1];return t[0].evaluate(e)&&r.evaluate(e)}],[gs(hn),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(!f[r].evaluate(e))return!1;return!0}]]},any:{type:hn,overloads:[[[hn,hn],function(e,t){var r=t[1];return t[0].evaluate(e)||r.evaluate(e)}],[gs(hn),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(f[r].evaluate(e))return!0;return!1}]]},"!":[hn,[hn],function(e,t){return!t[0].evaluate(e)}],"is-supported-script":[hn,[In],function(e,t){var r=e.globals&&e.globals.isSupportedScript;return!r||r(t[0].evaluate(e))}],upcase:[In,[In],function(e,t){return t[0].evaluate(e).toUpperCase()}],downcase:[In,[In],function(e,t){return t[0].evaluate(e).toLowerCase()}],concat:[In,gs(An),function(e,t){return t.map(function(r){return xo(r.evaluate(e))}).join("")}],"resolved-locale":[In,[Di],function(e,t){return t[0].evaluate(e).resolvedLocale()}]});var Iu=function(e,t){this.expression=e,this._warningHistory={},this._evaluator=new Da,this._defaultValue=t?function(r){return r.type==="color"&&_l(r.default)?new Xi(0,0,0,0):r.type==="color"?Xi.parse(r.default)||null:r.default===void 0?null:r.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null};function Ju(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in no}function bl(e,t){var r=new Us(no,[],t?function(v){var g={color:mn,string:In,number:Kt,enum:In,boolean:hn,formatted:ra,resolvedImage:hi};return v.type==="array"?na(g[v.value]||An,v.length):g[v.type]}(t):void 0),f=r.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Ol(new Iu(f,t)):eu(r.errors)}Iu.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,g){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)},Iu.prototype.evaluate=function(e,t,r,f,v,g){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=g||null;try{var x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new Xa("Expected value to be one of "+Object.keys(this._enumValues).map(function(P){return JSON.stringify(P)}).join(", ")+", but found "+JSON.stringify(x)+" instead.");return x}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console!="undefined"&&console.warn(P.message)),this._defaultValue}};var Sl=function(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!ls(t.expression)};Sl.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,g){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,g)},Sl.prototype.evaluate=function(e,t,r,f,v,g){return this._styleExpression.evaluate(e,t,r,f,v,g)};var Qu=function(e,t,r,f){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!ls(t.expression),this.interpolationType=f};function El(e,t){if((e=bl(e,t)).result==="error")return e;var r=e.value.expression,f=ts(r);if(!f&&!tu(t))return eu([new Nr("","data expressions not supported")]);var v=ws(r,["zoom"]);if(!v&&!mc(t))return eu([new Nr("","zoom expressions not supported")]);var g=function x(P){var k=null;if(P instanceof Nt)k=x(P.result);else if(P instanceof Dt)for(var Z=0,X=P.args;Z<X.length&&!(k=x(X[Z]));Z+=1);else(P instanceof As||P instanceof Ie)&&P.input instanceof co&&P.input.name==="zoom"&&(k=P);return k instanceof Nr||P.eachChild(function(re){var he=x(re);he instanceof Nr?k=he:!k&&he?k=new Nr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):k&&he&&k!==he&&(k=new Nr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),k}(r);return g||v?g instanceof Nr?eu([g]):g instanceof Ie&&!Fu(t)?eu([new Nr("",'"interpolate" expressions cannot be used with this property')]):Ol(g?new Qu(f?"camera":"composite",e.value,g.labels,g instanceof Ie?g.interpolation:void 0):new Sl(f?"constant":"source",e.value)):eu([new Nr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Qu.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,g){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,g)},Qu.prototype.evaluate=function(e,t,r,f,v,g){return this._styleExpression.evaluate(e,t,r,f,v,g)},Qu.prototype.interpolationFactor=function(e,t,r){return this.interpolationType?Ie.interpolationFactor(this.interpolationType,e,t,r):0};var qu=function(e,t){this._parameters=e,this._specification=t,Sr(this,function r(f,v){var g,x,P,k=v.type==="color",Z=f.stops&&typeof f.stops[0][0]=="object",X=Z||!(Z||f.property!==void 0),re=f.type||(Fu(v)?"exponential":"interval");if(k&&((f=Sr({},f)).stops&&(f.stops=f.stops.map(function(Vn){return[Vn[0],Xi.parse(Vn[1])]})),f.default=Xi.parse(f.default?f.default:v.default)),f.colorSpace&&f.colorSpace!=="rgb"&&!fe[f.colorSpace])throw new Error("Unknown color space: "+f.colorSpace);if(re==="exponential")g=$u;else if(re==="interval")g=Jc;else if(re==="categorical"){g=xl,x=Object.create(null);for(var he=0,be=f.stops;he<be.length;he+=1){var Ve=be[he];x[Ve[0]]=Ve[1]}P=typeof f.stops[0][0]}else{if(re!=="identity")throw new Error('Unknown function type "'+re+'"');g=Yl}if(Z){for(var We={},vt=[],tt=0;tt<f.stops.length;tt++){var It=f.stops[tt],Wt=It[0].zoom;We[Wt]===void 0&&(We[Wt]={zoom:Wt,type:f.type,property:f.property,default:f.default,stops:[]},vt.push(Wt)),We[Wt].stops.push([It[0].value,It[1]])}for(var pr=[],mr=0,Br=vt;mr<Br.length;mr+=1){var sn=Br[mr];pr.push([We[sn].zoom,r(We[sn],v)])}var Cn={name:"linear"};return{kind:"composite",interpolationType:Cn,interpolationFactor:Ie.interpolationFactor.bind(void 0,Cn),zoomStops:pr.map(function(Vn){return Vn[0]}),evaluate:function(Vn,di){var Kn=Vn.zoom;return $u({stops:pr,base:f.base},v,Kn).evaluate(Kn,di)}}}if(X){var fi=re==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:fi,interpolationFactor:Ie.interpolationFactor.bind(void 0,fi),zoomStops:f.stops.map(function(Vn){return Vn[0]}),evaluate:function(Vn){return g(f,v,Vn.zoom,x,P)}}}return{kind:"source",evaluate:function(Vn,di){var Kn=di&&di.properties?di.properties[f.property]:void 0;return Kn===void 0?Bu(f.default,v.default):g(f,v,Kn,x,P)}}}(this._parameters,this._specification))};function ru(e){var t=e.key,r=e.value,f=e.valueSpec||{},v=e.objectElementValidators||{},g=e.style,x=e.styleSpec,P=[],k=Ia(r);if(k!=="object")return[new _e(t,r,"object expected, "+k+" found")];for(var Z in r){var X=Z.split(".")[0],re=f[X]||f["*"],he=void 0;if(v[X])he=v[X];else if(f[X])he=sa;else if(v["*"])he=v["*"];else{if(!f["*"]){P.push(new _e(t,r[Z],'unknown property "'+Z+'"'));continue}he=sa}P=P.concat(he({key:(t&&t+".")+Z,value:r[Z],valueSpec:re,style:g,styleSpec:x,object:r,objectKey:Z},r))}for(var be in f)v[be]||f[be].required&&f[be].default===void 0&&r[be]===void 0&&P.push(new _e(t,r,'missing required property "'+be+'"'));return P}function Kl(e){var t=e.value,r=e.valueSpec,f=e.style,v=e.styleSpec,g=e.key,x=e.arrayElementValidator||sa;if(Ia(t)!=="array")return[new _e(g,t,"array expected, "+Ia(t)+" found")];if(r.length&&t.length!==r.length)return[new _e(g,t,"array length "+r.length+" expected, length "+t.length+" found")];if(r["min-length"]&&t.length<r["min-length"])return[new _e(g,t,"array length at least "+r["min-length"]+" expected, length "+t.length+" found")];var P={type:r.value,values:r.values};v.$version<7&&(P.function=r.function),Ia(r.value)==="object"&&(P=r.value);for(var k=[],Z=0;Z<t.length;Z++)k=k.concat(x({array:t,arrayIndex:Z,value:t[Z],valueSpec:P,style:f,styleSpec:v,key:g+"["+Z+"]"}));return k}function Nu(e){var t=e.key,r=e.value,f=e.valueSpec,v=Ia(r);return v==="number"&&r!=r&&(v="NaN"),v!=="number"?[new _e(t,r,"number expected, "+v+" found")]:"minimum"in f&&r<f.minimum?[new _e(t,r,r+" is less than the minimum value "+f.minimum)]:"maximum"in f&&r>f.maximum?[new _e(t,r,r+" is greater than the maximum value "+f.maximum)]:[]}function Dc(e){var t,r,f,v=e.valueSpec,g=Ht(e.value.type),x={},P=g!=="categorical"&&e.value.property===void 0,k=!P,Z=Ia(e.value.stops)==="array"&&Ia(e.value.stops[0])==="array"&&Ia(e.value.stops[0][0])==="object",X=ru({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(be){if(g==="identity")return[new _e(be.key,be.value,'identity function may not have a "stops" property')];var Ve=[],We=be.value;return Ve=Ve.concat(Kl({key:be.key,value:We,valueSpec:be.valueSpec,style:be.style,styleSpec:be.styleSpec,arrayElementValidator:re})),Ia(We)==="array"&&We.length===0&&Ve.push(new _e(be.key,We,"array must have at least one stop")),Ve},default:function(be){return sa({key:be.key,value:be.value,valueSpec:v,style:be.style,styleSpec:be.styleSpec})}}});return g==="identity"&&P&&X.push(new _e(e.key,e.value,'missing required property "property"')),g==="identity"||e.value.stops||X.push(new _e(e.key,e.value,'missing required property "stops"')),g==="exponential"&&e.valueSpec.expression&&!Fu(e.valueSpec)&&X.push(new _e(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(k&&!tu(e.valueSpec)?X.push(new _e(e.key,e.value,"property functions not supported")):P&&!mc(e.valueSpec)&&X.push(new _e(e.key,e.value,"zoom functions not supported"))),g!=="categorical"&&!Z||e.value.property!==void 0||X.push(new _e(e.key,e.value,'"property" property is required')),X;function re(be){var Ve=[],We=be.value,vt=be.key;if(Ia(We)!=="array")return[new _e(vt,We,"array expected, "+Ia(We)+" found")];if(We.length!==2)return[new _e(vt,We,"array length 2 expected, length "+We.length+" found")];if(Z){if(Ia(We[0])!=="object")return[new _e(vt,We,"object expected, "+Ia(We[0])+" found")];if(We[0].zoom===void 0)return[new _e(vt,We,"object stop key must have zoom")];if(We[0].value===void 0)return[new _e(vt,We,"object stop key must have value")];if(f&&f>Ht(We[0].zoom))return[new _e(vt,We[0].zoom,"stop zoom values must appear in ascending order")];Ht(We[0].zoom)!==f&&(f=Ht(We[0].zoom),r=void 0,x={}),Ve=Ve.concat(ru({key:vt+"[0]",value:We[0],valueSpec:{zoom:{}},style:be.style,styleSpec:be.styleSpec,objectElementValidators:{zoom:Nu,value:he}}))}else Ve=Ve.concat(he({key:vt+"[0]",value:We[0],valueSpec:{},style:be.style,styleSpec:be.styleSpec},We));return Ju(Jt(We[1]))?Ve.concat([new _e(vt+"[1]",We[1],"expressions are not allowed in function stops.")]):Ve.concat(sa({key:vt+"[1]",value:We[1],valueSpec:v,style:be.style,styleSpec:be.styleSpec}))}function he(be,Ve){var We=Ia(be.value),vt=Ht(be.value),tt=be.value!==null?be.value:Ve;if(t){if(We!==t)return[new _e(be.key,tt,We+" stop domain type must match previous stop domain type "+t)]}else t=We;if(We!=="number"&&We!=="string"&&We!=="boolean")return[new _e(be.key,tt,"stop domain value must be a number, string, or boolean")];if(We!=="number"&&g!=="categorical"){var It="number expected, "+We+" found";return tu(v)&&g===void 0&&(It+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new _e(be.key,tt,It)]}return g!=="categorical"||We!=="number"||isFinite(vt)&&Math.floor(vt)===vt?g!=="categorical"&&We==="number"&&r!==void 0&&vt<r?[new _e(be.key,tt,"stop domain values must appear in ascending order")]:(r=vt,g==="categorical"&&vt in x?[new _e(be.key,tt,"stop domain values must be unique")]:(x[vt]=!0,[])):[new _e(be.key,tt,"integer expected, found "+vt)]}}function el(e){var t=(e.expressionContext==="property"?El:bl)(Jt(e.value),e.valueSpec);if(t.result==="error")return t.value.map(function(f){return new _e(""+e.key+f.key,e.value,f.message)});var r=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!r.outputDefined())return[new _e(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!ls(r))return[new _e(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter"&&!ls(r))return[new _e(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!ws(r,["zoom","feature-state"]))return[new _e(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!ts(r))return[new _e(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Cl(e){var t=e.key,r=e.value,f=e.valueSpec,v=[];return Array.isArray(f.values)?f.values.indexOf(Ht(r))===-1&&v.push(new _e(t,r,"expected one of ["+f.values.join(", ")+"], "+JSON.stringify(r)+" found")):Object.keys(f.values).indexOf(Ht(r))===-1&&v.push(new _e(t,r,"expected one of ["+Object.keys(f.values).join(", ")+"], "+JSON.stringify(r)+" found")),v}function Ll(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var t=0,r=e.slice(1);t<r.length;t+=1){var f=r[t];if(!Ll(f)&&typeof f!="boolean")return!1}return!0;default:return!0}}qu.deserialize=function(e){return new qu(e._parameters,e._specification)},qu.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var gc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Rl(e){if(e==null)return{filter:function(){return!0},needGeometry:!1};Ll(e)||(e=$l(e));var t=bl(e,gc);if(t.result==="error")throw new Error(t.value.map(function(r){return r.key+": "+r.message}).join(", "));return{filter:function(r,f,v){return t.value.evaluate(r,f,{},v)},needGeometry:function r(f){if(!Array.isArray(f))return!1;if(f[0]==="within")return!0;for(var v=1;v<f.length;v++)if(r(f[v]))return!0;return!1}(e)}}function kc(e,t){return e<t?-1:e>t?1:0}function $l(e){if(!e)return!0;var t,r=e[0];return e.length<=1?r!=="any":r==="=="?js(e[1],e[2],"=="):r==="!="?zu(js(e[1],e[2],"==")):r==="<"||r===">"||r==="<="||r===">="?js(e[1],e[2],r):r==="any"?(t=e.slice(1),["any"].concat(t.map($l))):r==="all"?["all"].concat(e.slice(1).map($l)):r==="none"?["all"].concat(e.slice(1).map($l).map(zu)):r==="in"?io(e[1],e.slice(2)):r==="!in"?zu(io(e[1],e.slice(2))):r==="has"?bo(e[1]):r==="!has"?zu(bo(e[1])):r!=="within"||e}function js(e,t,r){switch(e){case"$type":return["filter-type-"+r,t];case"$id":return["filter-id-"+r,t];default:return["filter-"+r,e,t]}}function io(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(function(r){return typeof r!=typeof t[0]})?["filter-in-large",e,["literal",t.sort(kc)]]:["filter-in-small",e,["literal",t]]}}function bo(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function zu(e){return["!",e]}function Ds(e){return Ll(Jt(e.value))?el(Sr({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(r){var f=r.value,v=r.key;if(Ia(f)!=="array")return[new _e(v,f,"array expected, "+Ia(f)+" found")];var g,x=r.styleSpec,P=[];if(f.length<1)return[new _e(v,f,"filter array must have at least 1 element")];switch(P=P.concat(Cl({key:v+"[0]",value:f[0],valueSpec:x.filter_operator,style:r.style,styleSpec:r.styleSpec})),Ht(f[0])){case"<":case"<=":case">":case">=":f.length>=2&&Ht(f[1])==="$type"&&P.push(new _e(v,f,'"$type" cannot be use with operator "'+f[0]+'"'));case"==":case"!=":f.length!==3&&P.push(new _e(v,f,'filter array for operator "'+f[0]+'" must have 3 elements'));case"in":case"!in":f.length>=2&&(g=Ia(f[1]))!=="string"&&P.push(new _e(v+"[1]",f[1],"string expected, "+g+" found"));for(var k=2;k<f.length;k++)g=Ia(f[k]),Ht(f[1])==="$type"?P=P.concat(Cl({key:v+"["+k+"]",value:f[k],valueSpec:x.geometry_type,style:r.style,styleSpec:r.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&P.push(new _e(v+"["+k+"]",f[k],"string, number, or boolean expected, "+g+" found"));break;case"any":case"all":case"none":for(var Z=1;Z<f.length;Z++)P=P.concat(t({key:v+"["+Z+"]",value:f[Z],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":g=Ia(f[1]),f.length!==2?P.push(new _e(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):g!=="string"&&P.push(new _e(v+"[1]",f[1],"string expected, "+g+" found"));break;case"within":g=Ia(f[1]),f.length!==2?P.push(new _e(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):g!=="object"&&P.push(new _e(v+"[1]",f[1],"object expected, "+g+" found"))}return P}(e)}function Dl(e,t){var r=e.key,f=e.style,v=e.styleSpec,g=e.value,x=e.objectKey,P=v[t+"_"+e.layerType];if(!P)return[];var k=x.match(/^(.*)-transition$/);if(t==="paint"&&k&&P[k[1]]&&P[k[1]].transition)return sa({key:r,value:g,valueSpec:v.transition,style:f,styleSpec:v});var Z,X=e.valueSpec||P[x];if(!X)return[new _e(r,g,'unknown property "'+x+'"')];if(Ia(g)==="string"&&tu(X)&&!X.tokens&&(Z=/^{([^}]+)}$/.exec(g)))return[new _e(r,g,'"'+x+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(Z[1])+" }`.")];var re=[];return e.layerType==="symbol"&&(x==="text-field"&&f&&!f.glyphs&&re.push(new _e(r,g,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&_l(Jt(g))&&Ht(g.type)==="identity"&&re.push(new _e(r,g,'"text-font" does not support identity functions'))),re.concat(sa({key:e.key,value:g,valueSpec:X,style:f,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:x}))}function Jl(e){return Dl(e,"paint")}function _u(e){return Dl(e,"layout")}function Ql(e){var t=[],r=e.value,f=e.key,v=e.style,g=e.styleSpec;r.type||r.ref||t.push(new _e(f,r,'either "type" or "ref" is required'));var x,P=Ht(r.type),k=Ht(r.ref);if(r.id)for(var Z=Ht(r.id),X=0;X<e.arrayIndex;X++){var re=v.layers[X];Ht(re.id)===Z&&t.push(new _e(f,r.id,'duplicate layer id "'+r.id+'", previously used at line '+re.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(Ve){Ve in r&&t.push(new _e(f,r[Ve],'"'+Ve+'" is prohibited for ref layers'))}),v.layers.forEach(function(Ve){Ht(Ve.id)===k&&(x=Ve)}),x?x.ref?t.push(new _e(f,r.ref,"ref cannot reference another ref layer")):P=Ht(x.type):t.push(new _e(f,r.ref,'ref layer "'+k+'" not found'));else if(P!=="background")if(r.source){var he=v.sources&&v.sources[r.source],be=he&&Ht(he.type);he?be==="vector"&&P==="raster"?t.push(new _e(f,r.source,'layer "'+r.id+'" requires a raster source')):be==="raster"&&P!=="raster"?t.push(new _e(f,r.source,'layer "'+r.id+'" requires a vector source')):be!=="vector"||r["source-layer"]?be==="raster-dem"&&P!=="hillshade"?t.push(new _e(f,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="line"||!r.paint||!r.paint["line-gradient"]||be==="geojson"&&he.lineMetrics||t.push(new _e(f,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):t.push(new _e(f,r,'layer "'+r.id+'" must specify a "source-layer"')):t.push(new _e(f,r.source,'source "'+r.source+'" not found'))}else t.push(new _e(f,r,'missing required property "source"'));return t=t.concat(ru({key:f,value:r,valueSpec:g.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return sa({key:f+".type",value:r.type,valueSpec:g.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"})},filter:Ds,layout:function(Ve){return ru({layer:r,key:Ve.key,value:Ve.value,style:Ve.style,styleSpec:Ve.styleSpec,objectElementValidators:{"*":function(We){return _u(Sr({layerType:P},We))}}})},paint:function(Ve){return ru({layer:r,key:Ve.key,value:Ve.value,style:Ve.style,styleSpec:Ve.styleSpec,objectElementValidators:{"*":function(We){return Jl(Sr({layerType:P},We))}}})}}}))}function Uu(e){var t=e.value,r=e.key,f=Ia(t);return f!=="string"?[new _e(r,t,"string expected, "+f+" found")]:[]}var ao={promoteId:function(e){var t=e.key,r=e.value;if(Ia(r)==="string")return Uu({key:t,value:r});var f=[];for(var v in r)f.push.apply(f,Uu({key:t+"."+v,value:r[v]}));return f}};function kl(e){var t=e.value,r=e.key,f=e.styleSpec,v=e.style;if(!t.type)return[new _e(r,t,'"type" is required')];var g,x=Ht(t.type);switch(x){case"vector":case"raster":case"raster-dem":return ru({key:r,value:t,valueSpec:f["source_"+x.replace("-","_")],style:e.style,styleSpec:f,objectElementValidators:ao});case"geojson":if(g=ru({key:r,value:t,valueSpec:f.source_geojson,style:v,styleSpec:f,objectElementValidators:ao}),t.cluster)for(var P in t.clusterProperties){var k=t.clusterProperties[P],Z=k[0],X=typeof Z=="string"?[Z,["accumulated"],["get",P]]:Z;g.push.apply(g,el({key:r+"."+P+".map",value:k[1],expressionContext:"cluster-map"})),g.push.apply(g,el({key:r+"."+P+".reduce",value:X,expressionContext:"cluster-reduce"}))}return g;case"video":return ru({key:r,value:t,valueSpec:f.source_video,style:v,styleSpec:f});case"image":return ru({key:r,value:t,valueSpec:f.source_image,style:v,styleSpec:f});case"canvas":return[new _e(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Cl({key:r+".type",value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,styleSpec:f})}}function Vs(e){var t=e.value,r=e.styleSpec,f=r.light,v=e.style,g=[],x=Ia(t);if(t===void 0)return g;if(x!=="object")return g.concat([new _e("light",t,"object expected, "+x+" found")]);for(var P in t){var k=P.match(/^(.*)-transition$/);g=g.concat(k&&f[k[1]]&&f[k[1]].transition?sa({key:P,value:t[P],valueSpec:r.transition,style:v,styleSpec:r}):f[P]?sa({key:P,value:t[P],valueSpec:f[P],style:v,styleSpec:r}):[new _e(P,t[P],'unknown property "'+P+'"')])}return g}var pu={"*":function(){return[]},array:Kl,boolean:function(e){var t=e.value,r=e.key,f=Ia(t);return f!=="boolean"?[new _e(r,t,"boolean expected, "+f+" found")]:[]},number:Nu,color:function(e){var t=e.key,r=e.value,f=Ia(r);return f!=="string"?[new _e(t,r,"color expected, "+f+" found")]:Ni(r)===null?[new _e(t,r,'color expected, "'+r+'" found')]:[]},constants:ct,enum:Cl,filter:Ds,function:Dc,layer:Ql,object:ru,source:kl,light:Vs,string:Uu,formatted:function(e){return Uu(e).length===0?[]:el(e)},resolvedImage:function(e){return Uu(e).length===0?[]:el(e)}};function sa(e){var t=e.value,r=e.valueSpec,f=e.styleSpec;return r.expression&&_l(Ht(t))?Dc(e):r.expression&&Ju(Jt(t))?el(e):r.type&&pu[r.type]?pu[r.type](e):ru(Sr({},e,{valueSpec:r.type?f[r.type]:r}))}function Ai(e){var t=e.value,r=e.key,f=Uu(e);return f.length||(t.indexOf("{fontstack}")===-1&&f.push(new _e(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&f.push(new _e(r,t,'"glyphs" url must include a "{range}" token'))),f}function ys(e,t){t===void 0&&(t=ae);var r=[];return r=r.concat(sa({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Ai,"*":function(){return[]}}})),e.constants&&(r=r.concat(ct({key:"constants",value:e.constants,style:e,styleSpec:t}))),du(r)}function du(e){return[].concat(e).sort(function(t,r){return t.line-r.line})}function tl(e){return function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return du(e.apply(this,t))}}ys.source=tl(kl),ys.light=tl(Vs),ys.layer=tl(Ql),ys.filter=tl(Ds),ys.paintProperty=tl(Jl),ys.layoutProperty=tl(_u);var rs=ys,Qc=rs.light,Fc=rs.paintProperty,wl=rs.layoutProperty;function Fl(e,t){var r=!1;if(t&&t.length)for(var f=0,v=t;f<v.length;f+=1)e.fire(new de(new Error(v[f].message))),r=!0;return r}var xu=Ao;function Ao(e,t,r){var f=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var v=new Int32Array(this.arrayBuffer);e=v[0],this.d=(t=v[1])+2*(r=v[2]);for(var g=0;g<this.d*this.d;g++){var x=v[3+g],P=v[3+g+1];f.push(x===P?null:v.subarray(x,P))}var k=v[3+f.length+1];this.keys=v.subarray(v[3+f.length],k),this.bboxes=v.subarray(k),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var Z=0;Z<this.d*this.d;Z++)f.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var X=r/t*e;this.min=-X,this.max=e+X}Ao.prototype.insert=function(e,t,r,f,v){this._forEachCell(t,r,f,v,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(f),this.bboxes.push(v)},Ao.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ao.prototype._insertCell=function(e,t,r,f,v,g){this.cells[v].push(g)},Ao.prototype.query=function(e,t,r,f,v){var g=this.min,x=this.max;if(e<=g&&t<=g&&x<=r&&x<=f&&!v)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(e,t,r,f,this._queryCell,P,{},v),P},Ao.prototype._queryCell=function(e,t,r,f,v,g,x,P){var k=this.cells[v];if(k!==null)for(var Z=this.keys,X=this.bboxes,re=0;re<k.length;re++){var he=k[re];if(x[he]===void 0){var be=4*he;(P?P(X[be+0],X[be+1],X[be+2],X[be+3]):e<=X[be+2]&&t<=X[be+3]&&r>=X[be+0]&&f>=X[be+1])?(x[he]=!0,g.push(Z[he])):x[he]=!1}}},Ao.prototype._forEachCell=function(e,t,r,f,v,g,x,P){for(var k=this._convertToCellCoord(e),Z=this._convertToCellCoord(t),X=this._convertToCellCoord(r),re=this._convertToCellCoord(f),he=k;he<=X;he++)for(var be=Z;be<=re;be++){var Ve=this.d*be+he;if((!P||P(this._convertFromCellCoord(he),this._convertFromCellCoord(be),this._convertFromCellCoord(he+1),this._convertFromCellCoord(be+1)))&&v.call(this,e,t,r,f,Ve,g,x,P))return}},Ao.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Ao.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Ao.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,f=0;f<this.cells.length;f++)r+=this.cells[f].length;var v=new Int32Array(t+r+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;for(var g=t,x=0;x<e.length;x++){var P=e[x];v[3+x]=g,v.set(P,g),g+=P.length}return v[3+e.length]=g,v.set(this.keys,g),v[3+e.length+1]=g+=this.keys.length,v.set(this.bboxes,g),g+=this.bboxes.length,v.buffer};var Zu=K.ImageData,Al=K.ImageBitmap,To={};function Dn(e,t,r){r===void 0&&(r={}),Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),To[e]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}for(var ho in Dn("Object",Object),xu.serialize=function(e,t){var r=e.toArrayBuffer();return t&&t.push(r),{buffer:r}},xu.deserialize=function(e){return new xu(e.buffer)},Dn("Grid",xu),Dn("Color",Xi),Dn("Error",Error),Dn("ResolvedImage",$i),Dn("StylePropertyFunction",qu),Dn("StyleExpression",Iu,{omit:["_evaluator"]}),Dn("ZoomDependentExpression",Qu),Dn("ZoomConstantExpression",Sl),Dn("CompoundExpression",co,{omit:["_evaluate"]}),no)no[ho]._classRegistryKey||Dn("Expression_"+ho,no[ho]);function bu(e){return e&&typeof ArrayBuffer!="undefined"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function ju(e){return Al&&e instanceof Al}function Ka(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(bu(e)||ju(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var r=e;return t&&t.push(r.buffer),r}if(e instanceof Zu)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){for(var f=[],v=0,g=e;v<g.length;v+=1)f.push(Ka(g[v],t));return f}if(typeof e=="object"){var x=e.constructor,P=x._classRegistryKey;if(!P)throw new Error("can't serialize object of unregistered class");var k=x.serialize?x.serialize(e,t):{};if(!x.serialize){for(var Z in e)if(e.hasOwnProperty(Z)&&!(To[P].omit.indexOf(Z)>=0)){var X=e[Z];k[Z]=To[P].shallow.indexOf(Z)>=0?X:Ka(X,t)}e instanceof Error&&(k.message=e.message)}if(k.$name)throw new Error("$name property is reserved for worker serialization logic.");return P!=="Object"&&(k.$name=P),k}throw new Error("can't serialize object of type "+typeof e)}function ks(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||bu(e)||ju(e)||ArrayBuffer.isView(e)||e instanceof Zu)return e;if(Array.isArray(e))return e.map(ks);if(typeof e=="object"){var t=e.$name||"Object",r=To[t].klass;if(!r)throw new Error("can't deserialize unregistered class "+t);if(r.deserialize)return r.deserialize(e);for(var f=Object.create(r.prototype),v=0,g=Object.keys(e);v<g.length;v+=1){var x=g[v];if(x!=="$name"){var P=e[x];f[x]=To[t].shallow.indexOf(x)>=0?P:ks(P)}}return f}throw new Error("can't deserialize object of type "+typeof e)}var yc=function(){this.first=!0};yc.prototype.update=function(e,t){var r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))};var xn={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function Ou(e){for(var t=0,r=e;t<r.length;t+=1)if(_c(r[t].charCodeAt(0)))return!0;return!1}function _c(e){return!(e!==746&&e!==747&&(e<4352||!(xn["Bopomofo Extended"](e)||xn.Bopomofo(e)||xn["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||xn["CJK Compatibility Ideographs"](e)||xn["CJK Compatibility"](e)||xn["CJK Radicals Supplement"](e)||xn["CJK Strokes"](e)||!(!xn["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||xn["CJK Unified Ideographs Extension A"](e)||xn["CJK Unified Ideographs"](e)||xn["Enclosed CJK Letters and Months"](e)||xn["Hangul Compatibility Jamo"](e)||xn["Hangul Jamo Extended-A"](e)||xn["Hangul Jamo Extended-B"](e)||xn["Hangul Jamo"](e)||xn["Hangul Syllables"](e)||xn.Hiragana(e)||xn["Ideographic Description Characters"](e)||xn.Kanbun(e)||xn["Kangxi Radicals"](e)||xn["Katakana Phonetic Extensions"](e)||xn.Katakana(e)&&e!==12540||!(!xn["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!xn["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||xn["Unified Canadian Aboriginal Syllabics"](e)||xn["Unified Canadian Aboriginal Syllabics Extended"](e)||xn["Vertical Forms"](e)||xn["Yijing Hexagram Symbols"](e)||xn["Yi Syllables"](e)||xn["Yi Radicals"](e))))}function nu(e){return!(_c(e)||function(t){return!!(xn["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||xn["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||xn["Letterlike Symbols"](t)||xn["Number Forms"](t)||xn["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||xn["Control Pictures"](t)&&t!==9251||xn["Optical Character Recognition"](t)||xn["Enclosed Alphanumerics"](t)||xn["Geometric Shapes"](t)||xn["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||xn["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||xn["CJK Symbols and Punctuation"](t)||xn.Katakana(t)||xn["Private Use Area"](t)||xn["CJK Compatibility Forms"](t)||xn["Small Form Variants"](t)||xn["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function Za(e){return e>=1424&&e<=2303||xn["Arabic Presentation Forms-A"](e)||xn["Arabic Presentation Forms-B"](e)}function _s(e,t){return!(!t&&Za(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||xn.Khmer(e))}function Tl(e){for(var t=0,r=e;t<r.length;t+=1)if(Za(r[t].charCodeAt(0)))return!0;return!1}var iu=null,Ts="unavailable",Su=null,qc=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(Ts="error"),iu&&iu(e)};function ql(){ec.fire(new ee("pluginStateChange",{pluginStatus:Ts,pluginURL:Su}))}var ec=new Ae,Po=function(){return Ts},Gs=function(){if(Ts!=="deferred"||!Su)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ts="loading",ql(),Su&&Mn({url:Su},function(e){e?qc(e):(Ts="loaded",ql())})},Mo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Ts==="loaded"||Mo.applyArabicShaping!=null},isLoading:function(){return Ts==="loading"},setState:function(e){Ts=e.pluginStatus,Su=e.pluginURL},isParsed:function(){return Mo.applyArabicShaping!=null&&Mo.processBidirectionalText!=null&&Mo.processStyledBidirectionalText!=null},getPluginURL:function(){return Su}},ta=function(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new yc,this.transition={})};ta.prototype.isSupportedScript=function(e){return function(t,r){for(var f=0,v=t;f<v.length;f+=1)if(!_s(v[f].charCodeAt(0),r))return!1;return!0}(e,Mo.isLoaded())},ta.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},ta.prototype.getCrossfadeParameters=function(){var e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}};var Vu=function(e,t){this.property=e,this.value=t,this.expression=function(r,f){if(_l(r))return new qu(r,f);if(Ju(r)){var v=El(r,f);if(v.result==="error")throw new Error(v.value.map(function(x){return x.key+": "+x.message}).join(", "));return v.value}var g=r;return typeof r=="string"&&f.type==="color"&&(g=Xi.parse(r)),{kind:"constant",evaluate:function(){return g}}}(t===void 0?e.specification.default:t,e.specification)};Vu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Vu.prototype.possiblyEvaluate=function(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)};var vu=function(e){this.property=e,this.value=new Vu(e,void 0)};vu.prototype.transitioned=function(e,t){return new rl(this.property,this.value,t,Xt({},e.transition,this.transition),e.now)},vu.prototype.untransitioned=function(){return new rl(this.property,this.value,null,{},0)};var Ko=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};Ko.prototype.getValue=function(e){return $e(this._values[e].value.value)},Ko.prototype.setValue=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new vu(this._values[e].property)),this._values[e].value=new Vu(this._values[e].property,t===null?void 0:$e(t))},Ko.prototype.getTransition=function(e){return $e(this._values[e].transition)},Ko.prototype.setTransition=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new vu(this._values[e].property)),this._values[e].transition=$e(t)||void 0},Ko.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v);var g=this.getTransition(f);g!==void 0&&(e[f+"-transition"]=g)}return e},Ko.prototype.transitioned=function(e,t){for(var r=new Eu(this._properties),f=0,v=Object.keys(this._values);f<v.length;f+=1){var g=v[f];r._values[g]=this._values[g].transitioned(e,t._values[g])}return r},Ko.prototype.untransitioned=function(){for(var e=new Eu(this._properties),t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t];e._values[f]=this._values[f].untransitioned()}return e};var rl=function(e,t,r,f,v){this.property=e,this.value=t,this.begin=v+f.delay||0,this.end=this.begin+f.duration||0,e.specification.transition&&(f.delay||f.duration)&&(this.prior=r)};rl.prototype.possiblyEvaluate=function(e,t,r){var f=e.now||0,v=this.value.possiblyEvaluate(e,t,r),g=this.prior;if(g){if(f>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(f<this.begin)return g.possiblyEvaluate(e,t,r);var x=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,t,r),v,function(P){if(P<=0)return 0;if(P>=1)return 1;var k=P*P,Z=k*P;return 4*(P<.5?Z:3*(P-k)+Z-.75)}(x))}return v};var Eu=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};Eu.prototype.possiblyEvaluate=function(e,t,r){for(var f=new Pl(this._properties),v=0,g=Object.keys(this._values);v<g.length;v+=1){var x=g[v];f._values[x]=this._values[x].possiblyEvaluate(e,t,r)}return f},Eu.prototype.hasTransition=function(){for(var e=0,t=Object.keys(this._values);e<t.length;e+=1)if(this._values[t[e]].prior)return!0;return!1};var bi=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};bi.prototype.getValue=function(e){return $e(this._values[e].value)},bi.prototype.setValue=function(e,t){this._values[e]=new Vu(this._values[e].property,t===null?void 0:$e(t))},bi.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v)}return e},bi.prototype.possiblyEvaluate=function(e,t,r){for(var f=new Pl(this._properties),v=0,g=Object.keys(this._values);v<g.length;v+=1){var x=g[v];f._values[x]=this._values[x].possiblyEvaluate(e,t,r)}return f};var po=function(e,t,r){this.property=e,this.value=t,this.parameters=r};po.prototype.isConstant=function(){return this.value.kind==="constant"},po.prototype.constantOr=function(e){return this.value.kind==="constant"?this.value.value:e},po.prototype.evaluate=function(e,t,r,f){return this.property.evaluate(this.value,this.parameters,e,t,r,f)};var Pl=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};Pl.prototype.get=function(e){return this._values[e]};var jn=function(e){this.specification=e};jn.prototype.possiblyEvaluate=function(e,t){return e.expression.evaluate(t)},jn.prototype.interpolate=function(e,t,r){var f=Co[this.specification.type];return f?f(e,t,r):e};var Hn=function(e,t){this.specification=e,this.overrides=t};Hn.prototype.possiblyEvaluate=function(e,t,r,f){return new po(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},r,f)}:e.expression,t)},Hn.prototype.interpolate=function(e,t,r){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new po(this,{kind:"constant",value:void 0},e.parameters);var f=Co[this.specification.type];return f?new po(this,{kind:"constant",value:f(e.value.value,t.value.value,r)},e.parameters):e},Hn.prototype.evaluate=function(e,t,r,f,v,g){return e.kind==="constant"?e.value:e.evaluate(t,r,f,v,g)};var nl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f,v,g){if(r.value===void 0)return new po(this,{kind:"constant",value:void 0},f);if(r.expression.kind==="constant"){var x=r.expression.evaluate(f,null,{},v,g),P=r.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,k=this._calculate(P,P,P,f);return new po(this,{kind:"constant",value:k},f)}if(r.expression.kind==="camera"){var Z=this._calculate(r.expression.evaluate({zoom:f.zoom-1}),r.expression.evaluate({zoom:f.zoom}),r.expression.evaluate({zoom:f.zoom+1}),f);return new po(this,{kind:"constant",value:Z},f)}return new po(this,r.expression,f)},t.prototype.evaluate=function(r,f,v,g,x,P){if(r.kind==="source"){var k=r.evaluate(f,v,g,x,P);return this._calculate(k,k,k,f)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(f.zoom)-1},v,g),r.evaluate({zoom:Math.floor(f.zoom)},v,g),r.evaluate({zoom:Math.floor(f.zoom)+1},v,g),f):r.value},t.prototype._calculate=function(r,f,v,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:f}:{from:v,to:f}},t.prototype.interpolate=function(r){return r},t}(Hn),ns=function(e){this.specification=e};ns.prototype.possiblyEvaluate=function(e,t,r,f){if(e.value!==void 0){if(e.expression.kind==="constant"){var v=e.expression.evaluate(t,null,{},r,f);return this._calculate(v,v,v,t)}return this._calculate(e.expression.evaluate(new ta(Math.floor(t.zoom-1),t)),e.expression.evaluate(new ta(Math.floor(t.zoom),t)),e.expression.evaluate(new ta(Math.floor(t.zoom+1),t)),t)}},ns.prototype._calculate=function(e,t,r,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}},ns.prototype.interpolate=function(e){return e};var fs=function(e){this.specification=e};fs.prototype.possiblyEvaluate=function(e,t,r,f){return!!e.expression.evaluate(t,null,{},r,f)},fs.prototype.interpolate=function(){return!1};var Io=function(e){for(var t in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var r=e[t];r.specification.overridable&&this.overridableProperties.push(t);var f=this.defaultPropertyValues[t]=new Vu(r,void 0),v=this.defaultTransitionablePropertyValues[t]=new vu(r);this.defaultTransitioningPropertyValues[t]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=f.possiblyEvaluate({})}};Dn("DataDrivenProperty",Hn),Dn("DataConstantProperty",jn),Dn("CrossFadedDataDrivenProperty",nl),Dn("CrossFadedProperty",ns),Dn("ColorRampProperty",fs);var au=function(e){function t(r,f){if(e.call(this),this.id=r.id,this.type=r.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},r.type!=="custom"&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),f.layout&&(this._unevaluatedLayout=new bi(f.layout)),f.paint)){for(var v in this._transitionablePaint=new Ko(f.paint),r.paint)this.setPaintProperty(v,r.paint[v],{validate:!1});for(var g in r.layout)this.setLayoutProperty(g,r.layout[g],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Pl(f.paint)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},t.prototype.getLayoutProperty=function(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)},t.prototype.setLayoutProperty=function(r,f,v){v===void 0&&(v={}),f!=null&&this._validate(wl,"layers."+this.id+".layout."+r,r,f,v)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,f):this.visibility=f)},t.prototype.getPaintProperty=function(r){return q(r,"-transition")?this._transitionablePaint.getTransition(r.slice(0,-"-transition".length)):this._transitionablePaint.getValue(r)},t.prototype.setPaintProperty=function(r,f,v){if(v===void 0&&(v={}),f!=null&&this._validate(Fc,"layers."+this.id+".paint."+r,r,f,v))return!1;if(q(r,"-transition"))return this._transitionablePaint.setTransition(r.slice(0,-"-transition".length),f||void 0),!1;var g=this._transitionablePaint._values[r],x=g.property.specification["property-type"]==="cross-faded-data-driven",P=g.value.isDataDriven(),k=g.value;this._transitionablePaint.setValue(r,f),this._handleSpecialPaintPropertyUpdate(r);var Z=this._transitionablePaint._values[r].value;return Z.isDataDriven()||P||x||this._handleOverridablePaintPropertyUpdate(r,k,Z)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!1},t.prototype.isHidden=function(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"},t.prototype.updateTransitions=function(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)},t.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},t.prototype.recalculate=function(r,f){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,f)},t.prototype.serialize=function(){var r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),wt(r,function(f,v){return!(f===void 0||v==="layout"&&!Object.keys(f).length||v==="paint"&&!Object.keys(f).length)})},t.prototype._validate=function(r,f,v,g,x){return x===void 0&&(x={}),(!x||x.validate!==!1)&&Fl(this,r.call(rs,{key:f,layerType:this.type,objectKey:v,value:g,styleSpec:ae,style:{glyphs:!0,sprite:!0}}))},t.prototype.is3D=function(){return!1},t.prototype.isTileClipped=function(){return!1},t.prototype.hasOffscreenPass=function(){return!1},t.prototype.resize=function(){},t.prototype.isStateDependent=function(){for(var r in this.paint._values){var f=this.paint.get(r);if(f instanceof po&&tu(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1},t}(Ae),Bc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},tc=function(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Gi=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Ui(e,t){t===void 0&&(t=1);var r=0,f=0;return{members:e.map(function(v){var g=Bc[v.type].BYTES_PER_ELEMENT,x=r=ef(r,Math.max(t,g)),P=v.components||1;return f=Math.max(f,g),r+=g*P,{name:v.name,type:v.type,components:P,offset:x}}),size:ef(r,Math.max(f,t)),alignment:t}}function ef(e,t){return Math.ceil(e/t)*t}Gi.serialize=function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},Gi.deserialize=function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t},Gi.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Gi.prototype.clear=function(){this.length=0},Gi.prototype.resize=function(e){this.reserve(e),this.length=e},Gi.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}},Gi.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Ps=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var g=2*r;return this.int16[g+0]=f,this.int16[g+1]=v,r},t}(Gi);Ps.prototype.bytesPerElement=4,Dn("StructArrayLayout2i4",Ps);var Ml=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,g)},t.prototype.emplace=function(r,f,v,g,x){var P=4*r;return this.int16[P+0]=f,this.int16[P+1]=v,this.int16[P+2]=g,this.int16[P+3]=x,r},t}(Gi);Ml.prototype.bytesPerElement=8,Dn("StructArrayLayout4i8",Ml);var Ms=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,P){var k=this.length;return this.resize(k+1),this.emplace(k,r,f,v,g,x,P)},t.prototype.emplace=function(r,f,v,g,x,P,k){var Z=6*r;return this.int16[Z+0]=f,this.int16[Z+1]=v,this.int16[Z+2]=g,this.int16[Z+3]=x,this.int16[Z+4]=P,this.int16[Z+5]=k,r},t}(Gi);Ms.prototype.bytesPerElement=12,Dn("StructArrayLayout2i4i12",Ms);var Va=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,P){var k=this.length;return this.resize(k+1),this.emplace(k,r,f,v,g,x,P)},t.prototype.emplace=function(r,f,v,g,x,P,k){var Z=4*r,X=8*r;return this.int16[Z+0]=f,this.int16[Z+1]=v,this.uint8[X+4]=g,this.uint8[X+5]=x,this.uint8[X+6]=P,this.uint8[X+7]=k,r},t}(Gi);Va.prototype.bytesPerElement=8,Dn("StructArrayLayout2i4ub8",Va);var ou=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var g=2*r;return this.float32[g+0]=f,this.float32[g+1]=v,r},t}(Gi);ou.prototype.bytesPerElement=8,Dn("StructArrayLayout2f8",ou);var xs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,P,k,Z,X,re){var he=this.length;return this.resize(he+1),this.emplace(he,r,f,v,g,x,P,k,Z,X,re)},t.prototype.emplace=function(r,f,v,g,x,P,k,Z,X,re,he){var be=10*r;return this.uint16[be+0]=f,this.uint16[be+1]=v,this.uint16[be+2]=g,this.uint16[be+3]=x,this.uint16[be+4]=P,this.uint16[be+5]=k,this.uint16[be+6]=Z,this.uint16[be+7]=X,this.uint16[be+8]=re,this.uint16[be+9]=he,r},t}(Gi);xs.prototype.bytesPerElement=20,Dn("StructArrayLayout10ui20",xs);var Gu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,P,k,Z,X,re,he,be){var Ve=this.length;return this.resize(Ve+1),this.emplace(Ve,r,f,v,g,x,P,k,Z,X,re,he,be)},t.prototype.emplace=function(r,f,v,g,x,P,k,Z,X,re,he,be,Ve){var We=12*r;return this.int16[We+0]=f,this.int16[We+1]=v,this.int16[We+2]=g,this.int16[We+3]=x,this.uint16[We+4]=P,this.uint16[We+5]=k,this.uint16[We+6]=Z,this.uint16[We+7]=X,this.int16[We+8]=re,this.int16[We+9]=he,this.int16[We+10]=be,this.int16[We+11]=Ve,r},t}(Gi);Gu.prototype.bytesPerElement=24,Dn("StructArrayLayout4i4ui4i24",Gu);var il=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var g=this.length;return this.resize(g+1),this.emplace(g,r,f,v)},t.prototype.emplace=function(r,f,v,g){var x=3*r;return this.float32[x+0]=f,this.float32[x+1]=v,this.float32[x+2]=g,r},t}(Gi);il.prototype.bytesPerElement=12,Dn("StructArrayLayout3f12",il);var Il=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint32[1*r+0]=f,r},t}(Gi);Il.prototype.bytesPerElement=4,Dn("StructArrayLayout1ul4",Il);var rc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,P,k,Z,X){var re=this.length;return this.resize(re+1),this.emplace(re,r,f,v,g,x,P,k,Z,X)},t.prototype.emplace=function(r,f,v,g,x,P,k,Z,X,re){var he=10*r,be=5*r;return this.int16[he+0]=f,this.int16[he+1]=v,this.int16[he+2]=g,this.int16[he+3]=x,this.int16[he+4]=P,this.int16[he+5]=k,this.uint32[be+3]=Z,this.uint16[he+8]=X,this.uint16[he+9]=re,r},t}(Gi);rc.prototype.bytesPerElement=20,Dn("StructArrayLayout6i1ul2ui20",rc);var al=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,P){var k=this.length;return this.resize(k+1),this.emplace(k,r,f,v,g,x,P)},t.prototype.emplace=function(r,f,v,g,x,P,k){var Z=6*r;return this.int16[Z+0]=f,this.int16[Z+1]=v,this.int16[Z+2]=g,this.int16[Z+3]=x,this.int16[Z+4]=P,this.int16[Z+5]=k,r},t}(Gi);al.prototype.bytesPerElement=12,Dn("StructArrayLayout2i2i2i12",al);var ol=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x){var P=this.length;return this.resize(P+1),this.emplace(P,r,f,v,g,x)},t.prototype.emplace=function(r,f,v,g,x,P){var k=4*r,Z=8*r;return this.float32[k+0]=f,this.float32[k+1]=v,this.float32[k+2]=g,this.int16[Z+6]=x,this.int16[Z+7]=P,r},t}(Gi);ol.prototype.bytesPerElement=16,Dn("StructArrayLayout2f1f2i16",ol);var sl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,g)},t.prototype.emplace=function(r,f,v,g,x){var P=12*r,k=3*r;return this.uint8[P+0]=f,this.uint8[P+1]=v,this.float32[k+1]=g,this.float32[k+2]=x,r},t}(Gi);sl.prototype.bytesPerElement=12,Dn("StructArrayLayout2ub2f12",sl);var Cu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var g=this.length;return this.resize(g+1),this.emplace(g,r,f,v)},t.prototype.emplace=function(r,f,v,g){var x=3*r;return this.uint16[x+0]=f,this.uint16[x+1]=v,this.uint16[x+2]=g,r},t}(Gi);Cu.prototype.bytesPerElement=6,Dn("StructArrayLayout3ui6",Cu);var Hu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,P,k,Z,X,re,he,be,Ve,We,vt,tt,It){var Wt=this.length;return this.resize(Wt+1),this.emplace(Wt,r,f,v,g,x,P,k,Z,X,re,he,be,Ve,We,vt,tt,It)},t.prototype.emplace=function(r,f,v,g,x,P,k,Z,X,re,he,be,Ve,We,vt,tt,It,Wt){var pr=24*r,mr=12*r,Br=48*r;return this.int16[pr+0]=f,this.int16[pr+1]=v,this.uint16[pr+2]=g,this.uint16[pr+3]=x,this.uint32[mr+2]=P,this.uint32[mr+3]=k,this.uint32[mr+4]=Z,this.uint16[pr+10]=X,this.uint16[pr+11]=re,this.uint16[pr+12]=he,this.float32[mr+7]=be,this.float32[mr+8]=Ve,this.uint8[Br+36]=We,this.uint8[Br+37]=vt,this.uint8[Br+38]=tt,this.uint32[mr+10]=It,this.int16[pr+22]=Wt,r},t}(Gi);Hu.prototype.bytesPerElement=48,Dn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Hu);var xc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,P,k,Z,X,re,he,be,Ve,We,vt,tt,It,Wt,pr,mr,Br,sn,Cn,fi,Vn,di,Kn,oa){var Ii=this.length;return this.resize(Ii+1),this.emplace(Ii,r,f,v,g,x,P,k,Z,X,re,he,be,Ve,We,vt,tt,It,Wt,pr,mr,Br,sn,Cn,fi,Vn,di,Kn,oa)},t.prototype.emplace=function(r,f,v,g,x,P,k,Z,X,re,he,be,Ve,We,vt,tt,It,Wt,pr,mr,Br,sn,Cn,fi,Vn,di,Kn,oa,Ii){var oi=34*r,fa=17*r;return this.int16[oi+0]=f,this.int16[oi+1]=v,this.int16[oi+2]=g,this.int16[oi+3]=x,this.int16[oi+4]=P,this.int16[oi+5]=k,this.int16[oi+6]=Z,this.int16[oi+7]=X,this.uint16[oi+8]=re,this.uint16[oi+9]=he,this.uint16[oi+10]=be,this.uint16[oi+11]=Ve,this.uint16[oi+12]=We,this.uint16[oi+13]=vt,this.uint16[oi+14]=tt,this.uint16[oi+15]=It,this.uint16[oi+16]=Wt,this.uint16[oi+17]=pr,this.uint16[oi+18]=mr,this.uint16[oi+19]=Br,this.uint16[oi+20]=sn,this.uint16[oi+21]=Cn,this.uint16[oi+22]=fi,this.uint32[fa+12]=Vn,this.float32[fa+13]=di,this.float32[fa+14]=Kn,this.float32[fa+15]=oa,this.float32[fa+16]=Ii,r},t}(Gi);xc.prototype.bytesPerElement=68,Dn("StructArrayLayout8i15ui1ul4f68",xc);var wu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.float32[1*r+0]=f,r},t}(Gi);wu.prototype.bytesPerElement=4,Dn("StructArrayLayout1f4",wu);var Fs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var g=this.length;return this.resize(g+1),this.emplace(g,r,f,v)},t.prototype.emplace=function(r,f,v,g){var x=3*r;return this.int16[x+0]=f,this.int16[x+1]=v,this.int16[x+2]=g,r},t}(Gi);Fs.prototype.bytesPerElement=6,Dn("StructArrayLayout3i6",Fs);var Nc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var g=this.length;return this.resize(g+1),this.emplace(g,r,f,v)},t.prototype.emplace=function(r,f,v,g){var x=4*r;return this.uint32[2*r+0]=f,this.uint16[x+2]=v,this.uint16[x+3]=g,r},t}(Gi);Nc.prototype.bytesPerElement=8,Dn("StructArrayLayout1ul2ui8",Nc);var nc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var g=2*r;return this.uint16[g+0]=f,this.uint16[g+1]=v,r},t}(Gi);nc.prototype.bytesPerElement=4,Dn("StructArrayLayout2ui4",nc);var Bl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint16[1*r+0]=f,r},t}(Gi);Bl.prototype.bytesPerElement=2,Dn("StructArrayLayout1ui2",Bl);var ul=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,g)},t.prototype.emplace=function(r,f,v,g,x){var P=4*r;return this.float32[P+0]=f,this.float32[P+1]=v,this.float32[P+2]=g,this.float32[P+3]=x,r},t}(Gi);ul.prototype.bytesPerElement=16,Dn("StructArrayLayout4f16",ul);var i=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.anchorPoint.get=function(){return new oe(this.anchorPointX,this.anchorPointY)},Object.defineProperties(t.prototype,r),t}(tc);i.prototype.size=20;var u=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new i(this,r)},t}(rc);Dn("CollisionBoxArray",u);var o=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(f){this._structArray.uint8[this._pos1+37]=f},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(f){this._structArray.uint8[this._pos1+38]=f},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+10]=f},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(t.prototype,r),t}(tc);o.prototype.size=48;var h=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new o(this,r)},t}(Hu);Dn("PlacedSymbolArray",h);var y=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+12]=f},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},r.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(t.prototype,r),t}(tc);y.prototype.size=68;var b=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new y(this,r)},t}(xc);Dn("SymbolInstanceArray",b);var T=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getoffsetX=function(r){return this.float32[1*r+0]},t}(wu);Dn("GlyphOffsetArray",T);var D=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getx=function(r){return this.int16[3*r+0]},t.prototype.gety=function(r){return this.int16[3*r+1]},t.prototype.gettileUnitDistanceFromAnchor=function(r){return this.int16[3*r+2]},t}(Fs);Dn("SymbolLineVertexArray",D);var V=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(t.prototype,r),t}(tc);V.prototype.size=8;var se=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new V(this,r)},t}(Nc);Dn("FeatureIndexArray",se);var Ce=Ui([{name:"a_pos",components:2,type:"Int16"}],4).members,we=function(e){e===void 0&&(e=[]),this.segments=e};function Pe(e,t){return 256*(e=Cr(Math.floor(e),0,255))+Cr(Math.floor(t),0,255)}we.prototype.prepareSegment=function(e,t,r,f){var v=this.segments[this.segments.length-1];return e>we.MAX_VERTEX_ARRAY_LENGTH&&Xe("Max vertices per segment is "+we.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!v||v.vertexLength+e>we.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==f)&&(v={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},f!==void 0&&(v.sortKey=f),this.segments.push(v)),v},we.prototype.get=function(){return this.segments},we.prototype.destroy=function(){for(var e=0,t=this.segments;e<t.length;e+=1){var r=t[e];for(var f in r.vaos)r.vaos[f].destroy()}},we.simpleSegment=function(e,t,r,f){return new we([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:f,vaos:{},sortKey:0}])},we.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Dn("SegmentVector",we);var He=Ui([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ge=me(function(e){e.exports=function(t,r){var f,v,g,x,P,k,Z,X;for(v=t.length-(f=3&t.length),g=r,P=3432918353,k=461845907,X=0;X<v;)Z=255&t.charCodeAt(X)|(255&t.charCodeAt(++X))<<8|(255&t.charCodeAt(++X))<<16|(255&t.charCodeAt(++X))<<24,++X,g=27492+(65535&(x=5*(65535&(g=(g^=Z=(65535&(Z=(Z=(65535&Z)*P+(((Z>>>16)*P&65535)<<16)&4294967295)<<15|Z>>>17))*k+(((Z>>>16)*k&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(Z=0,f){case 3:Z^=(255&t.charCodeAt(X+2))<<16;case 2:Z^=(255&t.charCodeAt(X+1))<<8;case 1:g^=Z=(65535&(Z=(Z=(65535&(Z^=255&t.charCodeAt(X)))*P+(((Z>>>16)*P&65535)<<16)&4294967295)<<15|Z>>>17))*k+(((Z>>>16)*k&65535)<<16)&4294967295}return g^=t.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}}),nt=me(function(e){e.exports=function(t,r){for(var f,v=t.length,g=r^v,x=0;v>=4;)f=1540483477*(65535&(f=255&t.charCodeAt(x)|(255&t.charCodeAt(++x))<<8|(255&t.charCodeAt(++x))<<16|(255&t.charCodeAt(++x))<<24))+((1540483477*(f>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),v-=4,++x;switch(v){case 3:g^=(255&t.charCodeAt(x+2))<<16;case 2:g^=(255&t.charCodeAt(x+1))<<8;case 1:g=1540483477*(65535&(g^=255&t.charCodeAt(x)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}}),ze=Ge,it=nt;ze.murmur3=Ge,ze.murmur2=it;var bt=function(){this.ids=[],this.positions=[],this.indexed=!1};bt.prototype.add=function(e,t,r,f){this.ids.push(gr(e)),this.positions.push(t,r,f)},bt.prototype.getPositions=function(e){for(var t=gr(e),r=0,f=this.ids.length-1;r<f;){var v=r+f>>1;this.ids[v]>=t?f=v:r=v+1}for(var g=[];this.ids[r]===t;)g.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return g},bt.serialize=function(e,t){var r=new Float64Array(e.ids),f=new Uint32Array(e.positions);return function v(g,x,P,k){for(;P<k;){for(var Z=g[P+k>>1],X=P-1,re=k+1;;){do X++;while(g[X]<Z);do re--;while(g[re]>Z);if(X>=re)break;fr(g,X,re),fr(x,3*X,3*re),fr(x,3*X+1,3*re+1),fr(x,3*X+2,3*re+2)}re-P<k-re?(v(g,x,P,re),P=re+1):(v(g,x,re+1,k),k=re)}}(r,f,0,r.length-1),t&&t.push(r.buffer,f.buffer),{ids:r,positions:f}},bt.deserialize=function(e){var t=new bt;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t};var Vt=Math.pow(2,53)-1;function gr(e){var t=+e;return!isNaN(t)&&t<=Vt?t:ze(String(e))}function fr(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}Dn("FeaturePositionMap",bt);var Er=function(e,t){this.gl=e.gl,this.location=t},jr=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))},t}(Er),fn=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))},t}(Er),tn=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))},t}(Er),Zn=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))},t}(Er),si=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))},t}(Er),ui=function(e){function t(r,f){e.call(this,r,f),this.current=Xi.transparent}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))},t}(Er),dn=new Float32Array(16),ia=function(e){function t(r,f){e.call(this,r,f),this.current=dn}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(var f=1;f<16;f++)if(r[f]!==this.current[f]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}},t}(Er);function Wn(e){return[Pe(255*e.r,255*e.g),Pe(255*e.b,255*e.a)]}var xi=function(e,t,r){this.value=e,this.uniformNames=t.map(function(f){return"u_"+f}),this.type=r};xi.prototype.setUniform=function(e,t,r){e.set(r.constantOr(this.value))},xi.prototype.getBinding=function(e,t,r){return this.type==="color"?new ui(e,t):new fn(e,t)};var ji=function(e,t){this.uniformNames=t.map(function(r){return"u_"+r}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};ji.prototype.setConstantPatternPositions=function(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr},ji.prototype.setUniform=function(e,t,r,f){var v=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&e.set(v)},ji.prototype.getBinding=function(e,t,r){return r.substr(0,9)==="u_pattern"?new si(e,t):new fn(e,t)};var vi=function(e,t,r,f){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(function(v){return{name:"a_"+v,type:"Float32",components:r==="color"?2:1,offset:0}}),this.paintVertexArray=new f};vi.prototype.populatePaintArray=function(e,t,r,f,v){var g=this.paintVertexArray.length,x=this.expression.evaluate(new ta(0),t,{},f,[],v);this.paintVertexArray.resize(e),this._setPaintValue(g,e,x)},vi.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:0},r,f);this._setPaintValue(e,t,v)},vi.prototype._setPaintValue=function(e,t,r){if(this.type==="color")for(var f=Wn(r),v=e;v<t;v++)this.paintVertexArray.emplace(v,f[0],f[1]);else{for(var g=e;g<t;g++)this.paintVertexArray.emplace(g,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},vi.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},vi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Ci=function(e,t,r,f,v,g){this.expression=e,this.uniformNames=t.map(function(x){return"u_"+x+"_t"}),this.type=r,this.useIntegerZoom=f,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=t.map(function(x){return{name:"a_"+x,type:"Float32",components:r==="color"?4:2,offset:0}}),this.paintVertexArray=new g};Ci.prototype.populatePaintArray=function(e,t,r,f,v){var g=this.expression.evaluate(new ta(this.zoom),t,{},f,[],v),x=this.expression.evaluate(new ta(this.zoom+1),t,{},f,[],v),P=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(P,e,g,x)},Ci.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:this.zoom},r,f),g=this.expression.evaluate({zoom:this.zoom+1},r,f);this._setPaintValue(e,t,v,g)},Ci.prototype._setPaintValue=function(e,t,r,f){if(this.type==="color")for(var v=Wn(r),g=Wn(f),x=e;x<t;x++)this.paintVertexArray.emplace(x,v[0],v[1],g[0],g[1]);else{for(var P=e;P<t;P++)this.paintVertexArray.emplace(P,r,f);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(f))}},Ci.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Ci.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Ci.prototype.setUniform=function(e,t){var r=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,f=Cr(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);e.set(f)},Ci.prototype.getBinding=function(e,t,r){return new fn(e,t)};var Q=function(e,t,r,f,v,g){this.expression=e,this.type=t,this.useIntegerZoom=r,this.zoom=f,this.layerId=g,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v};Q.prototype.populatePaintArray=function(e,t,r){var f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(f,e,t.patterns&&t.patterns[this.layerId],r)},Q.prototype.updatePaintArray=function(e,t,r,f,v){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],v)},Q.prototype._setPaintValues=function(e,t,r,f){if(f&&r){var v=f[r.min],g=f[r.mid],x=f[r.max];if(v&&g&&x)for(var P=e;P<t;P++)this.zoomInPaintVertexArray.emplace(P,g.tl[0],g.tl[1],g.br[0],g.br[1],v.tl[0],v.tl[1],v.br[0],v.br[1],g.pixelRatio,v.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,g.tl[0],g.tl[1],g.br[0],g.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],g.pixelRatio,x.pixelRatio)}},Q.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,He.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,He.members,this.expression.isStateDependent))},Q.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var J=function(e,t,r){this.binders={},this._buffers=[];var f=[];for(var v in e.paint._values)if(r(v)){var g=e.paint.get(v);if(g instanceof po&&tu(g.property.specification)){var x=F(v,e.type),P=g.value,k=g.property.specification.type,Z=g.property.useIntegerZoom,X=g.property.specification["property-type"],re=X==="cross-faded"||X==="cross-faded-data-driven";if(P.kind==="constant")this.binders[v]=re?new ji(P.value,x):new xi(P.value,x,k),f.push("/u_"+v);else if(P.kind==="source"||re){var he=ne(v,k,"source");this.binders[v]=re?new Q(P,k,Z,t,he,e.id):new vi(P,x,k,he),f.push("/a_"+v)}else{var be=ne(v,k,"composite");this.binders[v]=new Ci(P,x,k,Z,t,be),f.push("/z_"+v)}}}this.cacheKey=f.sort().join("")};J.prototype.getMaxValue=function(e){var t=this.binders[e];return t instanceof vi||t instanceof Ci?t.maxValue:0},J.prototype.populatePaintArrays=function(e,t,r,f,v){for(var g in this.binders){var x=this.binders[g];(x instanceof vi||x instanceof Ci||x instanceof Q)&&x.populatePaintArray(e,t,r,f,v)}},J.prototype.setConstantPatternPositions=function(e,t){for(var r in this.binders){var f=this.binders[r];f instanceof ji&&f.setConstantPatternPositions(e,t)}},J.prototype.updatePaintArrays=function(e,t,r,f,v){var g=!1;for(var x in e)for(var P=0,k=t.getPositions(x);P<k.length;P+=1){var Z=k[P],X=r.feature(Z.index);for(var re in this.binders){var he=this.binders[re];if((he instanceof vi||he instanceof Ci||he instanceof Q)&&he.expression.isStateDependent===!0){var be=f.paint.get(re);he.expression=be.value,he.updatePaintArray(Z.start,Z.end,X,e[x],v),g=!0}}}return g},J.prototype.defines=function(){var e=[];for(var t in this.binders){var r=this.binders[t];(r instanceof xi||r instanceof ji)&&e.push.apply(e,r.uniformNames.map(function(f){return"#define HAS_UNIFORM_"+f}))}return e},J.prototype.getBinderAttributes=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof vi||r instanceof Ci)for(var f=0;f<r.paintVertexAttributes.length;f++)e.push(r.paintVertexAttributes[f].name);else if(r instanceof Q)for(var v=0;v<He.members.length;v++)e.push(He.members[v].name)}return e},J.prototype.getBinderUniforms=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof xi||r instanceof ji||r instanceof Ci)for(var f=0,v=r.uniformNames;f<v.length;f+=1)e.push(v[f])}return e},J.prototype.getPaintVertexBuffers=function(){return this._buffers},J.prototype.getUniforms=function(e,t){var r=[];for(var f in this.binders){var v=this.binders[f];if(v instanceof xi||v instanceof ji||v instanceof Ci)for(var g=0,x=v.uniformNames;g<x.length;g+=1){var P=x[g];if(t[P]){var k=v.getBinding(e,t[P],P);r.push({name:P,property:f,binding:k})}}}return r},J.prototype.setUniforms=function(e,t,r,f){for(var v=0,g=t;v<g.length;v+=1){var x=g[v],P=x.name,k=x.property;this.binders[k].setUniform(x.binding,f,r.get(k),P)}},J.prototype.updatePaintBuffers=function(e){for(var t in this._buffers=[],this.binders){var r=this.binders[t];if(e&&r instanceof Q){var f=e.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(r instanceof vi||r instanceof Ci)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},J.prototype.upload=function(e){for(var t in this.binders){var r=this.binders[t];(r instanceof vi||r instanceof Ci||r instanceof Q)&&r.upload(e)}this.updatePaintBuffers()},J.prototype.destroy=function(){for(var e in this.binders){var t=this.binders[e];(t instanceof vi||t instanceof Ci||t instanceof Q)&&t.destroy()}};var O=function(e,t,r){r===void 0&&(r=function(){return!0}),this.programConfigurations={};for(var f=0,v=e;f<v.length;f+=1){var g=v[f];this.programConfigurations[g.id]=new J(g,t,r)}this.needsUpload=!1,this._featureMap=new bt,this._bufferOffset=0};function F(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(t+"-","").replace(/-/g,"_")]}function ne(e,t,r){var f={color:{source:ou,composite:ul},number:{source:wu,composite:ou}},v=function(g){return{"line-pattern":{source:xs,composite:xs},"fill-pattern":{source:xs,composite:xs},"fill-extrusion-pattern":{source:xs,composite:xs}}[g]}(e);return v&&v[r]||f[t][r]}O.prototype.populatePaintArrays=function(e,t,r,f,v,g){for(var x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,t,f,v,g);t.id!==void 0&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},O.prototype.updatePaintArrays=function(e,t,r,f){for(var v=0,g=r;v<g.length;v+=1){var x=g[v];this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,t,x,f)||this.needsUpload}},O.prototype.get=function(e){return this.programConfigurations[e]},O.prototype.upload=function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}},O.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},Dn("ConstantBinder",xi),Dn("CrossFadedConstantBinder",ji),Dn("SourceExpressionBinder",vi),Dn("CrossFadedCompositeBinder",Q),Dn("CompositeExpressionBinder",Ci),Dn("ProgramConfiguration",J,{omit:["_buffers"]}),Dn("ProgramConfigurationSet",O);var xe=Math.pow(2,14)-1,pt=-xe-1;function Pt(e){for(var t=8192/e.extent,r=e.loadGeometry(),f=0;f<r.length;f++)for(var v=r[f],g=0;g<v.length;g++){var x=v[g],P=Math.round(x.x*t),k=Math.round(x.y*t);x.x=Cr(P,pt,xe),x.y=Cr(k,pt,xe),(P<x.x||P>x.x+1||k<x.y||k>x.y+1)&&Xe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function xt(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Pt(e):[]}}function ur(e,t,r,f,v){e.emplaceBack(2*t+(f+1)/2,2*r+(v+1)/2)}var Vr=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ps,this.indexArray=new Cu,this.segments=new we,this.programConfigurations=new O(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function Jn(e,t){for(var r=0;r<e.length;r++)if(Ca(t,e[r]))return!0;for(var f=0;f<t.length;f++)if(Ca(e,t[f]))return!0;return!!Ri(e,t)}function Xn(e,t,r){return!!Ca(e,t)||!!pa(t,e,r)}function li(e,t){if(e.length===1)return go(t,e[0]);for(var r=0;r<t.length;r++)for(var f=t[r],v=0;v<f.length;v++)if(Ca(e,f[v]))return!0;for(var g=0;g<e.length;g++)if(go(t,e[g]))return!0;for(var x=0;x<t.length;x++)if(Ri(e,t[x]))return!0;return!1}function mi(e,t,r){if(e.length>1){if(Ri(e,t))return!0;for(var f=0;f<t.length;f++)if(pa(t[f],e,r))return!0}for(var v=0;v<e.length;v++)if(pa(e[v],t,r))return!0;return!1}function Ri(e,t){if(e.length===0||t.length===0)return!1;for(var r=0;r<e.length-1;r++)for(var f=e[r],v=e[r+1],g=0;g<t.length-1;g++)if(aa(f,v,t[g],t[g+1]))return!0;return!1}function aa(e,t,r,f){return jt(e,r,f)!==jt(t,r,f)&&jt(e,t,r)!==jt(e,t,f)}function pa(e,t,r){var f=r*r;if(t.length===1)return e.distSqr(t[0])<f;for(var v=1;v<t.length;v++)if(ba(e,t[v-1],t[v])<f)return!0;return!1}function ba(e,t,r){var f=t.distSqr(r);if(f===0)return e.distSqr(t);var v=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/f;return e.distSqr(v<0?t:v>1?r:r.sub(t)._mult(v)._add(t))}function go(e,t){for(var r,f,v,g=!1,x=0;x<e.length;x++)for(var P=0,k=(r=e[x]).length-1;P<r.length;k=P++)(f=r[P]).y>t.y!=(v=r[k]).y>t.y&&t.x<(v.x-f.x)*(t.y-f.y)/(v.y-f.y)+f.x&&(g=!g);return g}function Ca(e,t){for(var r=!1,f=0,v=e.length-1;f<e.length;v=f++){var g=e[f],x=e[v];g.y>t.y!=x.y>t.y&&t.x<(x.x-g.x)*(t.y-g.y)/(x.y-g.y)+g.x&&(r=!r)}return r}function Bo(e,t,r){var f=r[0],v=r[2];if(e.x<f.x&&t.x<f.x||e.x>v.x&&t.x>v.x||e.y<f.y&&t.y<f.y||e.y>v.y&&t.y>v.y)return!1;var g=jt(e,t,r[0]);return g!==jt(e,t,r[1])||g!==jt(e,t,r[2])||g!==jt(e,t,r[3])}function ka(e,t,r){var f=t.paint.get(e).value;return f.kind==="constant"?f.value:r.programConfigurations.get(t.id).getMaxValue(e)}function Zi(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function da(e,t,r,f,v){if(!t[0]&&!t[1])return e;var g=oe.convert(t)._mult(v);r==="viewport"&&g._rotate(-f);for(var x=[],P=0;P<e.length;P++)x.push(e[P].sub(g));return x}Vr.prototype.populate=function(e,t,r){var f=this.layers[0],v=[],g=null;f.type==="circle"&&(g=f.layout.get("circle-sort-key"));for(var x=0,P=e;x<P.length;x+=1){var k=P[x],Z=k.feature,X=k.id,re=k.index,he=k.sourceLayerIndex,be=this.layers[0]._featureFilter.needGeometry,Ve=xt(Z,be);if(this.layers[0]._featureFilter.filter(new ta(this.zoom),Ve,r)){var We=g?g.evaluate(Ve,{},r):void 0,vt={id:X,properties:Z.properties,type:Z.type,sourceLayerIndex:he,index:re,geometry:be?Ve.geometry:Pt(Z),patterns:{},sortKey:We};v.push(vt)}}g&&v.sort(function(Cn,fi){return Cn.sortKey-fi.sortKey});for(var tt=0,It=v;tt<It.length;tt+=1){var Wt=It[tt],pr=Wt.geometry,mr=Wt.index,Br=Wt.sourceLayerIndex,sn=e[mr].feature;this.addFeature(Wt,pr,mr,r),t.featureIndex.insert(sn,pr,mr,Br,this.index)}},Vr.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Vr.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Vr.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Vr.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ce),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Vr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Vr.prototype.addFeature=function(e,t,r,f){for(var v=0,g=t;v<g.length;v+=1)for(var x=0,P=g[v];x<P.length;x+=1){var k=P[x],Z=k.x,X=k.y;if(!(Z<0||Z>=8192||X<0||X>=8192)){var re=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),he=re.vertexLength;ur(this.layoutVertexArray,Z,X,-1,-1),ur(this.layoutVertexArray,Z,X,1,-1),ur(this.layoutVertexArray,Z,X,1,1),ur(this.layoutVertexArray,Z,X,-1,1),this.indexArray.emplaceBack(he,he+1,he+2),this.indexArray.emplaceBack(he,he+3,he+2),re.vertexLength+=4,re.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},f)},Dn("CircleBucket",Vr,{omit:["layers"]});var $a=new Io({"circle-sort-key":new Hn(ae.layout_circle["circle-sort-key"])}),yo={paint:new Io({"circle-radius":new Hn(ae.paint_circle["circle-radius"]),"circle-color":new Hn(ae.paint_circle["circle-color"]),"circle-blur":new Hn(ae.paint_circle["circle-blur"]),"circle-opacity":new Hn(ae.paint_circle["circle-opacity"]),"circle-translate":new jn(ae.paint_circle["circle-translate"]),"circle-translate-anchor":new jn(ae.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new jn(ae.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new jn(ae.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Hn(ae.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Hn(ae.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Hn(ae.paint_circle["circle-stroke-opacity"])}),layout:$a},Pi=typeof Float32Array!="undefined"?Float32Array:Array;function oo(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ga(e,t,r){var f=t[0],v=t[1],g=t[2],x=t[3],P=t[4],k=t[5],Z=t[6],X=t[7],re=t[8],he=t[9],be=t[10],Ve=t[11],We=t[12],vt=t[13],tt=t[14],It=t[15],Wt=r[0],pr=r[1],mr=r[2],Br=r[3];return e[0]=Wt*f+pr*P+mr*re+Br*We,e[1]=Wt*v+pr*k+mr*he+Br*vt,e[2]=Wt*g+pr*Z+mr*be+Br*tt,e[3]=Wt*x+pr*X+mr*Ve+Br*It,e[4]=(Wt=r[4])*f+(pr=r[5])*P+(mr=r[6])*re+(Br=r[7])*We,e[5]=Wt*v+pr*k+mr*he+Br*vt,e[6]=Wt*g+pr*Z+mr*be+Br*tt,e[7]=Wt*x+pr*X+mr*Ve+Br*It,e[8]=(Wt=r[8])*f+(pr=r[9])*P+(mr=r[10])*re+(Br=r[11])*We,e[9]=Wt*v+pr*k+mr*he+Br*vt,e[10]=Wt*g+pr*Z+mr*be+Br*tt,e[11]=Wt*x+pr*X+mr*Ve+Br*It,e[12]=(Wt=r[12])*f+(pr=r[13])*P+(mr=r[14])*re+(Br=r[15])*We,e[13]=Wt*v+pr*k+mr*he+Br*vt,e[14]=Wt*g+pr*Z+mr*be+Br*tt,e[15]=Wt*x+pr*X+mr*Ve+Br*It,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,t=0,r=arguments.length;r--;)t+=e[r]*e[r];return Math.sqrt(t)});var Hs,Nl=Ga;function Bs(e,t,r){var f=t[0],v=t[1],g=t[2],x=t[3];return e[0]=r[0]*f+r[4]*v+r[8]*g+r[12]*x,e[1]=r[1]*f+r[5]*v+r[9]*g+r[13]*x,e[2]=r[2]*f+r[6]*v+r[10]*g+r[14]*x,e[3]=r[3]*f+r[7]*v+r[11]*g+r[15]*x,e}Hs=new Pi(3),Pi!=Float32Array&&(Hs[0]=0,Hs[1]=0,Hs[2]=0),function(){var e=new Pi(4);Pi!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var Lu=(function(){var e=new Pi(2);Pi!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function t(r){e.call(this,r,yo)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Vr(r)},t.prototype.queryRadius=function(r){var f=r;return ka("circle-radius",this,f)+ka("circle-stroke-width",this,f)+Zi(this.paint.get("circle-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,g,x,P,k,Z){for(var X=da(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),P.angle,k),re=this.paint.get("circle-radius").evaluate(f,v)+this.paint.get("circle-stroke-width").evaluate(f,v),he=this.paint.get("circle-pitch-alignment")==="map",be=he?X:function(sn,Cn){return sn.map(function(fi){return Ru(fi,Cn)})}(X,Z),Ve=he?re*k:re,We=0,vt=g;We<vt.length;We+=1)for(var tt=0,It=vt[We];tt<It.length;tt+=1){var Wt=It[tt],pr=he?Wt:Ru(Wt,Z),mr=Ve,Br=Bs([],[Wt.x,Wt.y,0,1],Z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?mr*=Br[3]/P.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(mr*=P.cameraToCenterDistance/Br[3]),Xn(be,pr,mr))return!0}return!1},t}(au));function Ru(e,t){var r=Bs([],[e.x,e.y,0,1],t);return new oe(r[0]/r[3],r[1]/r[3])}var zl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Vr);function ll(e,t,r,f){var v=t.width,g=t.height;if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==v*g*r)throw new RangeError("mismatched image size")}else f=new Uint8Array(v*g*r);return e.width=v,e.height=g,e.data=f,e}function Ul(e,t,r){var f=t.width,v=t.height;if(f!==e.width||v!==e.height){var g=ll({},{width:f,height:v},r);ic(e,g,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,f),height:Math.min(e.height,v)},r),e.width=f,e.height=v,e.data=g.data}}function ic(e,t,r,f,v,g){if(v.width===0||v.height===0)return t;if(v.width>e.width||v.height>e.height||r.x>e.width-v.width||r.y>e.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>t.width||v.height>t.height||f.x>t.width-v.width||f.y>t.height-v.height)throw new RangeError("out of range destination coordinates for image copy");for(var x=e.data,P=t.data,k=0;k<v.height;k++)for(var Z=((r.y+k)*e.width+r.x)*g,X=((f.y+k)*t.width+f.x)*g,re=0;re<v.width*g;re++)P[X+re]=x[Z+re];return t}Dn("HeatmapBucket",zl,{omit:["layers"]});var Wu=function(e,t){ll(this,e,1,t)};Wu.prototype.resize=function(e){Ul(this,e,1)},Wu.prototype.clone=function(){return new Wu({width:this.width,height:this.height},new Uint8Array(this.data))},Wu.copy=function(e,t,r,f,v){ic(e,t,r,f,v,1)};var hs=function(e,t){ll(this,e,4,t)};hs.prototype.resize=function(e){Ul(this,e,4)},hs.prototype.replace=function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},hs.prototype.clone=function(){return new hs({width:this.width,height:this.height},new Uint8Array(this.data))},hs.copy=function(e,t,r,f,v){ic(e,t,r,f,v,4)},Dn("AlphaImage",Wu),Dn("RGBAImage",hs);var Uf={paint:new Io({"heatmap-radius":new Hn(ae.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Hn(ae.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new jn(ae.paint_heatmap["heatmap-intensity"]),"heatmap-color":new fs(ae.paint_heatmap["heatmap-color"]),"heatmap-opacity":new jn(ae.paint_heatmap["heatmap-opacity"])})};function yf(e){var t={},r=e.resolution||256,f=e.clips?e.clips.length:1,v=e.image||new hs({width:r,height:f}),g=function(Ve,We,vt){t[e.evaluationKey]=vt;var tt=e.expression.evaluate(t);v.data[Ve+We+0]=Math.floor(255*tt.r/tt.a),v.data[Ve+We+1]=Math.floor(255*tt.g/tt.a),v.data[Ve+We+2]=Math.floor(255*tt.b/tt.a),v.data[Ve+We+3]=Math.floor(255*tt.a)};if(e.clips)for(var x=0,P=0;x<f;++x,P+=4*r)for(var k=0,Z=0;k<r;k++,Z+=4){var X=k/(r-1),re=e.clips[x];g(P,Z,re.start*(1-X)+re.end*X)}else for(var he=0,be=0;he<r;he++,be+=4)g(0,be,he/(r-1));return v}var _f=function(e){function t(r){e.call(this,r,Uf),this._updateColorRamp()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new zl(r)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="heatmap-color"&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){this.colorRamp=yf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},t}(au),ih={paint:new Io({"hillshade-illumination-direction":new jn(ae.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new jn(ae.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new jn(ae.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new jn(ae.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new jn(ae.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new jn(ae.paint_hillshade["hillshade-accent-color"])})},ah=function(e){function t(r){e.call(this,r,ih)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},t}(au),tf=Ui([{name:"a_pos",components:2,type:"Int16"}],4).members,bc=Zf,pp=Zf;function Zf(e,t,r){r=r||2;var f,v,g,x,P,k,Z,X=t&&t.length,re=X?t[0]*r:e.length,he=oh(e,0,re,r,!0),be=[];if(!he||he.next===he.prev)return be;if(X&&(he=function(We,vt,tt,It){var Wt,pr,mr,Br=[];for(Wt=0,pr=vt.length;Wt<pr;Wt++)(mr=oh(We,vt[Wt]*It,Wt<pr-1?vt[Wt+1]*It:We.length,It,!1))===mr.next&&(mr.steiner=!0),Br.push(gp(mr));for(Br.sort(vp),Wt=0;Wt<Br.length;Wt++)Rh(Br[Wt],tt),tt=ac(tt,tt.next);return tt}(e,t,he,r)),e.length>80*r){f=g=e[0],v=x=e[1];for(var Ve=r;Ve<re;Ve+=r)(P=e[Ve])<f&&(f=P),(k=e[Ve+1])<v&&(v=k),P>g&&(g=P),k>x&&(x=k);Z=(Z=Math.max(g-f,x-v))!==0?1/Z:0}return rf(he,be,r,f,v,Z),be}function oh(e,t,r,f,v){var g,x;if(v===sf(e,t,r,f)>0)for(g=t;g<r;g+=f)x=of(g,e[g],e[g+1],x);else for(g=r-f;g>=t;g-=f)x=of(g,e[g],e[g+1],x);return x&&jf(x,x.next)&&(Sc(x),x=x.next),x}function ac(e,t){if(!e)return e;t||(t=e);var r,f=e;do if(r=!1,f.steiner||!jf(f,f.next)&&is(f.prev,f,f.next)!==0)f=f.next;else{if(Sc(f),(f=t=f.prev)===f.next)break;r=!0}while(r||f!==t);return t}function rf(e,t,r,f,v,g,x){if(e){!x&&g&&function(X,re,he,be){var Ve=X;do Ve.z===null&&(Ve.z=uh(Ve.x,Ve.y,re,he,be)),Ve.prevZ=Ve.prev,Ve.nextZ=Ve.next,Ve=Ve.next;while(Ve!==X);Ve.prevZ.nextZ=null,Ve.prevZ=null,function(We){var vt,tt,It,Wt,pr,mr,Br,sn,Cn=1;do{for(tt=We,We=null,pr=null,mr=0;tt;){for(mr++,It=tt,Br=0,vt=0;vt<Cn&&(Br++,It=It.nextZ);vt++);for(sn=Cn;Br>0||sn>0&&It;)Br!==0&&(sn===0||!It||tt.z<=It.z)?(Wt=tt,tt=tt.nextZ,Br--):(Wt=It,It=It.nextZ,sn--),pr?pr.nextZ=Wt:We=Wt,Wt.prevZ=pr,pr=Wt;tt=It}pr.nextZ=null,Cn*=2}while(mr>1)}(Ve)}(e,f,v,g);for(var P,k,Z=e;e.prev!==e.next;)if(P=e.prev,k=e.next,g?nf(e,f,v,g):dp(e))t.push(P.i/r),t.push(e.i/r),t.push(k.i/r),Sc(e),e=k.next,Z=k.next;else if((e=k)===Z){x?x===1?rf(e=sh(ac(e),t,r),t,r,f,v,g,2):x===2&&Lh(e,t,r,f,v,g):rf(ac(e),t,r,f,v,g,1);break}}}function dp(e){var t=e.prev,r=e,f=e.next;if(is(t,r,f)>=0)return!1;for(var v=e.next.next;v!==e.prev;){if(af(t.x,t.y,r.x,r.y,f.x,f.y,v.x,v.y)&&is(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function nf(e,t,r,f){var v=e.prev,g=e,x=e.next;if(is(v,g,x)>=0)return!1;for(var P=v.x>g.x?v.x>x.x?v.x:x.x:g.x>x.x?g.x:x.x,k=v.y>g.y?v.y>x.y?v.y:x.y:g.y>x.y?g.y:x.y,Z=uh(v.x<g.x?v.x<x.x?v.x:x.x:g.x<x.x?g.x:x.x,v.y<g.y?v.y<x.y?v.y:x.y:g.y<x.y?g.y:x.y,t,r,f),X=uh(P,k,t,r,f),re=e.prevZ,he=e.nextZ;re&&re.z>=Z&&he&&he.z<=X;){if(re!==e.prev&&re!==e.next&&af(v.x,v.y,g.x,g.y,x.x,x.y,re.x,re.y)&&is(re.prev,re,re.next)>=0||(re=re.prevZ,he!==e.prev&&he!==e.next&&af(v.x,v.y,g.x,g.y,x.x,x.y,he.x,he.y)&&is(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;re&&re.z>=Z;){if(re!==e.prev&&re!==e.next&&af(v.x,v.y,g.x,g.y,x.x,x.y,re.x,re.y)&&is(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;he&&he.z<=X;){if(he!==e.prev&&he!==e.next&&af(v.x,v.y,g.x,g.y,x.x,x.y,he.x,he.y)&&is(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function sh(e,t,r){var f=e;do{var v=f.prev,g=f.next.next;!jf(v,g)&&lh(v,f,f.next,g)&&zc(v,g)&&zc(g,v)&&(t.push(v.i/r),t.push(f.i/r),t.push(g.i/r),Sc(f),Sc(f.next),f=e=g),f=f.next}while(f!==e);return ac(f)}function Lh(e,t,r,f,v,g){var x=e;do{for(var P=x.next.next;P!==x.prev;){if(x.i!==P.i&&yp(x,P)){var k=xf(x,P);return x=ac(x,x.next),k=ac(k,k.next),rf(x,t,r,f,v,g),void rf(k,t,r,f,v,g)}P=P.next}x=x.next}while(x!==e)}function vp(e,t){return e.x-t.x}function Rh(e,t){if(t=function(f,v){var g,x=v,P=f.x,k=f.y,Z=-1/0;do{if(k<=x.y&&k>=x.next.y&&x.next.y!==x.y){var X=x.x+(k-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(X<=P&&X>Z){if(Z=X,X===P){if(k===x.y)return x;if(k===x.next.y)return x.next}g=x.x<x.next.x?x:x.next}}x=x.next}while(x!==v);if(!g)return null;if(P===Z)return g;var re,he=g,be=g.x,Ve=g.y,We=1/0;x=g;do P>=x.x&&x.x>=be&&P!==x.x&&af(k<Ve?P:Z,k,be,Ve,k<Ve?Z:P,k,x.x,x.y)&&(re=Math.abs(k-x.y)/(P-x.x),zc(x,f)&&(re<We||re===We&&(x.x>g.x||x.x===g.x&&mp(g,x)))&&(g=x,We=re)),x=x.next;while(x!==he);return g}(e,t)){var r=xf(t,e);ac(t,t.next),ac(r,r.next)}}function mp(e,t){return is(e.prev,e,t.prev)<0&&is(t.next,e,e.next)<0}function uh(e,t,r,f,v){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*v)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-f)*v)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function gp(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function af(e,t,r,f,v,g,x,P){return(v-x)*(t-P)-(e-x)*(g-P)>=0&&(e-x)*(f-P)-(r-x)*(t-P)>=0&&(r-x)*(g-P)-(v-x)*(f-P)>=0}function yp(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(r,f){var v=r;do{if(v.i!==r.i&&v.next.i!==r.i&&v.i!==f.i&&v.next.i!==f.i&&lh(v,v.next,r,f))return!0;v=v.next}while(v!==r);return!1}(e,t)&&(zc(e,t)&&zc(t,e)&&function(r,f){var v=r,g=!1,x=(r.x+f.x)/2,P=(r.y+f.y)/2;do v.y>P!=v.next.y>P&&v.next.y!==v.y&&x<(v.next.x-v.x)*(P-v.y)/(v.next.y-v.y)+v.x&&(g=!g),v=v.next;while(v!==r);return g}(e,t)&&(is(e.prev,e,t.prev)||is(e,t.prev,t))||jf(e,t)&&is(e.prev,e,e.next)>0&&is(t.prev,t,t.next)>0)}function is(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function jf(e,t){return e.x===t.x&&e.y===t.y}function lh(e,t,r,f){var v=Gf(is(e,t,r)),g=Gf(is(e,t,f)),x=Gf(is(r,f,e)),P=Gf(is(r,f,t));return v!==g&&x!==P||!(v!==0||!Vf(e,r,t))||!(g!==0||!Vf(e,f,t))||!(x!==0||!Vf(r,e,f))||!(P!==0||!Vf(r,t,f))}function Vf(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function Gf(e){return e>0?1:e<0?-1:0}function zc(e,t){return is(e.prev,e,e.next)<0?is(e,t,e.next)>=0&&is(e,e.prev,t)>=0:is(e,t,e.prev)<0||is(e,e.next,t)<0}function xf(e,t){var r=new bf(e.i,e.x,e.y),f=new bf(t.i,t.x,t.y),v=e.next,g=t.prev;return e.next=t,t.prev=e,r.next=v,v.prev=r,f.next=r,r.prev=f,g.next=f,f.prev=g,f}function of(e,t,r,f){var v=new bf(e,t,r);return f?(v.next=f.next,v.prev=f,f.next.prev=v,f.next=v):(v.prev=v,v.next=v),v}function Sc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function bf(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function sf(e,t,r,f){for(var v=0,g=t,x=r-f;g<r;g+=f)v+=(e[x]-e[g])*(e[g+1]+e[x+1]),x=g;return v}function Hf(e,t,r,f,v){(function g(x,P,k,Z,X){for(;Z>k;){if(Z-k>600){var re=Z-k+1,he=P-k+1,be=Math.log(re),Ve=.5*Math.exp(2*be/3),We=.5*Math.sqrt(be*Ve*(re-Ve)/re)*(he-re/2<0?-1:1);g(x,P,Math.max(k,Math.floor(P-he*Ve/re+We)),Math.min(Z,Math.floor(P+(re-he)*Ve/re+We)),X)}var vt=x[P],tt=k,It=Z;for(Ec(x,k,P),X(x[Z],vt)>0&&Ec(x,k,Z);tt<It;){for(Ec(x,tt,It),tt++,It--;X(x[tt],vt)<0;)tt++;for(;X(x[It],vt)>0;)It--}X(x[k],vt)===0?Ec(x,k,It):Ec(x,++It,Z),It<=P&&(k=It+1),P<=It&&(Z=It-1)}})(e,t,r||0,f||e.length-1,v||ch)}function Ec(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}function ch(e,t){return e<t?-1:e>t?1:0}function uf(e,t){var r=e.length;if(r<=1)return[e];for(var f,v,g=[],x=0;x<r;x++){var P=br(e[x]);P!==0&&(e[x].area=Math.abs(P),v===void 0&&(v=P<0),v===P<0?(f&&g.push(f),f=[e[x]]):f.push(e[x]))}if(f&&g.push(f),t>1)for(var k=0;k<g.length;k++)g[k].length<=t||(Hf(g[k],t,1,g[k].length-1,Wf),g[k]=g[k].slice(0,t));return g}function Wf(e,t){return t.area-e.area}function lf(e,t,r){for(var f=r.patternDependencies,v=!1,g=0,x=t;g<x.length;g+=1){var P=x[g].paint.get(e+"-pattern");P.isConstant()||(v=!0);var k=P.constantOr(null);k&&(v=!0,f[k.to]=!0,f[k.from]=!0)}return v}function Cc(e,t,r,f,v){for(var g=v.patternDependencies,x=0,P=t;x<P.length;x+=1){var k=P[x],Z=k.paint.get(e+"-pattern").value;if(Z.kind!=="constant"){var X=Z.evaluate({zoom:f-1},r,{},v.availableImages),re=Z.evaluate({zoom:f},r,{},v.availableImages),he=Z.evaluate({zoom:f+1},r,{},v.availableImages);re=re&&re.name?re.name:re,he=he&&he.name?he.name:he,g[X=X&&X.name?X.name:X]=!0,g[re]=!0,g[he]=!0,r.patterns[k.id]={min:X,mid:re,max:he}}}return r}Zf.deviation=function(e,t,r,f){var v=t&&t.length,g=Math.abs(sf(e,0,v?t[0]*r:e.length,r));if(v)for(var x=0,P=t.length;x<P;x++)g-=Math.abs(sf(e,t[x]*r,x<P-1?t[x+1]*r:e.length,r));var k=0;for(x=0;x<f.length;x+=3){var Z=f[x]*r,X=f[x+1]*r,re=f[x+2]*r;k+=Math.abs((e[Z]-e[re])*(e[X+1]-e[Z+1])-(e[Z]-e[X])*(e[re+1]-e[Z+1]))}return g===0&&k===0?0:Math.abs((k-g)/g)},Zf.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},f=0,v=0;v<e.length;v++){for(var g=0;g<e[v].length;g++)for(var x=0;x<t;x++)r.vertices.push(e[v][g][x]);v>0&&r.holes.push(f+=e[v-1].length)}return r},bc.default=pp;var Au=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ps,this.indexArray=new Cu,this.indexArray2=new nc,this.programConfigurations=new O(e.layers,e.zoom),this.segments=new we,this.segments2=new we,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};Au.prototype.populate=function(e,t,r){this.hasPattern=lf("fill",this.layers,t);for(var f=this.layers[0].layout.get("fill-sort-key"),v=[],g=0,x=e;g<x.length;g+=1){var P=x[g],k=P.feature,Z=P.id,X=P.index,re=P.sourceLayerIndex,he=this.layers[0]._featureFilter.needGeometry,be=xt(k,he);if(this.layers[0]._featureFilter.filter(new ta(this.zoom),be,r)){var Ve=f?f.evaluate(be,{},r,t.availableImages):void 0,We={id:Z,properties:k.properties,type:k.type,sourceLayerIndex:re,index:X,geometry:he?be.geometry:Pt(k),patterns:{},sortKey:Ve};v.push(We)}}f&&v.sort(function(sn,Cn){return sn.sortKey-Cn.sortKey});for(var vt=0,tt=v;vt<tt.length;vt+=1){var It=tt[vt],Wt=It.geometry,pr=It.index,mr=It.sourceLayerIndex;if(this.hasPattern){var Br=Cc("fill",this.layers,It,this.zoom,t);this.patternFeatures.push(Br)}else this.addFeature(It,Wt,pr,r,{});t.featureIndex.insert(e[pr].feature,Wt,pr,mr,this.index)}},Au.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Au.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var g=v[f];this.addFeature(g,g.geometry,g.index,t,r)}},Au.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Au.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Au.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,tf),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},Au.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Au.prototype.addFeature=function(e,t,r,f,v){for(var g=0,x=uf(t,500);g<x.length;g+=1){for(var P=x[g],k=0,Z=0,X=P;Z<X.length;Z+=1)k+=X[Z].length;for(var re=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray),he=re.vertexLength,be=[],Ve=[],We=0,vt=P;We<vt.length;We+=1){var tt=vt[We];if(tt.length!==0){tt!==P[0]&&Ve.push(be.length/2);var It=this.segments2.prepareSegment(tt.length,this.layoutVertexArray,this.indexArray2),Wt=It.vertexLength;this.layoutVertexArray.emplaceBack(tt[0].x,tt[0].y),this.indexArray2.emplaceBack(Wt+tt.length-1,Wt),be.push(tt[0].x),be.push(tt[0].y);for(var pr=1;pr<tt.length;pr++)this.layoutVertexArray.emplaceBack(tt[pr].x,tt[pr].y),this.indexArray2.emplaceBack(Wt+pr-1,Wt+pr),be.push(tt[pr].x),be.push(tt[pr].y);It.vertexLength+=tt.length,It.primitiveLength+=tt.length}}for(var mr=bc(be,Ve),Br=0;Br<mr.length;Br+=3)this.indexArray.emplaceBack(he+mr[Br],he+mr[Br+1],he+mr[Br+2]);re.vertexLength+=k,re.primitiveLength+=mr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Dn("FillBucket",Au,{omit:["layers","patternFeatures"]});var Sf=new Io({"fill-sort-key":new Hn(ae.layout_fill["fill-sort-key"])}),Ef={paint:new Io({"fill-antialias":new jn(ae.paint_fill["fill-antialias"]),"fill-opacity":new Hn(ae.paint_fill["fill-opacity"]),"fill-color":new Hn(ae.paint_fill["fill-color"]),"fill-outline-color":new Hn(ae.paint_fill["fill-outline-color"]),"fill-translate":new jn(ae.paint_fill["fill-translate"]),"fill-translate-anchor":new jn(ae.paint_fill["fill-translate-anchor"]),"fill-pattern":new nl(ae.paint_fill["fill-pattern"])}),layout:Sf},Cf=function(e){function t(r){e.call(this,r,Ef)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f);var v=this.paint._values["fill-outline-color"];v.value.kind==="constant"&&v.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},t.prototype.createBucket=function(r){return new Au(r)},t.prototype.queryRadius=function(){return Zi(this.paint.get("fill-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,g,x,P,k){return li(da(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),P.angle,k),g)},t.prototype.isTileClipped=function(){return!0},t}(au),fh=Ui([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Uc=mu;function mu(e,t,r,f,v){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=f,this._values=v,e.readFields(Dh,this,t)}function Dh(e,t,r){e==1?t.id=r.readVarint():e==2?function(f,v){for(var g=f.readVarint()+f.pos;f.pos<g;){var x=v._keys[f.readVarint()],P=v._values[f.readVarint()];v.properties[x]=P}}(r,t):e==3?t.type=r.readVarint():e==4&&(t._geometry=r.pos)}function hh(e){for(var t,r,f=0,v=0,g=e.length,x=g-1;v<g;x=v++)f+=((r=e[x]).x-(t=e[v]).x)*(t.y+r.y);return f}mu.types=["Unknown","Point","LineString","Polygon"],mu.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,f=1,v=0,g=0,x=0,P=[];e.pos<r;){if(v<=0){var k=e.readVarint();f=7&k,v=k>>3}if(v--,f===1||f===2)g+=e.readSVarint(),x+=e.readSVarint(),f===1&&(t&&P.push(t),t=[]),t.push(new oe(g,x));else{if(f!==7)throw new Error("unknown command "+f);t&&t.push(t[0].clone())}}return t&&P.push(t),P},mu.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,f=0,v=0,g=0,x=1/0,P=-1/0,k=1/0,Z=-1/0;e.pos<t;){if(f<=0){var X=e.readVarint();r=7&X,f=X>>3}if(f--,r===1||r===2)(v+=e.readSVarint())<x&&(x=v),v>P&&(P=v),(g+=e.readSVarint())<k&&(k=g),g>Z&&(Z=g);else if(r!==7)throw new Error("unknown command "+r)}return[x,k,P,Z]},mu.prototype.toGeoJSON=function(e,t,r){var f,v,g=this.extent*Math.pow(2,r),x=this.extent*e,P=this.extent*t,k=this.loadGeometry(),Z=mu.types[this.type];function X(be){for(var Ve=0;Ve<be.length;Ve++){var We=be[Ve];be[Ve]=[360*(We.x+x)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(We.y+P)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var re=[];for(f=0;f<k.length;f++)re[f]=k[f][0];X(k=re);break;case 2:for(f=0;f<k.length;f++)X(k[f]);break;case 3:for(k=function(be){var Ve=be.length;if(Ve<=1)return[be];for(var We,vt,tt=[],It=0;It<Ve;It++){var Wt=hh(be[It]);Wt!==0&&(vt===void 0&&(vt=Wt<0),vt===Wt<0?(We&&tt.push(We),We=[be[It]]):We.push(be[It]))}return We&&tt.push(We),tt}(k),f=0;f<k.length;f++)for(v=0;v<k[f].length;v++)X(k[f][v])}k.length===1?k=k[0]:Z="Multi"+Z;var he={type:"Feature",geometry:{type:Z,coordinates:k},properties:this.properties};return"id"in this&&(he.id=this.id),he};var ph=kh;function kh(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(_p,this,t),this.length=this._features.length}function _p(e,t,r){e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(function(f){for(var v=null,g=f.readVarint()+f.pos;f.pos<g;){var x=f.readVarint()>>3;v=x===1?f.readString():x===2?f.readFloat():x===3?f.readDouble():x===4?f.readVarint64():x===5?f.readVarint():x===6?f.readSVarint():x===7?f.readBoolean():null}return v}(r))}function wc(e,t,r){if(e===3){var f=new ph(r,r.readVarint()+r.pos);f.length&&(t[f.name]=f)}}kh.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new Uc(this._pbf,t,this.extent,this._keys,this._values)};var Ac={VectorTile:function(e,t){this.layers=e.readFields(wc,{},t)},VectorTileFeature:Uc,VectorTileLayer:ph},Fh=Ac.VectorTileFeature.types,wf=Math.pow(2,13);function cf(e,t,r,f,v,g,x,P){e.emplaceBack(t,r,2*Math.floor(f*wf)+x,v*wf*2,g*wf*2,Math.round(P))}var Xu=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ms,this.indexArray=new Cu,this.programConfigurations=new O(e.layers,e.zoom),this.segments=new we,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function Bh(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}Xu.prototype.populate=function(e,t,r){this.features=[],this.hasPattern=lf("fill-extrusion",this.layers,t);for(var f=0,v=e;f<v.length;f+=1){var g=v[f],x=g.feature,P=g.id,k=g.index,Z=g.sourceLayerIndex,X=this.layers[0]._featureFilter.needGeometry,re=xt(x,X);if(this.layers[0]._featureFilter.filter(new ta(this.zoom),re,r)){var he={id:P,sourceLayerIndex:Z,index:k,geometry:X?re.geometry:Pt(x),properties:x.properties,type:x.type,patterns:{}};this.hasPattern?this.features.push(Cc("fill-extrusion",this.layers,he,this.zoom,t)):this.addFeature(he,he.geometry,k,r,{}),t.featureIndex.insert(x,he.geometry,k,Z,this.index,!0)}}},Xu.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.features;f<v.length;f+=1){var g=v[f];this.addFeature(g,g.geometry,g.index,t,r)}},Xu.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Xu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Xu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Xu.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fh),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Xu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Xu.prototype.addFeature=function(e,t,r,f,v){for(var g=0,x=uf(t,500);g<x.length;g+=1){for(var P=x[g],k=0,Z=0,X=P;Z<X.length;Z+=1)k+=X[Z].length;for(var re=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),he=0,be=P;he<be.length;he+=1){var Ve=be[he];if(Ve.length!==0&&!((fa=Ve).every(function(Qi){return Qi.x<0})||fa.every(function(Qi){return Qi.x>8192})||fa.every(function(Qi){return Qi.y<0})||fa.every(function(Qi){return Qi.y>8192})))for(var We=0,vt=0;vt<Ve.length;vt++){var tt=Ve[vt];if(vt>=1){var It=Ve[vt-1];if(!Bh(tt,It)){re.vertexLength+4>we.MAX_VERTEX_ARRAY_LENGTH&&(re=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Wt=tt.sub(It)._perp()._unit(),pr=It.dist(tt);We+pr>32768&&(We=0),cf(this.layoutVertexArray,tt.x,tt.y,Wt.x,Wt.y,0,0,We),cf(this.layoutVertexArray,tt.x,tt.y,Wt.x,Wt.y,0,1,We),cf(this.layoutVertexArray,It.x,It.y,Wt.x,Wt.y,0,0,We+=pr),cf(this.layoutVertexArray,It.x,It.y,Wt.x,Wt.y,0,1,We);var mr=re.vertexLength;this.indexArray.emplaceBack(mr,mr+2,mr+1),this.indexArray.emplaceBack(mr+1,mr+2,mr+3),re.vertexLength+=4,re.primitiveLength+=2}}}}if(re.vertexLength+k>we.MAX_VERTEX_ARRAY_LENGTH&&(re=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),Fh[e.type]==="Polygon"){for(var Br=[],sn=[],Cn=re.vertexLength,fi=0,Vn=P;fi<Vn.length;fi+=1){var di=Vn[fi];if(di.length!==0){di!==P[0]&&sn.push(Br.length/2);for(var Kn=0;Kn<di.length;Kn++){var oa=di[Kn];cf(this.layoutVertexArray,oa.x,oa.y,0,0,1,1,0),Br.push(oa.x),Br.push(oa.y)}}}for(var Ii=bc(Br,sn),oi=0;oi<Ii.length;oi+=3)this.indexArray.emplaceBack(Cn+Ii[oi],Cn+Ii[oi+2],Cn+Ii[oi+1]);re.primitiveLength+=Ii.length/3,re.vertexLength+=k}}var fa;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Dn("FillExtrusionBucket",Xu,{omit:["layers","features"]});var Zl={paint:new Io({"fill-extrusion-opacity":new jn(ae["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Hn(ae["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new jn(ae["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new jn(ae["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new nl(ae["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Hn(ae["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Hn(ae["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new jn(ae["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Nh=function(e){function t(r){e.call(this,r,Zl)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Xu(r)},t.prototype.queryRadius=function(){return Zi(this.paint.get("fill-extrusion-translate"))},t.prototype.is3D=function(){return!0},t.prototype.queryIntersectsFeature=function(r,f,v,g,x,P,k,Z){var X=da(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),P.angle,k),re=this.paint.get("fill-extrusion-height").evaluate(f,v),he=this.paint.get("fill-extrusion-base").evaluate(f,v),be=function(We,vt,tt,It){for(var Wt=[],pr=0,mr=We;pr<mr.length;pr+=1){var Br=mr[pr],sn=[Br.x,Br.y,0,1];Bs(sn,sn,vt),Wt.push(new oe(sn[0]/sn[3],sn[1]/sn[3]))}return Wt}(X,Z),Ve=function(We,vt,tt,It){for(var Wt=[],pr=[],mr=It[8]*vt,Br=It[9]*vt,sn=It[10]*vt,Cn=It[11]*vt,fi=It[8]*tt,Vn=It[9]*tt,di=It[10]*tt,Kn=It[11]*tt,oa=0,Ii=We;oa<Ii.length;oa+=1){for(var oi=[],fa=[],Qi=0,Sa=Ii[oa];Qi<Sa.length;Qi+=1){var gi=Sa[Qi],Ba=gi.x,So=gi.y,Jo=It[0]*Ba+It[4]*So+It[12],Ho=It[1]*Ba+It[5]*So+It[13],Ro=It[2]*Ba+It[6]*So+It[14],No=It[3]*Ba+It[7]*So+It[15],zs=Ro+sn,Cs=No+Cn,su=Jo+fi,Ls=Ho+Vn,Xs=Ro+di,Wo=No+Kn,Wa=new oe((Jo+mr)/Cs,(Ho+Br)/Cs);Wa.z=zs/Cs,oi.push(Wa);var ma=new oe(su/Wo,Ls/Wo);ma.z=Xs/Wo,fa.push(ma)}Wt.push(oi),pr.push(fa)}return[Wt,pr]}(g,he,re,Z);return function(We,vt,tt){var It=1/0;li(tt,vt)&&(It=oc(tt,vt[0]));for(var Wt=0;Wt<vt.length;Wt++)for(var pr=vt[Wt],mr=We[Wt],Br=0;Br<pr.length-1;Br++){var sn=pr[Br],Cn=[sn,pr[Br+1],mr[Br+1],mr[Br],sn];Jn(tt,Cn)&&(It=Math.min(It,oc(tt,Cn)))}return It!==1/0&&It}(Ve[0],Ve[1],be)},t}(au);function jl(e,t){return e.x*t.x+e.y*t.y}function oc(e,t){if(e.length===1){for(var r,f=0,v=t[f++];!r||v.equals(r);)if(!(r=t[f++]))return 1/0;for(;f<t.length;f++){var g=t[f],x=e[0],P=r.sub(v),k=g.sub(v),Z=x.sub(v),X=jl(P,P),re=jl(P,k),he=jl(k,k),be=jl(Z,P),Ve=jl(Z,k),We=X*he-re*re,vt=(he*be-re*Ve)/We,tt=(X*Ve-re*be)/We,It=v.z*(1-vt-tt)+r.z*vt+g.z*tt;if(isFinite(It))return It}return 1/0}for(var Wt=1/0,pr=0,mr=t;pr<mr.length;pr+=1)Wt=Math.min(Wt,mr[pr].z);return Wt}var zh=Ui([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,dh=Ui([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Af=Ac.VectorTileFeature.types,Uh=Math.cos(Math.PI/180*37.5),bs=Math.pow(2,14)/.5,Zo=function(e){var t=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(r){t.gradients[r.id]={}}),this.layoutVertexArray=new Va,this.layoutVertexArray2=new ou,this.indexArray=new Cu,this.programConfigurations=new O(e.layers,e.zoom),this.segments=new we,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};Zo.prototype.populate=function(e,t,r){this.hasPattern=lf("line",this.layers,t);for(var f=this.layers[0].layout.get("line-sort-key"),v=[],g=0,x=e;g<x.length;g+=1){var P=x[g],k=P.feature,Z=P.id,X=P.index,re=P.sourceLayerIndex,he=this.layers[0]._featureFilter.needGeometry,be=xt(k,he);if(this.layers[0]._featureFilter.filter(new ta(this.zoom),be,r)){var Ve=f?f.evaluate(be,{},r):void 0,We={id:Z,properties:k.properties,type:k.type,sourceLayerIndex:re,index:X,geometry:he?be.geometry:Pt(k),patterns:{},sortKey:Ve};v.push(We)}}f&&v.sort(function(sn,Cn){return sn.sortKey-Cn.sortKey});for(var vt=0,tt=v;vt<tt.length;vt+=1){var It=tt[vt],Wt=It.geometry,pr=It.index,mr=It.sourceLayerIndex;if(this.hasPattern){var Br=Cc("line",this.layers,It,this.zoom,t);this.patternFeatures.push(Br)}else this.addFeature(It,Wt,pr,r,{});t.featureIndex.insert(e[pr].feature,Wt,pr,mr,this.index)}},Zo.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Zo.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var g=v[f];this.addFeature(g,g.geometry,g.index,t,r)}},Zo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Zo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Zo.prototype.upload=function(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,dh)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zh),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Zo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Zo.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},Zo.prototype.addFeature=function(e,t,r,f,v){var g=this.layers[0].layout,x=g.get("line-join").evaluate(e,{}),P=g.get("line-cap"),k=g.get("line-miter-limit"),Z=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var X=0,re=t;X<re.length;X+=1)this.addLine(re[X],e,x,P,k,Z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Zo.prototype.addLine=function(e,t,r,f,v,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var x=0;x<e.length-1;x++)this.totalDistance+=e[x].dist(e[x+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var P=Af[t.type]==="Polygon",k=e.length;k>=2&&e[k-1].equals(e[k-2]);)k--;for(var Z=0;Z<k-1&&e[Z].equals(e[Z+1]);)Z++;if(!(k<(P?3:2))){r==="bevel"&&(v=1.05);var X,re=this.overscaling<=16?122880/(512*this.overscaling):0,he=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray),be=void 0,Ve=void 0,We=void 0,vt=void 0;this.e1=this.e2=-1,P&&(vt=e[Z].sub(X=e[k-2])._unit()._perp());for(var tt=Z;tt<k;tt++)if(!(Ve=tt===k-1?P?e[Z+1]:void 0:e[tt+1])||!e[tt].equals(Ve)){vt&&(We=vt),X&&(be=X),X=e[tt],vt=Ve?Ve.sub(X)._unit()._perp():We;var It=(We=We||vt).add(vt);It.x===0&&It.y===0||It._unit();var Wt=We.x*vt.x+We.y*vt.y,pr=It.x*vt.x+It.y*vt.y,mr=pr!==0?1/pr:1/0,Br=2*Math.sqrt(2-2*pr),sn=pr<Uh&&be&&Ve,Cn=We.x*vt.y-We.y*vt.x>0;if(sn&&tt>Z){var fi=X.dist(be);if(fi>2*re){var Vn=X.sub(X.sub(be)._mult(re/fi)._round());this.updateDistance(be,Vn),this.addCurrentVertex(Vn,We,0,0,he),be=Vn}}var di=be&&Ve,Kn=di?r:P?"butt":f;if(di&&Kn==="round"&&(mr<g?Kn="miter":mr<=2&&(Kn="fakeround")),Kn==="miter"&&mr>v&&(Kn="bevel"),Kn==="bevel"&&(mr>2&&(Kn="flipbevel"),mr<v&&(Kn="miter")),be&&this.updateDistance(be,X),Kn==="miter")It._mult(mr),this.addCurrentVertex(X,It,0,0,he);else if(Kn==="flipbevel"){if(mr>100)It=vt.mult(-1);else{var oa=mr*We.add(vt).mag()/We.sub(vt).mag();It._perp()._mult(oa*(Cn?-1:1))}this.addCurrentVertex(X,It,0,0,he),this.addCurrentVertex(X,It.mult(-1),0,0,he)}else if(Kn==="bevel"||Kn==="fakeround"){var Ii=-Math.sqrt(mr*mr-1),oi=Cn?Ii:0,fa=Cn?0:Ii;if(be&&this.addCurrentVertex(X,We,oi,fa,he),Kn==="fakeround")for(var Qi=Math.round(180*Br/Math.PI/20),Sa=1;Sa<Qi;Sa++){var gi=Sa/Qi;if(gi!==.5){var Ba=gi-.5;gi+=gi*Ba*(gi-1)*((1.0904+Wt*(Wt*(3.55645-1.43519*Wt)-3.2452))*Ba*Ba+(.848013+Wt*(.215638*Wt-1.06021)))}var So=vt.sub(We)._mult(gi)._add(We)._unit()._mult(Cn?-1:1);this.addHalfVertex(X,So.x,So.y,!1,Cn,0,he)}Ve&&this.addCurrentVertex(X,vt,-oi,-fa,he)}else if(Kn==="butt")this.addCurrentVertex(X,It,0,0,he);else if(Kn==="square"){var Jo=be?1:-1;this.addCurrentVertex(X,It,Jo,Jo,he)}else Kn==="round"&&(be&&(this.addCurrentVertex(X,We,0,0,he),this.addCurrentVertex(X,We,1,1,he,!0)),Ve&&(this.addCurrentVertex(X,vt,-1,-1,he,!0),this.addCurrentVertex(X,vt,0,0,he)));if(sn&&tt<k-1){var Ho=X.dist(Ve);if(Ho>2*re){var Ro=X.add(Ve.sub(X)._mult(re/Ho)._round());this.updateDistance(X,Ro),this.addCurrentVertex(Ro,vt,0,0,he),X=Ro}}}}},Zo.prototype.addCurrentVertex=function(e,t,r,f,v,g){g===void 0&&(g=!1);var x=t.y*f-t.x,P=-t.y-t.x*f;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,g,!1,r,v),this.addHalfVertex(e,x,P,g,!0,-f,v),this.distance>bs/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,t,r,f,v,g))},Zo.prototype.addHalfVertex=function(e,t,r,f,v,g,x){var P=.5*(this.lineClips?this.scaledDistance*(bs-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(f?1:0),(e.y<<1)+(v?1:0),Math.round(63*t)+128,Math.round(63*r)+128,1+(g===0?0:g<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var k=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),x.primitiveLength++),v?this.e2=k:this.e1=k},Zo.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Zo.prototype.updateDistance=function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()},Dn("LineBucket",Zo,{omit:["layers","patternFeatures"]});var as=new Io({"line-cap":new jn(ae.layout_line["line-cap"]),"line-join":new Hn(ae.layout_line["line-join"]),"line-miter-limit":new jn(ae.layout_line["line-miter-limit"]),"line-round-limit":new jn(ae.layout_line["line-round-limit"]),"line-sort-key":new Hn(ae.layout_line["line-sort-key"])}),gu={paint:new Io({"line-opacity":new Hn(ae.paint_line["line-opacity"]),"line-color":new Hn(ae.paint_line["line-color"]),"line-translate":new jn(ae.paint_line["line-translate"]),"line-translate-anchor":new jn(ae.paint_line["line-translate-anchor"]),"line-width":new Hn(ae.paint_line["line-width"]),"line-gap-width":new Hn(ae.paint_line["line-gap-width"]),"line-offset":new Hn(ae.paint_line["line-offset"]),"line-blur":new Hn(ae.paint_line["line-blur"]),"line-dasharray":new ns(ae.paint_line["line-dasharray"]),"line-pattern":new nl(ae.paint_line["line-pattern"]),"line-gradient":new fs(ae.paint_line["line-gradient"])}),layout:as},Xf=new(function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f){return f=new ta(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),e.prototype.possiblyEvaluate.call(this,r,f)},t.prototype.evaluate=function(r,f,v,g){return f=Xt({},f,{zoom:Math.floor(f.zoom)}),e.prototype.evaluate.call(this,r,f,v,g)},t}(Hn))(gu.paint.properties["line-width"].specification);Xf.useIntegerZoom=!0;var xp=function(e){function t(r){e.call(this,r,gu),this.gradientVersion=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof As,this.gradientVersion=(this.gradientVersion+1)%Qe)},t.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f),this.paint._values["line-floorwidth"]=Xf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)},t.prototype.createBucket=function(r){return new Zo(r)},t.prototype.queryRadius=function(r){var f=r,v=Zh(ka("line-width",this,f),ka("line-gap-width",this,f)),g=ka("line-offset",this,f);return v/2+Math.abs(g)+Zi(this.paint.get("line-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,g,x,P,k){var Z=da(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),P.angle,k),X=k/2*Zh(this.paint.get("line-width").evaluate(f,v),this.paint.get("line-gap-width").evaluate(f,v)),re=this.paint.get("line-offset").evaluate(f,v);return re&&(g=function(he,be){for(var Ve=[],We=new oe(0,0),vt=0;vt<he.length;vt++){for(var tt=he[vt],It=[],Wt=0;Wt<tt.length;Wt++){var pr=tt[Wt],mr=tt[Wt+1],Br=Wt===0?We:pr.sub(tt[Wt-1])._unit()._perp(),sn=Wt===tt.length-1?We:mr.sub(pr)._unit()._perp(),Cn=Br._add(sn)._unit();Cn._mult(1/(Cn.x*sn.x+Cn.y*sn.y)),It.push(Cn._mult(be)._add(pr))}Ve.push(It)}return Ve}(g,re*k)),function(he,be,Ve){for(var We=0;We<be.length;We++){var vt=be[We];if(he.length>=3){for(var tt=0;tt<vt.length;tt++)if(Ca(he,vt[tt]))return!0}if(mi(he,vt,Ve))return!0}return!1}(Z,g,X)},t.prototype.isTileClipped=function(){return!0},t}(au);function Zh(e,t){return t>0?t+2*e:e}var bp=Ui([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Sp=Ui([{name:"a_projected_pos",components:3,type:"Float32"}],4),jh=(Ui([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ui([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Vh=(Ui([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Ui([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Ep=Ui([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Cp(e,t,r){return e.sections.forEach(function(f){f.text=function(v,g,x){var P=g.layout.get("text-transform").evaluate(x,{});return P==="uppercase"?v=v.toLocaleUpperCase():P==="lowercase"&&(v=v.toLocaleLowerCase()),Mo.applyArabicShaping&&(v=Mo.applyArabicShaping(v)),v}(f.text,t,r)}),e}Ui([{name:"triangle",components:3,type:"Uint16"}]),Ui([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ui([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ui([{type:"Float32",name:"offsetX"}]),Ui([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Tf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Gh=function(e,t,r,f,v){var g,x,P=8*v-f-1,k=(1<<P)-1,Z=k>>1,X=-7,re=r?v-1:0,he=r?-1:1,be=e[t+re];for(re+=he,g=be&(1<<-X)-1,be>>=-X,X+=P;X>0;g=256*g+e[t+re],re+=he,X-=8);for(x=g&(1<<-X)-1,g>>=-X,X+=f;X>0;x=256*x+e[t+re],re+=he,X-=8);if(g===0)g=1-Z;else{if(g===k)return x?NaN:1/0*(be?-1:1);x+=Math.pow(2,f),g-=Z}return(be?-1:1)*x*Math.pow(2,g-f)},vh=function(e,t,r,f,v,g){var x,P,k,Z=8*g-v-1,X=(1<<Z)-1,re=X>>1,he=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,be=f?0:g-1,Ve=f?1:-1,We=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(P=isNaN(t)?1:0,x=X):(x=Math.floor(Math.log(t)/Math.LN2),t*(k=Math.pow(2,-x))<1&&(x--,k*=2),(t+=x+re>=1?he/k:he*Math.pow(2,1-re))*k>=2&&(x++,k/=2),x+re>=X?(P=0,x=X):x+re>=1?(P=(t*k-1)*Math.pow(2,v),x+=re):(P=t*Math.pow(2,re-1)*Math.pow(2,v),x=0));v>=8;e[r+be]=255&P,be+=Ve,P/=256,v-=8);for(x=x<<v|P,Z+=v;Z>0;e[r+be]=255&x,be+=Ve,x/=256,Z-=8);e[r+be-Ve]|=128*We},Pf=Ja;function Ja(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Ja.Varint=0,Ja.Fixed64=1,Ja.Bytes=2,Ja.Fixed32=5;var Hh=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function sc(e){return e.type===Ja.Bytes?e.readVarint()+e.pos:e.pos+1}function Zc(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Wh(e,t,r){var f=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(f);for(var v=r.pos-1;v>=e;v--)r.buf[v+f]=r.buf[v]}function U(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function Me(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function Je(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function ir(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function Fr(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function er(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function Pr(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function Zr(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function Kr(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function qr(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function en(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function an(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function bn(e,t,r){e===1&&r.readMessage($r,t)}function $r(e,t,r){if(e===3){var f=r.readMessage(nn,{}),v=f.width,g=f.height,x=f.left,P=f.top,k=f.advance;t.push({id:f.id,bitmap:new Wu({width:v+6,height:g+6},f.bitmap),metrics:{width:v,height:g,left:x,top:P,advance:k}})}}function nn(e,t,r){e===1?t.id=r.readVarint():e===2?t.bitmap=r.readBytes():e===3?t.width=r.readVarint():e===4?t.height=r.readVarint():e===5?t.left=r.readSVarint():e===6?t.top=r.readSVarint():e===7&&(t.advance=r.readVarint())}function Ot(e){for(var t=0,r=0,f=0,v=e;f<v.length;f+=1){var g=v[f];t+=g.w*g.h,r=Math.max(r,g.w)}e.sort(function(We,vt){return vt.h-We.h});for(var x=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],P=0,k=0,Z=0,X=e;Z<X.length;Z+=1)for(var re=X[Z],he=x.length-1;he>=0;he--){var be=x[he];if(!(re.w>be.w||re.h>be.h)){if(re.x=be.x,re.y=be.y,k=Math.max(k,re.y+re.h),P=Math.max(P,re.x+re.w),re.w===be.w&&re.h===be.h){var Ve=x.pop();he<x.length&&(x[he]=Ve)}else re.h===be.h?(be.x+=re.w,be.w-=re.w):re.w===be.w?(be.y+=re.h,be.h-=re.h):(x.push({x:be.x+re.w,y:be.y,w:be.w-re.w,h:re.h}),be.y+=re.h,be.h-=re.h);break}}return{w:P,h:k,fill:t/(P*k)||0}}Ja.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var f=this.readVarint(),v=f>>3,g=this.pos;this.type=7&f,e(v,t,this),this.pos===g&&this.skip(f)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=qr(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=an(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=qr(this.buf,this.pos)+4294967296*qr(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=qr(this.buf,this.pos)+4294967296*an(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=Gh(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Gh(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,f=this.buf;return t=127&(r=f[this.pos++]),r<128?t:(t|=(127&(r=f[this.pos++]))<<7,r<128?t:(t|=(127&(r=f[this.pos++]))<<14,r<128?t:(t|=(127&(r=f[this.pos++]))<<21,r<128?t:function(v,g,x){var P,k,Z=x.buf;if(P=(112&(k=Z[x.pos++]))>>4,k<128||(P|=(127&(k=Z[x.pos++]))<<3,k<128)||(P|=(127&(k=Z[x.pos++]))<<10,k<128)||(P|=(127&(k=Z[x.pos++]))<<17,k<128)||(P|=(127&(k=Z[x.pos++]))<<24,k<128)||(P|=(1&(k=Z[x.pos++]))<<31,k<128))return Zc(v,P,g);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=f[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Hh?function(r,f,v){return Hh.decode(r.subarray(f,v))}(this.buf,t,e):function(r,f,v){for(var g="",x=f;x<v;){var P,k,Z,X=r[x],re=null,he=X>239?4:X>223?3:X>191?2:1;if(x+he>v)break;he===1?X<128&&(re=X):he===2?(192&(P=r[x+1]))==128&&(re=(31&X)<<6|63&P)<=127&&(re=null):he===3?(k=r[x+2],(192&(P=r[x+1]))==128&&(192&k)==128&&((re=(15&X)<<12|(63&P)<<6|63&k)<=2047||re>=55296&&re<=57343)&&(re=null)):he===4&&(k=r[x+2],Z=r[x+3],(192&(P=r[x+1]))==128&&(192&k)==128&&(192&Z)==128&&((re=(15&X)<<18|(63&P)<<12|(63&k)<<6|63&Z)<=65535||re>=1114112)&&(re=null)),re===null?(re=65533,he=1):re>65535&&(re-=65536,g+=String.fromCharCode(re>>>10&1023|55296),re=56320|1023&re),g+=String.fromCharCode(re),x+=he}return g}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Ja.Bytes)return e.push(this.readVarint(t));var r=sc(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Ja.Bytes)return e.push(this.readSVarint());var t=sc(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Ja.Bytes)return e.push(this.readBoolean());var t=sc(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Ja.Bytes)return e.push(this.readFloat());var t=sc(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Ja.Bytes)return e.push(this.readDouble());var t=sc(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Ja.Bytes)return e.push(this.readFixed32());var t=sc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Ja.Bytes)return e.push(this.readSFixed32());var t=sc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Ja.Bytes)return e.push(this.readFixed64());var t=sc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Ja.Bytes)return e.push(this.readSFixed64());var t=sc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Ja.Varint)for(;this.buf[this.pos++]>127;);else if(t===Ja.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Ja.Fixed32)this.pos+=4;else{if(t!==Ja.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),en(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),en(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),en(this.buf,-1&e,this.pos),en(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),en(this.buf,-1&e,this.pos),en(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,r){var f,v;if(t>=0?(f=t%4294967296|0,v=t/4294967296|0):(v=~(-t/4294967296),4294967295^(f=~(-t%4294967296))?f=f+1|0:(f=0,v=v+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(g,x,P){P.buf[P.pos++]=127&g|128,g>>>=7,P.buf[P.pos++]=127&g|128,g>>>=7,P.buf[P.pos++]=127&g|128,g>>>=7,P.buf[P.pos++]=127&g|128,P.buf[P.pos]=127&(g>>>=7)}(f,0,r),function(g,x){var P=(7&g)<<4;x.buf[x.pos++]|=P|((g>>>=3)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g)))))}(v,r)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(f,v,g){for(var x,P,k=0;k<v.length;k++){if((x=v.charCodeAt(k))>55295&&x<57344){if(!P){x>56319||k+1===v.length?(f[g++]=239,f[g++]=191,f[g++]=189):P=x;continue}if(x<56320){f[g++]=239,f[g++]=191,f[g++]=189,P=x;continue}x=P-55296<<10|x-56320|65536,P=null}else P&&(f[g++]=239,f[g++]=191,f[g++]=189,P=null);x<128?f[g++]=x:(x<2048?f[g++]=x>>6|192:(x<65536?f[g++]=x>>12|224:(f[g++]=x>>18|240,f[g++]=x>>12&63|128),f[g++]=x>>6&63|128),f[g++]=63&x|128)}return g}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&Wh(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),vh(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),vh(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var f=this.pos-r;f>=128&&Wh(r,f,this),this.pos=r-1,this.writeVarint(f),this.pos+=f},writeMessage:function(e,t,r){this.writeTag(e,Ja.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,U,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Me,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Fr,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Je,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,ir,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,er,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Pr,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Zr,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Kr,t)},writeBytesField:function(e,t){this.writeTag(e,Ja.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Ja.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Ja.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Ja.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Ja.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Ja.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Ja.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Ja.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Ja.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Ja.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var vr=function(e,t){var r=t.pixelRatio,f=t.version,v=t.stretchX,g=t.stretchY,x=t.content;this.paddedRect=e,this.pixelRatio=r,this.stretchX=v,this.stretchY=g,this.content=x,this.version=f},Jr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Jr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Jr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Jr.tlbr.get=function(){return this.tl.concat(this.br)},Jr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(vr.prototype,Jr);var Tn=function(e,t){var r={},f={};this.haveRenderCallbacks=[];var v=[];this.addImages(e,r,v),this.addImages(t,f,v);var g=Ot(v),x=new hs({width:g.w||1,height:g.h||1});for(var P in e){var k=e[P],Z=r[P].paddedRect;hs.copy(k.data,x,{x:0,y:0},{x:Z.x+1,y:Z.y+1},k.data)}for(var X in t){var re=t[X],he=f[X].paddedRect,be=he.x+1,Ve=he.y+1,We=re.data.width,vt=re.data.height;hs.copy(re.data,x,{x:0,y:0},{x:be,y:Ve},re.data),hs.copy(re.data,x,{x:0,y:vt-1},{x:be,y:Ve-1},{width:We,height:1}),hs.copy(re.data,x,{x:0,y:0},{x:be,y:Ve+vt},{width:We,height:1}),hs.copy(re.data,x,{x:We-1,y:0},{x:be-1,y:Ve},{width:1,height:vt}),hs.copy(re.data,x,{x:0,y:0},{x:be+We,y:Ve},{width:1,height:vt})}this.image=x,this.iconPositions=r,this.patternPositions=f};Tn.prototype.addImages=function(e,t,r){for(var f in e){var v=e[f],g={x:0,y:0,w:v.data.width+2,h:v.data.height+2};r.push(g),t[f]=new vr(g,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(f)}},Tn.prototype.patchUpdatedImages=function(e,t){for(var r in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)},Tn.prototype.patchUpdatedImage=function(e,t,r){if(e&&t&&e.version!==t.version){e.version=t.version;var f=e.tl;r.update(t.data,void 0,{x:f[0],y:f[1]})}},Dn("ImagePosition",vr),Dn("ImageAtlas",Tn);var Lr={horizontal:1,vertical:2,horizontalOnly:3},Pn=function(){this.scale=1,this.fontStack="",this.imageName=null};Pn.forText=function(e,t){var r=new Pn;return r.scale=e||1,r.fontStack=t,r},Pn.forImage=function(e){var t=new Pn;return t.imageName=e,t};var on=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function ci(e,t,r,f,v,g,x,P,k,Z,X,re,he,be,Ve,We){var vt,tt=on.fromFeature(e,v);re===Lr.vertical&&tt.verticalizePunctuation();var It=Mo.processBidirectionalText,Wt=Mo.processStyledBidirectionalText;if(It&&tt.sections.length===1){vt=[];for(var pr=0,mr=It(tt.toString(),Ln(tt,Z,g,t,f,be,Ve));pr<mr.length;pr+=1){var Br=mr[pr],sn=new on;sn.text=Br,sn.sections=tt.sections;for(var Cn=0;Cn<Br.length;Cn++)sn.sectionIndex.push(0);vt.push(sn)}}else if(Wt){vt=[];for(var fi=0,Vn=Wt(tt.text,tt.sectionIndex,Ln(tt,Z,g,t,f,be,Ve));fi<Vn.length;fi+=1){var di=Vn[fi],Kn=new on;Kn.text=di[0],Kn.sectionIndex=di[1],Kn.sections=tt.sections,vt.push(Kn)}}else vt=function(oi,fa){for(var Qi=[],Sa=oi.text,gi=0,Ba=0,So=fa;Ba<So.length;Ba+=1){var Jo=So[Ba];Qi.push(oi.substring(gi,Jo)),gi=Jo}return gi<Sa.length&&Qi.push(oi.substring(gi,Sa.length)),Qi}(tt,Ln(tt,Z,g,t,f,be,Ve));var oa=[],Ii={positionedLines:oa,text:tt.toString(),top:X[1],bottom:X[1],left:X[0],right:X[0],writingMode:re,iconsInText:!1,verticalizable:!1};return function(oi,fa,Qi,Sa,gi,Ba,So,Jo,Ho,Ro,No,zs){for(var Cs=0,su=-17,Ls=0,Xs=0,Wo=Jo==="right"?1:Jo==="left"?0:.5,Wa=0,ma=0,Na=gi;ma<Na.length;ma+=1){var eo=Na[ma];eo.trim();var Aa=eo.getMaxScale(),Tu=24*(Aa-1),yu={positionedGlyphs:[],lineOffset:0};oi.positionedLines[Wa]=yu;var uo=yu.positionedGlyphs,zo=0;if(eo.length()){for(var Ys=0;Ys<eo.length();Ys++){var La=eo.getSection(Ys),cc=eo.getSectionIndex(Ys),Ks=eo.getCharCode(Ys),Gl=0,Uo=null,Mc=null,Hl=null,fc=24,Lf=!(Ho===Lr.horizontal||!No&&!_c(Ks)||No&&(Rr[Ks]||(Ic=Ks,xn.Arabic(Ic)||xn["Arabic Supplement"](Ic)||xn["Arabic Extended-A"](Ic)||xn["Arabic Presentation Forms-A"](Ic)||xn["Arabic Presentation Forms-B"](Ic))));if(La.imageName){var $f=Sa[La.imageName];if(!$f)continue;Hl=La.imageName,oi.iconsInText=oi.iconsInText||!0,Mc=$f.paddedRect;var hf=$f.displaySize;La.scale=24*La.scale/zs,Gl=Tu+(24-hf[1]*La.scale),fc=(Uo={width:hf[0],height:hf[1],left:1,top:-3,advance:Lf?hf[1]:hf[0]}).advance;var yh=Lf?hf[0]*La.scale-24*Aa:hf[1]*La.scale-24*Aa;yh>0&&yh>zo&&(zo=yh)}else{var Tp=Qi[La.fontStack],_h=Tp&&Tp[Ks];if(_h&&_h.rect)Mc=_h.rect,Uo=_h.metrics;else{var Kh=fa[La.fontStack],Pp=Kh&&Kh[Ks];if(!Pp)continue;Uo=Pp.metrics}Gl=24*(Aa-La.scale)}Lf?(oi.verticalizable=!0,uo.push({glyph:Ks,imageName:Hl,x:Cs,y:su+Gl,vertical:Lf,scale:La.scale,fontStack:La.fontStack,sectionIndex:cc,metrics:Uo,rect:Mc}),Cs+=fc*La.scale+Ro):(uo.push({glyph:Ks,imageName:Hl,x:Cs,y:su+Gl,vertical:Lf,scale:La.scale,fontStack:La.fontStack,sectionIndex:cc,metrics:Uo,rect:Mc}),Cs+=Uo.advance*La.scale+Ro)}uo.length!==0&&(Ls=Math.max(Cs-Ro,Ls),ki(uo,0,uo.length-1,Wo,zo)),Cs=0;var Mp=Ba*Aa+zo;yu.lineOffset=Math.max(zo,Tu),su+=Mp,Xs=Math.max(Mp,Xs),++Wa}else su+=Ba,++Wa}var Ic,Rf=su- -17,xh=Vi(So),Vc=xh.horizontalAlign,Jf=xh.verticalAlign;(function(Ip,bh,Sh,$h,Eh,Ch,Jh,pf,Qh){var wh,Oc=(bh-Sh)*Eh;wh=Ch!==Jh?-pf*$h- -17:(-$h*Qh+.5)*Jh;for(var Df=0,df=Ip;Df<df.length;Df+=1)for(var kf=0,Ah=df[Df].positionedGlyphs;kf<Ah.length;kf+=1){var hc=Ah[kf];hc.x+=Oc,hc.y+=wh}})(oi.positionedLines,Wo,Vc,Jf,Ls,Xs,Ba,Rf,gi.length),oi.top+=-Jf*Rf,oi.bottom=oi.top+Rf,oi.left+=-Vc*Ls,oi.right=oi.left+Ls}(Ii,t,r,f,vt,x,P,k,re,Z,he,We),!function(oi){for(var fa=0,Qi=oi;fa<Qi.length;fa+=1)if(Qi[fa].positionedGlyphs.length!==0)return!1;return!0}(oa)&&Ii}on.fromFeature=function(e,t){for(var r=new on,f=0;f<e.sections.length;f++){var v=e.sections[f];v.image?r.addImageSection(v):r.addTextSection(v,t)}return r},on.prototype.length=function(){return this.text.length},on.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},on.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},on.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},on.prototype.verticalizePunctuation=function(){this.text=function(e){for(var t="",r=0;r<e.length;r++){var f=e.charCodeAt(r+1)||null,v=e.charCodeAt(r-1)||null;t+=f&&nu(f)&&!Tf[e[r+1]]||v&&nu(v)&&!Tf[e[r-1]]||!Tf[e[r]]?e[r]:Tf[e[r]]}return t}(this.text)},on.prototype.trim=function(){for(var e=0,t=0;t<this.text.length&&Rr[this.text.charCodeAt(t)];t++)e++;for(var r=this.text.length,f=this.text.length-1;f>=0&&f>=e&&Rr[this.text.charCodeAt(f)];f--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)},on.prototype.substring=function(e,t){var r=new on;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r},on.prototype.toString=function(){return this.text},on.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce(function(t,r){return Math.max(t,e.sections[r].scale)},0)},on.prototype.addTextSection=function(e,t){this.text+=e.text,this.sections.push(Pn.forText(e.scale,e.fontStack||t));for(var r=this.sections.length-1,f=0;f<e.text.length;++f)this.sectionIndex.push(r)},on.prototype.addImageSection=function(e){var t=e.image?e.image.name:"";if(t.length!==0){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(Pn.forImage(t)),this.sectionIndex.push(this.sections.length-1)):Xe("Reached maximum number of images 6401")}else Xe("Can't add FormattedSection with an empty image.")},on.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Rr={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},wr={};function Qn(e,t,r,f,v,g){if(t.imageName){var x=f[t.imageName];return x?x.displaySize[0]*t.scale*24/g+v:0}var P=r[t.fontStack],k=P&&P[e];return k?k.metrics.advance*t.scale+v:0}function Sn(e,t,r,f){var v=Math.pow(e-t,2);return f?e<t?v/2:2*v:v+Math.abs(r)*r}function rn(e,t,r){var f=0;return e===10&&(f-=1e4),r&&(f+=150),e!==40&&e!==65288||(f+=50),t!==41&&t!==65289||(f+=50),f}function On(e,t,r,f,v,g){for(var x=null,P=Sn(t,r,v,g),k=0,Z=f;k<Z.length;k+=1){var X=Z[k],re=Sn(t-X.x,r,v,g)+X.badness;re<=P&&(x=X,P=re)}return{index:e,x:t,priorBreak:x,badness:P}}function Ln(e,t,r,f,v,g,x){if(g!=="point")return[];if(!e)return[];for(var P,k=[],Z=function(vt,tt,It,Wt,pr,mr){for(var Br=0,sn=0;sn<vt.length();sn++){var Cn=vt.getSection(sn);Br+=Qn(vt.getCharCode(sn),Cn,Wt,pr,tt,mr)}return Br/Math.max(1,Math.ceil(Br/It))}(e,t,r,f,v,x),X=e.text.indexOf("\u200B")>=0,re=0,he=0;he<e.length();he++){var be=e.getSection(he),Ve=e.getCharCode(he);if(Rr[Ve]||(re+=Qn(Ve,be,f,v,t,x)),he<e.length()-1){var We=!((P=Ve)<11904||!(xn["Bopomofo Extended"](P)||xn.Bopomofo(P)||xn["CJK Compatibility Forms"](P)||xn["CJK Compatibility Ideographs"](P)||xn["CJK Compatibility"](P)||xn["CJK Radicals Supplement"](P)||xn["CJK Strokes"](P)||xn["CJK Symbols and Punctuation"](P)||xn["CJK Unified Ideographs Extension A"](P)||xn["CJK Unified Ideographs"](P)||xn["Enclosed CJK Letters and Months"](P)||xn["Halfwidth and Fullwidth Forms"](P)||xn.Hiragana(P)||xn["Ideographic Description Characters"](P)||xn["Kangxi Radicals"](P)||xn["Katakana Phonetic Extensions"](P)||xn.Katakana(P)||xn["Vertical Forms"](P)||xn["Yi Radicals"](P)||xn["Yi Syllables"](P)));(wr[Ve]||We||be.imageName)&&k.push(On(he+1,re,Z,k,rn(Ve,e.getCharCode(he+1),We&&X),!1))}}return function vt(tt){return tt?vt(tt.priorBreak).concat(tt.index):[]}(On(e.length(),re,Z,k,0,!0))}function Vi(e){var t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function ki(e,t,r,f,v){if(f||v)for(var g=e[r],x=(e[r].x+g.metrics.advance*g.scale)*f,P=t;P<=r;P++)e[P].x-=x,e[P].y+=v}function kn(e,t,r,f,v,g){var x,P=e.image;if(P.content){var k=P.content,Z=P.pixelRatio||1;x=[k[0]/Z,k[1]/Z,P.displaySize[0]-k[2]/Z,P.displaySize[1]-k[3]/Z]}var X,re,he,be,Ve=t.left*g,We=t.right*g;r==="width"||r==="both"?(be=v[0]+Ve-f[3],re=v[0]+We+f[1]):re=(be=v[0]+(Ve+We-P.displaySize[0])/2)+P.displaySize[0];var vt=t.top*g,tt=t.bottom*g;return r==="height"||r==="both"?(X=v[1]+vt-f[0],he=v[1]+tt+f[2]):he=(X=v[1]+(vt+tt-P.displaySize[1])/2)+P.displaySize[1],{image:P,top:X,right:re,bottom:he,left:be,collisionPadding:x}}wr[10]=!0,wr[32]=!0,wr[38]=!0,wr[40]=!0,wr[41]=!0,wr[43]=!0,wr[45]=!0,wr[47]=!0,wr[173]=!0,wr[183]=!0,wr[8203]=!0,wr[8208]=!0,wr[8211]=!0,wr[8231]=!0;var Fn=function(e){function t(r,f,v,g){e.call(this,r,f),this.angle=v,g!==void 0&&(this.segment=g)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.clone=function(){return new t(this.x,this.y,this.angle,this.segment)},t}(oe);function Ti(e,t){var r=t.expression;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new ta(e+1))};if(r.kind==="source")return{kind:"source"};for(var f=r.zoomStops,v=r.interpolationType,g=0;g<f.length&&f[g]<=e;)g++;for(var x=g=Math.max(0,g-1);x<f.length&&f[x]<e+1;)x++;x=Math.min(f.length-1,x);var P=f[g],k=f[x];return r.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:k,interpolationType:v}:{kind:"camera",minZoom:P,maxZoom:k,minSize:r.evaluate(new ta(P)),maxSize:r.evaluate(new ta(k)),interpolationType:v}}function zi(e,t,r){var f=t.uSize,v=r.lowerSize;return e.kind==="source"?v/128:e.kind==="composite"?Ea(v/128,r.upperSize/128,t.uSizeT):f}function va(e,t){var r=0,f=0;if(e.kind==="constant")f=e.layoutSize;else if(e.kind!=="source"){var v=e.interpolationType,g=v?Cr(Ie.interpolationFactor(v,t,e.minZoom,e.maxZoom),0,1):0;e.kind==="camera"?f=Ea(e.minSize,e.maxSize,g):r=g}return{uSizeT:r,uSize:f}}Dn("Anchor",Fn);var jo=Object.freeze({__proto__:null,getSizeData:Ti,evaluateSizeForFeature:zi,evaluateSizeForZoom:va,SIZE_PACK_FACTOR:128});function Vo(e,t,r,f,v){if(t.segment===void 0)return!0;for(var g=t,x=t.segment+1,P=0;P>-r/2;){if(--x<0)return!1;P-=e[x].dist(g),g=e[x]}P+=e[x].dist(e[x+1]),x++;for(var k=[],Z=0;P<r/2;){var X=e[x],re=e[x+1];if(!re)return!1;var he=e[x-1].angleTo(X)-X.angleTo(re);for(he=Math.abs((he+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:P,angleDelta:he}),Z+=he;P-k[0].distance>f;)Z-=k.shift().angleDelta;if(Z>v)return!1;x++,P+=X.dist(re)}return!0}function la(e){for(var t=0,r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function Ss(e,t,r){return e?.6*t*r:0}function _o(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Is(e,t,r,f,v,g){for(var x=Ss(r,v,g),P=_o(r,f)*g,k=0,Z=la(e)/2,X=0;X<e.length-1;X++){var re=e[X],he=e[X+1],be=re.dist(he);if(k+be>Z){var Ve=(Z-k)/be,We=Ea(re.x,he.x,Ve),vt=Ea(re.y,he.y,Ve),tt=new Fn(We,vt,he.angleTo(re),X);return tt._round(),!x||Vo(e,tt,P,x,t)?tt:void 0}k+=be}}function Go(e,t,r,f,v,g,x,P,k){var Z=Ss(f,g,x),X=_o(f,v),re=X*x,he=e[0].x===0||e[0].x===k||e[0].y===0||e[0].y===k;return t-re<t/4&&(t=re+t/4),function be(Ve,We,vt,tt,It,Wt,pr,mr,Br){for(var sn=Wt/2,Cn=la(Ve),fi=0,Vn=We-vt,di=[],Kn=0;Kn<Ve.length-1;Kn++){for(var oa=Ve[Kn],Ii=Ve[Kn+1],oi=oa.dist(Ii),fa=Ii.angleTo(oa);Vn+vt<fi+oi;){var Qi=((Vn+=vt)-fi)/oi,Sa=Ea(oa.x,Ii.x,Qi),gi=Ea(oa.y,Ii.y,Qi);if(Sa>=0&&Sa<Br&&gi>=0&&gi<Br&&Vn-sn>=0&&Vn+sn<=Cn){var Ba=new Fn(Sa,gi,fa,Kn);Ba._round(),tt&&!Vo(Ve,Ba,Wt,tt,It)||di.push(Ba)}}fi+=oi}return mr||di.length||pr||(di=be(Ve,fi/2,vt,tt,It,Wt,pr,!0,Br)),di}(e,he?t/2*P%t:(X/2+2*g)*x*P%t,t,Z,r,re,he,!1,k)}function os(e,t,r,f,v){for(var g=[],x=0;x<e.length;x++)for(var P=e[x],k=void 0,Z=0;Z<P.length-1;Z++){var X=P[Z],re=P[Z+1];X.x<t&&re.x<t||(X.x<t?X=new oe(t,X.y+(t-X.x)/(re.x-X.x)*(re.y-X.y))._round():re.x<t&&(re=new oe(t,X.y+(t-X.x)/(re.x-X.x)*(re.y-X.y))._round()),X.y<r&&re.y<r||(X.y<r?X=new oe(X.x+(r-X.y)/(re.y-X.y)*(re.x-X.x),r)._round():re.y<r&&(re=new oe(X.x+(r-X.y)/(re.y-X.y)*(re.x-X.x),r)._round()),X.x>=f&&re.x>=f||(X.x>=f?X=new oe(f,X.y+(f-X.x)/(re.x-X.x)*(re.y-X.y))._round():re.x>=f&&(re=new oe(f,X.y+(f-X.x)/(re.x-X.x)*(re.y-X.y))._round()),X.y>=v&&re.y>=v||(X.y>=v?X=new oe(X.x+(v-X.y)/(re.y-X.y)*(re.x-X.x),v)._round():re.y>=v&&(re=new oe(X.x+(v-X.y)/(re.y-X.y)*(re.x-X.x),v)._round()),k&&X.equals(k[k.length-1])||g.push(k=[X]),k.push(re)))))}return g}function ps(e,t,r,f){var v=[],g=e.image,x=g.pixelRatio,P=g.paddedRect.w-2,k=g.paddedRect.h-2,Z=e.right-e.left,X=e.bottom-e.top,re=g.stretchX||[[0,P]],he=g.stretchY||[[0,k]],be=function(Sa,gi){return Sa+gi[1]-gi[0]},Ve=re.reduce(be,0),We=he.reduce(be,0),vt=P-Ve,tt=k-We,It=0,Wt=Ve,pr=0,mr=We,Br=0,sn=vt,Cn=0,fi=tt;if(g.content&&f){var Vn=g.content;It=Os(re,0,Vn[0]),pr=Os(he,0,Vn[1]),Wt=Os(re,Vn[0],Vn[2]),mr=Os(he,Vn[1],Vn[3]),Br=Vn[0]-It,Cn=Vn[1]-pr,sn=Vn[2]-Vn[0]-Wt,fi=Vn[3]-Vn[1]-mr}var di=function(Sa,gi,Ba,So){var Jo=Ji(Sa.stretch-It,Wt,Z,e.left),Ho=Es(Sa.fixed-Br,sn,Sa.stretch,Ve),Ro=Ji(gi.stretch-pr,mr,X,e.top),No=Es(gi.fixed-Cn,fi,gi.stretch,We),zs=Ji(Ba.stretch-It,Wt,Z,e.left),Cs=Es(Ba.fixed-Br,sn,Ba.stretch,Ve),su=Ji(So.stretch-pr,mr,X,e.top),Ls=Es(So.fixed-Cn,fi,So.stretch,We),Xs=new oe(Jo,Ro),Wo=new oe(zs,Ro),Wa=new oe(zs,su),ma=new oe(Jo,su),Na=new oe(Ho/x,No/x),eo=new oe(Cs/x,Ls/x),Aa=t*Math.PI/180;if(Aa){var Tu=Math.sin(Aa),yu=Math.cos(Aa),uo=[yu,-Tu,Tu,yu];Xs._matMult(uo),Wo._matMult(uo),ma._matMult(uo),Wa._matMult(uo)}var zo=Sa.stretch+Sa.fixed,Ys=gi.stretch+gi.fixed;return{tl:Xs,tr:Wo,bl:ma,br:Wa,tex:{x:g.paddedRect.x+1+zo,y:g.paddedRect.y+1+Ys,w:Ba.stretch+Ba.fixed-zo,h:So.stretch+So.fixed-Ys},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Na,pixelOffsetBR:eo,minFontScaleX:sn/x/Z,minFontScaleY:fi/x/X,isSDF:r}};if(f&&(g.stretchX||g.stretchY))for(var Kn=$o(re,vt,Ve),oa=$o(he,tt,We),Ii=0;Ii<Kn.length-1;Ii++)for(var oi=Kn[Ii],fa=Kn[Ii+1],Qi=0;Qi<oa.length-1;Qi++)v.push(di(oi,oa[Qi],fa,oa[Qi+1]));else v.push(di({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:k+1}));return v}function Os(e,t,r){for(var f=0,v=0,g=e;v<g.length;v+=1){var x=g[v];f+=Math.max(t,Math.min(r,x[1]))-Math.max(t,Math.min(r,x[0]))}return f}function $o(e,t,r){for(var f=[{fixed:-1,stretch:0}],v=0,g=e;v<g.length;v+=1){var x=g[v],P=x[0],k=x[1],Z=f[f.length-1];f.push({fixed:P-Z.stretch,stretch:Z.stretch}),f.push({fixed:P-Z.stretch,stretch:Z.stretch+(k-P)})}return f.push({fixed:t+1,stretch:r}),f}function Ji(e,t,r,f){return e/t*r+f}function Es(e,t,r,f){return e-t*r/f}var Fa=function(e,t,r,f,v,g,x,P,k,Z){if(this.boxStartIndex=e.length,k){var X=g.top,re=g.bottom,he=g.collisionPadding;he&&(X-=he[1],re+=he[3]);var be=re-X;be>0&&(be=Math.max(10,be),this.circleDiameter=be)}else{var Ve=g.top*x-P,We=g.bottom*x+P,vt=g.left*x-P,tt=g.right*x+P,It=g.collisionPadding;if(It&&(vt-=It[0]*x,Ve-=It[1]*x,tt+=It[2]*x,We+=It[3]*x),Z){var Wt=new oe(vt,Ve),pr=new oe(tt,Ve),mr=new oe(vt,We),Br=new oe(tt,We),sn=Z*Math.PI/180;Wt._rotate(sn),pr._rotate(sn),mr._rotate(sn),Br._rotate(sn),vt=Math.min(Wt.x,pr.x,mr.x,Br.x),tt=Math.max(Wt.x,pr.x,mr.x,Br.x),Ve=Math.min(Wt.y,pr.y,mr.y,Br.y),We=Math.max(Wt.y,pr.y,mr.y,Br.y)}e.emplaceBack(t.x,t.y,vt,Ve,tt,We,r,f,v)}this.boxEndIndex=e.length},Oo=function(e,t){if(e===void 0&&(e=[]),t===void 0&&(t=Mi),this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function Mi(e,t){return e<t?-1:e>t?1:0}function ca(e,t,r){t===void 0&&(t=1),r===void 0&&(r=!1);for(var f=1/0,v=1/0,g=-1/0,x=-1/0,P=e[0],k=0;k<P.length;k++){var Z=P[k];(!k||Z.x<f)&&(f=Z.x),(!k||Z.y<v)&&(v=Z.y),(!k||Z.x>g)&&(g=Z.x),(!k||Z.y>x)&&(x=Z.y)}var X=Math.min(g-f,x-v),re=X/2,he=new Oo([],Ha);if(X===0)return new oe(f,v);for(var be=f;be<g;be+=X)for(var Ve=v;Ve<x;Ve+=X)he.push(new Lo(be+re,Ve+re,re,e));for(var We=function(It){for(var Wt=0,pr=0,mr=0,Br=It[0],sn=0,Cn=Br.length,fi=Cn-1;sn<Cn;fi=sn++){var Vn=Br[sn],di=Br[fi],Kn=Vn.x*di.y-di.x*Vn.y;pr+=(Vn.x+di.x)*Kn,mr+=(Vn.y+di.y)*Kn,Wt+=3*Kn}return new Lo(pr/Wt,mr/Wt,0,It)}(e),vt=he.length;he.length;){var tt=he.pop();(tt.d>We.d||!We.d)&&(We=tt,r&&console.log("found best %d after %d probes",Math.round(1e4*tt.d)/1e4,vt)),tt.max-We.d<=t||(he.push(new Lo(tt.p.x-(re=tt.h/2),tt.p.y-re,re,e)),he.push(new Lo(tt.p.x+re,tt.p.y-re,re,e)),he.push(new Lo(tt.p.x-re,tt.p.y+re,re,e)),he.push(new Lo(tt.p.x+re,tt.p.y+re,re,e)),vt+=4)}return r&&(console.log("num probes: "+vt),console.log("best distance: "+We.d)),We.p}function Ha(e,t){return t.max-e.max}function Lo(e,t,r,f){this.p=new oe(e,t),this.h=r,this.d=function(v,g){for(var x=!1,P=1/0,k=0;k<g.length;k++)for(var Z=g[k],X=0,re=Z.length,he=re-1;X<re;he=X++){var be=Z[X],Ve=Z[he];be.y>v.y!=Ve.y>v.y&&v.x<(Ve.x-be.x)*(v.y-be.y)/(Ve.y-be.y)+be.x&&(x=!x),P=Math.min(P,ba(v,be,Ve))}return(x?1:-1)*Math.sqrt(P)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}Oo.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},Oo.prototype.pop=function(){if(this.length!==0){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},Oo.prototype.peek=function(){return this.data[0]},Oo.prototype._up=function(e){for(var t=this.data,r=this.compare,f=t[e];e>0;){var v=e-1>>1,g=t[v];if(r(f,g)>=0)break;t[e]=g,e=v}t[e]=f},Oo.prototype._down=function(e){for(var t=this.data,r=this.compare,f=this.length>>1,v=t[e];e<f;){var g=1+(e<<1),x=t[g],P=g+1;if(P<this.length&&r(t[P],x)<0&&(g=P,x=t[P]),r(x,v)>=0)break;t[e]=x,e=g}t[e]=v};var Vl=Number.POSITIVE_INFINITY;function je(e,t){return t[1]!==Vl?function(r,f,v){var g=0,x=0;switch(f=Math.abs(f),v=Math.abs(v),r){case"top-right":case"top-left":case"top":x=v-7;break;case"bottom-right":case"bottom-left":case"bottom":x=7-v}switch(r){case"top-right":case"bottom-right":case"right":g=-f;break;case"top-left":case"bottom-left":case"left":g=f}return[g,x]}(e,t[0],t[1]):function(r,f){var v=0,g=0;f<0&&(f=0);var x=f/Math.sqrt(2);switch(r){case"top-right":case"top-left":g=x-7;break;case"bottom-right":case"bottom-left":g=7-x;break;case"bottom":g=7-f;break;case"top":g=f-7}switch(r){case"top-right":case"bottom-right":v=-x;break;case"top-left":case"bottom-left":v=x;break;case"left":v=f;break;case"right":v=-f}return[v,g]}(e,t[0])}function or(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function $t(e,t,r,f,v,g,x,P,k,Z,X,re,he,be,Ve){var We=function(pr,mr,Br,sn,Cn,fi,Vn,di){for(var Kn=sn.layout.get("text-rotate").evaluate(fi,{})*Math.PI/180,oa=[],Ii=0,oi=mr.positionedLines;Ii<oi.length;Ii+=1)for(var fa=oi[Ii],Qi=0,Sa=fa.positionedGlyphs;Qi<Sa.length;Qi+=1){var gi=Sa[Qi];if(gi.rect){var Ba=gi.rect||{},So=4,Jo=!0,Ho=1,Ro=0,No=(Cn||di)&&gi.vertical,zs=gi.metrics.advance*gi.scale/2;if(di&&mr.verticalizable&&(Ro=fa.lineOffset/2-(gi.imageName?-(24-gi.metrics.width*gi.scale)/2:24*(gi.scale-1))),gi.imageName){var Cs=Vn[gi.imageName];Jo=Cs.sdf,So=1/(Ho=Cs.pixelRatio)}var su=Cn?[gi.x+zs,gi.y]:[0,0],Ls=Cn?[0,0]:[gi.x+zs+Br[0],gi.y+Br[1]-Ro],Xs=[0,0];No&&(Xs=Ls,Ls=[0,0]);var Wo=(gi.metrics.left-So)*gi.scale-zs+Ls[0],Wa=(-gi.metrics.top-So)*gi.scale+Ls[1],ma=Wo+Ba.w*gi.scale/Ho,Na=Wa+Ba.h*gi.scale/Ho,eo=new oe(Wo,Wa),Aa=new oe(ma,Wa),Tu=new oe(Wo,Na),yu=new oe(ma,Na);if(No){var uo=new oe(-zs,zs- -17),zo=-Math.PI/2,Ys=12-zs,La=new oe(22-Ys,-(gi.imageName?Ys:0)),cc=new(Function.prototype.bind.apply(oe,[null].concat(Xs)));eo._rotateAround(zo,uo)._add(La)._add(cc),Aa._rotateAround(zo,uo)._add(La)._add(cc),Tu._rotateAround(zo,uo)._add(La)._add(cc),yu._rotateAround(zo,uo)._add(La)._add(cc)}if(Kn){var Ks=Math.sin(Kn),Gl=Math.cos(Kn),Uo=[Gl,-Ks,Ks,Gl];eo._matMult(Uo),Aa._matMult(Uo),Tu._matMult(Uo),yu._matMult(Uo)}var Mc=new oe(0,0),Hl=new oe(0,0);oa.push({tl:eo,tr:Aa,bl:Tu,br:yu,tex:Ba,writingMode:mr.writingMode,glyphOffset:su,sectionIndex:gi.sectionIndex,isSDF:Jo,pixelOffsetTL:Mc,pixelOffsetBR:Hl,minFontScaleX:0,minFontScaleY:0})}}return oa}(0,r,P,v,g,x,f,e.allowVerticalPlacement),vt=e.textSizeData,tt=null;vt.kind==="source"?(tt=[128*v.layout.get("text-size").evaluate(x,{})])[0]>32640&&Xe(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):vt.kind==="composite"&&((tt=[128*be.compositeTextSizes[0].evaluate(x,{},Ve),128*be.compositeTextSizes[1].evaluate(x,{},Ve)])[0]>32640||tt[1]>32640)&&Xe(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,We,tt,P,g,x,Z,t,k.lineStartIndex,k.lineLength,he,Ve);for(var It=0,Wt=X;It<Wt.length;It+=1)re[Wt[It]]=e.text.placedSymbolArray.length-1;return 4*We.length}function Yn(e){for(var t in e)return e[t];return null}function ua(e,t,r,f){var v=e.compareText;if(t in v){for(var g=v[t],x=g.length-1;x>=0;x--)if(f.dist(g[x])<r)return!0}else v[t]=[];return v[t].push(f),!1}var Fe=Ac.VectorTileFeature.types,Ee=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function at(e,t,r,f,v,g,x,P,k,Z,X,re,he){var be=P?Math.min(32640,Math.round(P[0])):0,Ve=P?Math.min(32640,Math.round(P[1])):0;e.emplaceBack(t,r,Math.round(32*f),Math.round(32*v),g,x,(be<<1)+(k?1:0),Ve,16*Z,16*X,256*re,256*he)}function Mt(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}function tr(e){for(var t=0,r=e.sections;t<r.length;t+=1)if(Tl(r[t].text))return!0;return!1}var yt=function(e){this.layoutVertexArray=new Gu,this.indexArray=new Cu,this.programConfigurations=e,this.segments=new we,this.dynamicLayoutVertexArray=new il,this.opacityVertexArray=new Il,this.placedSymbolArray=new h};yt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},yt.prototype.upload=function(e,t,r,f){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Sp.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Ee,!0),this.opacityVertexBuffer.itemSize=1),(r||f)&&this.programConfigurations.upload(e))},yt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Dn("SymbolBuffers",yt);var ht=function(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new we,this.collisionVertexArray=new sl};ht.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,jh.members,!0)},ht.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Dn("CollisionBuffers",ht);var ot=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(g){return g.id}),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=oo([]),this.placementViewportMatrix=oo([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ti(this.zoom,t["text-size"]),this.iconSizeData=Ti(this.zoom,t["icon-size"]);var r=this.layers[0].layout,f=r.get("symbol-sort-key"),v=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,r.get("symbol-placement")==="point"&&(this.writingModes=r.get("text-writing-mode").map(function(g){return Lr[g]})),this.stateDependentLayerIds=this.layers.filter(function(g){return g.isStateDependent()}).map(function(g){return g.id}),this.sourceID=e.sourceID};ot.prototype.createArrays=function(){this.text=new yt(new O(this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new yt(new O(this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.glyphOffsetArray=new T,this.lineVertexArray=new D,this.symbolInstances=new b},ot.prototype.calculateGlyphDependencies=function(e,t,r,f,v){for(var g=0;g<e.length;g++)if(t[e.charCodeAt(g)]=!0,(r||f)&&v){var x=Tf[e.charAt(g)];x&&(t[x.charCodeAt(0)]=!0)}},ot.prototype.populate=function(e,t,r){var f=this.layers[0],v=f.layout,g=v.get("text-font"),x=v.get("text-field"),P=v.get("icon-image"),k=(x.value.kind!=="constant"||x.value.value instanceof za&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),Z=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,X=v.get("symbol-sort-key");if(this.features=[],k||Z){for(var re=t.iconDependencies,he=t.glyphDependencies,be=t.availableImages,Ve=new ta(this.zoom),We=0,vt=e;We<vt.length;We+=1){var tt=vt[We],It=tt.feature,Wt=tt.id,pr=tt.index,mr=tt.sourceLayerIndex,Br=f._featureFilter.needGeometry,sn=xt(It,Br);if(f._featureFilter.filter(Ve,sn,r)){Br||(sn.geometry=Pt(It));var Cn=void 0;if(k){var fi=f.getValueAndResolveTokens("text-field",sn,r,be),Vn=za.factory(fi);tr(Vn)&&(this.hasRTLText=!0),(!this.hasRTLText||Po()==="unavailable"||this.hasRTLText&&Mo.isParsed())&&(Cn=Cp(Vn,f,sn))}var di=void 0;if(Z){var Kn=f.getValueAndResolveTokens("icon-image",sn,r,be);di=Kn instanceof $i?Kn:$i.fromString(Kn)}if(Cn||di){var oa=this.sortFeaturesByKey?X.evaluate(sn,{},r):void 0;if(this.features.push({id:Wt,text:Cn,icon:di,index:pr,sourceLayerIndex:mr,geometry:sn.geometry,properties:It.properties,type:Fe[It.type],sortKey:oa}),di&&(re[di.name]=!0),Cn){var Ii=g.evaluate(sn,{},r).join(","),oi=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Lr.vertical)>=0;for(var fa=0,Qi=Cn.sections;fa<Qi.length;fa+=1){var Sa=Qi[fa];if(Sa.image)re[Sa.image.name]=!0;else{var gi=Ou(Cn.toString()),Ba=Sa.fontStack||Ii,So=he[Ba]=he[Ba]||{};this.calculateGlyphDependencies(Sa.text,So,oi,this.allowVerticalPlacement,gi)}}}}}}v.get("symbol-placement")==="line"&&(this.features=function(Jo){var Ho={},Ro={},No=[],zs=0;function Cs(uo){No.push(Jo[uo]),zs++}function su(uo,zo,Ys){var La=Ro[uo];return delete Ro[uo],Ro[zo]=La,No[La].geometry[0].pop(),No[La].geometry[0]=No[La].geometry[0].concat(Ys[0]),La}function Ls(uo,zo,Ys){var La=Ho[zo];return delete Ho[zo],Ho[uo]=La,No[La].geometry[0].shift(),No[La].geometry[0]=Ys[0].concat(No[La].geometry[0]),La}function Xs(uo,zo,Ys){var La=Ys?zo[0][zo[0].length-1]:zo[0][0];return uo+":"+La.x+":"+La.y}for(var Wo=0;Wo<Jo.length;Wo++){var Wa=Jo[Wo],ma=Wa.geometry,Na=Wa.text?Wa.text.toString():null;if(Na){var eo=Xs(Na,ma),Aa=Xs(Na,ma,!0);if(eo in Ro&&Aa in Ho&&Ro[eo]!==Ho[Aa]){var Tu=Ls(eo,Aa,ma),yu=su(eo,Aa,No[Tu].geometry);delete Ho[eo],delete Ro[Aa],Ro[Xs(Na,No[yu].geometry,!0)]=yu,No[Tu].geometry=null}else eo in Ro?su(eo,Aa,ma):Aa in Ho?Ls(eo,Aa,ma):(Cs(Wo),Ho[eo]=zs-1,Ro[Aa]=zs-1)}else Cs(Wo)}return No.filter(function(uo){return uo.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Jo,Ho){return Jo.sortKey-Ho.sortKey})}},ot.prototype.update=function(e,t,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r))},ot.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},ot.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},ot.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},ot.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},ot.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},ot.prototype.addToLineVertexArray=function(e,t){var r=this.lineVertexArray.length;if(e.segment!==void 0){for(var f=e.dist(t[e.segment+1]),v=e.dist(t[e.segment]),g={},x=e.segment+1;x<t.length;x++)g[x]={x:t[x].x,y:t[x].y,tileUnitDistanceFromAnchor:f},x<t.length-1&&(f+=t[x+1].dist(t[x]));for(var P=e.segment||0;P>=0;P--)g[P]={x:t[P].x,y:t[P].y,tileUnitDistanceFromAnchor:v},P>0&&(v+=t[P-1].dist(t[P]));for(var k=0;k<t.length;k++){var Z=g[k];this.lineVertexArray.emplaceBack(Z.x,Z.y,Z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},ot.prototype.addSymbols=function(e,t,r,f,v,g,x,P,k,Z,X,re){for(var he=e.indexArray,be=e.layoutVertexArray,Ve=e.segments.prepareSegment(4*t.length,be,he,this.canOverlap?g.sortKey:void 0),We=this.glyphOffsetArray.length,vt=Ve.vertexLength,tt=this.allowVerticalPlacement&&x===Lr.vertical?Math.PI/2:0,It=g.text&&g.text.sections,Wt=0;Wt<t.length;Wt++){var pr=t[Wt],mr=pr.tl,Br=pr.tr,sn=pr.bl,Cn=pr.br,fi=pr.tex,Vn=pr.pixelOffsetTL,di=pr.pixelOffsetBR,Kn=pr.minFontScaleX,oa=pr.minFontScaleY,Ii=pr.glyphOffset,oi=pr.isSDF,fa=pr.sectionIndex,Qi=Ve.vertexLength,Sa=Ii[1];at(be,P.x,P.y,mr.x,Sa+mr.y,fi.x,fi.y,r,oi,Vn.x,Vn.y,Kn,oa),at(be,P.x,P.y,Br.x,Sa+Br.y,fi.x+fi.w,fi.y,r,oi,di.x,Vn.y,Kn,oa),at(be,P.x,P.y,sn.x,Sa+sn.y,fi.x,fi.y+fi.h,r,oi,Vn.x,di.y,Kn,oa),at(be,P.x,P.y,Cn.x,Sa+Cn.y,fi.x+fi.w,fi.y+fi.h,r,oi,di.x,di.y,Kn,oa),Mt(e.dynamicLayoutVertexArray,P,tt),he.emplaceBack(Qi,Qi+1,Qi+2),he.emplaceBack(Qi+1,Qi+2,Qi+3),Ve.vertexLength+=4,Ve.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ii[0]),Wt!==t.length-1&&fa===t[Wt+1].sectionIndex||e.programConfigurations.populatePaintArrays(be.length,g,g.index,{},re,It&&It[fa])}e.placedSymbolArray.emplaceBack(P.x,P.y,We,this.glyphOffsetArray.length-We,vt,k,Z,P.segment,r?r[0]:0,r?r[1]:0,f[0],f[1],x,0,!1,0,X)},ot.prototype._addCollisionDebugVertex=function(e,t,r,f,v,g){return t.emplaceBack(0,0),e.emplaceBack(r.x,r.y,f,v,Math.round(g.x),Math.round(g.y))},ot.prototype.addCollisionDebugVertices=function(e,t,r,f,v,g,x){var P=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),k=P.vertexLength,Z=v.layoutVertexArray,X=v.collisionVertexArray,re=x.anchorX,he=x.anchorY;this._addCollisionDebugVertex(Z,X,g,re,he,new oe(e,t)),this._addCollisionDebugVertex(Z,X,g,re,he,new oe(r,t)),this._addCollisionDebugVertex(Z,X,g,re,he,new oe(r,f)),this._addCollisionDebugVertex(Z,X,g,re,he,new oe(e,f)),P.vertexLength+=4;var be=v.indexArray;be.emplaceBack(k,k+1),be.emplaceBack(k+1,k+2),be.emplaceBack(k+2,k+3),be.emplaceBack(k+3,k),P.primitiveLength+=4},ot.prototype.addDebugCollisionBoxes=function(e,t,r,f){for(var v=e;v<t;v++){var g=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,f?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,r)}},ot.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ht(al,Vh.members,nc),this.iconCollisionBox=new ht(al,Vh.members,nc);for(var e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}},ot.prototype._deserializeCollisionBoxesForSymbol=function(e,t,r,f,v,g,x,P,k){for(var Z={},X=t;X<r;X++){var re=e.get(X);Z.textBox={x1:re.x1,y1:re.y1,x2:re.x2,y2:re.y2,anchorPointX:re.anchorPointX,anchorPointY:re.anchorPointY},Z.textFeatureIndex=re.featureIndex;break}for(var he=f;he<v;he++){var be=e.get(he);Z.verticalTextBox={x1:be.x1,y1:be.y1,x2:be.x2,y2:be.y2,anchorPointX:be.anchorPointX,anchorPointY:be.anchorPointY},Z.verticalTextFeatureIndex=be.featureIndex;break}for(var Ve=g;Ve<x;Ve++){var We=e.get(Ve);Z.iconBox={x1:We.x1,y1:We.y1,x2:We.x2,y2:We.y2,anchorPointX:We.anchorPointX,anchorPointY:We.anchorPointY},Z.iconFeatureIndex=We.featureIndex;break}for(var vt=P;vt<k;vt++){var tt=e.get(vt);Z.verticalIconBox={x1:tt.x1,y1:tt.y1,x2:tt.x2,y2:tt.y2,anchorPointX:tt.anchorPointX,anchorPointY:tt.anchorPointY},Z.verticalIconFeatureIndex=tt.featureIndex;break}return Z},ot.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},ot.prototype.hasTextData=function(){return this.text.segments.get().length>0},ot.prototype.hasIconData=function(){return this.icon.segments.get().length>0},ot.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},ot.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},ot.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},ot.prototype.addIndicesForPlacedSymbol=function(e,t){for(var r=e.placedSymbolArray.get(t),f=r.vertexStartIndex+4*r.numGlyphs,v=r.vertexStartIndex;v<f;v+=4)e.indexArray.emplaceBack(v,v+1,v+2),e.indexArray.emplaceBack(v+1,v+2,v+3)},ot.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var t=Math.sin(e),r=Math.cos(e),f=[],v=[],g=[],x=0;x<this.symbolInstances.length;++x){g.push(x);var P=this.symbolInstances.get(x);f.push(0|Math.round(t*P.anchorX+r*P.anchorY)),v.push(P.featureIndex)}return g.sort(function(k,Z){return f[k]-f[Z]||v[Z]-v[k]}),g},ot.prototype.addToSortKeyRanges=function(e,t){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})},ot.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,f=this.symbolInstanceIndexes;r<f.length;r+=1){var v=this.symbolInstances.get(f[r]);this.featureSortOrder.push(v.featureIndex),[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach(function(g,x,P){g>=0&&P.indexOf(g)===x&&t.addIndicesForPlacedSymbol(t.text,g)}),v.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,v.verticalPlacedTextSymbolIndex),v.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.placedIconSymbolIndex),v.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Dn("SymbolBucket",ot,{omit:["layers","collisionBoxArray","features","compareText"]}),ot.MAX_GLYPHS=65535,ot.addDynamicAttributes=Mt;var Le=new Io({"symbol-placement":new jn(ae.layout_symbol["symbol-placement"]),"symbol-spacing":new jn(ae.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new jn(ae.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Hn(ae.layout_symbol["symbol-sort-key"]),"symbol-z-order":new jn(ae.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new jn(ae.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new jn(ae.layout_symbol["icon-ignore-placement"]),"icon-optional":new jn(ae.layout_symbol["icon-optional"]),"icon-rotation-alignment":new jn(ae.layout_symbol["icon-rotation-alignment"]),"icon-size":new Hn(ae.layout_symbol["icon-size"]),"icon-text-fit":new jn(ae.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new jn(ae.layout_symbol["icon-text-fit-padding"]),"icon-image":new Hn(ae.layout_symbol["icon-image"]),"icon-rotate":new Hn(ae.layout_symbol["icon-rotate"]),"icon-padding":new jn(ae.layout_symbol["icon-padding"]),"icon-keep-upright":new jn(ae.layout_symbol["icon-keep-upright"]),"icon-offset":new Hn(ae.layout_symbol["icon-offset"]),"icon-anchor":new Hn(ae.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new jn(ae.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new jn(ae.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new jn(ae.layout_symbol["text-rotation-alignment"]),"text-field":new Hn(ae.layout_symbol["text-field"]),"text-font":new Hn(ae.layout_symbol["text-font"]),"text-size":new Hn(ae.layout_symbol["text-size"]),"text-max-width":new Hn(ae.layout_symbol["text-max-width"]),"text-line-height":new jn(ae.layout_symbol["text-line-height"]),"text-letter-spacing":new Hn(ae.layout_symbol["text-letter-spacing"]),"text-justify":new Hn(ae.layout_symbol["text-justify"]),"text-radial-offset":new Hn(ae.layout_symbol["text-radial-offset"]),"text-variable-anchor":new jn(ae.layout_symbol["text-variable-anchor"]),"text-anchor":new Hn(ae.layout_symbol["text-anchor"]),"text-max-angle":new jn(ae.layout_symbol["text-max-angle"]),"text-writing-mode":new jn(ae.layout_symbol["text-writing-mode"]),"text-rotate":new Hn(ae.layout_symbol["text-rotate"]),"text-padding":new jn(ae.layout_symbol["text-padding"]),"text-keep-upright":new jn(ae.layout_symbol["text-keep-upright"]),"text-transform":new Hn(ae.layout_symbol["text-transform"]),"text-offset":new Hn(ae.layout_symbol["text-offset"]),"text-allow-overlap":new jn(ae.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new jn(ae.layout_symbol["text-ignore-placement"]),"text-optional":new jn(ae.layout_symbol["text-optional"])}),qe={paint:new Io({"icon-opacity":new Hn(ae.paint_symbol["icon-opacity"]),"icon-color":new Hn(ae.paint_symbol["icon-color"]),"icon-halo-color":new Hn(ae.paint_symbol["icon-halo-color"]),"icon-halo-width":new Hn(ae.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Hn(ae.paint_symbol["icon-halo-blur"]),"icon-translate":new jn(ae.paint_symbol["icon-translate"]),"icon-translate-anchor":new jn(ae.paint_symbol["icon-translate-anchor"]),"text-opacity":new Hn(ae.paint_symbol["text-opacity"]),"text-color":new Hn(ae.paint_symbol["text-color"],{runtimeType:mn,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new Hn(ae.paint_symbol["text-halo-color"]),"text-halo-width":new Hn(ae.paint_symbol["text-halo-width"]),"text-halo-blur":new Hn(ae.paint_symbol["text-halo-blur"]),"text-translate":new jn(ae.paint_symbol["text-translate"]),"text-translate-anchor":new jn(ae.paint_symbol["text-translate-anchor"])}),layout:Le},Be=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Nn,this.defaultValue=e};Be.prototype.evaluate=function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},Be.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},Be.prototype.outputDefined=function(){return!1},Be.prototype.serialize=function(){return null},Dn("FormatSectionOverride",Be,{omit:["defaultValue"]});var kt=function(e){function t(r){e.call(this,r,qe)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){if(e.prototype.recalculate.call(this,r,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var v=this.layout.get("text-writing-mode");if(v){for(var g=[],x=0,P=v;x<P.length;x+=1){var k=P[x];g.indexOf(k)<0&&g.push(k)}this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},t.prototype.getValueAndResolveTokens=function(r,f,v,g){var x=this.layout.get(r).evaluate(f,{},v,g),P=this._unevaluatedLayout._values[r];return P.isDataDriven()||Ju(P.value)||!x?x:function(k,Z){return Z.replace(/{([^{}]+)}/g,function(X,re){return re in k?String(k[re]):""})}(f.properties,x)},t.prototype.createBucket=function(r){return new ot(r)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype._setPaintOverrides=function(){for(var r=0,f=qe.paint.overridableProperties;r<f.length;r+=1){var v=f[r];if(t.hasPaintOverride(this.layout,v)){var g,x=this.paint.get(v),P=new Be(x),k=new Iu(P,x.property.specification);g=x.value.kind==="constant"||x.value.kind==="source"?new Sl("source",k):new Qu("composite",k,x.value.zoomStops,x.value._interpolationType),this.paint._values[v]=new po(x.property,g,x.parameters)}}},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!(!this.layout||f.isDataDriven()||v.isDataDriven())&&t.hasPaintOverride(this.layout,r)},t.hasPaintOverride=function(r,f){var v=r.get("text-field"),g=qe.paint.properties[f],x=!1,P=function(X){for(var re=0,he=X;re<he.length;re+=1)if(g.overrides&&g.overrides.hasOverride(he[re]))return void(x=!0)};if(v.value.kind==="constant"&&v.value.value instanceof za)P(v.value.value.sections);else if(v.value.kind==="source"){var k=function(X){x||(X instanceof Ki&&Yi(X.value)===ra?P(X.value.sections):X instanceof Do?P(X.sections):X.eachChild(k))},Z=v.value;Z._styleExpression&&k(Z._styleExpression.expression)}return x},t}(au),Yt={paint:new Io({"background-color":new jn(ae.paint_background["background-color"]),"background-pattern":new ns(ae.paint_background["background-pattern"]),"background-opacity":new jn(ae.paint_background["background-opacity"])})},Gr=function(e){function t(r){e.call(this,r,Yt)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(au),gn={paint:new Io({"raster-opacity":new jn(ae.paint_raster["raster-opacity"]),"raster-hue-rotate":new jn(ae.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new jn(ae.paint_raster["raster-brightness-min"]),"raster-brightness-max":new jn(ae.paint_raster["raster-brightness-max"]),"raster-saturation":new jn(ae.paint_raster["raster-saturation"]),"raster-contrast":new jn(ae.paint_raster["raster-contrast"]),"raster-resampling":new jn(ae.paint_raster["raster-resampling"]),"raster-fade-duration":new jn(ae.paint_raster["raster-fade-duration"])})},yn=function(e){function t(r){e.call(this,r,gn)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(au),Bn=function(e){function t(r){e.call(this,r,{}),this.implementation=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},t.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},t.prototype.recalculate=function(){},t.prototype.updateTransitions=function(){},t.prototype.hasTransition=function(){},t.prototype.serialize=function(){},t.prototype.onAdd=function(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},t.prototype.onRemove=function(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},t}(au),pn={circle:Lu,heatmap:_f,hillshade:ah,fill:Cf,"fill-extrusion":Nh,line:xp,symbol:kt,background:Gr,raster:yn},qn=K.HTMLImageElement,Rn=K.HTMLCanvasElement,ri=K.HTMLVideoElement,ii=K.ImageData,ei=K.ImageBitmap,pi=function(e,t,r,f){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,f)};pi.prototype.update=function(e,t,r){var f=e.width,v=e.height,g=!(this.size&&this.size[0]===f&&this.size[1]===v||r),x=this.context,P=x.gl;if(this.useMipmap=Boolean(t&&t.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!t||t.premultiply!==!1)),g)this.size=[f,v],e instanceof qn||e instanceof Rn||e instanceof ri||e instanceof ii||ei&&e instanceof ei?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,e):P.texImage2D(P.TEXTURE_2D,0,this.format,f,v,0,this.format,P.UNSIGNED_BYTE,e.data);else{var k=r||{x:0,y:0},Z=k.x,X=k.y;e instanceof qn||e instanceof Rn||e instanceof ri||e instanceof ii||ei&&e instanceof ei?P.texSubImage2D(P.TEXTURE_2D,0,Z,X,P.RGBA,P.UNSIGNED_BYTE,e):P.texSubImage2D(P.TEXTURE_2D,0,Z,X,f,v,P.RGBA,P.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)},pi.prototype.bind=function(e,t,r){var f=this.context.gl;f.bindTexture(f.TEXTURE_2D,this.texture),r!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,r||e),this.filter=e),t!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,t),this.wrap=t)},pi.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},pi.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Oa=function(e){var t=this;this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){t._triggered=!1,t._callback()})};Oa.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){e._triggered=!1,e._callback()},0))},Oa.prototype.remove=function(){delete this._channel,this._callback=function(){}};var so=function(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},yr(["receive","process"],this),this.invoker=new Oa(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=sr()?e:K};function uc(e,t,r){var f=2*Math.PI*6378137/256/Math.pow(2,r);return[e*f-2*Math.PI*6378137/2,t*f-2*Math.PI*6378137/2]}so.prototype.send=function(e,t,r,f,v){var g=this;v===void 0&&(v=!1);var x=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[x]=r);var P=Re(this.globalScope)?void 0:[];return this.target.postMessage({id:x,type:e,hasCallback:!!r,targetMapId:f,mustQueue:v,sourceMapId:this.mapId,data:Ka(t,P)},P),{cancel:function(){r&&delete g.callbacks[x],g.target.postMessage({id:x,type:"<cancel>",targetMapId:f,sourceMapId:g.mapId})}}},so.prototype.receive=function(e){var t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[r];var f=this.cancelCallbacks[r];delete this.cancelCallbacks[r],f&&f()}else sr()||t.mustQueue?(this.tasks[r]=t,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,t)},so.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)}},so.prototype.processTask=function(e,t){var r=this;if(t.type==="<response>"){var f=this.callbacks[e];delete this.callbacks[e],f&&(t.error?f(ks(t.error)):f(null,ks(t.data)))}else{var v=!1,g=Re(this.globalScope)?void 0:[],x=t.hasCallback?function(X,re){v=!0,delete r.cancelCallbacks[e],r.target.postMessage({id:e,type:"<response>",sourceMapId:r.mapId,error:X?Ka(X):null,data:Ka(re,g)},g)}:function(X){v=!0},P=null,k=ks(t.data);if(this.parent[t.type])P=this.parent[t.type](t.sourceMapId,k,x);else if(this.parent.getWorkerSource){var Z=t.type.split(".");P=this.parent.getWorkerSource(t.sourceMapId,Z[0],k.source)[Z[1]](k,x)}else x(new Error("Could not find function "+t.type));!v&&P&&P.cancel&&(this.cancelCallbacks[e]=P.cancel)}},so.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Qa=function(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};Qa.prototype.setNorthEast=function(e){return this._ne=e instanceof wa?new wa(e.lng,e.lat):wa.convert(e),this},Qa.prototype.setSouthWest=function(e){return this._sw=e instanceof wa?new wa(e.lng,e.lat):wa.convert(e),this},Qa.prototype.extend=function(e){var t,r,f=this._sw,v=this._ne;if(e instanceof wa)t=e,r=e;else{if(!(e instanceof Qa))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Qa.convert(e)):this.extend(wa.convert(e)):this;if(r=e._ne,!(t=e._sw)||!r)return this}return f||v?(f.lng=Math.min(t.lng,f.lng),f.lat=Math.min(t.lat,f.lat),v.lng=Math.max(r.lng,v.lng),v.lat=Math.max(r.lat,v.lat)):(this._sw=new wa(t.lng,t.lat),this._ne=new wa(r.lng,r.lat)),this},Qa.prototype.getCenter=function(){return new wa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Qa.prototype.getSouthWest=function(){return this._sw},Qa.prototype.getNorthEast=function(){return this._ne},Qa.prototype.getNorthWest=function(){return new wa(this.getWest(),this.getNorth())},Qa.prototype.getSouthEast=function(){return new wa(this.getEast(),this.getSouth())},Qa.prototype.getWest=function(){return this._sw.lng},Qa.prototype.getSouth=function(){return this._sw.lat},Qa.prototype.getEast=function(){return this._ne.lng},Qa.prototype.getNorth=function(){return this._ne.lat},Qa.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Qa.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Qa.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Qa.prototype.contains=function(e){var t=wa.convert(e),r=t.lng,f=t.lat,v=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&v},Qa.convert=function(e){return!e||e instanceof Qa?e:new Qa(e)};var wa=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: ("+e+", "+t+")");if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};wa.prototype.wrap=function(){return new wa(Qt(this.lng,-180,180),this.lat)},wa.prototype.toArray=function(){return[this.lng,this.lat]},wa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},wa.prototype.distanceTo=function(e){var t=Math.PI/180,r=this.lat*t,f=e.lat*t,v=Math.sin(r)*Math.sin(f)+Math.cos(r)*Math.cos(f)*Math.cos((e.lng-this.lng)*t);return 63710088e-1*Math.acos(Math.min(v,1))},wa.prototype.toBounds=function(e){e===void 0&&(e=0);var t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new Qa(new wa(this.lng-r,this.lat-t),new wa(this.lng+r,this.lat+t))},wa.convert=function(e){if(e instanceof wa)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new wa(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new wa(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Ws=2*Math.PI*63710088e-1;function cl(e){return Ws*Math.cos(e*Math.PI/180)}function fl(e){return(180+e)/360}function mh(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function hl(e,t){return e/cl(t)}function Yf(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var Mf=function(e,t,r){r===void 0&&(r=0),this.x=+e,this.y=+t,this.z=+r};Mf.fromLngLat=function(e,t){t===void 0&&(t=0);var r=wa.convert(e);return new Mf(fl(r.lng),mh(r.lat),hl(t,r.lat))},Mf.prototype.toLngLat=function(){return new wa(360*this.x-180,Yf(this.y))},Mf.prototype.toAltitude=function(){return this.z*cl(Yf(this.y))},Mf.prototype.meterInMercatorCoordinateUnits=function(){return 1/Ws*(e=Yf(this.y),1/Math.cos(e*Math.PI/180));var e};var jc=function(e,t,r){this.z=e,this.x=t,this.y=r,this.key=If(0,e,e,t,r)};jc.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},jc.prototype.url=function(e,t){var r,f,v,g,x,P=(f=this.y,v=this.z,g=uc(256*(r=this.x),256*(f=Math.pow(2,v)-f-1),v),x=uc(256*(r+1),256*(f+1),v),g[0]+","+g[1]+","+x[0]+","+x[1]),k=function(Z,X,re){for(var he,be="",Ve=Z;Ve>0;Ve--)be+=(X&(he=1<<Ve-1)?1:0)+(re&he?2:0);return be}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",k).replace("{bbox-epsg-3857}",P)},jc.prototype.getTilePoint=function(e){var t=Math.pow(2,this.z);return new oe(8192*(e.x*t-this.x),8192*(e.y*t-this.y))},jc.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var wp=function(e,t){this.wrap=e,this.canonical=t,this.key=If(e,t.z,t.z,t.x,t.y)},qa=function(e,t,r,f,v){this.overscaledZ=e,this.wrap=t,this.canonical=new jc(r,+f,+v),this.key=If(t,e,r,f,v)};function If(e,t,r,f,v){(e*=2)<0&&(e=-1*e-1);var g=1<<r;return(g*g*e+g*v+f).toString(36)+r.toString(36)+t.toString(36)}qa.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},qa.prototype.scaledTo=function(e){var t=this.canonical.z-e;return e>this.canonical.z?new qa(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new qa(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)},qa.prototype.calculateScaledKey=function(e,t){var r=this.canonical.z-e;return e>this.canonical.z?If(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):If(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)},qa.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t},qa.prototype.children=function(e){if(this.overscaledZ>=e)return[new qa(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var t=this.canonical.z+1,r=2*this.canonical.x,f=2*this.canonical.y;return[new qa(t,this.wrap,t,r,f),new qa(t,this.wrap,t,r+1,f),new qa(t,this.wrap,t,r,f+1),new qa(t,this.wrap,t,r+1,f+1)]},qa.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},qa.prototype.wrapped=function(){return new qa(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},qa.prototype.unwrapTo=function(e){return new qa(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},qa.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},qa.prototype.toUnwrapped=function(){return new wp(this.wrap,this.canonical)},qa.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},qa.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new Mf(e.x-this.wrap,e.y))},Dn("CanonicalTileID",jc),Dn("OverscaledTileID",qa,{omit:["posMatrix"]});var Tc=function(e,t,r){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return Xe('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=t.height;var f=this.dim=t.height-2;this.data=new Uint32Array(t.data.buffer),this.encoding=r||"mapbox";for(var v=0;v<f;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(f,v)]=this.data[this._idx(f-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,f)]=this.data[this._idx(v,f-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(f,-1)]=this.data[this._idx(f-1,0)],this.data[this._idx(-1,f)]=this.data[this._idx(0,f-1)],this.data[this._idx(f,f)]=this.data[this._idx(f-1,f-1)]};Tc.prototype.get=function(e,t){var r=new Uint8Array(this.data.buffer),f=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(r[f],r[f+1],r[f+2])},Tc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Tc.prototype._idx=function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)},Tc.prototype._unpackMapbox=function(e,t,r){return(256*e*256+256*t+r)/10-1e4},Tc.prototype._unpackTerrarium=function(e,t,r){return 256*e+t+r/256-32768},Tc.prototype.getPixels=function(){return new hs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Tc.prototype.backfillBorder=function(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var f=t*this.dim,v=t*this.dim+this.dim,g=r*this.dim,x=r*this.dim+this.dim;switch(t){case-1:f=v-1;break;case 1:v=f+1}switch(r){case-1:g=x-1;break;case 1:x=g+1}for(var P=-t*this.dim,k=-r*this.dim,Z=g;Z<x;Z++)for(var X=f;X<v;X++)this.data[this._idx(X,Z)]=e.data[this._idx(X+P,Z+k)]},Dn("DEMData",Tc);var Xh=function(e){this._stringToNumber={},this._numberToString=[];for(var t=0;t<e.length;t++){var r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}};Xh.prototype.encode=function(e){return this._stringToNumber[e]},Xh.prototype.decode=function(e){return this._numberToString[e]};var Yh=function(e,t,r,f,v){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=r,e._y=f,this.properties=e.properties,this.id=v},Kf={geometry:{configurable:!0}};Kf.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Kf.geometry.set=function(e){this._geometry=e},Yh.prototype.toJSON=function(){var e={geometry:this.geometry};for(var t in this)t!=="_geometry"&&t!=="_vectorTileFeature"&&(e[t]=this[t]);return e},Object.defineProperties(Yh.prototype,Kf);var ff=function(){this.state={},this.stateChanges={},this.deletedStates={}};ff.prototype.updateState=function(e,t,r){var f=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},Xt(this.stateChanges[e][f],r),this.deletedStates[e]===null)for(var v in this.deletedStates[e]={},this.state[e])v!==f&&(this.deletedStates[e][v]=null);else if(this.deletedStates[e]&&this.deletedStates[e][f]===null)for(var g in this.deletedStates[e][f]={},this.state[e][f])r[g]||(this.deletedStates[e][f][g]=null);else for(var x in r)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][x]===null&&delete this.deletedStates[e][f][x]},ff.prototype.removeFeatureState=function(e,t,r){if(this.deletedStates[e]!==null){var f=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&t!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][r]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(r in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][r]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}},ff.prototype.getState=function(e,t){var r=String(t),f=Xt({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){var v=this.deletedStates[e][t];if(v===null)return{};for(var g in v)delete f[g]}return f},ff.prototype.initializeTileState=function(e,t){e.setFeatureState(this.state,t)},ff.prototype.coalesceChanges=function(e,t){var r={};for(var f in this.stateChanges){this.state[f]=this.state[f]||{};var v={};for(var g in this.stateChanges[f])this.state[f][g]||(this.state[f][g]={}),Xt(this.state[f][g],this.stateChanges[f][g]),v[g]=this.state[f][g];r[f]=v}for(var x in this.deletedStates){this.state[x]=this.state[x]||{};var P={};if(this.deletedStates[x]===null)for(var k in this.state[x])P[k]={},this.state[x][k]={};else for(var Z in this.deletedStates[x]){if(this.deletedStates[x][Z]===null)this.state[x][Z]={};else for(var X=0,re=Object.keys(this.deletedStates[x][Z]);X<re.length;X+=1)delete this.state[x][Z][re[X]];P[Z]=this.state[x][Z]}r[x]=r[x]||{},Xt(r[x],P)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(var he in e)e[he].setFeatureState(r,t)};var Pc=function(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new xu(8192,16,0),this.grid3D=new xu(8192,16,0),this.featureIndexArray=new se,this.promoteId=t};function Kp(e,t,r,f,v){return hr(e,function(g,x){var P=t instanceof Pl?t.get(x):null;return P&&P.evaluate?P.evaluate(r,f,v):P})}function gh(e){for(var t=1/0,r=1/0,f=-1/0,v=-1/0,g=0,x=e;g<x.length;g+=1){var P=x[g];t=Math.min(t,P.x),r=Math.min(r,P.y),f=Math.max(f,P.x),v=Math.max(v,P.y)}return{minX:t,minY:r,maxX:f,maxY:v}}function Ap(e,t){return t-e}Pc.prototype.insert=function(e,t,r,f,v,g){var x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,f,v);for(var P=g?this.grid3D:this.grid,k=0;k<t.length;k++){for(var Z=t[k],X=[1/0,1/0,-1/0,-1/0],re=0;re<Z.length;re++){var he=Z[re];X[0]=Math.min(X[0],he.x),X[1]=Math.min(X[1],he.y),X[2]=Math.max(X[2],he.x),X[3]=Math.max(X[3],he.y)}X[0]<8192&&X[1]<8192&&X[2]>=0&&X[3]>=0&&P.insert(x,X[0],X[1],X[2],X[3])}},Pc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Ac.VectorTile(new Pf(this.rawTileData)).layers,this.sourceLayerCoder=new Xh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Pc.prototype.query=function(e,t,r,f){var v=this;this.loadVTLayers();for(var g=e.params||{},x=8192/e.tileSize/e.scale,P=Rl(g.filter),k=e.queryGeometry,Z=e.queryPadding*x,X=gh(k),re=this.grid.query(X.minX-Z,X.minY-Z,X.maxX+Z,X.maxY+Z),he=gh(e.cameraQueryGeometry),be=this.grid3D.query(he.minX-Z,he.minY-Z,he.maxX+Z,he.maxY+Z,function(pr,mr,Br,sn){return function(Cn,fi,Vn,di,Kn){for(var oa=0,Ii=Cn;oa<Ii.length;oa+=1){var oi=Ii[oa];if(fi<=oi.x&&Vn<=oi.y&&di>=oi.x&&Kn>=oi.y)return!0}var fa=[new oe(fi,Vn),new oe(fi,Kn),new oe(di,Kn),new oe(di,Vn)];if(Cn.length>2){for(var Qi=0,Sa=fa;Qi<Sa.length;Qi+=1)if(Ca(Cn,Sa[Qi]))return!0}for(var gi=0;gi<Cn.length-1;gi++)if(Bo(Cn[gi],Cn[gi+1],fa))return!0;return!1}(e.cameraQueryGeometry,pr-Z,mr-Z,Br+Z,sn+Z)}),Ve=0,We=be;Ve<We.length;Ve+=1)re.push(We[Ve]);re.sort(Ap);for(var vt,tt={},It=function(pr){var mr=re[pr];if(mr!==vt){vt=mr;var Br=v.featureIndexArray.get(mr),sn=null;v.loadMatchingFeature(tt,Br.bucketIndex,Br.sourceLayerIndex,Br.featureIndex,P,g.layers,g.availableImages,t,r,f,function(Cn,fi,Vn){return sn||(sn=Pt(Cn)),fi.queryIntersectsFeature(k,Cn,Vn,sn,v.z,e.transform,x,e.pixelPosMatrix)})}},Wt=0;Wt<re.length;Wt++)It(Wt);return tt},Pc.prototype.loadMatchingFeature=function(e,t,r,f,v,g,x,P,k,Z,X){var re=this.bucketLayerIDs[t];if(!g||function(Cn,fi){for(var Vn=0;Vn<Cn.length;Vn++)if(fi.indexOf(Cn[Vn])>=0)return!0;return!1}(g,re)){var he=this.sourceLayerCoder.decode(r),be=this.vtLayers[he].feature(f);if(v.needGeometry){var Ve=xt(be,!0);if(!v.filter(new ta(this.tileID.overscaledZ),Ve,this.tileID.canonical))return}else if(!v.filter(new ta(this.tileID.overscaledZ),be))return;for(var We=this.getId(be,he),vt=0;vt<re.length;vt++){var tt=re[vt];if(!(g&&g.indexOf(tt)<0)){var It=P[tt];if(It){var Wt={};We!==void 0&&Z&&(Wt=Z.getState(It.sourceLayer||"_geojsonTileLayer",We));var pr=Xt({},k[tt]);pr.paint=Kp(pr.paint,It.paint,be,Wt,x),pr.layout=Kp(pr.layout,It.layout,be,Wt,x);var mr=!X||X(be,It,Wt);if(mr){var Br=new Yh(be,this.z,this.x,this.y,We);Br.layer=pr;var sn=e[tt];sn===void 0&&(sn=e[tt]=[]),sn.push({featureIndex:f,feature:Br,intersectionZ:mr})}}}}}},Pc.prototype.lookupSymbolFeatures=function(e,t,r,f,v,g,x,P){var k={};this.loadVTLayers();for(var Z=Rl(v),X=0,re=e;X<re.length;X+=1)this.loadMatchingFeature(k,r,f,re[X],Z,g,x,P,t);return k},Pc.prototype.hasLayer=function(e){for(var t=0,r=this.bucketLayerIDs;t<r.length;t+=1)for(var f=0,v=r[t];f<v.length;f+=1)if(e===v[f])return!0;return!1},Pc.prototype.getId=function(e,t){var r=e.id;return this.promoteId&&typeof(r=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]])=="boolean"&&(r=Number(r)),r},Dn("FeatureIndex",Pc,{omit:["rawTileData","sourceLayerCoder"]});var Ns=function(e,t){this.tileID=e,this.uid=Ut(),this.uses=0,this.tileSize=t,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Ns.prototype.registerFadeDuration=function(e){var t=e+this.timeAdded;t<ea.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)},Ns.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Ns.prototype.loadVectorData=function(e,t,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var f in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(Z,X){var re={};if(!X)return re;for(var he=function(){var We=Ve[be],vt=We.layerIds.map(function(Wt){return X.getLayer(Wt)}).filter(Boolean);if(vt.length!==0){We.layers=vt,We.stateDependentLayerIds&&(We.stateDependentLayers=We.stateDependentLayerIds.map(function(Wt){return vt.filter(function(pr){return pr.id===Wt})[0]}));for(var tt=0,It=vt;tt<It.length;tt+=1)re[It[tt].id]=We}},be=0,Ve=Z;be<Ve.length;be+=1)he();return re}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var v=this.buckets[f];if(v instanceof ot){if(this.hasSymbolBuckets=!0,!r)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var g in this.buckets){var x=this.buckets[g];if(x instanceof ot&&x.hasRTLText){this.hasRTLText=!0,Mo.isLoading()||Mo.isLoaded()||Po()!=="deferred"||Gs();break}}for(var P in this.queryPadding=0,this.buckets){var k=this.buckets[P];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(P).queryRadius(k))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new u},Ns.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Ns.prototype.getBucket=function(e){return this.buckets[e.id]},Ns.prototype.upload=function(e){for(var t in this.buckets){var r=this.buckets[t];r.uploadPending()&&r.upload(e)}var f=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new pi(e,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new pi(e,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)},Ns.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},Ns.prototype.queryRenderedFeatures=function(e,t,r,f,v,g,x,P,k,Z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:v,scale:g,tileSize:this.tileSize,pixelPosMatrix:Z,transform:P,params:x,queryPadding:this.queryPadding*k},e,t,r):{}},Ns.prototype.querySourceFeatures=function(e,t){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var f=r.loadVTLayers(),v=t?t.sourceLayer:"",g=f._geojsonTileLayer||f[v];if(g)for(var x=Rl(t&&t.filter),P=this.tileID.canonical,k=P.z,Z=P.x,X=P.y,re={z:k,x:Z,y:X},he=0;he<g.length;he++){var be=g.feature(he);if(x.needGeometry){var Ve=xt(be,!0);if(!x.filter(new ta(this.tileID.overscaledZ),Ve,this.tileID.canonical))continue}else if(!x.filter(new ta(this.tileID.overscaledZ),be))continue;var We=r.getId(be,v),vt=new Yh(be,k,Z,X,We);vt.tile=re,e.push(vt)}}},Ns.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Ns.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Ns.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var r=j(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var f=Date.now(),v=!1;if(this.expirationTime>f)v=!1;else if(t)if(this.expirationTime<t)v=!0;else{var g=this.expirationTime-t;g?this.expirationTime=f+Math.max(g,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Ns.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Ns.prototype.setFeatureState=function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0){var r=this.latestFeatureIndex.loadVTLayers();for(var f in this.buckets)if(t.style.hasLayer(f)){var v=this.buckets[f],g=v.layers[0].sourceLayer||"_geojsonTileLayer",x=r[g],P=e[g];if(x&&P&&Object.keys(P).length!==0){v.update(P,x,this.imageAtlas&&this.imageAtlas.patternPositions||{});var k=t&&t.style&&t.style.getLayer(f);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(v)))}}}},Ns.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Ns.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ea.now()},Ns.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Ns.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=ea.now()+e},Ns.prototype.setDependencies=function(e,t){for(var r={},f=0,v=t;f<v.length;f+=1)r[v[f]]=!0;this.dependencies[e]=r},Ns.prototype.hasDependency=function(e,t){for(var r=0,f=e;r<f.length;r+=1){var v=this.dependencies[f[r]];if(v){for(var g=0,x=t;g<x.length;g+=1)if(v[x[g]])return!0}}return!1};var lc=K.performance,Of=function(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},lc.mark(this._marks.start)};Of.prototype.finish=function(){lc.mark(this._marks.end);var e=lc.getEntriesByName(this._marks.measure);return e.length===0&&(lc.measure(this._marks.measure,this._marks.start,this._marks.end),e=lc.getEntriesByName(this._marks.measure),lc.clearMarks(this._marks.start),lc.clearMarks(this._marks.end),lc.clearMeasures(this._marks.measure)),e},d.Actor=so,d.AlphaImage=Wu,d.CanonicalTileID=jc,d.CollisionBoxArray=u,d.Color=Xi,d.DEMData=Tc,d.DataConstantProperty=jn,d.DictionaryCoder=Xh,d.EXTENT=8192,d.ErrorEvent=de,d.EvaluationParameters=ta,d.Event=ee,d.Evented=Ae,d.FeatureIndex=Pc,d.FillBucket=Au,d.FillExtrusionBucket=Xu,d.ImageAtlas=Tn,d.ImagePosition=vr,d.LineBucket=Zo,d.LngLat=wa,d.LngLatBounds=Qa,d.MercatorCoordinate=Mf,d.ONE_EM=24,d.OverscaledTileID=qa,d.Point=oe,d.Point$1=oe,d.Properties=Io,d.Protobuf=Pf,d.RGBAImage=hs,d.RequestManager=nr,d.RequestPerformance=Of,d.ResourceType=Yr,d.SegmentVector=we,d.SourceFeatureState=ff,d.StructArrayLayout1ui2=Bl,d.StructArrayLayout2f1f2i16=ol,d.StructArrayLayout2i4=Ps,d.StructArrayLayout3ui6=Cu,d.StructArrayLayout4i8=Ml,d.SymbolBucket=ot,d.Texture=pi,d.Tile=Ns,d.Transitionable=Ko,d.Uniform1f=fn,d.Uniform1i=jr,d.Uniform2f=tn,d.Uniform3f=Zn,d.Uniform4f=si,d.UniformColor=ui,d.UniformMatrix4f=ia,d.UnwrappedTileID=wp,d.ValidationError=_e,d.WritingMode=Lr,d.ZoomHistory=yc,d.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},d.addDynamicAttributes=Mt,d.asyncAll=function(e,t,r){if(!e.length)return r(null,[]);var f=e.length,v=new Array(e.length),g=null;e.forEach(function(x,P){t(x,function(k,Z){k&&(g=k),v[P]=Z,--f==0&&r(g,v)})})},d.bezier=mt,d.bindAll=yr,d.browser=ea,d.cacheEntryPossiblyAdded=function(e){++Ke>At&&(e.getActor().send("enforceCacheSizeLimit",ut),Ke=0)},d.clamp=Cr,d.clearTileCache=function(e){var t=K.caches.delete("mapbox-tiles");e&&t.catch(e).then(function(){return e()})},d.clipLine=os,d.clone=function(e){var t=new Pi(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},d.clone$1=$e,d.clone$2=function(e){var t=new Pi(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},d.collisionCircleLayout=Ep,d.config=ar,d.create=function(){var e=new Pi(16);return Pi!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},d.create$1=function(){var e=new Pi(9);return Pi!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},d.create$2=function(){var e=new Pi(4);return Pi!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},d.createCommonjsModule=me,d.createExpression=bl,d.createLayout=Ui,d.createStyleLayer=function(e){return e.type==="custom"?new Bn(e):new pn[e.type](e)},d.cross=function(e,t,r){var f=t[0],v=t[1],g=t[2],x=r[0],P=r[1],k=r[2];return e[0]=v*k-g*P,e[1]=g*x-f*k,e[2]=f*P-v*x,e},d.deepEqual=function e(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var f=0;f<t.length;f++)if(!e(t[f],r[f]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(var v in t)if(!e(t[v],r[v]))return!1;return!0}return t===r},d.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},d.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},d.ease=Zt,d.emitValidationErrors=Fl,d.endsWith=q,d.enforceCacheSizeLimit=function(e){Rt(),st&&st.then(function(t){t.keys().then(function(r){for(var f=0;f<r.length-e;f++)t.delete(r[f])})})},d.evaluateSizeForFeature=zi,d.evaluateSizeForZoom=va,d.evaluateVariableOffset=je,d.evented=ec,d.extend=Xt,d.featureFilter=Rl,d.filterObject=wt,d.fromRotation=function(e,t){var r=Math.sin(t),f=Math.cos(t);return e[0]=f,e[1]=r,e[2]=0,e[3]=-r,e[4]=f,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},d.getAnchorAlignment=Vi,d.getAnchorJustification=or,d.getArrayBuffer=Mn,d.getImage=le,d.getJSON=function(e,t){return Gn(Xt(e,{type:"json"}),t)},d.getRTLTextPluginStatus=Po,d.getReferrer=cr,d.getVideo=function(e,t){var r,f,v=K.document.createElement("video");v.muted=!0,v.onloadstart=function(){t(null,v)};for(var g=0;g<e.length;g++){var x=K.document.createElement("source");r=e[g],f=void 0,(f=K.document.createElement("a")).href=r,(f.protocol!==K.document.location.protocol||f.host!==K.document.location.host)&&(v.crossOrigin="Anonymous"),x.src=e[g],v.appendChild(x)}return{cancel:function(){}}},d.identity=oo,d.invert=function(e,t){var r=t[0],f=t[1],v=t[2],g=t[3],x=t[4],P=t[5],k=t[6],Z=t[7],X=t[8],re=t[9],he=t[10],be=t[11],Ve=t[12],We=t[13],vt=t[14],tt=t[15],It=r*P-f*x,Wt=r*k-v*x,pr=r*Z-g*x,mr=f*k-v*P,Br=f*Z-g*P,sn=v*Z-g*k,Cn=X*We-re*Ve,fi=X*vt-he*Ve,Vn=X*tt-be*Ve,di=re*vt-he*We,Kn=re*tt-be*We,oa=he*tt-be*vt,Ii=It*oa-Wt*Kn+pr*di+mr*Vn-Br*fi+sn*Cn;return Ii?(e[0]=(P*oa-k*Kn+Z*di)*(Ii=1/Ii),e[1]=(v*Kn-f*oa-g*di)*Ii,e[2]=(We*sn-vt*Br+tt*mr)*Ii,e[3]=(he*Br-re*sn-be*mr)*Ii,e[4]=(k*Vn-x*oa-Z*fi)*Ii,e[5]=(r*oa-v*Vn+g*fi)*Ii,e[6]=(vt*pr-Ve*sn-tt*Wt)*Ii,e[7]=(X*sn-he*pr+be*Wt)*Ii,e[8]=(x*Kn-P*Vn+Z*Cn)*Ii,e[9]=(f*Vn-r*Kn-g*Cn)*Ii,e[10]=(Ve*Br-We*pr+tt*It)*Ii,e[11]=(re*pr-X*Br-be*It)*Ii,e[12]=(P*fi-x*di-k*Cn)*Ii,e[13]=(r*di-f*fi+v*Cn)*Ii,e[14]=(We*Wt-Ve*mr-vt*It)*Ii,e[15]=(X*mr-re*Wt+he*It)*Ii,e):null},d.isChar=xn,d.isMapboxURL=dr,d.keysDifference=function(e,t){var r=[];for(var f in e)f in t||r.push(f);return r},d.makeRequest=Gn,d.mapObject=hr,d.mercatorXfromLng=fl,d.mercatorYfromLat=mh,d.mercatorZfromAltitude=hl,d.mul=Nl,d.multiply=Ga,d.mvt=Ac,d.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},d.normalize=function(e,t){var r=t[0],f=t[1],v=t[2],g=r*r+f*f+v*v;return g>0&&(g=1/Math.sqrt(g)),e[0]=t[0]*g,e[1]=t[1]*g,e[2]=t[2]*g,e},d.number=Ea,d.offscreenCanvasSupported=Xr,d.ortho=function(e,t,r,f,v,g,x){var P=1/(t-r),k=1/(f-v),Z=1/(g-x);return e[0]=-2*P,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*k,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*Z,e[11]=0,e[12]=(t+r)*P,e[13]=(v+f)*k,e[14]=(x+g)*Z,e[15]=1,e},d.parseGlyphPBF=function(e){return new Pf(e).readFields(bn,[])},d.pbf=Pf,d.performSymbolLayout=function(e,t,r,f,v,g,x){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var P=e.layers[0].layout,k=e.layers[0]._unevaluatedLayout._values,Z={};if(e.textSizeData.kind==="composite"){var X=e.textSizeData,re=X.maxZoom;Z.compositeTextSizes=[k["text-size"].possiblyEvaluate(new ta(X.minZoom),x),k["text-size"].possiblyEvaluate(new ta(re),x)]}if(e.iconSizeData.kind==="composite"){var he=e.iconSizeData,be=he.maxZoom;Z.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new ta(he.minZoom),x),k["icon-size"].possiblyEvaluate(new ta(be),x)]}Z.layoutTextSize=k["text-size"].possiblyEvaluate(new ta(e.zoom+1),x),Z.layoutIconSize=k["icon-size"].possiblyEvaluate(new ta(e.zoom+1),x),Z.textMaxSize=k["text-size"].possiblyEvaluate(new ta(18));for(var Ve=24*P.get("text-line-height"),We=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",vt=P.get("text-keep-upright"),tt=P.get("text-size"),It=function(){var mr=pr[Wt],Br=P.get("text-font").evaluate(mr,{},x).join(","),sn=tt.evaluate(mr,{},x),Cn=Z.layoutTextSize.evaluate(mr,{},x),fi=Z.layoutIconSize.evaluate(mr,{},x),Vn={horizontal:{},vertical:void 0},di=mr.text,Kn=[0,0];if(di){var oa=di.toString(),Ii=24*P.get("text-letter-spacing").evaluate(mr,{},x),oi=function(ma){for(var Na=0,eo=ma;Na<eo.length;Na+=1)if(Aa=eo[Na].charCodeAt(0),xn.Arabic(Aa)||xn["Arabic Supplement"](Aa)||xn["Arabic Extended-A"](Aa)||xn["Arabic Presentation Forms-A"](Aa)||xn["Arabic Presentation Forms-B"](Aa))return!1;var Aa;return!0}(oa)?Ii:0,fa=P.get("text-anchor").evaluate(mr,{},x),Qi=P.get("text-variable-anchor");if(!Qi){var Sa=P.get("text-radial-offset").evaluate(mr,{},x);Kn=Sa?je(fa,[24*Sa,Vl]):P.get("text-offset").evaluate(mr,{},x).map(function(ma){return 24*ma})}var gi=We?"center":P.get("text-justify").evaluate(mr,{},x),Ba=P.get("symbol-placement"),So=Ba==="point"?24*P.get("text-max-width").evaluate(mr,{},x):0,Jo=function(){e.allowVerticalPlacement&&Ou(oa)&&(Vn.vertical=ci(di,t,r,v,Br,So,Ve,fa,"left",oi,Kn,Lr.vertical,!0,Ba,Cn,sn))};if(!We&&Qi){for(var Ho=gi==="auto"?Qi.map(function(ma){return or(ma)}):[gi],Ro=!1,No=0;No<Ho.length;No++){var zs=Ho[No];if(!Vn.horizontal[zs])if(Ro)Vn.horizontal[zs]=Vn.horizontal[0];else{var Cs=ci(di,t,r,v,Br,So,Ve,"center",zs,oi,Kn,Lr.horizontal,!1,Ba,Cn,sn);Cs&&(Vn.horizontal[zs]=Cs,Ro=Cs.positionedLines.length===1)}}Jo()}else{gi==="auto"&&(gi=or(fa));var su=ci(di,t,r,v,Br,So,Ve,fa,gi,oi,Kn,Lr.horizontal,!1,Ba,Cn,sn);su&&(Vn.horizontal[gi]=su),Jo(),Ou(oa)&&We&&vt&&(Vn.vertical=ci(di,t,r,v,Br,So,Ve,fa,gi,oi,Kn,Lr.vertical,!1,Ba,Cn,sn))}}var Ls=void 0,Xs=!1;if(mr.icon&&mr.icon.name){var Wo=f[mr.icon.name];Wo&&(Ls=function(ma,Na,eo){var Aa=Vi(eo),Tu=Na[0]-ma.displaySize[0]*Aa.horizontalAlign,yu=Na[1]-ma.displaySize[1]*Aa.verticalAlign;return{image:ma,top:yu,bottom:yu+ma.displaySize[1],left:Tu,right:Tu+ma.displaySize[0]}}(v[mr.icon.name],P.get("icon-offset").evaluate(mr,{},x),P.get("icon-anchor").evaluate(mr,{},x)),Xs=Wo.sdf,e.sdfIcons===void 0?e.sdfIcons=Wo.sdf:e.sdfIcons!==Wo.sdf&&Xe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Wo.pixelRatio!==e.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}var Wa=Yn(Vn.horizontal)||Vn.vertical;e.iconsInText=!!Wa&&Wa.iconsInText,(Wa||Ls)&&function(ma,Na,eo,Aa,Tu,yu,uo,zo,Ys,La,cc){var Ks=yu.textMaxSize.evaluate(Na,{});Ks===void 0&&(Ks=uo);var Gl,Uo=ma.layers[0].layout,Mc=Uo.get("icon-offset").evaluate(Na,{},cc),Hl=Yn(eo.horizontal),fc=uo/24,Lf=ma.tilePixelRatio*fc,$f=ma.tilePixelRatio*Ks/24,hf=ma.tilePixelRatio*zo,yh=ma.tilePixelRatio*Uo.get("symbol-spacing"),Tp=Uo.get("text-padding")*ma.tilePixelRatio,_h=Uo.get("icon-padding")*ma.tilePixelRatio,Kh=Uo.get("text-max-angle")/180*Math.PI,Pp=Uo.get("text-rotation-alignment")==="map"&&Uo.get("symbol-placement")!=="point",Mp=Uo.get("icon-rotation-alignment")==="map"&&Uo.get("symbol-placement")!=="point",Ic=Uo.get("symbol-placement"),Rf=yh/2,xh=Uo.get("icon-text-fit");Aa&&xh!=="none"&&(ma.allowVerticalPlacement&&eo.vertical&&(Gl=kn(Aa,eo.vertical,xh,Uo.get("icon-text-fit-padding"),Mc,fc)),Hl&&(Aa=kn(Aa,Hl,xh,Uo.get("icon-text-fit-padding"),Mc,fc)));var Vc=function(Hd,qh){qh.x<0||qh.x>=8192||qh.y<0||qh.y>=8192||function(ds,Lc,qp,Gc,ed,ep,vf,Hc,Qf,Ff,mf,tp,rp,uu,Th,td,lo,rd,qf,eh,pl,np,nd,Rc,Ad){var Lp,gf,th,rh,nh,Bf=ds.addToLineVertexArray(Lc,qp),id=0,Rp=0,ad=0,od=0,Dp=-1,kp=-1,Wc={},sd=ze(""),Fp=0,ip=0;if(Hc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Fp=(Lp=Hc.layout.get("text-offset").evaluate(pl,{},Rc).map(function(Mh){return 24*Mh}))[0],ip=Lp[1]):(Fp=24*Hc.layout.get("text-radial-offset").evaluate(pl,{},Rc),ip=Vl),ds.allowVerticalPlacement&&Gc.vertical){var ud=Hc.layout.get("text-rotate").evaluate(pl,{},Rc)+90;rh=new Fa(Qf,Lc,Ff,mf,tp,Gc.vertical,rp,uu,Th,ud),vf&&(nh=new Fa(Qf,Lc,Ff,mf,tp,vf,lo,rd,Th,ud))}if(ed){var Bp=Hc.layout.get("icon-rotate").evaluate(pl,{}),ld=Hc.layout.get("icon-text-fit")!=="none",Np=ps(ed,Bp,nd,ld),zp=vf?ps(vf,Bp,nd,ld):void 0;th=new Fa(Qf,Lc,Ff,mf,tp,ed,lo,rd,!1,Bp),id=4*Np.length;var cd=ds.iconSizeData,Ph=null;cd.kind==="source"?(Ph=[128*Hc.layout.get("icon-size").evaluate(pl,{})])[0]>32640&&Xe(ds.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):cd.kind==="composite"&&((Ph=[128*np.compositeIconSizes[0].evaluate(pl,{},Rc),128*np.compositeIconSizes[1].evaluate(pl,{},Rc)])[0]>32640||Ph[1]>32640)&&Xe(ds.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),ds.addSymbols(ds.icon,Np,Ph,eh,qf,pl,!1,Lc,Bf.lineStartIndex,Bf.lineLength,-1,Rc),Dp=ds.icon.placedSymbolArray.length-1,zp&&(Rp=4*zp.length,ds.addSymbols(ds.icon,zp,Ph,eh,qf,pl,Lr.vertical,Lc,Bf.lineStartIndex,Bf.lineLength,-1,Rc),kp=ds.icon.placedSymbolArray.length-1)}for(var fd in Gc.horizontal){var ap=Gc.horizontal[fd];if(!gf){sd=ze(ap.text);var Td=Hc.layout.get("text-rotate").evaluate(pl,{},Rc);gf=new Fa(Qf,Lc,Ff,mf,tp,ap,rp,uu,Th,Td)}var Up=ap.positionedLines.length===1;if(ad+=$t(ds,Lc,ap,ep,Hc,Th,pl,td,Bf,Gc.vertical?Lr.horizontal:Lr.horizontalOnly,Up?Object.keys(Gc.horizontal):[fd],Wc,Dp,np,Rc),Up)break}Gc.vertical&&(od+=$t(ds,Lc,Gc.vertical,ep,Hc,Th,pl,td,Bf,Lr.vertical,["vertical"],Wc,kp,np,Rc));var Pd=gf?gf.boxStartIndex:ds.collisionBoxArray.length,Md=gf?gf.boxEndIndex:ds.collisionBoxArray.length,Id=rh?rh.boxStartIndex:ds.collisionBoxArray.length,Od=rh?rh.boxEndIndex:ds.collisionBoxArray.length,Ld=th?th.boxStartIndex:ds.collisionBoxArray.length,Rd=th?th.boxEndIndex:ds.collisionBoxArray.length,Dd=nh?nh.boxStartIndex:ds.collisionBoxArray.length,kd=nh?nh.boxEndIndex:ds.collisionBoxArray.length,pc=-1,op=function(Mh,Zp){return Mh&&Mh.circleDiameter?Math.max(Mh.circleDiameter,Zp):Zp};pc=op(gf,pc),pc=op(rh,pc),pc=op(th,pc);var hd=(pc=op(nh,pc))>-1?1:0;hd&&(pc*=Ad/24),ds.glyphOffsetArray.length>=ot.MAX_GLYPHS&&Xe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),pl.sortKey!==void 0&&ds.addToSortKeyRanges(ds.symbolInstances.length,pl.sortKey),ds.symbolInstances.emplaceBack(Lc.x,Lc.y,Wc.right>=0?Wc.right:-1,Wc.center>=0?Wc.center:-1,Wc.left>=0?Wc.left:-1,Wc.vertical||-1,Dp,kp,sd,Pd,Md,Id,Od,Ld,Rd,Dd,kd,Ff,ad,od,id,Rp,hd,0,rp,Fp,ip,pc)}(ma,qh,Hd,eo,Aa,Tu,Gl,ma.layers[0],ma.collisionBoxArray,Na.index,Na.sourceLayerIndex,ma.index,Lf,Tp,Pp,Ys,hf,_h,Mp,Mc,Na,yu,La,cc,uo)};if(Ic==="line")for(var Jf=0,Ip=os(Na.geometry,0,0,8192,8192);Jf<Ip.length;Jf+=1)for(var bh=Ip[Jf],Sh=0,$h=Go(bh,yh,Kh,eo.vertical||Hl,Aa,24,$f,ma.overscaling,8192);Sh<$h.length;Sh+=1){var Eh=$h[Sh];Hl&&ua(ma,Hl.text,Rf,Eh)||Vc(bh,Eh)}else if(Ic==="line-center")for(var Ch=0,Jh=Na.geometry;Ch<Jh.length;Ch+=1){var pf=Jh[Ch];if(pf.length>1){var Qh=Is(pf,Kh,eo.vertical||Hl,Aa,24,$f);Qh&&Vc(pf,Qh)}}else if(Na.type==="Polygon")for(var wh=0,Oc=uf(Na.geometry,0);wh<Oc.length;wh+=1){var Df=Oc[wh],df=ca(Df,16);Vc(Df[0],new Fn(df.x,df.y,0))}else if(Na.type==="LineString")for(var kf=0,Ah=Na.geometry;kf<Ah.length;kf+=1){var hc=Ah[kf];Vc(hc,new Fn(hc[0].x,hc[0].y,0))}else if(Na.type==="Point")for(var Op=0,$p=Na.geometry;Op<$p.length;Op+=1)for(var Jp=0,wd=$p[Op];Jp<wd.length;Jp+=1){var Qp=wd[Jp];Vc([Qp],new Fn(Qp.x,Qp.y,0))}}(e,mr,Vn,Ls,f,Z,Cn,fi,Kn,Xs,x)},Wt=0,pr=e.features;Wt<pr.length;Wt+=1)It();g&&e.generateCollisionDebugBuffers()},d.perspective=function(e,t,r,f,v){var g,x=1/Math.tan(t/2);return e[0]=x/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,v!=null&&v!==1/0?(e[10]=(v+f)*(g=1/(f-v)),e[14]=2*v*f*g):(e[10]=-1,e[14]=-2*f),e},d.pick=function(e,t){for(var r={},f=0;f<t.length;f++){var v=t[f];v in e&&(r[v]=e[v])}return r},d.plugin=Mo,d.polygonIntersectsPolygon=Jn,d.postMapLoadEvent=Ye,d.postTurnstileEvent=Tr,d.potpack=Ot,d.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],d.register=Dn,d.registerForPluginStateChange=function(e){return e({pluginStatus:Ts,pluginURL:Su}),ec.on("pluginStateChange",e),e},d.renderColorRamp=yf,d.rotate=function(e,t,r){var f=t[0],v=t[1],g=t[2],x=t[3],P=Math.sin(r),k=Math.cos(r);return e[0]=f*k+g*P,e[1]=v*k+x*P,e[2]=f*-P+g*k,e[3]=v*-P+x*k,e},d.rotateX=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),g=t[4],x=t[5],P=t[6],k=t[7],Z=t[8],X=t[9],re=t[10],he=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=g*v+Z*f,e[5]=x*v+X*f,e[6]=P*v+re*f,e[7]=k*v+he*f,e[8]=Z*v-g*f,e[9]=X*v-x*f,e[10]=re*v-P*f,e[11]=he*v-k*f,e},d.rotateZ=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),g=t[0],x=t[1],P=t[2],k=t[3],Z=t[4],X=t[5],re=t[6],he=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=g*v+Z*f,e[1]=x*v+X*f,e[2]=P*v+re*f,e[3]=k*v+he*f,e[4]=Z*v-g*f,e[5]=X*v-x*f,e[6]=re*v-P*f,e[7]=he*v-k*f,e},d.scale=function(e,t,r){var f=r[0],v=r[1],g=r[2];return e[0]=t[0]*f,e[1]=t[1]*f,e[2]=t[2]*f,e[3]=t[3]*f,e[4]=t[4]*v,e[5]=t[5]*v,e[6]=t[6]*v,e[7]=t[7]*v,e[8]=t[8]*g,e[9]=t[9]*g,e[10]=t[10]*g,e[11]=t[11]*g,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},d.scale$1=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},d.scale$2=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},d.setCacheLimits=function(e,t){ut=e,At=t},d.setRTLTextPlugin=function(e,t,r){if(r===void 0&&(r=!1),Ts==="deferred"||Ts==="loading"||Ts==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Su=ea.resolveURL(e),Ts="deferred",iu=t,ql(),r||Gs()},d.sphericalToCartesian=function(e){var t=e[0],r=e[1],f=e[2];return r+=90,r*=Math.PI/180,f*=Math.PI/180,{x:t*Math.cos(r)*Math.sin(f),y:t*Math.sin(r)*Math.sin(f),z:t*Math.cos(f)}},d.sqrLen=function(e){var t=e[0],r=e[1];return t*t+r*r},d.styleSpec=ae,d.sub=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},d.symbolSize=jo,d.transformMat3=function(e,t,r){var f=t[0],v=t[1],g=t[2];return e[0]=f*r[0]+v*r[3]+g*r[6],e[1]=f*r[1]+v*r[4]+g*r[7],e[2]=f*r[2]+v*r[5]+g*r[8],e},d.transformMat4=Bs,d.translate=function(e,t,r){var f,v,g,x,P,k,Z,X,re,he,be,Ve,We=r[0],vt=r[1],tt=r[2];return t===e?(e[12]=t[0]*We+t[4]*vt+t[8]*tt+t[12],e[13]=t[1]*We+t[5]*vt+t[9]*tt+t[13],e[14]=t[2]*We+t[6]*vt+t[10]*tt+t[14],e[15]=t[3]*We+t[7]*vt+t[11]*tt+t[15]):(v=t[1],g=t[2],x=t[3],P=t[4],k=t[5],Z=t[6],X=t[7],re=t[8],he=t[9],be=t[10],Ve=t[11],e[0]=f=t[0],e[1]=v,e[2]=g,e[3]=x,e[4]=P,e[5]=k,e[6]=Z,e[7]=X,e[8]=re,e[9]=he,e[10]=be,e[11]=Ve,e[12]=f*We+P*vt+re*tt+t[12],e[13]=v*We+k*vt+he*tt+t[13],e[14]=g*We+Z*vt+be*tt+t[14],e[15]=x*We+X*vt+Ve*tt+t[15]),e},d.triggerPluginCompletionEvent=qc,d.uniqueId=Ut,d.validateCustomStyleLayer=function(e){var t=[],r=e.id;return r===void 0&&t.push({message:"layers."+r+': missing required property "id"'}),e.render===void 0&&t.push({message:"layers."+r+': missing required method "render"'}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&t.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),t},d.validateLight=Qc,d.validateStyle=rs,d.values=function(e){var t=[];for(var r in e)t.push(e[r]);return t},d.vectorTile=Ac,d.version="1.13.2",d.warnOnce=Xe,d.webpSupported=ge,d.window=K,d.wrap=Qt}),E(["./shared"],function(d){"use strict";function me(Y){var le=typeof Y;if(le==="number"||le==="boolean"||le==="string"||Y==null)return JSON.stringify(Y);if(Array.isArray(Y)){for(var ve="[",B=0,ee=Y;B<ee.length;B+=1)ve+=me(ee[B])+",";return ve+"]"}for(var de=Object.keys(Y).sort(),Ae="{",ae=0;ae<de.length;ae++)Ae+=JSON.stringify(de[ae])+":"+me(Y[de[ae]])+",";return Ae+"}"}function te(Y){for(var le="",ve=0,B=d.refProperties;ve<B.length;ve+=1)le+="/"+me(Y[B[ve]]);return le}var ue=function(Y){this.keyCache={},Y&&this.replace(Y)};ue.prototype.replace=function(Y){this._layerConfigs={},this._layers={},this.update(Y,[])},ue.prototype.update=function(Y,le){for(var ve=this,B=0,ee=Y;B<ee.length;B+=1){var de=ee[B];this._layerConfigs[de.id]=de;var Ae=this._layers[de.id]=d.createStyleLayer(de);Ae._featureFilter=d.featureFilter(Ae.filter),this.keyCache[de.id]&&delete this.keyCache[de.id]}for(var ae=0,_e=le;ae<_e.length;ae+=1){var ct=_e[ae];delete this.keyCache[ct],delete this._layerConfigs[ct],delete this._layers[ct]}this.familiesBySource={};for(var Sr=0,Ht=function(hn,mn){for(var Bi={},An=0;An<hn.length;An++){var Di=mn&&mn[hn[An].id]||te(hn[An]);mn&&(mn[hn[An].id]=Di);var ra=Bi[Di];ra||(ra=Bi[Di]=[]),ra.push(hn[An])}var hi=[];for(var na in Bi)hi.push(Bi[na]);return hi}(d.values(this._layerConfigs),this.keyCache);Sr<Ht.length;Sr+=1){var Jt=Ht[Sr].map(function(hn){return ve._layers[hn.id]}),Nr=Jt[0];if(Nr.visibility!=="none"){var zn=Nr.source||"",Nn=this.familiesBySource[zn];Nn||(Nn=this.familiesBySource[zn]={});var Kt=Nr.sourceLayer||"_geojsonTileLayer",In=Nn[Kt];In||(In=Nn[Kt]=[]),In.push(Jt)}}};var oe=function(Y){var le={},ve=[];for(var B in Y){var ee=Y[B],de=le[B]={};for(var Ae in ee){var ae=ee[+Ae];if(ae&&ae.bitmap.width!==0&&ae.bitmap.height!==0){var _e={x:0,y:0,w:ae.bitmap.width+2,h:ae.bitmap.height+2};ve.push(_e),de[Ae]={rect:_e,metrics:ae.metrics}}}}var ct=d.potpack(ve),Sr=new d.AlphaImage({width:ct.w||1,height:ct.h||1});for(var Ht in Y){var Jt=Y[Ht];for(var Nr in Jt){var zn=Jt[+Nr];if(zn&&zn.bitmap.width!==0&&zn.bitmap.height!==0){var Nn=le[Ht][Nr].rect;d.AlphaImage.copy(zn.bitmap,Sr,{x:0,y:0},{x:Nn.x+1,y:Nn.y+1},zn.bitmap)}}}this.image=Sr,this.positions=le};d.register("GlyphAtlas",oe);var Ne=function(Y){this.tileID=new d.OverscaledTileID(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.uid=Y.uid,this.zoom=Y.zoom,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.collectResourceTiming,this.returnDependencies=!!Y.returnDependencies,this.promoteId=Y.promoteId};function K(Y,le,ve){for(var B=new d.EvaluationParameters(le),ee=0,de=Y;ee<de.length;ee+=1)de[ee].recalculate(B,ve)}function Qe(Y,le){var ve=d.getArrayBuffer(Y.request,function(B,ee,de,Ae){B?le(B):ee&&le(null,{vectorTile:new d.vectorTile.VectorTile(new d.pbf(ee)),rawData:ee,cacheControl:de,expires:Ae})});return function(){ve.cancel(),le()}}Ne.prototype.parse=function(Y,le,ve,B,ee){var de=this;this.status="parsing",this.data=Y,this.collisionBoxArray=new d.CollisionBoxArray;var Ae=new d.DictionaryCoder(Object.keys(Y.layers).sort()),ae=new d.FeatureIndex(this.tileID,this.promoteId);ae.bucketLayerIDs=[];var _e,ct,Sr,Ht,Jt={},Nr={featureIndex:ae,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ve},zn=le.familiesBySource[this.source];for(var Nn in zn){var Kt=Y.layers[Nn];if(Kt){Kt.version===1&&d.warnOnce('Vector tile source "'+this.source+'" layer "'+Nn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var In=Ae.encode(Nn),hn=[],mn=0;mn<Kt.length;mn++){var Bi=Kt.feature(mn),An=ae.getId(Bi,Nn);hn.push({feature:Bi,id:An,index:mn,sourceLayerIndex:In})}for(var Di=0,ra=zn[Nn];Di<ra.length;Di+=1){var hi=ra[Di],na=hi[0];na.minzoom&&this.zoom<Math.floor(na.minzoom)||na.maxzoom&&this.zoom>=na.maxzoom||na.visibility!=="none"&&(K(hi,this.zoom,ve),(Jt[na.id]=na.createBucket({index:ae.bucketLayerIDs.length,layers:hi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:In,sourceID:this.source})).populate(hn,Nr,this.tileID.canonical),ae.bucketLayerIDs.push(hi.map(function(Wi){return Wi.id})))}}}var Hi=d.mapObject(Nr.glyphDependencies,function(Wi){return Object.keys(Wi).map(Number)});Object.keys(Hi).length?B.send("getGlyphs",{uid:this.uid,stacks:Hi},function(Wi,Ni){_e||(_e=Wi,ct=Ni,Ra.call(de))}):ct={};var Oi=Object.keys(Nr.iconDependencies);Oi.length?B.send("getImages",{icons:Oi,source:this.source,tileID:this.tileID,type:"icons"},function(Wi,Ni){_e||(_e=Wi,Sr=Ni,Ra.call(de))}):Sr={};var ga=Object.keys(Nr.patternDependencies);function Ra(){if(_e)return ee(_e);if(ct&&Sr&&Ht){var Wi=new oe(ct),Ni=new d.ImageAtlas(Sr,Ht);for(var Xi in Jt){var ro=Jt[Xi];ro instanceof d.SymbolBucket?(K(ro.layers,this.zoom,ve),d.performSymbolLayout(ro,ct,Wi.positions,Sr,Ni.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):ro.hasPattern&&(ro instanceof d.LineBucket||ro instanceof d.FillBucket||ro instanceof d.FillExtrusionBucket)&&(K(ro.layers,this.zoom,ve),ro.addFeatures(Nr,this.tileID.canonical,Ni.patternPositions))}this.status="done",ee(null,{buckets:d.values(Jt).filter(function(Qo){return!Qo.isEmpty()}),featureIndex:ae,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Wi.image,imageAtlas:Ni,glyphMap:this.returnDependencies?ct:null,iconMap:this.returnDependencies?Sr:null,glyphPositions:this.returnDependencies?Wi.positions:null})}}ga.length?B.send("getImages",{icons:ga,source:this.source,tileID:this.tileID,type:"patterns"},function(Wi,Ni){_e||(_e=Wi,Ht=Ni,Ra.call(de))}):Ht={},Ra.call(this)};var mt=function(Y,le,ve,B){this.actor=Y,this.layerIndex=le,this.availableImages=ve,this.loadVectorData=B||Qe,this.loading={},this.loaded={}};mt.prototype.loadTile=function(Y,le){var ve=this,B=Y.uid;this.loading||(this.loading={});var ee=!!(Y&&Y.request&&Y.request.collectResourceTiming)&&new d.RequestPerformance(Y.request),de=this.loading[B]=new Ne(Y);de.abort=this.loadVectorData(Y,function(Ae,ae){if(delete ve.loading[B],Ae||!ae)return de.status="done",ve.loaded[B]=de,le(Ae);var _e=ae.rawData,ct={};ae.expires&&(ct.expires=ae.expires),ae.cacheControl&&(ct.cacheControl=ae.cacheControl);var Sr={};if(ee){var Ht=ee.finish();Ht&&(Sr.resourceTiming=JSON.parse(JSON.stringify(Ht)))}de.vectorTile=ae.vectorTile,de.parse(ae.vectorTile,ve.layerIndex,ve.availableImages,ve.actor,function(Jt,Nr){if(Jt||!Nr)return le(Jt);le(null,d.extend({rawTileData:_e.slice(0)},Nr,ct,Sr))}),ve.loaded=ve.loaded||{},ve.loaded[B]=de})},mt.prototype.reloadTile=function(Y,le){var ve=this,B=this.loaded,ee=Y.uid,de=this;if(B&&B[ee]){var Ae=B[ee];Ae.showCollisionBoxes=Y.showCollisionBoxes;var ae=function(_e,ct){var Sr=Ae.reloadCallback;Sr&&(delete Ae.reloadCallback,Ae.parse(Ae.vectorTile,de.layerIndex,ve.availableImages,de.actor,Sr)),le(_e,ct)};Ae.status==="parsing"?Ae.reloadCallback=ae:Ae.status==="done"&&(Ae.vectorTile?Ae.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.actor,ae):ae())}},mt.prototype.abortTile=function(Y,le){var ve=this.loading,B=Y.uid;ve&&ve[B]&&ve[B].abort&&(ve[B].abort(),delete ve[B]),le()},mt.prototype.removeTile=function(Y,le){var ve=this.loaded,B=Y.uid;ve&&ve[B]&&delete ve[B],le()};var Zt=d.window.ImageBitmap,Cr=function(){this.loaded={}};function Qt(Y,le){if(Y.length!==0){Xt(Y[0],le);for(var ve=1;ve<Y.length;ve++)Xt(Y[ve],!le)}}function Xt(Y,le){for(var ve=0,B=0,ee=Y.length,de=ee-1;B<ee;de=B++)ve+=(Y[B][0]-Y[de][0])*(Y[de][1]+Y[B][1]);ve>=0!=!!le&&Y.reverse()}Cr.prototype.loadTile=function(Y,le){var ve=Y.uid,B=Y.encoding,ee=Y.rawImageData,de=Zt&&ee instanceof Zt?this.getImageData(ee):ee,Ae=new d.DEMData(ve,de,B);this.loaded=this.loaded||{},this.loaded[ve]=Ae,le(null,Ae)},Cr.prototype.getImageData=function(Y){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);var le=this.offscreenCanvasContext.getImageData(-1,-1,Y.width+2,Y.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new d.RGBAImage({width:le.width,height:le.height},le.data)},Cr.prototype.removeTile=function(Y){var le=this.loaded,ve=Y.uid;le&&le[ve]&&delete le[ve]};var rr=d.vectorTile.VectorTileFeature.prototype.toGeoJSON,Ut=function(Y){this._feature=Y,this.extent=d.EXTENT,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))};Ut.prototype.loadGeometry=function(){if(this._feature.type===1){for(var Y=[],le=0,ve=this._feature.geometry;le<ve.length;le+=1){var B=ve[le];Y.push([new d.Point$1(B[0],B[1])])}return Y}for(var ee=[],de=0,Ae=this._feature.geometry;de<Ae.length;de+=1){for(var ae=[],_e=0,ct=Ae[de];_e<ct.length;_e+=1){var Sr=ct[_e];ae.push(new d.Point$1(Sr[0],Sr[1]))}ee.push(ae)}return ee},Ut.prototype.toGeoJSON=function(Y,le,ve){return rr.call(this,Y,le,ve)};var St=function(Y){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.EXTENT,this.length=Y.length,this._features=Y};St.prototype.feature=function(Y){return new Ut(this._features[Y])};var Et=d.vectorTile.VectorTileFeature,yr=q;function q(Y,le){this.options=le||{},this.features=Y,this.length=Y.length}function hr(Y,le){this.id=typeof Y.id=="number"?Y.id:void 0,this.type=Y.type,this.rawGeometry=Y.type===1?[Y.geometry]:Y.geometry,this.properties=Y.tags,this.extent=le||4096}q.prototype.feature=function(Y){return new hr(this.features[Y],this.options.extent)},hr.prototype.loadGeometry=function(){var Y=this.rawGeometry;this.geometry=[];for(var le=0;le<Y.length;le++){for(var ve=Y[le],B=[],ee=0;ee<ve.length;ee++)B.push(new d.Point$1(ve[ee][0],ve[ee][1]));this.geometry.push(B)}return this.geometry},hr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Y=this.geometry,le=1/0,ve=-1/0,B=1/0,ee=-1/0,de=0;de<Y.length;de++)for(var Ae=Y[de],ae=0;ae<Ae.length;ae++){var _e=Ae[ae];le=Math.min(le,_e.x),ve=Math.max(ve,_e.x),B=Math.min(B,_e.y),ee=Math.max(ee,_e.y)}return[le,B,ve,ee]},hr.prototype.toGeoJSON=Et.prototype.toGeoJSON;var wt=Ft,$e=yr;function Ft(Y){var le=new d.pbf;return function(ve,B){for(var ee in ve.layers)B.writeMessage(3,Xe,ve.layers[ee])}(Y,le),le.finish()}function Xe(Y,le){var ve;le.writeVarintField(15,Y.version||1),le.writeStringField(1,Y.name||""),le.writeVarintField(5,Y.extent||4096);var B={keys:[],values:[],keycache:{},valuecache:{}};for(ve=0;ve<Y.length;ve++)B.feature=Y.feature(ve),le.writeMessage(2,jt,B);var ee=B.keys;for(ve=0;ve<ee.length;ve++)le.writeStringField(3,ee[ve]);var de=B.values;for(ve=0;ve<de.length;ve++)le.writeMessage(4,Re,de[ve])}function jt(Y,le){var ve=Y.feature;ve.id!==void 0&&le.writeVarintField(1,ve.id),le.writeMessage(2,br,Y),le.writeVarintField(3,ve.type),le.writeMessage(4,ie,ve)}function br(Y,le){var ve=Y.feature,B=Y.keys,ee=Y.values,de=Y.keycache,Ae=Y.valuecache;for(var ae in ve.properties){var _e=de[ae];_e===void 0&&(B.push(ae),de[ae]=_e=B.length-1),le.writeVarint(_e);var ct=ve.properties[ae],Sr=typeof ct;Sr!=="string"&&Sr!=="boolean"&&Sr!=="number"&&(ct=JSON.stringify(ct));var Ht=Sr+":"+ct,Jt=Ae[Ht];Jt===void 0&&(ee.push(ct),Ae[Ht]=Jt=ee.length-1),le.writeVarint(Jt)}}function sr(Y,le){return(le<<3)+(7&Y)}function j(Y){return Y<<1^Y>>31}function ie(Y,le){for(var ve=Y.loadGeometry(),B=Y.type,ee=0,de=0,Ae=ve.length,ae=0;ae<Ae;ae++){var _e=ve[ae],ct=1;B===1&&(ct=_e.length),le.writeVarint(sr(1,ct));for(var Sr=B===3?_e.length-1:_e.length,Ht=0;Ht<Sr;Ht++){Ht===1&&B!==1&&le.writeVarint(sr(2,Sr-1));var Jt=_e[Ht].x-ee,Nr=_e[Ht].y-de;le.writeVarint(j(Jt)),le.writeVarint(j(Nr)),ee+=Jt,de+=Nr}B===3&&le.writeVarint(sr(7,1))}}function Re(Y,le){var ve=typeof Y;ve==="string"?le.writeStringField(1,Y):ve==="boolean"?le.writeBooleanField(7,Y):ve==="number"&&(Y%1!=0?le.writeDoubleField(3,Y):Y<0?le.writeSVarintField(6,Y):le.writeVarintField(5,Y))}function ye(Y,le,ve,B){_t(Y,ve,B),_t(le,2*ve,2*B),_t(le,2*ve+1,2*B+1)}function _t(Y,le,ve){var B=Y[le];Y[le]=Y[ve],Y[ve]=B}function dt(Y,le,ve,B){var ee=Y-ve,de=le-B;return ee*ee+de*de}wt.fromVectorTileJs=Ft,wt.fromGeojsonVt=function(Y,le){le=le||{};var ve={};for(var B in Y)ve[B]=new yr(Y[B].features,le),ve[B].name=B,ve[B].version=le.version,ve[B].extent=le.extent;return Ft({layers:ve})},wt.GeoJSONWrapper=$e;var zt=function(Y){return Y[0]},Bt=function(Y){return Y[1]},Ur=function(Y,le,ve,B,ee){le===void 0&&(le=zt),ve===void 0&&(ve=Bt),B===void 0&&(B=64),ee===void 0&&(ee=Float64Array),this.nodeSize=B,this.points=Y;for(var de=Y.length<65536?Uint16Array:Uint32Array,Ae=this.ids=new de(Y.length),ae=this.coords=new ee(2*Y.length),_e=0;_e<Y.length;_e++)Ae[_e]=_e,ae[2*_e]=le(Y[_e]),ae[2*_e+1]=ve(Y[_e]);(function ct(Sr,Ht,Jt,Nr,zn,Nn){if(!(zn-Nr<=Jt)){var Kt=Nr+zn>>1;(function In(hn,mn,Bi,An,Di,ra){for(;Di>An;){if(Di-An>600){var hi=Di-An+1,na=Bi-An+1,Hi=Math.log(hi),Oi=.5*Math.exp(2*Hi/3),ga=.5*Math.sqrt(Hi*Oi*(hi-Oi)/hi)*(na-hi/2<0?-1:1);In(hn,mn,Bi,Math.max(An,Math.floor(Bi-na*Oi/hi+ga)),Math.min(Di,Math.floor(Bi+(hi-na)*Oi/hi+ga)),ra)}var Ra=mn[2*Bi+ra],Wi=An,Ni=Di;for(ye(hn,mn,An,Bi),mn[2*Di+ra]>Ra&&ye(hn,mn,An,Di);Wi<Ni;){for(ye(hn,mn,Wi,Ni),Wi++,Ni--;mn[2*Wi+ra]<Ra;)Wi++;for(;mn[2*Ni+ra]>Ra;)Ni--}mn[2*An+ra]===Ra?ye(hn,mn,An,Ni):ye(hn,mn,++Ni,Di),Ni<=Bi&&(An=Ni+1),Bi<=Ni&&(Di=Ni-1)}})(Sr,Ht,Kt,Nr,zn,Nn%2),ct(Sr,Ht,Jt,Nr,Kt-1,Nn+1),ct(Sr,Ht,Jt,Kt+1,zn,Nn+1)}})(Ae,ae,B,0,Ae.length-1,0)};Ur.prototype.range=function(Y,le,ve,B){return function(ee,de,Ae,ae,_e,ct,Sr){for(var Ht,Jt,Nr=[0,ee.length-1,0],zn=[];Nr.length;){var Nn=Nr.pop(),Kt=Nr.pop(),In=Nr.pop();if(Kt-In<=Sr)for(var hn=In;hn<=Kt;hn++)Jt=de[2*hn+1],(Ht=de[2*hn])>=Ae&&Ht<=_e&&Jt>=ae&&Jt<=ct&&zn.push(ee[hn]);else{var mn=Math.floor((In+Kt)/2);Jt=de[2*mn+1],(Ht=de[2*mn])>=Ae&&Ht<=_e&&Jt>=ae&&Jt<=ct&&zn.push(ee[mn]);var Bi=(Nn+1)%2;(Nn===0?Ae<=Ht:ae<=Jt)&&(Nr.push(In),Nr.push(mn-1),Nr.push(Bi)),(Nn===0?_e>=Ht:ct>=Jt)&&(Nr.push(mn+1),Nr.push(Kt),Nr.push(Bi))}}return zn}(this.ids,this.coords,Y,le,ve,B,this.nodeSize)},Ur.prototype.within=function(Y,le,ve){return function(B,ee,de,Ae,ae,_e){for(var ct=[0,B.length-1,0],Sr=[],Ht=ae*ae;ct.length;){var Jt=ct.pop(),Nr=ct.pop(),zn=ct.pop();if(Nr-zn<=_e)for(var Nn=zn;Nn<=Nr;Nn++)dt(ee[2*Nn],ee[2*Nn+1],de,Ae)<=Ht&&Sr.push(B[Nn]);else{var Kt=Math.floor((zn+Nr)/2),In=ee[2*Kt],hn=ee[2*Kt+1];dt(In,hn,de,Ae)<=Ht&&Sr.push(B[Kt]);var mn=(Jt+1)%2;(Jt===0?de-ae<=In:Ae-ae<=hn)&&(ct.push(zn),ct.push(Kt-1),ct.push(mn)),(Jt===0?de+ae>=In:Ae+ae>=hn)&&(ct.push(Kt+1),ct.push(Nr),ct.push(mn))}}return Sr}(this.ids,this.coords,Y,le,ve,this.nodeSize)};var vn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Y){return Y}},En=function(Y){this.options=Lt(Object.create(vn),Y),this.trees=new Array(this.options.maxZoom+1)};function ea(Y,le,ve,B,ee){return{x:Y,y:le,zoom:1/0,id:ve,parentId:-1,numPoints:B,properties:ee}}function ar(Y,le){var ve=Y.geometry.coordinates,B=ve[1];return{x:Ze(ve[0]),y:Oe(B),zoom:1/0,index:le,parentId:-1}}function ge(Y){return{type:"Feature",id:Y.id,properties:Te(Y),geometry:{type:"Point",coordinates:[(B=Y.x,360*(B-.5)),(le=Y.y,ve=(180-360*le)*Math.PI/180,360*Math.atan(Math.exp(ve))/Math.PI-90)]}};var le,ve,B}function Te(Y){var le=Y.numPoints,ve=le>=1e4?Math.round(le/1e3)+"k":le>=1e3?Math.round(le/100)/10+"k":le;return Lt(Lt({},Y.properties),{cluster:!0,cluster_id:Y.id,point_count:le,point_count_abbreviated:ve})}function Ze(Y){return Y/360+.5}function Oe(Y){var le=Math.sin(Y*Math.PI/180),ve=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return ve<0?0:ve>1?1:ve}function Lt(Y,le){for(var ve in le)Y[ve]=le[ve];return Y}function nr(Y){return Y.x}function dr(Y){return Y.y}function Or(Y,le,ve,B,ee,de){var Ae=ee-ve,ae=de-B;if(Ae!==0||ae!==0){var _e=((Y-ve)*Ae+(le-B)*ae)/(Ae*Ae+ae*ae);_e>1?(ve=ee,B=de):_e>0&&(ve+=Ae*_e,B+=ae*_e)}return(Ae=Y-ve)*Ae+(ae=le-B)*ae}function lr(Y,le,ve,B){var ee={id:Y===void 0?null:Y,type:le,geometry:ve,tags:B,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(de){var Ae=de.geometry,ae=de.type;if(ae==="Point"||ae==="MultiPoint"||ae==="LineString")un(de,Ae);else if(ae==="Polygon"||ae==="MultiLineString")for(var _e=0;_e<Ae.length;_e++)un(de,Ae[_e]);else if(ae==="MultiPolygon")for(_e=0;_e<Ae.length;_e++)for(var ct=0;ct<Ae[_e].length;ct++)un(de,Ae[_e][ct])}(ee),ee}function un(Y,le){for(var ve=0;ve<le.length;ve+=3)Y.minX=Math.min(Y.minX,le[ve]),Y.minY=Math.min(Y.minY,le[ve+1]),Y.maxX=Math.max(Y.maxX,le[ve]),Y.maxY=Math.max(Y.maxY,le[ve+1])}function w(Y,le,ve,B){if(le.geometry){var ee=le.geometry.coordinates,de=le.geometry.type,Ae=Math.pow(ve.tolerance/((1<<ve.maxZoom)*ve.extent),2),ae=[],_e=le.id;if(ve.promoteId?_e=le.properties[ve.promoteId]:ve.generateId&&(_e=B||0),de==="Point")H(ee,ae);else if(de==="MultiPoint")for(var ct=0;ct<ee.length;ct++)H(ee[ct],ae);else if(de==="LineString")Ue(ee,ae,Ae,!1);else if(de==="MultiLineString"){if(ve.lineMetrics){for(ct=0;ct<ee.length;ct++)Ue(ee[ct],ae=[],Ae,!1),Y.push(lr(_e,"LineString",ae,le.properties));return}et(ee,ae,Ae,!1)}else if(de==="Polygon")et(ee,ae,Ae,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(ct=0;ct<le.geometry.geometries.length;ct++)w(Y,{id:_e,geometry:le.geometry.geometries[ct],properties:le.properties},ve,B);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ct=0;ct<ee.length;ct++){var Sr=[];et(ee[ct],Sr,Ae,!0),ae.push(Sr)}}Y.push(lr(_e,de,ae,le.properties))}}function H(Y,le){le.push(st(Y[0])),le.push(Ct(Y[1])),le.push(0)}function Ue(Y,le,ve,B){for(var ee,de,Ae=0,ae=0;ae<Y.length;ae++){var _e=st(Y[ae][0]),ct=Ct(Y[ae][1]);le.push(_e),le.push(ct),le.push(0),ae>0&&(Ae+=B?(ee*ct-_e*de)/2:Math.sqrt(Math.pow(_e-ee,2)+Math.pow(ct-de,2))),ee=_e,de=ct}var Sr=le.length-3;le[2]=1,function Ht(Jt,Nr,zn,Nn){for(var Kt,In=Nn,hn=zn-Nr>>1,mn=zn-Nr,Bi=Jt[Nr],An=Jt[Nr+1],Di=Jt[zn],ra=Jt[zn+1],hi=Nr+3;hi<zn;hi+=3){var na=Or(Jt[hi],Jt[hi+1],Bi,An,Di,ra);if(na>In)Kt=hi,In=na;else if(na===In){var Hi=Math.abs(hi-hn);Hi<mn&&(Kt=hi,mn=Hi)}}In>Nn&&(Kt-Nr>3&&Ht(Jt,Nr,Kt,Nn),Jt[Kt+2]=In,zn-Kt>3&&Ht(Jt,Kt,zn,Nn))}(le,0,Sr,ve),le[Sr+2]=1,le.size=Math.abs(Ae),le.start=0,le.end=le.size}function et(Y,le,ve,B){for(var ee=0;ee<Y.length;ee++){var de=[];Ue(Y[ee],de,ve,B),le.push(de)}}function st(Y){return Y/360+.5}function Ct(Y){var le=Math.sin(Y*Math.PI/180),ve=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return ve<0?0:ve>1?1:ve}function $(Y,le,ve,B,ee,de,Ae,ae){if(B/=le,de>=(ve/=le)&&Ae<B)return Y;if(Ae<ve||de>=B)return null;for(var _e=[],ct=0;ct<Y.length;ct++){var Sr=Y[ct],Ht=Sr.geometry,Jt=Sr.type,Nr=ee===0?Sr.minX:Sr.minY,zn=ee===0?Sr.maxX:Sr.maxY;if(Nr>=ve&&zn<B)_e.push(Sr);else if(!(zn<ve||Nr>=B)){var Nn=[];if(Jt==="Point"||Jt==="MultiPoint")Gt(Ht,Nn,ve,B,ee);else if(Jt==="LineString")Tr(Ht,Nn,ve,B,ee,!1,ae.lineMetrics);else if(Jt==="MultiLineString")Ye(Ht,Nn,ve,B,ee,!1);else if(Jt==="Polygon")Ye(Ht,Nn,ve,B,ee,!0);else if(Jt==="MultiPolygon")for(var Kt=0;Kt<Ht.length;Kt++){var In=[];Ye(Ht[Kt],In,ve,B,ee,!0),In.length&&Nn.push(In)}if(Nn.length){if(ae.lineMetrics&&Jt==="LineString"){for(Kt=0;Kt<Nn.length;Kt++)_e.push(lr(Sr.id,Jt,Nn[Kt],Sr.tags));continue}Jt!=="LineString"&&Jt!=="MultiLineString"||(Nn.length===1?(Jt="LineString",Nn=Nn[0]):Jt="MultiLineString"),Jt!=="Point"&&Jt!=="MultiPoint"||(Jt=Nn.length===3?"Point":"MultiPoint"),_e.push(lr(Sr.id,Jt,Nn,Sr.tags))}}}return _e.length?_e:null}function Gt(Y,le,ve,B,ee){for(var de=0;de<Y.length;de+=3){var Ae=Y[de+ee];Ae>=ve&&Ae<=B&&(le.push(Y[de]),le.push(Y[de+1]),le.push(Y[de+2]))}}function Tr(Y,le,ve,B,ee,de,Ae){for(var ae,_e,ct=Ir(Y),Sr=ee===0?At:Rt,Ht=Y.start,Jt=0;Jt<Y.length-3;Jt+=3){var Nr=Y[Jt],zn=Y[Jt+1],Nn=Y[Jt+2],Kt=Y[Jt+3],In=Y[Jt+4],hn=ee===0?Nr:zn,mn=ee===0?Kt:In,Bi=!1;Ae&&(ae=Math.sqrt(Math.pow(Nr-Kt,2)+Math.pow(zn-In,2))),hn<ve?mn>ve&&(_e=Sr(ct,Nr,zn,Kt,In,ve),Ae&&(ct.start=Ht+ae*_e)):hn>B?mn<B&&(_e=Sr(ct,Nr,zn,Kt,In,B),Ae&&(ct.start=Ht+ae*_e)):ut(ct,Nr,zn,Nn),mn<ve&&hn>=ve&&(_e=Sr(ct,Nr,zn,Kt,In,ve),Bi=!0),mn>B&&hn<=B&&(_e=Sr(ct,Nr,zn,Kt,In,B),Bi=!0),!de&&Bi&&(Ae&&(ct.end=Ht+ae*_e),le.push(ct),ct=Ir(Y)),Ae&&(Ht+=ae)}var An=Y.length-3;Nr=Y[An],zn=Y[An+1],Nn=Y[An+2],(hn=ee===0?Nr:zn)>=ve&&hn<=B&&ut(ct,Nr,zn,Nn),An=ct.length-3,de&&An>=3&&(ct[An]!==ct[0]||ct[An+1]!==ct[1])&&ut(ct,ct[0],ct[1],ct[2]),ct.length&&le.push(ct)}function Ir(Y){var le=[];return le.size=Y.size,le.start=Y.start,le.end=Y.end,le}function Ye(Y,le,ve,B,ee,de){for(var Ae=0;Ae<Y.length;Ae++)Tr(Y[Ae],le,ve,B,ee,de,!1)}function ut(Y,le,ve,B){Y.push(le),Y.push(ve),Y.push(B)}function At(Y,le,ve,B,ee,de){var Ae=(de-le)/(B-le);return Y.push(de),Y.push(ve+(ee-ve)*Ae),Y.push(1),Ae}function Rt(Y,le,ve,B,ee,de){var Ae=(de-ve)/(ee-ve);return Y.push(le+(B-le)*Ae),Y.push(de),Y.push(1),Ae}function xr(Y,le){for(var ve=[],B=0;B<Y.length;B++){var ee,de=Y[B],Ae=de.type;if(Ae==="Point"||Ae==="MultiPoint"||Ae==="LineString")ee=Ar(de.geometry,le);else if(Ae==="MultiLineString"||Ae==="Polygon"){ee=[];for(var ae=0;ae<de.geometry.length;ae++)ee.push(Ar(de.geometry[ae],le))}else if(Ae==="MultiPolygon")for(ee=[],ae=0;ae<de.geometry.length;ae++){for(var _e=[],ct=0;ct<de.geometry[ae].length;ct++)_e.push(Ar(de.geometry[ae][ct],le));ee.push(_e)}ve.push(lr(de.id,Ae,ee,de.tags))}return ve}function Ar(Y,le){var ve=[];ve.size=Y.size,Y.start!==void 0&&(ve.start=Y.start,ve.end=Y.end);for(var B=0;B<Y.length;B+=3)ve.push(Y[B]+le,Y[B+1],Y[B+2]);return ve}function Ke(Y,le){if(Y.transformed)return Y;var ve,B,ee,de=1<<Y.z,Ae=Y.x,ae=Y.y;for(ve=0;ve<Y.features.length;ve++){var _e=Y.features[ve],ct=_e.geometry,Sr=_e.type;if(_e.geometry=[],Sr===1)for(B=0;B<ct.length;B+=2)_e.geometry.push(Xr(ct[B],ct[B+1],le,de,Ae,ae));else for(B=0;B<ct.length;B++){var Ht=[];for(ee=0;ee<ct[B].length;ee+=2)Ht.push(Xr(ct[B][ee],ct[B][ee+1],le,de,Ae,ae));_e.geometry.push(Ht)}}return Y.transformed=!0,Y}function Xr(Y,le,ve,B,ee,de){return[Math.round(ve*(Y*B-ee)),Math.round(ve*(le*B-de))]}function Yr(Y,le,ve,B,ee){for(var de=le===ee.maxZoom?0:ee.tolerance/((1<<le)*ee.extent),Ae={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ve,y:B,z:le,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ae=0;ae<Y.length;ae++){Ae.numFeatures++,wn(Ae,Y[ae],de,ee);var _e=Y[ae].minX,ct=Y[ae].minY,Sr=Y[ae].maxX,Ht=Y[ae].maxY;_e<Ae.minX&&(Ae.minX=_e),ct<Ae.minY&&(Ae.minY=ct),Sr>Ae.maxX&&(Ae.maxX=Sr),Ht>Ae.maxY&&(Ae.maxY=Ht)}return Ae}function wn(Y,le,ve,B){var ee=le.geometry,de=le.type,Ae=[];if(de==="Point"||de==="MultiPoint")for(var ae=0;ae<ee.length;ae+=3)Ae.push(ee[ae]),Ae.push(ee[ae+1]),Y.numPoints++,Y.numSimplified++;else if(de==="LineString")cr(Ae,ee,Y,ve,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(ae=0;ae<ee.length;ae++)cr(Ae,ee[ae],Y,ve,de==="Polygon",ae===0);else if(de==="MultiPolygon")for(var _e=0;_e<ee.length;_e++){var ct=ee[_e];for(ae=0;ae<ct.length;ae++)cr(Ae,ct[ae],Y,ve,!0,ae===0)}if(Ae.length){var Sr=le.tags||null;if(de==="LineString"&&B.lineMetrics){for(var Ht in Sr={},le.tags)Sr[Ht]=le.tags[Ht];Sr.mapbox_clip_start=ee.start/ee.size,Sr.mapbox_clip_end=ee.end/ee.size}var Jt={geometry:Ae,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:Sr};le.id!==null&&(Jt.id=le.id),Y.features.push(Jt)}}function cr(Y,le,ve,B,ee,de){var Ae=B*B;if(B>0&&le.size<(ee?Ae:B))ve.numPoints+=le.length/3;else{for(var ae=[],_e=0;_e<le.length;_e+=3)(B===0||le[_e+2]>Ae)&&(ve.numSimplified++,ae.push(le[_e]),ae.push(le[_e+1])),ve.numPoints++;ee&&function(ct,Sr){for(var Ht=0,Jt=0,Nr=ct.length,zn=Nr-2;Jt<Nr;zn=Jt,Jt+=2)Ht+=(ct[Jt]-ct[zn])*(ct[Jt+1]+ct[zn+1]);if(Ht>0===Sr)for(Jt=0,Nr=ct.length;Jt<Nr/2;Jt+=2){var Nn=ct[Jt],Kt=ct[Jt+1];ct[Jt]=ct[Nr-2-Jt],ct[Jt+1]=ct[Nr-1-Jt],ct[Nr-2-Jt]=Nn,ct[Nr-1-Jt]=Kt}}(ae,de),Y.push(ae)}}function Mr(Y,le){var ve=(le=this.options=function(ee,de){for(var Ae in de)ee[Ae]=de[Ae];return ee}(Object.create(this.options),le)).debug;if(ve&&console.time("preprocess data"),le.maxZoom<0||le.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(le.promoteId&&le.generateId)throw new Error("promoteId and generateId cannot be used together.");var B=function(ee,de){var Ae=[];if(ee.type==="FeatureCollection")for(var ae=0;ae<ee.features.length;ae++)w(Ae,ee.features[ae],de,ae);else w(Ae,ee.type==="Feature"?ee:{geometry:ee},de);return Ae}(Y,le);this.tiles={},this.tileCoords=[],ve&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",le.indexMaxZoom,le.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(B=function(ee,de){var Ae=de.buffer/de.extent,ae=ee,_e=$(ee,1,-1-Ae,Ae,0,-1,2,de),ct=$(ee,1,1-Ae,2+Ae,0,-1,2,de);return(_e||ct)&&(ae=$(ee,1,-Ae,1+Ae,0,-1,2,de)||[],_e&&(ae=xr(_e,1).concat(ae)),ct&&(ae=ae.concat(xr(ct,-1)))),ae}(B,le)).length&&this.splitTile(B,0,0,0),ve&&(B.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function gt(Y,le,ve){return 32*((1<<Y)*ve+le)+Y}function Gn(Y,le){var ve=Y.tileID.canonical;if(!this._geoJSONIndex)return le(null,null);var B=this._geoJSONIndex.getTile(ve.z,ve.x,ve.y);if(!B)return le(null,null);var ee=new St(B.features),de=wt(ee);de.byteOffset===0&&de.byteLength===de.buffer.byteLength||(de=new Uint8Array(de)),le(null,{vectorTile:ee,rawData:de.buffer})}En.prototype.load=function(Y){var le=this.options,ve=le.log,B=le.minZoom,ee=le.maxZoom,de=le.nodeSize;ve&&console.time("total time");var Ae="prepare "+Y.length+" points";ve&&console.time(Ae),this.points=Y;for(var ae=[],_e=0;_e<Y.length;_e++)Y[_e].geometry&&ae.push(ar(Y[_e],_e));this.trees[ee+1]=new Ur(ae,nr,dr,de,Float32Array),ve&&console.timeEnd(Ae);for(var ct=ee;ct>=B;ct--){var Sr=+Date.now();ae=this._cluster(ae,ct),this.trees[ct]=new Ur(ae,nr,dr,de,Float32Array),ve&&console.log("z%d: %d clusters in %dms",ct,ae.length,+Date.now()-Sr)}return ve&&console.timeEnd("total time"),this},En.prototype.getClusters=function(Y,le){var ve=((Y[0]+180)%360+360)%360-180,B=Math.max(-90,Math.min(90,Y[1])),ee=Y[2]===180?180:((Y[2]+180)%360+360)%360-180,de=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)ve=-180,ee=180;else if(ve>ee){var Ae=this.getClusters([ve,B,180,de],le),ae=this.getClusters([-180,B,ee,de],le);return Ae.concat(ae)}for(var _e=this.trees[this._limitZoom(le)],ct=[],Sr=0,Ht=_e.range(Ze(ve),Oe(de),Ze(ee),Oe(B));Sr<Ht.length;Sr+=1){var Jt=_e.points[Ht[Sr]];ct.push(Jt.numPoints?ge(Jt):this.points[Jt.index])}return ct},En.prototype.getChildren=function(Y){var le=this._getOriginId(Y),ve=this._getOriginZoom(Y),B="No cluster with the specified id.",ee=this.trees[ve];if(!ee)throw new Error(B);var de=ee.points[le];if(!de)throw new Error(B);for(var Ae=this.options.radius/(this.options.extent*Math.pow(2,ve-1)),ae=[],_e=0,ct=ee.within(de.x,de.y,Ae);_e<ct.length;_e+=1){var Sr=ee.points[ct[_e]];Sr.parentId===Y&&ae.push(Sr.numPoints?ge(Sr):this.points[Sr.index])}if(ae.length===0)throw new Error(B);return ae},En.prototype.getLeaves=function(Y,le,ve){var B=[];return this._appendLeaves(B,Y,le=le||10,ve=ve||0,0),B},En.prototype.getTile=function(Y,le,ve){var B=this.trees[this._limitZoom(Y)],ee=Math.pow(2,Y),de=this.options,Ae=de.radius/de.extent,ae=(ve-Ae)/ee,_e=(ve+1+Ae)/ee,ct={features:[]};return this._addTileFeatures(B.range((le-Ae)/ee,ae,(le+1+Ae)/ee,_e),B.points,le,ve,ee,ct),le===0&&this._addTileFeatures(B.range(1-Ae/ee,ae,1,_e),B.points,ee,ve,ee,ct),le===ee-1&&this._addTileFeatures(B.range(0,ae,Ae/ee,_e),B.points,-1,ve,ee,ct),ct.features.length?ct:null},En.prototype.getClusterExpansionZoom=function(Y){for(var le=this._getOriginZoom(Y)-1;le<=this.options.maxZoom;){var ve=this.getChildren(Y);if(le++,ve.length!==1)break;Y=ve[0].properties.cluster_id}return le},En.prototype._appendLeaves=function(Y,le,ve,B,ee){for(var de=0,Ae=this.getChildren(le);de<Ae.length;de+=1){var ae=Ae[de],_e=ae.properties;if(_e&&_e.cluster?ee+_e.point_count<=B?ee+=_e.point_count:ee=this._appendLeaves(Y,_e.cluster_id,ve,B,ee):ee<B?ee++:Y.push(ae),Y.length===ve)break}return ee},En.prototype._addTileFeatures=function(Y,le,ve,B,ee,de){for(var Ae=0,ae=Y;Ae<ae.length;Ae+=1){var _e=le[ae[Ae]],ct=_e.numPoints,Sr={type:1,geometry:[[Math.round(this.options.extent*(_e.x*ee-ve)),Math.round(this.options.extent*(_e.y*ee-B))]],tags:ct?Te(_e):this.points[_e.index].properties},Ht=void 0;ct?Ht=_e.id:this.options.generateId?Ht=_e.index:this.points[_e.index].id&&(Ht=this.points[_e.index].id),Ht!==void 0&&(Sr.id=Ht),de.features.push(Sr)}},En.prototype._limitZoom=function(Y){return Math.max(this.options.minZoom,Math.min(+Y,this.options.maxZoom+1))},En.prototype._cluster=function(Y,le){for(var ve=[],B=this.options,ee=B.reduce,de=B.minPoints,Ae=B.radius/(B.extent*Math.pow(2,le)),ae=0;ae<Y.length;ae++){var _e=Y[ae];if(!(_e.zoom<=le)){_e.zoom=le;for(var ct=this.trees[le+1],Sr=ct.within(_e.x,_e.y,Ae),Ht=_e.numPoints||1,Jt=Ht,Nr=0,zn=Sr;Nr<zn.length;Nr+=1){var Nn=ct.points[zn[Nr]];Nn.zoom>le&&(Jt+=Nn.numPoints||1)}if(Jt>=de){for(var Kt=_e.x*Ht,In=_e.y*Ht,hn=ee&&Ht>1?this._map(_e,!0):null,mn=(ae<<5)+(le+1)+this.points.length,Bi=0,An=Sr;Bi<An.length;Bi+=1){var Di=ct.points[An[Bi]];if(!(Di.zoom<=le)){Di.zoom=le;var ra=Di.numPoints||1;Kt+=Di.x*ra,In+=Di.y*ra,Di.parentId=mn,ee&&(hn||(hn=this._map(_e,!0)),ee(hn,this._map(Di)))}}_e.parentId=mn,ve.push(ea(Kt/Jt,In/Jt,mn,Jt,hn))}else if(ve.push(_e),Jt>1)for(var hi=0,na=Sr;hi<na.length;hi+=1){var Hi=ct.points[na[hi]];Hi.zoom<=le||(Hi.zoom=le,ve.push(Hi))}}}return ve},En.prototype._getOriginId=function(Y){return Y-this.points.length>>5},En.prototype._getOriginZoom=function(Y){return(Y-this.points.length)%32},En.prototype._map=function(Y,le){if(Y.numPoints)return le?Lt({},Y.properties):Y.properties;var ve=this.points[Y.index].properties,B=this.options.map(ve);return le&&B===ve?Lt({},B):B},Mr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Mr.prototype.splitTile=function(Y,le,ve,B,ee,de,Ae){for(var ae=[Y,le,ve,B],_e=this.options,ct=_e.debug;ae.length;){B=ae.pop(),ve=ae.pop(),le=ae.pop(),Y=ae.pop();var Sr=1<<le,Ht=gt(le,ve,B),Jt=this.tiles[Ht];if(!Jt&&(ct>1&&console.time("creation"),Jt=this.tiles[Ht]=Yr(Y,le,ve,B,_e),this.tileCoords.push({z:le,x:ve,y:B}),ct)){ct>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",le,ve,B,Jt.numFeatures,Jt.numPoints,Jt.numSimplified),console.timeEnd("creation"));var Nr="z"+le;this.stats[Nr]=(this.stats[Nr]||0)+1,this.total++}if(Jt.source=Y,ee){if(le===_e.maxZoom||le===ee)continue;var zn=1<<ee-le;if(ve!==Math.floor(de/zn)||B!==Math.floor(Ae/zn))continue}else if(le===_e.indexMaxZoom||Jt.numPoints<=_e.indexMaxPoints)continue;if(Jt.source=null,Y.length!==0){ct>1&&console.time("clipping");var Nn,Kt,In,hn,mn,Bi,An=.5*_e.buffer/_e.extent,Di=.5-An,ra=.5+An,hi=1+An;Nn=Kt=In=hn=null,mn=$(Y,Sr,ve-An,ve+ra,0,Jt.minX,Jt.maxX,_e),Bi=$(Y,Sr,ve+Di,ve+hi,0,Jt.minX,Jt.maxX,_e),Y=null,mn&&(Nn=$(mn,Sr,B-An,B+ra,1,Jt.minY,Jt.maxY,_e),Kt=$(mn,Sr,B+Di,B+hi,1,Jt.minY,Jt.maxY,_e),mn=null),Bi&&(In=$(Bi,Sr,B-An,B+ra,1,Jt.minY,Jt.maxY,_e),hn=$(Bi,Sr,B+Di,B+hi,1,Jt.minY,Jt.maxY,_e),Bi=null),ct>1&&console.timeEnd("clipping"),ae.push(Nn||[],le+1,2*ve,2*B),ae.push(Kt||[],le+1,2*ve,2*B+1),ae.push(In||[],le+1,2*ve+1,2*B),ae.push(hn||[],le+1,2*ve+1,2*B+1)}}},Mr.prototype.getTile=function(Y,le,ve){var B=this.options,ee=B.extent,de=B.debug;if(Y<0||Y>24)return null;var Ae=1<<Y,ae=gt(Y,le=(le%Ae+Ae)%Ae,ve);if(this.tiles[ae])return Ke(this.tiles[ae],ee);de>1&&console.log("drilling down to z%d-%d-%d",Y,le,ve);for(var _e,ct=Y,Sr=le,Ht=ve;!_e&&ct>0;)ct--,Sr=Math.floor(Sr/2),Ht=Math.floor(Ht/2),_e=this.tiles[gt(ct,Sr,Ht)];return _e&&_e.source?(de>1&&console.log("found parent tile z%d-%d-%d",ct,Sr,Ht),de>1&&console.time("drilling down"),this.splitTile(_e.source,ct,Sr,Ht,Y,le,ve),de>1&&console.timeEnd("drilling down"),this.tiles[ae]?Ke(this.tiles[ae],ee):null):null};var Mn=function(Y){function le(ve,B,ee,de){Y.call(this,ve,B,ee,Gn),de&&(this.loadGeoJSON=de)}return Y&&(le.__proto__=Y),(le.prototype=Object.create(Y&&Y.prototype)).constructor=le,le.prototype.loadData=function(ve,B){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=B,this._pendingLoadDataParams=ve,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},le.prototype._loadData=function(){var ve=this;if(this._pendingCallback&&this._pendingLoadDataParams){var B=this._pendingCallback,ee=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var de=!!(ee&&ee.request&&ee.request.collectResourceTiming)&&new d.RequestPerformance(ee.request);this.loadGeoJSON(ee,function(Ae,ae){if(Ae||!ae)return B(Ae);if(typeof ae!="object")return B(new Error("Input data given to '"+ee.source+"' is not a valid GeoJSON object."));(function Jt(Nr,zn){var Nn,Kt=Nr&&Nr.type;if(Kt==="FeatureCollection")for(Nn=0;Nn<Nr.features.length;Nn++)Jt(Nr.features[Nn],zn);else if(Kt==="GeometryCollection")for(Nn=0;Nn<Nr.geometries.length;Nn++)Jt(Nr.geometries[Nn],zn);else if(Kt==="Feature")Jt(Nr.geometry,zn);else if(Kt==="Polygon")Qt(Nr.coordinates,zn);else if(Kt==="MultiPolygon")for(Nn=0;Nn<Nr.coordinates.length;Nn++)Qt(Nr.coordinates[Nn],zn);return Nr})(ae,!0);try{if(ee.filter){var _e=d.createExpression(ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(_e.result==="error")throw new Error(_e.value.map(function(Jt){return Jt.key+": "+Jt.message}).join(", "));var ct=ae.features.filter(function(Jt){return _e.value.evaluate({zoom:0},Jt)});ae={type:"FeatureCollection",features:ct}}ve._geoJSONIndex=ee.cluster?new En(function(Jt){var Nr=Jt.superclusterOptions,zn=Jt.clusterProperties;if(!zn||!Nr)return Nr;for(var Nn={},Kt={},In={accumulated:null,zoom:0},hn={properties:null},mn=Object.keys(zn),Bi=0,An=mn;Bi<An.length;Bi+=1){var Di=An[Bi],ra=zn[Di],hi=ra[0],na=d.createExpression(ra[1]),Hi=d.createExpression(typeof hi=="string"?[hi,["accumulated"],["get",Di]]:hi);Nn[Di]=na.value,Kt[Di]=Hi.value}return Nr.map=function(Oi){hn.properties=Oi;for(var ga={},Ra=0,Wi=mn;Ra<Wi.length;Ra+=1){var Ni=Wi[Ra];ga[Ni]=Nn[Ni].evaluate(In,hn)}return ga},Nr.reduce=function(Oi,ga){hn.properties=ga;for(var Ra=0,Wi=mn;Ra<Wi.length;Ra+=1){var Ni=Wi[Ra];In.accumulated=Oi[Ni],Oi[Ni]=Kt[Ni].evaluate(In,hn)}},Nr}(ee)).load(ae.features):function(Jt,Nr){return new Mr(Jt,Nr)}(ae,ee.geojsonVtOptions)}catch(Jt){return B(Jt)}ve.loaded={};var Sr={};if(de){var Ht=de.finish();Ht&&(Sr.resourceTiming={},Sr.resourceTiming[ee.source]=JSON.parse(JSON.stringify(Ht)))}B(null,Sr)})}},le.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},le.prototype.reloadTile=function(ve,B){var ee=this.loaded;return ee&&ee[ve.uid]?Y.prototype.reloadTile.call(this,ve,B):this.loadTile(ve,B)},le.prototype.loadGeoJSON=function(ve,B){if(ve.request)d.getJSON(ve.request,B);else{if(typeof ve.data!="string")return B(new Error("Input data given to '"+ve.source+"' is not a valid GeoJSON object."));try{return B(null,JSON.parse(ve.data))}catch(ee){return B(new Error("Input data given to '"+ve.source+"' is not a valid GeoJSON object."))}}},le.prototype.removeSource=function(ve,B){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),B()},le.prototype.getClusterExpansionZoom=function(ve,B){try{B(null,this._geoJSONIndex.getClusterExpansionZoom(ve.clusterId))}catch(ee){B(ee)}},le.prototype.getClusterChildren=function(ve,B){try{B(null,this._geoJSONIndex.getChildren(ve.clusterId))}catch(ee){B(ee)}},le.prototype.getClusterLeaves=function(ve,B){try{B(null,this._geoJSONIndex.getLeaves(ve.clusterId,ve.limit,ve.offset))}catch(ee){B(ee)}},le}(mt),kr=function(Y){var le=this;this.self=Y,this.actor=new d.Actor(Y,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:mt,geojson:Mn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ve,B){if(le.workerSourceTypes[ve])throw new Error('Worker source with name "'+ve+'" already registered.');le.workerSourceTypes[ve]=B},this.self.registerRTLTextPlugin=function(ve){if(d.plugin.isParsed())throw new Error("RTL text plugin already registered.");d.plugin.applyArabicShaping=ve.applyArabicShaping,d.plugin.processBidirectionalText=ve.processBidirectionalText,d.plugin.processStyledBidirectionalText=ve.processStyledBidirectionalText}};return kr.prototype.setReferrer=function(Y,le){this.referrer=le},kr.prototype.setImages=function(Y,le,ve){for(var B in this.availableImages[Y]=le,this.workerSources[Y]){var ee=this.workerSources[Y][B];for(var de in ee)ee[de].availableImages=le}ve()},kr.prototype.setLayers=function(Y,le,ve){this.getLayerIndex(Y).replace(le),ve()},kr.prototype.updateLayers=function(Y,le,ve){this.getLayerIndex(Y).update(le.layers,le.removedIds),ve()},kr.prototype.loadTile=function(Y,le,ve){this.getWorkerSource(Y,le.type,le.source).loadTile(le,ve)},kr.prototype.loadDEMTile=function(Y,le,ve){this.getDEMWorkerSource(Y,le.source).loadTile(le,ve)},kr.prototype.reloadTile=function(Y,le,ve){this.getWorkerSource(Y,le.type,le.source).reloadTile(le,ve)},kr.prototype.abortTile=function(Y,le,ve){this.getWorkerSource(Y,le.type,le.source).abortTile(le,ve)},kr.prototype.removeTile=function(Y,le,ve){this.getWorkerSource(Y,le.type,le.source).removeTile(le,ve)},kr.prototype.removeDEMTile=function(Y,le){this.getDEMWorkerSource(Y,le.source).removeTile(le)},kr.prototype.removeSource=function(Y,le,ve){if(this.workerSources[Y]&&this.workerSources[Y][le.type]&&this.workerSources[Y][le.type][le.source]){var B=this.workerSources[Y][le.type][le.source];delete this.workerSources[Y][le.type][le.source],B.removeSource!==void 0?B.removeSource(le,ve):ve()}},kr.prototype.loadWorkerSource=function(Y,le,ve){try{this.self.importScripts(le.url),ve()}catch(B){ve(B.toString())}},kr.prototype.syncRTLPluginState=function(Y,le,ve){try{d.plugin.setState(le);var B=d.plugin.getPluginURL();if(d.plugin.isLoaded()&&!d.plugin.isParsed()&&B!=null){this.self.importScripts(B);var ee=d.plugin.isParsed();ve(ee?void 0:new Error("RTL Text Plugin failed to import scripts from "+B),ee)}}catch(de){ve(de.toString())}},kr.prototype.getAvailableImages=function(Y){var le=this.availableImages[Y];return le||(le=[]),le},kr.prototype.getLayerIndex=function(Y){var le=this.layerIndexes[Y];return le||(le=this.layerIndexes[Y]=new ue),le},kr.prototype.getWorkerSource=function(Y,le,ve){var B=this;return this.workerSources[Y]||(this.workerSources[Y]={}),this.workerSources[Y][le]||(this.workerSources[Y][le]={}),this.workerSources[Y][le][ve]||(this.workerSources[Y][le][ve]=new this.workerSourceTypes[le]({send:function(ee,de,Ae){B.actor.send(ee,de,Ae,Y)}},this.getLayerIndex(Y),this.getAvailableImages(Y))),this.workerSources[Y][le][ve]},kr.prototype.getDEMWorkerSource=function(Y,le){return this.demWorkerSources[Y]||(this.demWorkerSources[Y]={}),this.demWorkerSources[Y][le]||(this.demWorkerSources[Y][le]=new Cr),this.demWorkerSources[Y][le]},kr.prototype.enforceCacheSizeLimit=function(Y,le){d.enforceCacheSizeLimit(le)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new kr(self)),kr}),E(["./shared"],function(d){"use strict";var me=d.createCommonjsModule(function(i){function u(y){return!o(y)}function o(y){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var T,D,V=new Blob([""],{type:"text/javascript"}),se=URL.createObjectURL(V);try{D=new Worker(se),T=!0}catch(Ce){T=!1}return D&&D.terminate(),URL.revokeObjectURL(se),T}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var T=document.createElement("canvas");T.width=T.height=1;var D=T.getContext("2d");if(!D)return!1;var V=D.getImageData(0,0,1,1);return V&&V.width===T.width}()?(h[b=y&&y.failIfMajorPerformanceCaveat]===void 0&&(h[b]=function(T){var D=function(se){var Ce=document.createElement("canvas"),we=Object.create(u.webGLContextAttributes);return we.failIfMajorPerformanceCaveat=se,Ce.probablySupportsContext?Ce.probablySupportsContext("webgl",we)||Ce.probablySupportsContext("experimental-webgl",we):Ce.supportsContext?Ce.supportsContext("webgl",we)||Ce.supportsContext("experimental-webgl",we):Ce.getContext("webgl",we)||Ce.getContext("experimental-webgl",we)}(T);if(!D)return!1;var V=D.createShader(D.VERTEX_SHADER);return!(!V||D.isContextLost())&&(D.shaderSource(V,"void main() {}"),D.compileShader(V),D.getShaderParameter(V,D.COMPILE_STATUS)===!0)}(b)),h[b]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var b}i.exports?i.exports=u:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=u,window.mapboxgl.notSupportedReason=o);var h={};u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),te={create:function(i,u,o){var h=d.window.document.createElement(i);return u!==void 0&&(h.className=u),o&&o.appendChild(h),h},createNS:function(i,u){return d.window.document.createElementNS(i,u)}},ue=d.window.document&&d.window.document.documentElement.style;function oe(i){if(!ue)return i[0];for(var u=0;u<i.length;u++)if(i[u]in ue)return i[u];return i[0]}var Ne,K=oe(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);te.disableDrag=function(){ue&&K&&(Ne=ue[K],ue[K]="none")},te.enableDrag=function(){ue&&K&&(ue[K]=Ne)};var Qe=oe(["transform","WebkitTransform"]);te.setTransform=function(i,u){i.style[Qe]=u};var mt=!1;try{var Zt=Object.defineProperty({},"passive",{get:function(){mt=!0}});d.window.addEventListener("test",Zt,Zt),d.window.removeEventListener("test",Zt,Zt)}catch(i){mt=!1}te.addEventListener=function(i,u,o,h){h===void 0&&(h={}),i.addEventListener(u,o,"passive"in h&&mt?h:h.capture)},te.removeEventListener=function(i,u,o,h){h===void 0&&(h={}),i.removeEventListener(u,o,"passive"in h&&mt?h:h.capture)};var Cr=function(i){i.preventDefault(),i.stopPropagation(),d.window.removeEventListener("click",Cr,!0)};function Qt(i){var u=i.userImage;return!!(u&&u.render&&u.render())&&(i.data.replace(new Uint8Array(u.data.buffer)),!0)}te.suppressClick=function(){d.window.addEventListener("click",Cr,!0),d.window.setTimeout(function(){d.window.removeEventListener("click",Cr,!0)},0)},te.mousePos=function(i,u){var o=i.getBoundingClientRect();return new d.Point(u.clientX-o.left-i.clientLeft,u.clientY-o.top-i.clientTop)},te.touchPos=function(i,u){for(var o=i.getBoundingClientRect(),h=[],y=0;y<u.length;y++)h.push(new d.Point(u[y].clientX-o.left-i.clientLeft,u[y].clientY-o.top-i.clientTop));return h},te.mouseButton=function(i){return d.window.InstallTrigger!==void 0&&i.button===2&&i.ctrlKey&&d.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:i.button},te.remove=function(i){i.parentNode&&i.parentNode.removeChild(i)};var Xt=function(i){function u(){i.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.RGBAImage({width:1,height:1}),this.dirty=!0}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.isLoaded=function(){return this.loaded},u.prototype.setLoaded=function(o){if(this.loaded!==o&&(this.loaded=o,o)){for(var h=0,y=this.requestors;h<y.length;h+=1){var b=y[h];this._notify(b.ids,b.callback)}this.requestors=[]}},u.prototype.getImage=function(o){return this.images[o]},u.prototype.addImage=function(o,h){this._validate(o,h)&&(this.images[o]=h)},u.prototype._validate=function(o,h){var y=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new d.ErrorEvent(new Error('Image "'+o+'" has invalid "stretchX" value'))),y=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new d.ErrorEvent(new Error('Image "'+o+'" has invalid "stretchY" value'))),y=!1),this._validateContent(h.content,h)||(this.fire(new d.ErrorEvent(new Error('Image "'+o+'" has invalid "content" value'))),y=!1),y},u.prototype._validateStretch=function(o,h){if(!o)return!0;for(var y=0,b=0,T=o;b<T.length;b+=1){var D=T[b];if(D[0]<y||D[1]<D[0]||h<D[1])return!1;y=D[1]}return!0},u.prototype._validateContent=function(o,h){return!(o&&(o.length!==4||o[0]<0||h.data.width<o[0]||o[1]<0||h.data.height<o[1]||o[2]<0||h.data.width<o[2]||o[3]<0||h.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))},u.prototype.updateImage=function(o,h){h.version=this.images[o].version+1,this.images[o]=h,this.updatedImages[o]=!0},u.prototype.removeImage=function(o){var h=this.images[o];delete this.images[o],delete this.patterns[o],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()},u.prototype.listImages=function(){return Object.keys(this.images)},u.prototype.getImages=function(o,h){var y=!0;if(!this.isLoaded())for(var b=0,T=o;b<T.length;b+=1)this.images[T[b]]||(y=!1);this.isLoaded()||y?this._notify(o,h):this.requestors.push({ids:o,callback:h})},u.prototype._notify=function(o,h){for(var y={},b=0,T=o;b<T.length;b+=1){var D=T[b];this.images[D]||this.fire(new d.Event("styleimagemissing",{id:D}));var V=this.images[D];V?y[D]={data:V.data.clone(),pixelRatio:V.pixelRatio,sdf:V.sdf,version:V.version,stretchX:V.stretchX,stretchY:V.stretchY,content:V.content,hasRenderCallback:Boolean(V.userImage&&V.userImage.render)}:d.warnOnce('Image "'+D+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}h(null,y)},u.prototype.getPixelSize=function(){var o=this.atlasImage;return{width:o.width,height:o.height}},u.prototype.getPattern=function(o){var h=this.patterns[o],y=this.getImage(o);if(!y)return null;if(h&&h.position.version===y.version)return h.position;if(h)h.position.version=y.version;else{var b={w:y.data.width+2,h:y.data.height+2,x:0,y:0},T=new d.ImagePosition(b,y);this.patterns[o]={bin:b,position:T}}return this._updatePatternAtlas(),this.patterns[o].position},u.prototype.bind=function(o){var h=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.Texture(o,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)},u.prototype._updatePatternAtlas=function(){var o=[];for(var h in this.patterns)o.push(this.patterns[h].bin);var y=d.potpack(o),b=y.w,T=y.h,D=this.atlasImage;for(var V in D.resize({width:b||1,height:T||1}),this.patterns){var se=this.patterns[V].bin,Ce=se.x+1,we=se.y+1,Pe=this.images[V].data,He=Pe.width,Ge=Pe.height;d.RGBAImage.copy(Pe,D,{x:0,y:0},{x:Ce,y:we},{width:He,height:Ge}),d.RGBAImage.copy(Pe,D,{x:0,y:Ge-1},{x:Ce,y:we-1},{width:He,height:1}),d.RGBAImage.copy(Pe,D,{x:0,y:0},{x:Ce,y:we+Ge},{width:He,height:1}),d.RGBAImage.copy(Pe,D,{x:He-1,y:0},{x:Ce-1,y:we},{width:1,height:Ge}),d.RGBAImage.copy(Pe,D,{x:0,y:0},{x:Ce+He,y:we},{width:1,height:Ge})}this.dirty=!0},u.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},u.prototype.dispatchRenderCallbacks=function(o){for(var h=0,y=o;h<y.length;h+=1){var b=y[h];if(!this.callbackDispatchedThisFrame[b]){this.callbackDispatchedThisFrame[b]=!0;var T=this.images[b];Qt(T)&&this.updateImage(b,T)}}},u}(d.Evented),rr=Et,Ut=Et,St=1e20;function Et(i,u,o,h,y,b){this.fontSize=i||24,this.buffer=u===void 0?3:u,this.cutoff=h||.25,this.fontFamily=y||"sans-serif",this.fontWeight=b||"normal",this.radius=o||8;var T=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=T,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.d=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Int16Array(T),this.middle=Math.round(T/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function yr(i,u,o,h,y,b,T){for(var D=0;D<u;D++){for(var V=0;V<o;V++)h[V]=i[V*u+D];for(q(h,y,b,T,o),V=0;V<o;V++)i[V*u+D]=y[V]}for(V=0;V<o;V++){for(D=0;D<u;D++)h[D]=i[V*u+D];for(q(h,y,b,T,u),D=0;D<u;D++)i[V*u+D]=Math.sqrt(y[D])}}function q(i,u,o,h,y){o[0]=0,h[0]=-St,h[1]=+St;for(var b=1,T=0;b<y;b++){for(var D=(i[b]+b*b-(i[o[T]]+o[T]*o[T]))/(2*b-2*o[T]);D<=h[T];)T--,D=(i[b]+b*b-(i[o[T]]+o[T]*o[T]))/(2*b-2*o[T]);o[++T]=b,h[T]=D,h[T+1]=+St}for(b=0,T=0;b<y;b++){for(;h[T+1]<b;)T++;u[b]=(b-o[T])*(b-o[T])+i[o[T]]}}Et.prototype.draw=function(i){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(i,this.buffer,this.middle);for(var u=this.ctx.getImageData(0,0,this.size,this.size),o=new Uint8ClampedArray(this.size*this.size),h=0;h<this.size*this.size;h++){var y=u.data[4*h+3]/255;this.gridOuter[h]=y===1?0:y===0?St:Math.pow(Math.max(0,.5-y),2),this.gridInner[h]=y===1?St:y===0?0:Math.pow(Math.max(0,y-.5),2)}for(yr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),yr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),h=0;h<this.size*this.size;h++)o[h]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[h]-this.gridInner[h])/this.radius+this.cutoff))));return o},rr.default=Ut;var hr=function(i,u){this.requestManager=i,this.localIdeographFontFamily=u,this.entries={}};hr.prototype.setURL=function(i){this.url=i},hr.prototype.getGlyphs=function(i,u){var o=this,h=[];for(var y in i)for(var b=0,T=i[y];b<T.length;b+=1)h.push({stack:y,id:T[b]});d.asyncAll(h,function(D,V){var se=D.stack,Ce=D.id,we=o.entries[se];we||(we=o.entries[se]={glyphs:{},requests:{},ranges:{}});var Pe=we.glyphs[Ce];if(Pe===void 0){if(Pe=o._tinySDF(we,se,Ce))return we.glyphs[Ce]=Pe,void V(null,{stack:se,id:Ce,glyph:Pe});var He=Math.floor(Ce/256);if(256*He>65535)V(new Error("glyphs > 65535 not supported"));else if(we.ranges[He])V(null,{stack:se,id:Ce,glyph:Pe});else{var Ge=we.requests[He];Ge||(Ge=we.requests[He]=[],hr.loadGlyphRange(se,He,o.url,o.requestManager,function(nt,ze){if(ze){for(var it in ze)o._doesCharSupportLocalGlyph(+it)||(we.glyphs[+it]=ze[+it]);we.ranges[He]=!0}for(var bt=0,Vt=Ge;bt<Vt.length;bt+=1)(0,Vt[bt])(nt,ze);delete we.requests[He]})),Ge.push(function(nt,ze){nt?V(nt):ze&&V(null,{stack:se,id:Ce,glyph:ze[Ce]||null})})}}else V(null,{stack:se,id:Ce,glyph:Pe})},function(D,V){if(D)u(D);else if(V){for(var se={},Ce=0,we=V;Ce<we.length;Ce+=1){var Pe=we[Ce],He=Pe.stack,Ge=Pe.id,nt=Pe.glyph;(se[He]||(se[He]={}))[Ge]=nt&&{id:nt.id,bitmap:nt.bitmap.clone(),metrics:nt.metrics}}u(null,se)}})},hr.prototype._doesCharSupportLocalGlyph=function(i){return!!this.localIdeographFontFamily&&(d.isChar["CJK Unified Ideographs"](i)||d.isChar["Hangul Syllables"](i)||d.isChar.Hiragana(i)||d.isChar.Katakana(i))},hr.prototype._tinySDF=function(i,u,o){var h=this.localIdeographFontFamily;if(h&&this._doesCharSupportLocalGlyph(o)){var y=i.tinySDF;if(!y){var b="400";/bold/i.test(u)?b="900":/medium/i.test(u)?b="500":/light/i.test(u)&&(b="200"),y=i.tinySDF=new hr.TinySDF(24,3,8,.25,h,b)}return{id:o,bitmap:new d.AlphaImage({width:30,height:30},y.draw(String.fromCharCode(o))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},hr.loadGlyphRange=function(i,u,o,h,y){var b=256*u,T=b+255,D=h.transformRequest(h.normalizeGlyphsURL(o).replace("{fontstack}",i).replace("{range}",b+"-"+T),d.ResourceType.Glyphs);d.getArrayBuffer(D,function(V,se){if(V)y(V);else if(se){for(var Ce={},we=0,Pe=d.parseGlyphPBF(se);we<Pe.length;we+=1){var He=Pe[we];Ce[He.id]=He}y(null,Ce)}})},hr.TinySDF=rr;var wt=function(){this.specification=d.styleSpec.light.position};wt.prototype.possiblyEvaluate=function(i,u){return d.sphericalToCartesian(i.expression.evaluate(u))},wt.prototype.interpolate=function(i,u,o){return{x:d.number(i.x,u.x,o),y:d.number(i.y,u.y,o),z:d.number(i.z,u.z,o)}};var $e=new d.Properties({anchor:new d.DataConstantProperty(d.styleSpec.light.anchor),position:new wt,color:new d.DataConstantProperty(d.styleSpec.light.color),intensity:new d.DataConstantProperty(d.styleSpec.light.intensity)}),Ft=function(i){function u(o){i.call(this),this._transitionable=new d.Transitionable($e),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getLight=function(){return this._transitionable.serialize()},u.prototype.setLight=function(o,h){if(h===void 0&&(h={}),!this._validate(d.validateLight,o,h))for(var y in o){var b=o[y];d.endsWith(y,"-transition")?this._transitionable.setTransition(y.slice(0,-"-transition".length),b):this._transitionable.setValue(y,b)}},u.prototype.updateTransitions=function(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)},u.prototype.hasTransition=function(){return this._transitioning.hasTransition()},u.prototype.recalculate=function(o){this.properties=this._transitioning.possiblyEvaluate(o)},u.prototype._validate=function(o,h,y){return(!y||y.validate!==!1)&&d.emitValidationErrors(this,o.call(d.validateStyle,d.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:d.styleSpec})))},u}(d.Evented),Xe=function(i,u){this.width=i,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Xe.prototype.getDash=function(i,u){var o=i.join(",")+String(u);return this.dashEntry[o]||(this.dashEntry[o]=this.addDash(i,u)),this.dashEntry[o]},Xe.prototype.getDashRanges=function(i,u,o){var h=[],y=i.length%2==1?-i[i.length-1]*o:0,b=i[0]*o,T=!0;h.push({left:y,right:b,isDash:T,zeroLength:i[0]===0});for(var D=i[0],V=1;V<i.length;V++){var se=i[V];h.push({left:y=D*o,right:b=(D+=se)*o,isDash:T=!T,zeroLength:se===0})}return h},Xe.prototype.addRoundDash=function(i,u,o){for(var h=u/2,y=-o;y<=o;y++)for(var b=this.width*(this.nextRow+o+y),T=0,D=i[T],V=0;V<this.width;V++){V/D.right>1&&(D=i[++T]);var se=Math.abs(V-D.left),Ce=Math.abs(V-D.right),we=Math.min(se,Ce),Pe=void 0,He=y/o*(h+1);if(D.isDash){var Ge=h-Math.abs(He);Pe=Math.sqrt(we*we+Ge*Ge)}else Pe=h-Math.sqrt(we*we+He*He);this.data[b+V]=Math.max(0,Math.min(255,Pe+128))}},Xe.prototype.addRegularDash=function(i){for(var u=i.length-1;u>=0;--u){var o=i[u],h=i[u+1];o.zeroLength?i.splice(u,1):h&&h.isDash===o.isDash&&(h.left=o.left,i.splice(u,1))}var y=i[0],b=i[i.length-1];y.isDash===b.isDash&&(y.left=b.left-this.width,b.right=y.right+this.width);for(var T=this.width*this.nextRow,D=0,V=i[D],se=0;se<this.width;se++){se/V.right>1&&(V=i[++D]);var Ce=Math.abs(se-V.left),we=Math.abs(se-V.right),Pe=Math.min(Ce,we);this.data[T+se]=Math.max(0,Math.min(255,(V.isDash?Pe:-Pe)+128))}},Xe.prototype.addDash=function(i,u){var o=u?7:0,h=2*o+1;if(this.nextRow+h>this.height)return d.warnOnce("LineAtlas out of space"),null;for(var y=0,b=0;b<i.length;b++)y+=i[b];if(y!==0){var T=this.width/y,D=this.getDashRanges(i,this.width,T);u?this.addRoundDash(D,T,o):this.addRegularDash(D)}var V={y:(this.nextRow+o+.5)/this.height,height:2*o/this.height,width:y};return this.nextRow+=h,this.dirty=!0,V},Xe.prototype.bind=function(i){var u=i.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))};var jt=function i(u,o){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=d.uniqueId();for(var h=this.workerPool.acquire(this.id),y=0;y<h.length;y++){var b=new i.Actor(h[y],o,this.id);b.name="Worker "+y,this.actors.push(b)}};function br(i,u,o){var h=function(y,b){if(y)return o(y);if(b){var T=d.pick(d.extend(b,i),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(T.vectorLayers=b.vector_layers,T.vectorLayerIds=T.vectorLayers.map(function(D){return D.id})),T.tiles=u.canonicalizeTileset(T,i.url),o(null,T)}};return i.url?d.getJSON(u.transformRequest(u.normalizeSourceURL(i.url),d.ResourceType.Source),h):d.browser.frame(function(){return h(null,i)})}jt.prototype.broadcast=function(i,u,o){d.asyncAll(this.actors,function(h,y){h.send(i,u,y)},o=o||function(){})},jt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},jt.prototype.remove=function(){this.actors.forEach(function(i){i.remove()}),this.actors=[],this.workerPool.release(this.id)},jt.Actor=d.Actor;var sr=function(i,u,o){this.bounds=d.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=u||0,this.maxzoom=o||24};sr.prototype.validateBounds=function(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]},sr.prototype.contains=function(i){var u=Math.pow(2,i.z),o=Math.floor(d.mercatorXfromLng(this.bounds.getWest())*u),h=Math.floor(d.mercatorYfromLat(this.bounds.getNorth())*u),y=Math.ceil(d.mercatorXfromLng(this.bounds.getEast())*u),b=Math.ceil(d.mercatorYfromLat(this.bounds.getSouth())*u);return i.x>=o&&i.x<y&&i.y>=h&&i.y<b};var j=function(i){function u(o,h,y,b){if(i.call(this),this.id=o,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.extend(this,d.pick(h,["url","scheme","tileSize","promoteId"])),this._options=d.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=br(this._options,this.map._requestManager,function(h,y){o._tileJSONRequest=null,o._loaded=!0,h?o.fire(new d.ErrorEvent(h)):y&&(d.extend(o,y),y.bounds&&(o.tileBounds=new sr(y.bounds,o.minzoom,o.maxzoom)),d.postTurnstileEvent(y.tiles,o.map._requestManager._customAccessToken),d.postMapLoadEvent(y.tiles,o.map._getMapId(),o.map._requestManager._skuToken,o.map._requestManager._customAccessToken),o.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),o.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.hasTile=function(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.setSourceProperty=function(o){this._tileJSONRequest&&this._tileJSONRequest.cancel(),o(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},u.prototype.setTiles=function(o){var h=this;return this.setSourceProperty(function(){h._options.tiles=o}),this},u.prototype.setUrl=function(o){var h=this;return this.setSourceProperty(function(){h.url=o,h._options.url=o}),this},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return d.extend({},this._options)},u.prototype.loadTile=function(o,h){var y=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme)),b={request:this.map._requestManager.transformRequest(y,d.ResourceType.Tile),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:d.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function T(D,V){return delete o.request,o.aborted?h(null):D&&D.status!==404?h(D):(V&&V.resourceTiming&&(o.resourceTiming=V.resourceTiming),this.map._refreshExpiredTiles&&V&&o.setExpiryData(V),o.loadVectorData(V,this.map.painter),d.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}b.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired"?o.state==="loading"?o.reloadCallback=h:o.request=o.actor.send("reloadTile",b,T.bind(this)):(o.actor=this.dispatcher.getActor(),o.request=o.actor.send("loadTile",b,T.bind(this)))},u.prototype.abortTile=function(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id},void 0)},u.prototype.unloadTile=function(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id},void 0)},u.prototype.hasTransition=function(){return!1},u}(d.Evented),ie=function(i){function u(o,h,y,b){i.call(this),this.id=o,this.dispatcher=y,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.extend({type:"raster"},h),d.extend(this,d.pick(h,["url","scheme","tileSize"]))}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=br(this._options,this.map._requestManager,function(h,y){o._tileJSONRequest=null,o._loaded=!0,h?o.fire(new d.ErrorEvent(h)):y&&(d.extend(o,y),y.bounds&&(o.tileBounds=new sr(y.bounds,o.minzoom,o.maxzoom)),d.postTurnstileEvent(y.tiles),d.postMapLoadEvent(y.tiles,o.map._getMapId(),o.map._requestManager._skuToken),o.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),o.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return d.extend({},this._options)},u.prototype.hasTile=function(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)},u.prototype.loadTile=function(o,h){var y=this,b=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);o.request=d.getImage(this.map._requestManager.transformRequest(b,d.ResourceType.Tile),function(T,D){if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(T)o.state="errored",h(T);else if(D){y.map._refreshExpiredTiles&&o.setExpiryData(D),delete D.cacheControl,delete D.expires;var V=y.map.painter.context,se=V.gl;o.texture=y.map.painter.getTileTexture(D.width),o.texture?o.texture.update(D,{useMipmap:!0}):(o.texture=new d.Texture(V,D,se.RGBA,{useMipmap:!0}),o.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE,se.LINEAR_MIPMAP_NEAREST),V.extTextureFilterAnisotropic&&se.texParameterf(se.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax)),o.state="loaded",d.cacheEntryPossiblyAdded(y.dispatcher),h(null)}})},u.prototype.abortTile=function(o,h){o.request&&(o.request.cancel(),delete o.request),h()},u.prototype.unloadTile=function(o,h){o.texture&&this.map.painter.saveTileTexture(o.texture),h()},u.prototype.hasTransition=function(){return!1},u}(d.Evented),Re=function(i){function u(o,h,y,b){i.call(this,o,h,y,b),this.type="raster-dem",this.maxzoom=22,this._options=d.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},u.prototype.loadTile=function(o,h){var y=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function b(T,D){T&&(o.state="errored",h(T)),D&&(o.dem=D,o.needsHillshadePrepare=!0,o.state="loaded",h(null))}o.request=d.getImage(this.map._requestManager.transformRequest(y,d.ResourceType.Tile),function(T,D){if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(T)o.state="errored",h(T);else if(D){this.map._refreshExpiredTiles&&o.setExpiryData(D),delete D.cacheControl,delete D.expires;var V=d.window.ImageBitmap&&D instanceof d.window.ImageBitmap&&d.offscreenCanvasSupported()?D:d.browser.getImageData(D,1),se={uid:o.uid,coord:o.tileID,source:this.id,rawImageData:V,encoding:this.encoding};o.actor&&o.state!=="expired"||(o.actor=this.dispatcher.getActor(),o.actor.send("loadDEMTile",se,b.bind(this)))}}.bind(this)),o.neighboringTiles=this._getNeighboringTiles(o.tileID)},u.prototype._getNeighboringTiles=function(o){var h=o.canonical,y=Math.pow(2,h.z),b=(h.x-1+y)%y,T=h.x===0?o.wrap-1:o.wrap,D=(h.x+1+y)%y,V=h.x+1===y?o.wrap+1:o.wrap,se={};return se[new d.OverscaledTileID(o.overscaledZ,T,h.z,b,h.y).key]={backfilled:!1},se[new d.OverscaledTileID(o.overscaledZ,V,h.z,D,h.y).key]={backfilled:!1},h.y>0&&(se[new d.OverscaledTileID(o.overscaledZ,T,h.z,b,h.y-1).key]={backfilled:!1},se[new d.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},se[new d.OverscaledTileID(o.overscaledZ,V,h.z,D,h.y-1).key]={backfilled:!1}),h.y+1<y&&(se[new d.OverscaledTileID(o.overscaledZ,T,h.z,b,h.y+1).key]={backfilled:!1},se[new d.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},se[new d.OverscaledTileID(o.overscaledZ,V,h.z,D,h.y+1).key]={backfilled:!1}),se},u.prototype.unloadTile=function(o){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&o.actor.send("removeDEMTile",{uid:o.uid,source:this.id})},u}(ie),ye=function(i){function u(o,h,y,b){i.call(this),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=y.getActor(),this.setEventedParent(b),this._data=h.data,this._options=d.extend({},h),this._collectResourceTiming=h.collectResourceTiming,this._resourceTiming=[],h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;var T=d.EXTENT/this.tileSize;this.workerOptions=d.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*T,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*T,extent:d.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?Math.min(h.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:d.EXTENT,radius:(h.clusterRadius||50)*T,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this.fire(new d.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(h){if(h)o.fire(new d.ErrorEvent(h));else{var y={dataType:"source",sourceDataType:"metadata"};o._collectResourceTiming&&o._resourceTiming&&o._resourceTiming.length>0&&(y.resourceTiming=o._resourceTiming,o._resourceTiming=[]),o.fire(new d.Event("data",y))}})},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.setData=function(o){var h=this;return this._data=o,this.fire(new d.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(y){if(y)h.fire(new d.ErrorEvent(y));else{var b={dataType:"source",sourceDataType:"content"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(b.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new d.Event("data",b))}}),this},u.prototype.getClusterExpansionZoom=function(o,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:o,source:this.id},h),this},u.prototype.getClusterChildren=function(o,h){return this.actor.send("geojson.getClusterChildren",{clusterId:o,source:this.id},h),this},u.prototype.getClusterLeaves=function(o,h,y,b){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:o,limit:h,offset:y},b),this},u.prototype._updateWorkerData=function(o){var h=this;this._loaded=!1;var y=d.extend({},this.workerOptions),b=this._data;typeof b=="string"?(y.request=this.map._requestManager.transformRequest(d.browser.resolveURL(b),d.ResourceType.Source),y.request.collectResourceTiming=this._collectResourceTiming):y.data=JSON.stringify(b),this.actor.send(this.type+".loadData",y,function(T,D){h._removed||D&&D.abandoned||(h._loaded=!0,D&&D.resourceTiming&&D.resourceTiming[h.id]&&(h._resourceTiming=D.resourceTiming[h.id].slice(0)),h.actor.send(h.type+".coalesce",{source:y.source},null),o(T))})},u.prototype.loaded=function(){return this._loaded},u.prototype.loadTile=function(o,h){var y=this,b=o.actor?"reloadTile":"loadTile";o.actor=this.actor,o.request=this.actor.send(b,{type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:d.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(T,D){return delete o.request,o.unloadVectorData(),o.aborted?h(null):T?h(T):(o.loadVectorData(D,y.map.painter,b==="reloadTile"),h(null))})},u.prototype.abortTile=function(o){o.request&&(o.request.cancel(),delete o.request),o.aborted=!0},u.prototype.unloadTile=function(o){o.unloadVectorData(),this.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})},u.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},u.prototype.serialize=function(){return d.extend({},this._options,{type:this.type,data:this._data})},u.prototype.hasTransition=function(){return!1},u}(d.Evented),_t=d.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),dt=function(i){function u(o,h,y,b){i.call(this),this.id=o,this.dispatcher=y,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(o,h){var y=this;this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this.url=this.options.url,d.getImage(this.map._requestManager.transformRequest(this.url,d.ResourceType.Image),function(b,T){y._loaded=!0,b?y.fire(new d.ErrorEvent(b)):T&&(y.image=T,o&&(y.coordinates=o),h&&h(),y._finishLoading())})},u.prototype.loaded=function(){return this._loaded},u.prototype.updateImage=function(o){var h=this;return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,function(){h.texture=null}),this):this},u.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})))},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.setCoordinates=function(o){var h=this;this.coordinates=o;var y=o.map(d.MercatorCoordinate.fromLngLat);this.tileID=function(T){for(var D=1/0,V=1/0,se=-1/0,Ce=-1/0,we=0,Pe=T;we<Pe.length;we+=1){var He=Pe[we];D=Math.min(D,He.x),V=Math.min(V,He.y),se=Math.max(se,He.x),Ce=Math.max(Ce,He.y)}var Ge=Math.max(se-D,Ce-V),nt=Math.max(0,Math.floor(-Math.log(Ge)/Math.LN2)),ze=Math.pow(2,nt);return new d.CanonicalTileID(nt,Math.floor((D+se)/2*ze),Math.floor((V+Ce)/2*ze))}(y),this.minzoom=this.maxzoom=this.tileID.z;var b=y.map(function(T){return h.tileID.getTilePoint(T)._round()});return this._boundsArray=new d.StructArrayLayout4i8,this._boundsArray.emplaceBack(b[0].x,b[0].y,0,0),this._boundsArray.emplaceBack(b[1].x,b[1].y,d.EXTENT,0),this._boundsArray.emplaceBack(b[3].x,b[3].y,0,d.EXTENT),this._boundsArray.emplaceBack(b[2].x,b[2].y,d.EXTENT,d.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})),this},u.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var o=this.map.painter.context,h=o.gl;for(var y in this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new d.Texture(o,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var b=this.tiles[y];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture)}}},u.prototype.loadTile=function(o,h){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},h(null)):(o.state="errored",h(null))},u.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return!1},u}(d.Evented),zt=function(i){function u(o,h,y,b){i.call(this,o,h,y,b),this.roundZoom=!0,this.type="video",this.options=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this._loaded=!1;var h=this.options;this.urls=[];for(var y=0,b=h.urls;y<b.length;y+=1)this.urls.push(this.map._requestManager.transformRequest(b[y],d.ResourceType.Source).url);d.getVideo(this.urls,function(T,D){o._loaded=!0,T?o.fire(new d.ErrorEvent(T)):D&&(o.video=D,o.video.loop=!0,o.video.addEventListener("playing",function(){o.map.triggerRepaint()}),o.map&&o.video.play(),o._finishLoading())})},u.prototype.pause=function(){this.video&&this.video.pause()},u.prototype.play=function(){this.video&&this.video.play()},u.prototype.seek=function(o){if(this.video){var h=this.video.seekable;o<h.start(0)||o>h.end(0)?this.fire(new d.ErrorEvent(new d.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+h.start(0)+" and "+h.end(0)+"-second mark."))):this.video.currentTime=o}},u.prototype.getVideo=function(){return this.video},u.prototype.onAdd=function(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},u.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var o=this.map.painter.context,h=o.gl;for(var y in this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new d.Texture(o,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var b=this.tiles[y];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this.video&&!this.video.paused},u}(dt),Bt=function(i){function u(o,h,y,b){i.call(this,o,h,y,b),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(function(T){return!Array.isArray(T)||T.length!==2||T.some(function(D){return typeof D!="number"})})||this.fire(new d.ErrorEvent(new d.ValidationError("sources."+o,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.ErrorEvent(new d.ValidationError("sources."+o,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new d.ErrorEvent(new d.ValidationError("sources."+o,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof d.window.HTMLCanvasElement||this.fire(new d.ErrorEvent(new d.ValidationError("sources."+o,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.ErrorEvent(new d.ValidationError("sources."+o,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof d.window.HTMLCanvasElement?this.options.canvas:d.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},u.prototype.getCanvas=function(){return this.canvas},u.prototype.onAdd=function(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()},u.prototype.onRemove=function(){this.pause()},u.prototype.prepare=function(){var o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var h=this.map.painter.context,y=h.gl;for(var b in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.Texture(h,this.canvas,y.RGBA,{premultiply:!0}),this.tiles){var T=this.tiles[b];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this._playing},u.prototype._hasInvalidDimensions=function(){for(var o=0,h=[this.canvas.width,this.canvas.height];o<h.length;o+=1){var y=h[o];if(isNaN(y)||y<=0)return!0}return!1},u}(dt),Ur={vector:j,raster:ie,"raster-dem":Re,geojson:ye,video:zt,image:dt,canvas:Bt};function vn(i,u){var o=d.identity([]);return d.translate(o,o,[1,1,0]),d.scale(o,o,[.5*i.width,.5*i.height,1]),d.multiply(o,o,i.calculatePosMatrix(u.toUnwrapped()))}function En(i,u,o,h,y,b){var T=function(nt,ze,it){if(nt)for(var bt=0,Vt=nt;bt<Vt.length;bt+=1){var gr=ze[Vt[bt]];if(gr&&gr.source===it&&gr.type==="fill-extrusion")return!0}else for(var fr in ze){var Er=ze[fr];if(Er.source===it&&Er.type==="fill-extrusion")return!0}return!1}(y&&y.layers,u,i.id),D=b.maxPitchScaleFactor(),V=i.tilesIn(h,D,T);V.sort(ea);for(var se=[],Ce=0,we=V;Ce<we.length;Ce+=1){var Pe=we[Ce];se.push({wrappedTileID:Pe.tileID.wrapped().key,queryResults:Pe.tile.queryRenderedFeatures(u,o,i._state,Pe.queryGeometry,Pe.cameraQueryGeometry,Pe.scale,y,b,D,vn(i.transform,Pe.tileID))})}var He=function(nt){for(var ze={},it={},bt=0,Vt=nt;bt<Vt.length;bt+=1){var gr=Vt[bt],fr=gr.queryResults,Er=gr.wrappedTileID,jr=it[Er]=it[Er]||{};for(var fn in fr)for(var tn=fr[fn],Zn=jr[fn]=jr[fn]||{},si=ze[fn]=ze[fn]||[],ui=0,dn=tn;ui<dn.length;ui+=1){var ia=dn[ui];Zn[ia.featureIndex]||(Zn[ia.featureIndex]=!0,si.push(ia))}}return ze}(se);for(var Ge in He)He[Ge].forEach(function(nt){var ze=nt.feature,it=i.getFeatureState(ze.layer["source-layer"],ze.id);ze.source=ze.layer.source,ze.layer["source-layer"]&&(ze.sourceLayer=ze.layer["source-layer"]),ze.state=it});return He}function ea(i,u){var o=i.tileID,h=u.tileID;return o.overscaledZ-h.overscaledZ||o.canonical.y-h.canonical.y||o.wrap-h.wrap||o.canonical.x-h.canonical.x}var ar=function(i,u){this.max=i,this.onRemove=u,this.reset()};ar.prototype.reset=function(){for(var i in this.data)for(var u=0,o=this.data[i];u<o.length;u+=1){var h=o[u];h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value)}return this.data={},this.order=[],this},ar.prototype.add=function(i,u,o){var h=this,y=i.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);var b={value:u,timeout:void 0};if(o!==void 0&&(b.timeout=setTimeout(function(){h.remove(i,b)},o)),this.data[y].push(b),this.order.push(y),this.order.length>this.max){var T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this},ar.prototype.has=function(i){return i.wrapped().key in this.data},ar.prototype.getAndRemove=function(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null},ar.prototype._getAndRemoveByKey=function(i){var u=this.data[i].shift();return u.timeout&&clearTimeout(u.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),u.value},ar.prototype.getByKey=function(i){var u=this.data[i];return u?u[0].value:null},ar.prototype.get=function(i){return this.has(i)?this.data[i.wrapped().key][0].value:null},ar.prototype.remove=function(i,u){if(!this.has(i))return this;var o=i.wrapped().key,h=u===void 0?0:this.data[o].indexOf(u),y=this.data[o][h];return this.data[o].splice(h,1),y.timeout&&clearTimeout(y.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(y.value),this.order.splice(this.order.indexOf(o),1),this},ar.prototype.setMaxSize=function(i){for(this.max=i;this.order.length>this.max;){var u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this},ar.prototype.filter=function(i){var u=[];for(var o in this.data)for(var h=0,y=this.data[o];h<y.length;h+=1){var b=y[h];i(b.value)||u.push(b)}for(var T=0,D=u;T<D.length;T+=1){var V=D[T];this.remove(V.value.tileID,V)}};var ge=function(i,u,o){this.context=i;var h=i.gl;this.buffer=h.createBuffer(),this.dynamicDraw=Boolean(o),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};ge.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ge.prototype.updateData=function(i){var u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)},ge.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Te={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Ze=function(i,u,o,h){this.length=u.length,this.attributes=o,this.itemSize=u.bytesPerElement,this.dynamicDraw=h,this.context=i;var y=i.gl;this.buffer=y.createBuffer(),i.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};Ze.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Ze.prototype.updateData=function(i){var u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,i.arrayBuffer)},Ze.prototype.enableAttributes=function(i,u){for(var o=0;o<this.attributes.length;o++){var h=u.attributes[this.attributes[o].name];h!==void 0&&i.enableVertexAttribArray(h)}},Ze.prototype.setVertexAttribPointers=function(i,u,o){for(var h=0;h<this.attributes.length;h++){var y=this.attributes[h],b=u.attributes[y.name];b!==void 0&&i.vertexAttribPointer(b,y.components,i[Te[y.type]],!1,this.itemSize,y.offset+this.itemSize*(o||0))}},Ze.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Oe=function(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Oe.prototype.get=function(){return this.current},Oe.prototype.set=function(i){},Oe.prototype.getDefault=function(){return this.default},Oe.prototype.setDefault=function(){this.set(this.default)};var Lt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return d.Color.transparent},u.prototype.set=function(o){var h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)},u}(Oe),nr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 1},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)},u}(Oe),dr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 0},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)},u}(Oe),Or=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return[!0,!0,!0,!0]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)},u}(Oe),lr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!0},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)},u}(Oe),un=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 255},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)},u}(Oe),w=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},u.prototype.set=function(o){var h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)},u}(Oe),H=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)},u}(Oe),Ue=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}},u}(Oe),et=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return[0,1]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)},u}(Oe),st=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}},u}(Oe),Ct=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.LESS},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)},u}(Oe),$=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}},u}(Oe),Gt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var o=this.gl;return[o.ONE,o.ZERO]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)},u}(Oe),Tr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return d.Color.transparent},u.prototype.set=function(o){var h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)},u}(Oe),Ir=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.FUNC_ADD},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)},u}(Oe),Ye=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}},u}(Oe),ut=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.BACK},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)},u}(Oe),At=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.CCW},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)},u}(Oe),Rt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)},u}(Oe),xr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.TEXTURE0},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)},u}(Oe),Ar=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)},u}(Oe),Ke=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}},u}(Oe),Xr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}},u}(Oe),Yr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}},u}(Oe),wn=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}},u}(Oe),cr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){var h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1},u}(Oe),Mr=function(i){function u(o){i.call(this,o),this.vao=o.extVertexArrayObject}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)},u}(Oe),gt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 4},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}},u}(Oe),Gn=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}},u}(Oe),Mn=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}},u}(Oe),kr=function(i){function u(o,h){i.call(this,o),this.context=o,this.parent=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u}(Oe),Y=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.setDirty=function(){this.dirty=!0},u.prototype.set=function(o){if(o!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}},u}(kr),le=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.set=function(o){if(o!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}},u}(kr),ve=function(i,u,o,h){this.context=i,this.width=u,this.height=o;var y=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new Y(i,y),h&&(this.depthAttachment=new le(i,y))};ve.prototype.destroy=function(){var i=this.context.gl,u=this.colorAttachment.get();if(u&&i.deleteTexture(u),this.depthAttachment){var o=this.depthAttachment.get();o&&i.deleteRenderbuffer(o)}i.deleteFramebuffer(this.framebuffer)};var B=function(i,u,o){this.func=i,this.mask=u,this.range=o};B.ReadOnly=!1,B.ReadWrite=!0,B.disabled=new B(519,B.ReadOnly,[0,1]);var ee=function(i,u,o,h,y,b){this.test=i,this.ref=u,this.mask=o,this.fail=h,this.depthFail=y,this.pass=b};ee.disabled=new ee({func:519,mask:0},0,0,7680,7680,7680);var de=function(i,u,o){this.blendFunction=i,this.blendColor=u,this.mask=o};de.disabled=new de(de.Replace=[1,0],d.Color.transparent,[!1,!1,!1,!1]),de.unblended=new de(de.Replace,d.Color.transparent,[!0,!0,!0,!0]),de.alphaBlended=new de([1,771],d.Color.transparent,[!0,!0,!0,!0]);var Ae=function(i,u,o){this.enable=i,this.mode=u,this.frontFace=o};Ae.disabled=new Ae(!1,1029,2305),Ae.backCCW=new Ae(!0,1029,2305);var ae=function(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Lt(this),this.clearDepth=new nr(this),this.clearStencil=new dr(this),this.colorMask=new Or(this),this.depthMask=new lr(this),this.stencilMask=new un(this),this.stencilFunc=new w(this),this.stencilOp=new H(this),this.stencilTest=new Ue(this),this.depthRange=new et(this),this.depthTest=new st(this),this.depthFunc=new Ct(this),this.blend=new $(this),this.blendFunc=new Gt(this),this.blendColor=new Tr(this),this.blendEquation=new Ir(this),this.cullFace=new Ye(this),this.cullFaceSide=new ut(this),this.frontFace=new At(this),this.program=new Rt(this),this.activeTexture=new xr(this),this.viewport=new Ar(this),this.bindFramebuffer=new Ke(this),this.bindRenderbuffer=new Xr(this),this.bindTexture=new Yr(this),this.bindVertexBuffer=new wn(this),this.bindElementBuffer=new cr(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Mr(this),this.pixelStoreUnpack=new gt(this),this.pixelStoreUnpackPremultiplyAlpha=new Gn(this),this.pixelStoreUnpackFlipY=new Mn(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)};ae.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ae.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ae.prototype.createIndexBuffer=function(i,u){return new ge(this,i,u)},ae.prototype.createVertexBuffer=function(i,u,o){return new Ze(this,i,u,o)},ae.prototype.createRenderbuffer=function(i,u,o){var h=this.gl,y=h.createRenderbuffer();return this.bindRenderbuffer.set(y),h.renderbufferStorage(h.RENDERBUFFER,i,u,o),this.bindRenderbuffer.set(null),y},ae.prototype.createFramebuffer=function(i,u,o){return new ve(this,i,u,o)},ae.prototype.clear=function(i){var u=i.color,o=i.depth,h=this.gl,y=0;u&&(y|=h.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(y|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),h.clear(y)},ae.prototype.setCullFace=function(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))},ae.prototype.setDepthMode=function(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)},ae.prototype.setStencilMode=function(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)},ae.prototype.setColorMode=function(i){d.deepEqual(i.blendFunction,de.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)},ae.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var _e=function(i){function u(o,h,y){var b=this;i.call(this),this.id=o,this.dispatcher=y,this.on("data",function(T){T.dataType==="source"&&T.sourceDataType==="metadata"&&(b._sourceLoaded=!0),b._sourceLoaded&&!b._paused&&T.dataType==="source"&&T.sourceDataType==="content"&&(b.reload(),b.transform&&b.update(b.transform))}),this.on("error",function(){b._sourceErrored=!0}),this._source=function(T,D,V,se){var Ce=new Ur[D.type](T,D,V,se);if(Ce.id!==T)throw new Error("Expected Source id to be "+T+" instead of "+Ce.id);return d.bindAll(["load","abort","unload","serialize","prepare"],Ce),Ce}(o,h,y,this),this._tiles={},this._cache=new ar(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new d.SourceFeatureState}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.onAdd=function(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(o)},u.prototype.onRemove=function(o){this._source&&this._source.onRemove&&this._source.onRemove(o)},u.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var o in this._tiles){var h=this._tiles[o];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0},u.prototype.getSource=function(){return this._source},u.prototype.pause=function(){this._paused=!0},u.prototype.resume=function(){if(this._paused){var o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}},u.prototype._loadTile=function(o,h){return this._source.loadTile(o,h)},u.prototype._unloadTile=function(o){if(this._source.unloadTile)return this._source.unloadTile(o,function(){})},u.prototype._abortTile=function(o){if(this._source.abortTile)return this._source.abortTile(o,function(){})},u.prototype.serialize=function(){return this._source.serialize()},u.prototype.prepare=function(o){for(var h in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var y=this._tiles[h];y.upload(o),y.prepare(this.map.style.imageManager)}},u.prototype.getIds=function(){return d.values(this._tiles).map(function(o){return o.tileID}).sort(ct).map(function(o){return o.key})},u.prototype.getRenderableIds=function(o){var h=this,y=[];for(var b in this._tiles)this._isIdRenderable(b,o)&&y.push(this._tiles[b]);return o?y.sort(function(T,D){var V=T.tileID,se=D.tileID,Ce=new d.Point(V.canonical.x,V.canonical.y)._rotate(h.transform.angle),we=new d.Point(se.canonical.x,se.canonical.y)._rotate(h.transform.angle);return V.overscaledZ-se.overscaledZ||we.y-Ce.y||we.x-Ce.x}).map(function(T){return T.tileID.key}):y.map(function(T){return T.tileID}).sort(ct).map(function(T){return T.key})},u.prototype.hasRenderableParent=function(o){var h=this.findLoadedParent(o,0);return!!h&&this._isIdRenderable(h.tileID.key)},u.prototype._isIdRenderable=function(o,h){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(h||!this._tiles[o].holdingForFade())},u.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var o in this._cache.reset(),this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")},u.prototype._reloadTile=function(o,h){var y=this._tiles[o];y&&(y.state!=="loading"&&(y.state=h),this._loadTile(y,this._tileLoaded.bind(this,y,o,h)))},u.prototype._tileLoaded=function(o,h,y,b){if(b)return o.state="errored",void(b.status!==404?this._source.fire(new d.ErrorEvent(b,{tile:o})):this.update(this.transform));o.timeAdded=d.browser.now(),y==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(h,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new d.Event("data",{dataType:"source",tile:o,coord:o.tileID}))},u.prototype._backfillDEM=function(o){for(var h=this.getRenderableIds(),y=0;y<h.length;y++){var b=h[y];if(o.neighboringTiles&&o.neighboringTiles[b]){var T=this.getTileByID(b);D(o,T),D(T,o)}}function D(V,se){V.needsHillshadePrepare=!0;var Ce=se.tileID.canonical.x-V.tileID.canonical.x,we=se.tileID.canonical.y-V.tileID.canonical.y,Pe=Math.pow(2,V.tileID.canonical.z),He=se.tileID.key;Ce===0&&we===0||Math.abs(we)>1||(Math.abs(Ce)>1&&(Math.abs(Ce+Pe)===1?Ce+=Pe:Math.abs(Ce-Pe)===1&&(Ce-=Pe)),se.dem&&V.dem&&(V.dem.backfillBorder(se.dem,Ce,we),V.neighboringTiles&&V.neighboringTiles[He]&&(V.neighboringTiles[He].backfilled=!0)))}},u.prototype.getTile=function(o){return this.getTileByID(o.key)},u.prototype.getTileByID=function(o){return this._tiles[o]},u.prototype._retainLoadedChildren=function(o,h,y,b){for(var T in this._tiles){var D=this._tiles[T];if(!(b[T]||!D.hasData()||D.tileID.overscaledZ<=h||D.tileID.overscaledZ>y)){for(var V=D.tileID;D&&D.tileID.overscaledZ>h+1;){var se=D.tileID.scaledTo(D.tileID.overscaledZ-1);(D=this._tiles[se.key])&&D.hasData()&&(V=se)}for(var Ce=V;Ce.overscaledZ>h;)if(o[(Ce=Ce.scaledTo(Ce.overscaledZ-1)).key]){b[V.key]=V;break}}}},u.prototype.findLoadedParent=function(o,h){if(o.key in this._loadedParentTiles){var y=this._loadedParentTiles[o.key];return y&&y.tileID.overscaledZ>=h?y:null}for(var b=o.overscaledZ-1;b>=h;b--){var T=o.scaledTo(b),D=this._getLoadedTile(T);if(D)return D}},u.prototype._getLoadedTile=function(o){var h=this._tiles[o.key];return h&&h.hasData()?h:this._cache.getByKey(o.wrapped().key)},u.prototype.updateCacheSize=function(o){var h=Math.ceil(o.width/this._source.tileSize)+1,y=Math.ceil(o.height/this._source.tileSize)+1,b=Math.floor(h*y*5),T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(T)},u.prototype.handleWrapJump=function(o){var h=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,h){var y={};for(var b in this._tiles){var T=this._tiles[b];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+h),y[T.tileID.key]=T}for(var D in this._tiles=y,this._timers)clearTimeout(this._timers[D]),delete this._timers[D];for(var V in this._tiles)this._setTileReloadTimer(V,this._tiles[V])}},u.prototype.update=function(o){var h=this;if(this.transform=o,this._sourceLoaded&&!this._paused){var y;this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?y=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(jr){return new d.OverscaledTileID(jr.canonical.z,jr.wrap,jr.canonical.z,jr.canonical.x,jr.canonical.y)}):(y=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(y=y.filter(function(jr){return h._source.hasTile(jr)}))):y=[];var b=o.coveringZoomLevel(this._source),T=Math.max(b-u.maxOverzooming,this._source.minzoom),D=Math.max(b+u.maxUnderzooming,this._source.minzoom),V=this._updateRetainedTiles(y,b);if(Sr(this._source.type)){for(var se={},Ce={},we=0,Pe=Object.keys(V);we<Pe.length;we+=1){var He=Pe[we],Ge=V[He],nt=this._tiles[He];if(nt&&!(nt.fadeEndTime&&nt.fadeEndTime<=d.browser.now())){var ze=this.findLoadedParent(Ge,T);ze&&(this._addTile(ze.tileID),se[ze.tileID.key]=ze.tileID),Ce[He]=Ge}}for(var it in this._retainLoadedChildren(Ce,b,D,V),se)V[it]||(this._coveredTiles[it]=!0,V[it]=se[it])}for(var bt in V)this._tiles[bt].clearFadeHold();for(var Vt=0,gr=d.keysDifference(this._tiles,V);Vt<gr.length;Vt+=1){var fr=gr[Vt],Er=this._tiles[fr];Er.hasSymbolBuckets&&!Er.holdingForFade()?Er.setHoldDuration(this.map._fadeDuration):Er.hasSymbolBuckets&&!Er.symbolFadeFinished()||this._removeTile(fr)}this._updateLoadedParentTileCache()}},u.prototype.releaseSymbolFadeTiles=function(){for(var o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)},u.prototype._updateRetainedTiles=function(o,h){for(var y={},b={},T=Math.max(h-u.maxOverzooming,this._source.minzoom),D=Math.max(h+u.maxUnderzooming,this._source.minzoom),V={},se=0,Ce=o;se<Ce.length;se+=1){var we=Ce[se],Pe=this._addTile(we);y[we.key]=we,Pe.hasData()||h<this._source.maxzoom&&(V[we.key]=we)}this._retainLoadedChildren(V,h,D,y);for(var He=0,Ge=o;He<Ge.length;He+=1){var nt=Ge[He],ze=this._tiles[nt.key];if(!ze.hasData()){if(h+1>this._source.maxzoom){var it=nt.children(this._source.maxzoom)[0],bt=this.getTile(it);if(bt&&bt.hasData()){y[it.key]=it;continue}}else{var Vt=nt.children(this._source.maxzoom);if(y[Vt[0].key]&&y[Vt[1].key]&&y[Vt[2].key]&&y[Vt[3].key])continue}for(var gr=ze.wasRequested(),fr=nt.overscaledZ-1;fr>=T;--fr){var Er=nt.scaledTo(fr);if(b[Er.key]||(b[Er.key]=!0,!(ze=this.getTile(Er))&&gr&&(ze=this._addTile(Er)),ze&&(y[Er.key]=Er,gr=ze.wasRequested(),ze.hasData())))break}}}return y},u.prototype._updateLoadedParentTileCache=function(){for(var o in this._loadedParentTiles={},this._tiles){for(var h=[],y=void 0,b=this._tiles[o].tileID;b.overscaledZ>0;){if(b.key in this._loadedParentTiles){y=this._loadedParentTiles[b.key];break}h.push(b.key);var T=b.scaledTo(b.overscaledZ-1);if(y=this._getLoadedTile(T))break;b=T}for(var D=0,V=h;D<V.length;D+=1)this._loadedParentTiles[V[D]]=y}},u.prototype._addTile=function(o){var h=this._tiles[o.key];if(h)return h;(h=this._cache.getAndRemove(o))&&(this._setTileReloadTimer(o.key,h),h.tileID=o,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,h)));var y=Boolean(h);return y||(h=new d.Tile(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,o.key,h.state))),h?(h.uses++,this._tiles[o.key]=h,y||this._source.fire(new d.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null},u.prototype._setTileReloadTimer=function(o,h){var y=this;o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);var b=h.getExpiryTimeout();b&&(this._timers[o]=setTimeout(function(){y._reloadTile(o,"expired"),delete y._timers[o]},b))},u.prototype._removeTile=function(o){var h=this._tiles[o];h&&(h.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))},u.prototype.clearTiles=function(){for(var o in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(o);this._cache.reset()},u.prototype.tilesIn=function(o,h,y){var b=this,T=[],D=this.transform;if(!D)return T;for(var V=y?D.getCameraQueryGeometry(o):o,se=o.map(function(fr){return D.pointCoordinate(fr)}),Ce=V.map(function(fr){return D.pointCoordinate(fr)}),we=this.getIds(),Pe=1/0,He=1/0,Ge=-1/0,nt=-1/0,ze=0,it=Ce;ze<it.length;ze+=1){var bt=it[ze];Pe=Math.min(Pe,bt.x),He=Math.min(He,bt.y),Ge=Math.max(Ge,bt.x),nt=Math.max(nt,bt.y)}for(var Vt=function(fr){var Er=b._tiles[we[fr]];if(!Er.holdingForFade()){var jr=Er.tileID,fn=Math.pow(2,D.zoom-Er.tileID.overscaledZ),tn=h*Er.queryPadding*d.EXTENT/Er.tileSize/fn,Zn=[jr.getTilePoint(new d.MercatorCoordinate(Pe,He)),jr.getTilePoint(new d.MercatorCoordinate(Ge,nt))];if(Zn[0].x-tn<d.EXTENT&&Zn[0].y-tn<d.EXTENT&&Zn[1].x+tn>=0&&Zn[1].y+tn>=0){var si=se.map(function(dn){return jr.getTilePoint(dn)}),ui=Ce.map(function(dn){return jr.getTilePoint(dn)});T.push({tile:Er,tileID:jr,queryGeometry:si,cameraQueryGeometry:ui,scale:fn})}}},gr=0;gr<we.length;gr++)Vt(gr);return T},u.prototype.getVisibleCoordinates=function(o){for(var h=this,y=this.getRenderableIds(o).map(function(V){return h._tiles[V].tileID}),b=0,T=y;b<T.length;b+=1){var D=T[b];D.posMatrix=this.transform.calculatePosMatrix(D.toUnwrapped())}return y},u.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Sr(this._source.type))for(var o in this._tiles){var h=this._tiles[o];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=d.browser.now())return!0}return!1},u.prototype.setFeatureState=function(o,h,y){this._state.updateState(o=o||"_geojsonTileLayer",h,y)},u.prototype.removeFeatureState=function(o,h,y){this._state.removeFeatureState(o=o||"_geojsonTileLayer",h,y)},u.prototype.getFeatureState=function(o,h){return this._state.getState(o=o||"_geojsonTileLayer",h)},u.prototype.setDependencies=function(o,h,y){var b=this._tiles[o];b&&b.setDependencies(h,y)},u.prototype.reloadTilesForDependencies=function(o,h){for(var y in this._tiles)this._tiles[y].hasDependency(o,h)&&this._reloadTile(y,"reloading");this._cache.filter(function(b){return!b.hasDependency(o,h)})},u}(d.Evented);function ct(i,u){var o=Math.abs(2*i.wrap)-+(i.wrap<0),h=Math.abs(2*u.wrap)-+(u.wrap<0);return i.overscaledZ-u.overscaledZ||h-o||u.canonical.y-i.canonical.y||u.canonical.x-i.canonical.x}function Sr(i){return i==="raster"||i==="image"||i==="video"}function Ht(){return new d.window.Worker(ul.workerUrl)}_e.maxOverzooming=10,_e.maxUnderzooming=3;var Jt="mapboxgl_preloaded_worker_pool",Nr=function(){this.active={}};Nr.prototype.acquire=function(i){if(!this.workers)for(this.workers=[];this.workers.length<Nr.workerCount;)this.workers.push(new Ht);return this.active[i]=!0,this.workers.slice()},Nr.prototype.release=function(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(function(u){u.terminate()}),this.workers=null)},Nr.prototype.isPreloaded=function(){return!!this.active[Jt]},Nr.prototype.numActive=function(){return Object.keys(this.active).length};var zn,Nn=Math.floor(d.browser.hardwareConcurrency/2);function Kt(){return zn||(zn=new Nr),zn}function In(i,u){var o={};for(var h in i)h!=="ref"&&(o[h]=i[h]);return d.refProperties.forEach(function(y){y in u&&(o[y]=u[y])}),o}function hn(i){i=i.slice();for(var u=Object.create(null),o=0;o<i.length;o++)u[i[o].id]=i[o];for(var h=0;h<i.length;h++)"ref"in i[h]&&(i[h]=In(i[h],u[i[h].ref]));return i}Nr.workerCount=Math.max(Math.min(Nn,6),1);var mn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Bi(i,u,o){o.push({command:mn.addSource,args:[i,u[i]]})}function An(i,u,o){u.push({command:mn.removeSource,args:[i]}),o[i]=!0}function Di(i,u,o,h){An(i,o,h),Bi(i,u,o)}function ra(i,u,o){var h;for(h in i[o])if(i[o].hasOwnProperty(h)&&h!=="data"&&!d.deepEqual(i[o][h],u[o][h]))return!1;for(h in u[o])if(u[o].hasOwnProperty(h)&&h!=="data"&&!d.deepEqual(i[o][h],u[o][h]))return!1;return!0}function hi(i,u,o,h,y,b){var T;for(T in u=u||{},i=i||{})i.hasOwnProperty(T)&&(d.deepEqual(i[T],u[T])||o.push({command:b,args:[h,T,u[T],y]}));for(T in u)u.hasOwnProperty(T)&&!i.hasOwnProperty(T)&&(d.deepEqual(i[T],u[T])||o.push({command:b,args:[h,T,u[T],y]}))}function na(i){return i.id}function Hi(i,u){return i[u.id]=u,i}var Oi=function(i,u){this.reset(i,u)};Oi.prototype.reset=function(i,u){this.points=i||[],this._distances=[0];for(var o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Oi.prototype.lerp=function(i){if(this.points.length===1)return this.points[0];i=d.clamp(i,0,1);for(var u=1,o=this._distances[u],h=i*this.paddedLength+this.padding;o<h&&u<this._distances.length;)o=this._distances[++u];var y=u-1,b=this._distances[y],T=o-b,D=T>0?(h-b)/T:0;return this.points[y].mult(1-D).add(this.points[u].mult(D))};var ga=function(i,u,o){var h=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(i/o),this.yCellCount=Math.ceil(u/o);for(var b=0;b<this.xCellCount*this.yCellCount;b++)h.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=u,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0};function Ra(i,u,o,h,y){var b=d.create();return u?(d.scale(b,b,[1/y,1/y,1]),o||d.rotateZ(b,b,h.angle)):d.multiply(b,h.labelPlaneMatrix,i),b}function Wi(i,u,o,h,y){if(u){var b=d.clone(i);return d.scale(b,b,[y,y,1]),o||d.rotateZ(b,b,-h.angle),b}return h.glCoordMatrix}function Ni(i,u){var o=[i.x,i.y,0,1];Xa(o,o,u);var h=o[3];return{point:new d.Point(o[0]/h,o[1]/h),signedDistanceFromCamera:h}}function Xi(i,u){return .5+i/u*.5}function ro(i,u){var o=i[0]/i[3],h=i[1]/i[3];return o>=-u[0]&&o<=u[0]&&h>=-u[1]&&h<=u[1]}function Qo(i,u,o,h,y,b,T,D){var V=h?i.textSizeData:i.iconSizeData,se=d.evaluateSizeForZoom(V,o.transform.zoom),Ce=[256/o.width*2+1,256/o.height*2+1],we=h?i.text.dynamicLayoutVertexArray:i.icon.dynamicLayoutVertexArray;we.clear();for(var Pe=i.lineVertexArray,He=h?i.text.placedSymbolArray:i.icon.placedSymbolArray,Ge=o.transform.width/o.transform.height,nt=!1,ze=0;ze<He.length;ze++){var it=He.get(ze);if(it.hidden||it.writingMode===d.WritingMode.vertical&&!nt)Ki(it.numGlyphs,we);else{nt=!1;var bt=[it.anchorX,it.anchorY,0,1];if(d.transformMat4(bt,bt,u),ro(bt,Ce)){var Vt=Xi(o.transform.cameraToCenterDistance,bt[3]),gr=d.evaluateSizeForFeature(V,se,it),fr=T?gr/Vt:gr*Vt,Er=new d.Point(it.anchorX,it.anchorY),jr=Ni(Er,y).point,fn={},tn=cu(it,fr,!1,D,u,y,b,i.glyphOffsetArray,Pe,we,jr,Er,fn,Ge);nt=tn.useVertical,(tn.notEnoughRoom||nt||tn.needsFlipping&&cu(it,fr,!0,D,u,y,b,i.glyphOffsetArray,Pe,we,jr,Er,fn,Ge).notEnoughRoom)&&Ki(it.numGlyphs,we)}else Ki(it.numGlyphs,we)}}h?i.text.dynamicLayoutVertexBuffer.updateData(we):i.icon.dynamicLayoutVertexBuffer.updateData(we)}function za(i,u,o,h,y,b,T,D,V,se,Ce){var we=D.glyphStartIndex+D.numGlyphs,Pe=D.lineStartIndex,He=D.lineStartIndex+D.lineLength,Ge=u.getoffsetX(D.glyphStartIndex),nt=u.getoffsetX(we-1),ze=Yi(i*Ge,o,h,y,b,T,D.segment,Pe,He,V,se,Ce);if(!ze)return null;var it=Yi(i*nt,o,h,y,b,T,D.segment,Pe,He,V,se,Ce);return it?{first:ze,last:it}:null}function $i(i,u,o,h){return i===d.WritingMode.horizontal&&Math.abs(o.y-u.y)>Math.abs(o.x-u.x)*h?{useVertical:!0}:(i===d.WritingMode.vertical?u.y<o.y:u.x>o.x)?{needsFlipping:!0}:null}function cu(i,u,o,h,y,b,T,D,V,se,Ce,we,Pe,He){var Ge,nt=u/24,ze=i.lineOffsetX*nt,it=i.lineOffsetY*nt;if(i.numGlyphs>1){var bt=i.glyphStartIndex+i.numGlyphs,Vt=i.lineStartIndex,gr=i.lineStartIndex+i.lineLength,fr=za(nt,D,ze,it,o,Ce,we,i,V,b,Pe);if(!fr)return{notEnoughRoom:!0};var Er=Ni(fr.first.point,T).point,jr=Ni(fr.last.point,T).point;if(h&&!o){var fn=$i(i.writingMode,Er,jr,He);if(fn)return fn}Ge=[fr.first];for(var tn=i.glyphStartIndex+1;tn<bt-1;tn++)Ge.push(Yi(nt*D.getoffsetX(tn),ze,it,o,Ce,we,i.segment,Vt,gr,V,b,Pe));Ge.push(fr.last)}else{if(h&&!o){var Zn=Ni(we,y).point,si=i.lineStartIndex+i.segment+1,ui=new d.Point(V.getx(si),V.gety(si)),dn=Ni(ui,y),ia=dn.signedDistanceFromCamera>0?dn.point:Pu(we,ui,Zn,1,y),Wn=$i(i.writingMode,Zn,ia,He);if(Wn)return Wn}var xi=Yi(nt*D.getoffsetX(i.glyphStartIndex),ze,it,o,Ce,we,i.segment,i.lineStartIndex,i.lineStartIndex+i.lineLength,V,b,Pe);if(!xi)return{notEnoughRoom:!0};Ge=[xi]}for(var ji=0,vi=Ge;ji<vi.length;ji+=1){var Ci=vi[ji];d.addDynamicAttributes(se,Ci.point,Ci.angle)}return{}}function Pu(i,u,o,h,y){var b=Ni(i.add(i.sub(u)._unit()),y).point,T=o.sub(b);return o.add(T._mult(h/T.mag()))}function Yi(i,u,o,h,y,b,T,D,V,se,Ce,we){var Pe=h?i-u:i+u,He=Pe>0?1:-1,Ge=0;h&&(He*=-1,Ge=Math.PI),He<0&&(Ge+=Math.PI);for(var nt=He>0?D+T:D+T+1,ze=y,it=y,bt=0,Vt=0,gr=Math.abs(Pe),fr=[];bt+Vt<=gr;){if((nt+=He)<D||nt>=V)return null;if(it=ze,fr.push(ze),(ze=we[nt])===void 0){var Er=new d.Point(se.getx(nt),se.gety(nt)),jr=Ni(Er,Ce);if(jr.signedDistanceFromCamera>0)ze=we[nt]=jr.point;else{var fn=nt-He;ze=Pu(bt===0?b:new d.Point(se.getx(fn),se.gety(fn)),Er,it,gr-bt+1,Ce)}}bt+=Vt,Vt=it.dist(ze)}var tn=(gr-bt)/Vt,Zn=ze.sub(it),si=Zn.mult(tn)._add(it);si._add(Zn._unit()._perp()._mult(o*He));var ui=Ge+Math.atan2(ze.y-it.y,ze.x-it.x);return fr.push(si),{point:si,angle:ui,path:fr}}ga.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},ga.prototype.insert=function(i,u,o,h,y){this._forEachCell(u,o,h,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(u),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(y)},ga.prototype.insertCircle=function(i,u,o,h){this._forEachCell(u-h,o-h,u+h,o+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(u),this.circles.push(o),this.circles.push(h)},ga.prototype._insertBoxCell=function(i,u,o,h,y,b){this.boxCells[y].push(b)},ga.prototype._insertCircleCell=function(i,u,o,h,y,b){this.circleCells[y].push(b)},ga.prototype._query=function(i,u,o,h,y,b){if(o<0||i>this.width||h<0||u>this.height)return!y&&[];var T=[];if(i<=0&&u<=0&&this.width<=o&&this.height<=h){if(y)return!0;for(var D=0;D<this.boxKeys.length;D++)T.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(var V=0;V<this.circleKeys.length;V++){var se=this.circles[3*V],Ce=this.circles[3*V+1],we=this.circles[3*V+2];T.push({key:this.circleKeys[V],x1:se-we,y1:Ce-we,x2:se+we,y2:Ce+we})}return b?T.filter(b):T}return this._forEachCell(i,u,o,h,this._queryCell,T,{hitTest:y,seenUids:{box:{},circle:{}}},b),y?T.length>0:T},ga.prototype._queryCircle=function(i,u,o,h,y){var b=i-o,T=i+o,D=u-o,V=u+o;if(T<0||b>this.width||V<0||D>this.height)return!h&&[];var se=[];return this._forEachCell(b,D,T,V,this._queryCellCircle,se,{hitTest:h,circle:{x:i,y:u,radius:o},seenUids:{box:{},circle:{}}},y),h?se.length>0:se},ga.prototype.query=function(i,u,o,h,y){return this._query(i,u,o,h,!1,y)},ga.prototype.hitTest=function(i,u,o,h,y){return this._query(i,u,o,h,!0,y)},ga.prototype.hitTestCircle=function(i,u,o,h){return this._queryCircle(i,u,o,!0,h)},ga.prototype._queryCell=function(i,u,o,h,y,b,T,D){var V=T.seenUids,se=this.boxCells[y];if(se!==null)for(var Ce=this.bboxes,we=0,Pe=se;we<Pe.length;we+=1){var He=Pe[we];if(!V.box[He]){V.box[He]=!0;var Ge=4*He;if(i<=Ce[Ge+2]&&u<=Ce[Ge+3]&&o>=Ce[Ge+0]&&h>=Ce[Ge+1]&&(!D||D(this.boxKeys[He]))){if(T.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[He],x1:Ce[Ge],y1:Ce[Ge+1],x2:Ce[Ge+2],y2:Ce[Ge+3]})}}}var nt=this.circleCells[y];if(nt!==null)for(var ze=this.circles,it=0,bt=nt;it<bt.length;it+=1){var Vt=bt[it];if(!V.circle[Vt]){V.circle[Vt]=!0;var gr=3*Vt;if(this._circleAndRectCollide(ze[gr],ze[gr+1],ze[gr+2],i,u,o,h)&&(!D||D(this.circleKeys[Vt]))){if(T.hitTest)return b.push(!0),!0;var fr=ze[gr],Er=ze[gr+1],jr=ze[gr+2];b.push({key:this.circleKeys[Vt],x1:fr-jr,y1:Er-jr,x2:fr+jr,y2:Er+jr})}}}},ga.prototype._queryCellCircle=function(i,u,o,h,y,b,T,D){var V=T.circle,se=T.seenUids,Ce=this.boxCells[y];if(Ce!==null)for(var we=this.bboxes,Pe=0,He=Ce;Pe<He.length;Pe+=1){var Ge=He[Pe];if(!se.box[Ge]){se.box[Ge]=!0;var nt=4*Ge;if(this._circleAndRectCollide(V.x,V.y,V.radius,we[nt+0],we[nt+1],we[nt+2],we[nt+3])&&(!D||D(this.boxKeys[Ge])))return b.push(!0),!0}}var ze=this.circleCells[y];if(ze!==null)for(var it=this.circles,bt=0,Vt=ze;bt<Vt.length;bt+=1){var gr=Vt[bt];if(!se.circle[gr]){se.circle[gr]=!0;var fr=3*gr;if(this._circlesCollide(it[fr],it[fr+1],it[fr+2],V.x,V.y,V.radius)&&(!D||D(this.circleKeys[gr])))return b.push(!0),!0}}},ga.prototype._forEachCell=function(i,u,o,h,y,b,T,D){for(var V=this._convertToXCellCoord(i),se=this._convertToYCellCoord(u),Ce=this._convertToXCellCoord(o),we=this._convertToYCellCoord(h),Pe=V;Pe<=Ce;Pe++)for(var He=se;He<=we;He++)if(y.call(this,i,u,o,h,this.xCellCount*He+Pe,b,T,D))return},ga.prototype._convertToXCellCoord=function(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))},ga.prototype._convertToYCellCoord=function(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))},ga.prototype._circlesCollide=function(i,u,o,h,y,b){var T=h-i,D=y-u,V=o+b;return V*V>T*T+D*D},ga.prototype._circleAndRectCollide=function(i,u,o,h,y,b,T){var D=(b-h)/2,V=Math.abs(i-(h+D));if(V>D+o)return!1;var se=(T-y)/2,Ce=Math.abs(u-(y+se));if(Ce>se+o)return!1;if(V<=D||Ce<=se)return!0;var we=V-D,Pe=Ce-se;return we*we+Pe*Pe<=o*o};var xo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ki(i,u){for(var o=0;o<i;o++){var h=u.length;u.resize(h+4),u.float32.set(xo,3*h)}}function Xa(i,u,o){var h=u[0],y=u[1];return i[0]=o[0]*h+o[4]*y+o[12],i[1]=o[1]*h+o[5]*y+o[13],i[3]=o[3]*h+o[7]*y+o[15],i}var qo=function(i,u,o){u===void 0&&(u=new ga(i.width+200,i.height+200,25)),o===void 0&&(o=new ga(i.width+200,i.height+200,25)),this.transform=i,this.grid=u,this.ignoredGrid=o,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+100,this.screenBottomBoundary=i.height+100,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200};function xa(i,u,o){return u*(d.EXTENT/(i.tileSize*Math.pow(2,o-i.tileID.overscaledZ)))}qo.prototype.placeCollisionBox=function(i,u,o,h,y){var b=this.projectAndGetPerspectiveRatio(h,i.anchorPointX,i.anchorPointY),T=o*b.perspectiveRatio,D=i.x1*T+b.point.x,V=i.y1*T+b.point.y,se=i.x2*T+b.point.x,Ce=i.y2*T+b.point.y;return!this.isInsideGrid(D,V,se,Ce)||!u&&this.grid.hitTest(D,V,se,Ce,y)?{box:[],offscreen:!1}:{box:[D,V,se,Ce],offscreen:this.isOffscreen(D,V,se,Ce)}},qo.prototype.placeCollisionCircles=function(i,u,o,h,y,b,T,D,V,se,Ce,we,Pe){var He=[],Ge=new d.Point(u.anchorX,u.anchorY),nt=Ni(Ge,b),ze=Xi(this.transform.cameraToCenterDistance,nt.signedDistanceFromCamera),it=(se?y/ze:y*ze)/d.ONE_EM,bt=Ni(Ge,T).point,Vt=za(it,h,u.lineOffsetX*it,u.lineOffsetY*it,!1,bt,Ge,u,o,T,{}),gr=!1,fr=!1,Er=!0;if(Vt){for(var jr=.5*we*ze+Pe,fn=new d.Point(-100,-100),tn=new d.Point(this.screenRightBoundary,this.screenBottomBoundary),Zn=new Oi,si=Vt.first,ui=Vt.last,dn=[],ia=si.path.length-1;ia>=1;ia--)dn.push(si.path[ia]);for(var Wn=1;Wn<ui.path.length;Wn++)dn.push(ui.path[Wn]);var xi=2.5*jr;if(D){var ji=dn.map(function(mi){return Ni(mi,D)});dn=ji.some(function(mi){return mi.signedDistanceFromCamera<=0})?[]:ji.map(function(mi){return mi.point})}var vi=[];if(dn.length>0){for(var Ci=dn[0].clone(),Q=dn[0].clone(),J=1;J<dn.length;J++)Ci.x=Math.min(Ci.x,dn[J].x),Ci.y=Math.min(Ci.y,dn[J].y),Q.x=Math.max(Q.x,dn[J].x),Q.y=Math.max(Q.y,dn[J].y);vi=Ci.x>=fn.x&&Q.x<=tn.x&&Ci.y>=fn.y&&Q.y<=tn.y?[dn]:Q.x<fn.x||Ci.x>tn.x||Q.y<fn.y||Ci.y>tn.y?[]:d.clipLine([dn],fn.x,fn.y,tn.x,tn.y)}for(var O=0,F=vi;O<F.length;O+=1){var ne;Zn.reset(F[O],.25*jr),ne=Zn.length<=.5*jr?1:Math.ceil(Zn.paddedLength/xi)+1;for(var xe=0;xe<ne;xe++){var pt=xe/Math.max(ne-1,1),Pt=Zn.lerp(pt),xt=Pt.x+100,ur=Pt.y+100;He.push(xt,ur,jr,0);var Vr=xt-jr,Jn=ur-jr,Xn=xt+jr,li=ur+jr;if(Er=Er&&this.isOffscreen(Vr,Jn,Xn,li),fr=fr||this.isInsideGrid(Vr,Jn,Xn,li),!i&&this.grid.hitTestCircle(xt,ur,jr,Ce)&&(gr=!0,!V))return{circles:[],offscreen:!1,collisionDetected:gr}}}}return{circles:!V&&gr||!fr?[]:He,offscreen:Er,collisionDetected:gr}},qo.prototype.queryRenderedSymbols=function(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var u=[],o=1/0,h=1/0,y=-1/0,b=-1/0,T=0,D=i;T<D.length;T+=1){var V=D[T],se=new d.Point(V.x+100,V.y+100);o=Math.min(o,se.x),h=Math.min(h,se.y),y=Math.max(y,se.x),b=Math.max(b,se.y),u.push(se)}for(var Ce={},we={},Pe=0,He=this.grid.query(o,h,y,b).concat(this.ignoredGrid.query(o,h,y,b));Pe<He.length;Pe+=1){var Ge=He[Pe],nt=Ge.key;if(Ce[nt.bucketInstanceId]===void 0&&(Ce[nt.bucketInstanceId]={}),!Ce[nt.bucketInstanceId][nt.featureIndex]){var ze=[new d.Point(Ge.x1,Ge.y1),new d.Point(Ge.x2,Ge.y1),new d.Point(Ge.x2,Ge.y2),new d.Point(Ge.x1,Ge.y2)];d.polygonIntersectsPolygon(u,ze)&&(Ce[nt.bucketInstanceId][nt.featureIndex]=!0,we[nt.bucketInstanceId]===void 0&&(we[nt.bucketInstanceId]=[]),we[nt.bucketInstanceId].push(nt.featureIndex))}}return we},qo.prototype.insertCollisionBox=function(i,u,o,h,y){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:o,featureIndex:h,collisionGroupID:y},i[0],i[1],i[2],i[3])},qo.prototype.insertCollisionCircles=function(i,u,o,h,y){for(var b=u?this.ignoredGrid:this.grid,T={bucketInstanceId:o,featureIndex:h,collisionGroupID:y},D=0;D<i.length;D+=4)b.insertCircle(T,i[D],i[D+1],i[D+2])},qo.prototype.projectAndGetPerspectiveRatio=function(i,u,o){var h=[u,o,0,1];return Xa(h,h,i),{point:new d.Point((h[0]/h[3]+1)/2*this.transform.width+100,(-h[1]/h[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/h[3]*.5}},qo.prototype.isOffscreen=function(i,u,o,h){return o<100||i>=this.screenRightBoundary||h<100||u>this.screenBottomBoundary},qo.prototype.isInsideGrid=function(i,u,o,h){return o>=0&&i<this.gridRightBoundary&&h>=0&&u<this.gridBottomBoundary},qo.prototype.getViewportMatrix=function(){var i=d.identity([]);return d.translate(i,i,[-100,-100,0]),i};var Do=function(i,u,o,h){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?u:-u))):h&&o?1:0,this.placed=o};Do.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var ko=function(i,u,o,h,y){this.text=new Do(i?i.text:null,u,o,y),this.icon=new Do(i?i.icon:null,u,h,y)};ko.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Rs=function(i,u,o){this.text=i,this.icon=u,this.skipFade=o},vo=function(){this.invProjMatrix=d.create(),this.viewportMatrix=d.create(),this.circles=[]},Xo=function(i,u,o,h,y){this.bucketInstanceId=i,this.featureIndex=u,this.sourceLayerIndex=o,this.bucketIndex=h,this.tileID=y},Da=function(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}};function co(i,u,o,h,y){var b=d.getAnchorAlignment(i),T=-(b.horizontalAlign-.5)*u,D=-(b.verticalAlign-.5)*o,V=d.evaluateVariableOffset(i,h);return new d.Point(T+V[0]*y,D+V[1]*y)}function ss(i,u,o,h,y,b){var T=i.x1,D=i.x2,V=i.y1,se=i.y2,Ce=i.anchorPointX,we=i.anchorPointY,Pe=new d.Point(u,o);return h&&Pe._rotate(y?b:-b),{x1:T+Pe.x,y1:V+Pe.y,x2:D+Pe.x,y2:se+Pe.y,anchorPointX:Ce,anchorPointY:we}}Da.prototype.get=function(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){var u=++this.maxGroupID;this.collisionGroups[i]={ID:u,predicate:function(o){return o.collisionGroupID===u}}}return this.collisionGroups[i]};var Fo=function(i,u,o,h){this.transform=i.clone(),this.collisionIndex=new qo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Da(o),this.collisionCircleArrays={},this.prevPlacement=h,h&&(h.prevPlacement=void 0),this.placedOrientations={}};function Se(i,u,o,h,y){i.emplaceBack(u?1:0,o?1:0,h||0,y||0),i.emplaceBack(u?1:0,o?1:0,h||0,y||0),i.emplaceBack(u?1:0,o?1:0,h||0,y||0),i.emplaceBack(u?1:0,o?1:0,h||0,y||0)}Fo.prototype.getBucketParts=function(i,u,o,h){var y=o.getBucket(u),b=o.latestFeatureIndex;if(y&&b&&u.id===y.layerIds[0]){var T=o.collisionBoxArray,D=y.layers[0].layout,V=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),se=o.tileSize/d.EXTENT,Ce=this.transform.calculatePosMatrix(o.tileID.toUnwrapped()),we=D.get("text-pitch-alignment")==="map",Pe=D.get("text-rotation-alignment")==="map",He=xa(o,1,this.transform.zoom),Ge=Ra(Ce,we,Pe,this.transform,He),nt=null;if(we){var ze=Wi(Ce,we,Pe,this.transform,He);nt=d.multiply([],this.transform.labelPlaneMatrix,ze)}this.retainedQueryData[y.bucketInstanceId]=new Xo(y.bucketInstanceId,b,y.sourceLayerIndex,y.index,o.tileID);var it={bucket:y,layout:D,posMatrix:Ce,textLabelPlaneMatrix:Ge,labelToScreenMatrix:nt,scale:V,textPixelRatio:se,holdingForFade:o.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:d.evaluateSizeForZoom(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(h)for(var bt=0,Vt=y.sortKeyRanges;bt<Vt.length;bt+=1){var gr=Vt[bt];i.push({sortKey:gr.sortKey,symbolInstanceStart:gr.symbolInstanceStart,symbolInstanceEnd:gr.symbolInstanceEnd,parameters:it})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:it})}},Fo.prototype.attemptAnchorPlacement=function(i,u,o,h,y,b,T,D,V,se,Ce,we,Pe,He,Ge){var nt,ze=[we.textOffset0,we.textOffset1],it=co(i,o,h,ze,y),bt=this.collisionIndex.placeCollisionBox(ss(u,it.x,it.y,b,T,this.transform.angle),Ce,D,V,se.predicate);if(!Ge||this.collisionIndex.placeCollisionBox(ss(Ge,it.x,it.y,b,T,this.transform.angle),Ce,D,V,se.predicate).box.length!==0)return bt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[we.crossTileID]&&this.prevPlacement.placements[we.crossTileID]&&this.prevPlacement.placements[we.crossTileID].text&&(nt=this.prevPlacement.variableOffsets[we.crossTileID].anchor),this.variableOffsets[we.crossTileID]={textOffset:ze,width:o,height:h,anchor:i,textBoxScale:y,prevAnchor:nt},this.markUsedJustification(Pe,i,we,He),Pe.allowVerticalPlacement&&(this.markUsedOrientation(Pe,He,we),this.placedOrientations[we.crossTileID]=He),{shift:it,placedGlyphBoxes:bt}):void 0},Fo.prototype.placeLayerBucketPart=function(i,u,o){var h=this,y=i.parameters,b=y.bucket,T=y.layout,D=y.posMatrix,V=y.textLabelPlaneMatrix,se=y.labelToScreenMatrix,Ce=y.textPixelRatio,we=y.holdingForFade,Pe=y.collisionBoxArray,He=y.partiallyEvaluatedTextSize,Ge=y.collisionGroup,nt=T.get("text-optional"),ze=T.get("icon-optional"),it=T.get("text-allow-overlap"),bt=T.get("icon-allow-overlap"),Vt=T.get("text-rotation-alignment")==="map",gr=T.get("text-pitch-alignment")==="map",fr=T.get("icon-text-fit")!=="none",Er=T.get("symbol-z-order")==="viewport-y",jr=it&&(bt||!b.hasIconData()||ze),fn=bt&&(it||!b.hasTextData()||nt);!b.collisionArrays&&Pe&&b.deserializeCollisionBoxes(Pe);var tn=function(Wn,xi){if(!u[Wn.crossTileID])if(we)h.placements[Wn.crossTileID]=new Rs(!1,!1,!1);else{var ji,vi=!1,Ci=!1,Q=!0,J=null,O={box:null,offscreen:null},F={box:null,offscreen:null},ne=null,xe=null,pt=0,Pt=0,xt=0;xi.textFeatureIndex?pt=xi.textFeatureIndex:Wn.useRuntimeCollisionCircles&&(pt=Wn.featureIndex),xi.verticalTextFeatureIndex&&(Pt=xi.verticalTextFeatureIndex);var ur=xi.textBox;if(ur){var Vr=function(Pi){var oo=d.WritingMode.horizontal;if(b.allowVerticalPlacement&&!Pi&&h.prevPlacement){var Ga=h.prevPlacement.placedOrientations[Wn.crossTileID];Ga&&(h.placedOrientations[Wn.crossTileID]=Ga,h.markUsedOrientation(b,oo=Ga,Wn))}return oo},Jn=function(Pi,oo){if(b.allowVerticalPlacement&&Wn.numVerticalGlyphVertices>0&&xi.verticalTextBox)for(var Ga=0,Hs=b.writingModes;Ga<Hs.length&&(Hs[Ga]===d.WritingMode.vertical?(O=oo(),F=O):O=Pi(),!(O&&O.box&&O.box.length));Ga+=1);else O=Pi()};if(T.get("text-variable-anchor")){var Xn=T.get("text-variable-anchor");if(h.prevPlacement&&h.prevPlacement.variableOffsets[Wn.crossTileID]){var li=h.prevPlacement.variableOffsets[Wn.crossTileID];Xn.indexOf(li.anchor)>0&&(Xn=Xn.filter(function(Pi){return Pi!==li.anchor})).unshift(li.anchor)}var mi=function(Pi,oo,Ga){for(var Hs=Pi.x2-Pi.x1,Nl=Pi.y2-Pi.y1,Bs=Wn.textBoxScale,Lu=fr&&!bt?oo:null,Ru={box:[],offscreen:!1},zl=it?2*Xn.length:Xn.length,ll=0;ll<zl;++ll){var Ul=h.attemptAnchorPlacement(Xn[ll%Xn.length],Pi,Hs,Nl,Bs,Vt,gr,Ce,D,Ge,ll>=Xn.length,Wn,b,Ga,Lu);if(Ul&&(Ru=Ul.placedGlyphBoxes)&&Ru.box&&Ru.box.length){vi=!0,J=Ul.shift;break}}return Ru};Jn(function(){return mi(ur,xi.iconBox,d.WritingMode.horizontal)},function(){var Pi=xi.verticalTextBox;return b.allowVerticalPlacement&&!(O&&O.box&&O.box.length)&&Wn.numVerticalGlyphVertices>0&&Pi?mi(Pi,xi.verticalIconBox,d.WritingMode.vertical):{box:null,offscreen:null}}),O&&(vi=O.box,Q=O.offscreen);var Ri=Vr(O&&O.box);if(!vi&&h.prevPlacement){var aa=h.prevPlacement.variableOffsets[Wn.crossTileID];aa&&(h.variableOffsets[Wn.crossTileID]=aa,h.markUsedJustification(b,aa.anchor,Wn,Ri))}}else{var pa=function(Pi,oo){var Ga=h.collisionIndex.placeCollisionBox(Pi,it,Ce,D,Ge.predicate);return Ga&&Ga.box&&Ga.box.length&&(h.markUsedOrientation(b,oo,Wn),h.placedOrientations[Wn.crossTileID]=oo),Ga};Jn(function(){return pa(ur,d.WritingMode.horizontal)},function(){var Pi=xi.verticalTextBox;return b.allowVerticalPlacement&&Wn.numVerticalGlyphVertices>0&&Pi?pa(Pi,d.WritingMode.vertical):{box:null,offscreen:null}}),Vr(O&&O.box&&O.box.length)}}if(vi=(ji=O)&&ji.box&&ji.box.length>0,Q=ji&&ji.offscreen,Wn.useRuntimeCollisionCircles){var ba=b.text.placedSymbolArray.get(Wn.centerJustifiedTextSymbolIndex),go=d.evaluateSizeForFeature(b.textSizeData,He,ba),Ca=T.get("text-padding");ne=h.collisionIndex.placeCollisionCircles(it,ba,b.lineVertexArray,b.glyphOffsetArray,go,D,V,se,o,gr,Ge.predicate,Wn.collisionCircleDiameter,Ca),vi=it||ne.circles.length>0&&!ne.collisionDetected,Q=Q&&ne.offscreen}if(xi.iconFeatureIndex&&(xt=xi.iconFeatureIndex),xi.iconBox){var Bo=function(Pi){var oo=fr&&J?ss(Pi,J.x,J.y,Vt,gr,h.transform.angle):Pi;return h.collisionIndex.placeCollisionBox(oo,bt,Ce,D,Ge.predicate)};Ci=F&&F.box&&F.box.length&&xi.verticalIconBox?(xe=Bo(xi.verticalIconBox)).box.length>0:(xe=Bo(xi.iconBox)).box.length>0,Q=Q&&xe.offscreen}var ka=nt||Wn.numHorizontalGlyphVertices===0&&Wn.numVerticalGlyphVertices===0,Zi=ze||Wn.numIconVertices===0;if(ka||Zi?Zi?ka||(Ci=Ci&&vi):vi=Ci&&vi:Ci=vi=Ci&&vi,vi&&ji&&ji.box&&h.collisionIndex.insertCollisionBox(ji.box,T.get("text-ignore-placement"),b.bucketInstanceId,F&&F.box&&Pt?Pt:pt,Ge.ID),Ci&&xe&&h.collisionIndex.insertCollisionBox(xe.box,T.get("icon-ignore-placement"),b.bucketInstanceId,xt,Ge.ID),ne&&(vi&&h.collisionIndex.insertCollisionCircles(ne.circles,T.get("text-ignore-placement"),b.bucketInstanceId,pt,Ge.ID),o)){var da=b.bucketInstanceId,$a=h.collisionCircleArrays[da];$a===void 0&&($a=h.collisionCircleArrays[da]=new vo);for(var yo=0;yo<ne.circles.length;yo+=4)$a.circles.push(ne.circles[yo+0]),$a.circles.push(ne.circles[yo+1]),$a.circles.push(ne.circles[yo+2]),$a.circles.push(ne.collisionDetected?1:0)}h.placements[Wn.crossTileID]=new Rs(vi||jr,Ci||fn,Q||b.justReloaded),u[Wn.crossTileID]=!0}};if(Er)for(var Zn=b.getSortedSymbolIndexes(this.transform.angle),si=Zn.length-1;si>=0;--si){var ui=Zn[si];tn(b.symbolInstances.get(ui),b.collisionArrays[ui])}else for(var dn=i.symbolInstanceStart;dn<i.symbolInstanceEnd;dn++)tn(b.symbolInstances.get(dn),b.collisionArrays[dn]);if(o&&b.bucketInstanceId in this.collisionCircleArrays){var ia=this.collisionCircleArrays[b.bucketInstanceId];d.invert(ia.invProjMatrix,D),ia.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1},Fo.prototype.markUsedJustification=function(i,u,o,h){var y;y=h===d.WritingMode.vertical?o.verticalPlacedTextSymbolIndex:{left:o.leftJustifiedTextSymbolIndex,center:o.centerJustifiedTextSymbolIndex,right:o.rightJustifiedTextSymbolIndex}[d.getAnchorJustification(u)];for(var b=0,T=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex,o.verticalPlacedTextSymbolIndex];b<T.length;b+=1){var D=T[b];D>=0&&(i.text.placedSymbolArray.get(D).crossTileID=y>=0&&D!==y?0:o.crossTileID)}},Fo.prototype.markUsedOrientation=function(i,u,o){for(var h=u===d.WritingMode.horizontal||u===d.WritingMode.horizontalOnly?u:0,y=u===d.WritingMode.vertical?u:0,b=0,T=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex];b<T.length;b+=1)i.text.placedSymbolArray.get(T[b]).placedOrientation=h;o.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation=y)},Fo.prototype.commit=function(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;var u=this.prevPlacement,o=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;var h=u?u.symbolFadeChange(i):1,y=u?u.opacities:{},b=u?u.variableOffsets:{},T=u?u.placedOrientations:{};for(var D in this.placements){var V=this.placements[D],se=y[D];se?(this.opacities[D]=new ko(se,h,V.text,V.icon),o=o||V.text!==se.text.placed||V.icon!==se.icon.placed):(this.opacities[D]=new ko(null,h,V.text,V.icon,V.skipFade),o=o||V.text||V.icon)}for(var Ce in y){var we=y[Ce];if(!this.opacities[Ce]){var Pe=new ko(we,h,!1,!1);Pe.isHidden()||(this.opacities[Ce]=Pe,o=o||we.text.placed||we.icon.placed)}}for(var He in b)this.variableOffsets[He]||!this.opacities[He]||this.opacities[He].isHidden()||(this.variableOffsets[He]=b[He]);for(var Ge in T)this.placedOrientations[Ge]||!this.opacities[Ge]||this.opacities[Ge].isHidden()||(this.placedOrientations[Ge]=T[Ge]);o?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:i)},Fo.prototype.updateLayerOpacities=function(i,u){for(var o={},h=0,y=u;h<y.length;h+=1){var b=y[h],T=b.getBucket(i);T&&b.latestFeatureIndex&&i.id===T.layerIds[0]&&this.updateBucketOpacities(T,o,b.collisionBoxArray)}},Fo.prototype.updateBucketOpacities=function(i,u,o){var h=this;i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();var y=i.layers[0].layout,b=new ko(null,0,!1,!1,!0),T=y.get("text-allow-overlap"),D=y.get("icon-allow-overlap"),V=y.get("text-variable-anchor"),se=y.get("text-rotation-alignment")==="map",Ce=y.get("text-pitch-alignment")==="map",we=y.get("icon-text-fit")!=="none",Pe=new ko(null,0,T&&(D||!i.hasIconData()||y.get("icon-optional")),D&&(T||!i.hasTextData()||y.get("text-optional")),!0);!i.collisionArrays&&o&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(o);for(var He=function(it,bt,Vt){for(var gr=0;gr<bt/4;gr++)it.opacityVertexArray.emplaceBack(Vt)},Ge=function(it){var bt=i.symbolInstances.get(it),Vt=bt.numHorizontalGlyphVertices,gr=bt.numVerticalGlyphVertices,fr=bt.crossTileID,Er=h.opacities[fr];u[fr]?Er=b:Er||(h.opacities[fr]=Er=Pe),u[fr]=!0;var jr=bt.numIconVertices>0,fn=h.placedOrientations[bt.crossTileID],tn=fn===d.WritingMode.vertical,Zn=fn===d.WritingMode.horizontal||fn===d.WritingMode.horizontalOnly;if(Vt>0||gr>0){var si=Ya(Er.text);He(i.text,Vt,tn?ja:si),He(i.text,gr,Zn?ja:si);var ui=Er.text.isHidden();[bt.rightJustifiedTextSymbolIndex,bt.centerJustifiedTextSymbolIndex,bt.leftJustifiedTextSymbolIndex].forEach(function(O){O>=0&&(i.text.placedSymbolArray.get(O).hidden=ui||tn?1:0)}),bt.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(bt.verticalPlacedTextSymbolIndex).hidden=ui||Zn?1:0);var dn=h.variableOffsets[bt.crossTileID];dn&&h.markUsedJustification(i,dn.anchor,bt,fn);var ia=h.placedOrientations[bt.crossTileID];ia&&(h.markUsedJustification(i,"left",bt,ia),h.markUsedOrientation(i,ia,bt))}if(jr){var Wn=Ya(Er.icon),xi=!(we&&bt.verticalPlacedIconSymbolIndex&&tn);bt.placedIconSymbolIndex>=0&&(He(i.icon,bt.numIconVertices,xi?Wn:ja),i.icon.placedSymbolArray.get(bt.placedIconSymbolIndex).hidden=Er.icon.isHidden()),bt.verticalPlacedIconSymbolIndex>=0&&(He(i.icon,bt.numVerticalIconVertices,xi?ja:Wn),i.icon.placedSymbolArray.get(bt.verticalPlacedIconSymbolIndex).hidden=Er.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){var ji=i.collisionArrays[it];if(ji){var vi=new d.Point(0,0);if(ji.textBox||ji.verticalTextBox){var Ci=!0;if(V){var Q=h.variableOffsets[fr];Q?(vi=co(Q.anchor,Q.width,Q.height,Q.textOffset,Q.textBoxScale),se&&vi._rotate(Ce?h.transform.angle:-h.transform.angle)):Ci=!1}ji.textBox&&Se(i.textCollisionBox.collisionVertexArray,Er.text.placed,!Ci||tn,vi.x,vi.y),ji.verticalTextBox&&Se(i.textCollisionBox.collisionVertexArray,Er.text.placed,!Ci||Zn,vi.x,vi.y)}var J=Boolean(!Zn&&ji.verticalIconBox);ji.iconBox&&Se(i.iconCollisionBox.collisionVertexArray,Er.icon.placed,J,we?vi.x:0,we?vi.y:0),ji.verticalIconBox&&Se(i.iconCollisionBox.collisionVertexArray,Er.icon.placed,!J,we?vi.x:0,we?vi.y:0)}}},nt=0;nt<i.symbolInstances.length;nt++)Ge(nt);if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){var ze=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=ze.invProjMatrix,i.placementViewportMatrix=ze.viewportMatrix,i.collisionCircleArray=ze.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}},Fo.prototype.symbolFadeChange=function(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Fo.prototype.zoomAdjustment=function(i){return Math.max(0,(this.transform.zoom-i)/1.5)},Fo.prototype.hasTransitions=function(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration},Fo.prototype.stillRecent=function(i,u){var o=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*o>i},Fo.prototype.setStale=function(){this.stale=!0};var ke=Math.pow(2,25),ft=Math.pow(2,24),L=Math.pow(2,17),Qr=Math.pow(2,16),ai=Math.pow(2,9),wi=Math.pow(2,8),fo=Math.pow(2,1);function Ya(i){if(i.opacity===0&&!i.placed)return 0;if(i.opacity===1&&i.placed)return 4294967295;var u=i.placed?1:0,o=Math.floor(127*i.opacity);return o*ke+u*ft+o*L+u*Qr+o*ai+u*wi+o*fo+u}var ja=0,us=function(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};us.prototype.continuePlacement=function(i,u,o,h,y){for(var b=this._bucketParts;this._currentTileIndex<i.length;)if(u.getBucketParts(b,h,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort(function(T,D){return T.sortKey-D.sortKey}));this._currentPartIndex<b.length;)if(u.placeLayerBucketPart(b[this._currentPartIndex],this._seenCrossTileIDs,o),this._currentPartIndex++,y())return!0;return!1};var fu=function(i,u,o,h,y,b,T){this.placement=new Fo(i,y,b,T),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=o,this._showCollisionBoxes=h,this._done=!1};fu.prototype.isDone=function(){return this._done},fu.prototype.continuePlacement=function(i,u,o){for(var h=this,y=d.browser.now(),b=function(){var V=d.browser.now()-y;return!h._forceFullPlacement&&V>2};this._currentPlacementIndex>=0;){var T=u[i[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=D)&&(!T.maxzoom||T.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new us(T)),this._inProgressLayer.continuePlacement(o[T.source],this.placement,this._showCollisionBoxes,T,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},fu.prototype.commit=function(i){return this.placement.commit(i),this.placement};var Mu=512/d.EXTENT/2,Yu=function(i,u,o){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=o;for(var h=0;h<u.length;h++){var y=u.get(h),b=y.key;this.indexedSymbolInstances[b]||(this.indexedSymbolInstances[b]=[]),this.indexedSymbolInstances[b].push({crossTileID:y.crossTileID,coord:this.getScaledCoordinates(y,i)})}};Yu.prototype.getScaledCoordinates=function(i,u){var o=Mu/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*d.EXTENT+i.anchorX)*o),y:Math.floor((u.canonical.y*d.EXTENT+i.anchorY)*o)}},Yu.prototype.findMatches=function(i,u,o){for(var h=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),y=0;y<i.length;y++){var b=i.get(y);if(!b.crossTileID){var T=this.indexedSymbolInstances[b.key];if(T)for(var D=this.getScaledCoordinates(b,u),V=0,se=T;V<se.length;V+=1){var Ce=se[V];if(Math.abs(Ce.coord.x-D.x)<=h&&Math.abs(Ce.coord.y-D.y)<=h&&!o[Ce.crossTileID]){o[Ce.crossTileID]=!0,b.crossTileID=Ce.crossTileID;break}}}}};var es=function(){this.maxCrossTileID=0};es.prototype.generate=function(){return++this.maxCrossTileID};var ts=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};ts.prototype.handleWrapJump=function(i){var u=Math.round((i-this.lng)/360);if(u!==0)for(var o in this.indexes){var h=this.indexes[o],y={};for(var b in h){var T=h[b];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+u),y[T.tileID.key]=T}this.indexes[o]=y}this.lng=i},ts.prototype.addBucket=function(i,u,o){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(var h=0;h<u.symbolInstances.length;h++)u.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});var y=this.usedCrossTileIDs[i.overscaledZ];for(var b in this.indexes){var T=this.indexes[b];if(Number(b)>i.overscaledZ)for(var D in T){var V=T[D];V.tileID.isChildOf(i)&&V.findMatches(u.symbolInstances,i,y)}else{var se=T[i.scaledTo(Number(b)).key];se&&se.findMatches(u.symbolInstances,i,y)}}for(var Ce=0;Ce<u.symbolInstances.length;Ce++){var we=u.symbolInstances.get(Ce);we.crossTileID||(we.crossTileID=o.generate(),y[we.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Yu(i,u.symbolInstances,u.bucketInstanceId),!0},ts.prototype.removeBucketCrossTileIDs=function(i,u){for(var o in u.indexedSymbolInstances)for(var h=0,y=u.indexedSymbolInstances[o];h<y.length;h+=1)delete this.usedCrossTileIDs[i][y[h].crossTileID]},ts.prototype.removeStaleBuckets=function(i){var u=!1;for(var o in this.indexes){var h=this.indexes[o];for(var y in h)i[h[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,h[y]),delete h[y],u=!0)}return u};var ls=function(){this.layerIndexes={},this.crossTileIDs=new es,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};ls.prototype.addLayer=function(i,u,o){var h=this.layerIndexes[i.id];h===void 0&&(h=this.layerIndexes[i.id]=new ts);var y=!1,b={};h.handleWrapJump(o);for(var T=0,D=u;T<D.length;T+=1){var V=D[T],se=V.getBucket(i);se&&i.id===se.layerIds[0]&&(se.bucketInstanceId||(se.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(V.tileID,se,this.crossTileIDs)&&(y=!0),b[se.bucketInstanceId]=!0)}return h.removeStaleBuckets(b)&&(y=!0),y},ls.prototype.pruneUnusedLayers=function(i){var u={};for(var o in i.forEach(function(h){u[h]=!0}),this.layerIndexes)u[o]||delete this.layerIndexes[o]};var ws=function(i,u){return d.emitValidationErrors(i,u&&u.filter(function(o){return o.identifier!=="source.canvas"}))},cs=d.pick(mn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Us=d.pick(mn,["setCenter","setZoom","setBearing","setPitch"]),$s=function(){var i={},u=d.styleSpec.$version;for(var o in d.styleSpec.$root){var h,y=d.styleSpec.$root[o];y.required&&(h=o==="version"?u:y.type==="array"?[]:{})!=null&&(i[o]=h)}return i}(),As=function(i){function u(o,h){var y=this;h===void 0&&(h={}),i.call(this),this.map=o,this.dispatcher=new jt(Kt(),this),this.imageManager=new Xt,this.imageManager.setEventedParent(this),this.glyphManager=new hr(o._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Xe(256,512),this.crossTileSymbolIndex=new ls,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",d.getReferrer());var b=this;this._rtlTextPluginCallback=u.registerForPluginStateChange(function(T){b.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:T.pluginStatus,pluginURL:T.pluginURL},function(D,V){if(d.triggerPluginCompletionEvent(D),V&&V.every(function(Ce){return Ce}))for(var se in b.sourceCaches)b.sourceCaches[se].reload()})}),this.on("data",function(T){if(T.dataType==="source"&&T.sourceDataType==="metadata"){var D=y.sourceCaches[T.sourceId];if(D){var V=D.getSource();if(V&&V.vectorLayerIds)for(var se in y._layers){var Ce=y._layers[se];Ce.source===V.id&&y._validateLayer(Ce)}}}})}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.loadURL=function(o,h){var y=this;h===void 0&&(h={}),this.fire(new d.Event("dataloading",{dataType:"style"}));var b=typeof h.validate=="boolean"?h.validate:!d.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,h.accessToken);var T=this.map._requestManager.transformRequest(o,d.ResourceType.Style);this._request=d.getJSON(T,function(D,V){y._request=null,D?y.fire(new d.ErrorEvent(D)):V&&y._load(V,b)})},u.prototype.loadJSON=function(o,h){var y=this;h===void 0&&(h={}),this.fire(new d.Event("dataloading",{dataType:"style"})),this._request=d.browser.frame(function(){y._request=null,y._load(o,h.validate!==!1)})},u.prototype.loadEmpty=function(){this.fire(new d.Event("dataloading",{dataType:"style"})),this._load($s,!1)},u.prototype._load=function(o,h){if(!h||!ws(this,d.validateStyle(o))){for(var y in this._loaded=!0,this.stylesheet=o,o.sources)this.addSource(y,o.sources[y],{validate:!1});o.sprite?this._loadSprite(o.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(o.glyphs);var b=hn(this.stylesheet.layers);this._order=b.map(function(se){return se.id}),this._layers={},this._serializedLayers={};for(var T=0,D=b;T<D.length;T+=1){var V=D[T];(V=d.createStyleLayer(V)).setEventedParent(this,{layer:{id:V.id}}),this._layers[V.id]=V,this._serializedLayers[V.id]=V.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ft(this.stylesheet.light),this.fire(new d.Event("data",{dataType:"style"})),this.fire(new d.Event("style.load"))}},u.prototype._loadSprite=function(o){var h=this;this._spriteRequest=function(y,b,T){var D,V,se,Ce=d.browser.devicePixelRatio>1?"@2x":"",we=d.getJSON(b.transformRequest(b.normalizeSpriteURL(y,Ce,".json"),d.ResourceType.SpriteJSON),function(Ge,nt){we=null,se||(se=Ge,D=nt,He())}),Pe=d.getImage(b.transformRequest(b.normalizeSpriteURL(y,Ce,".png"),d.ResourceType.SpriteImage),function(Ge,nt){Pe=null,se||(se=Ge,V=nt,He())});function He(){if(se)T(se);else if(D&&V){var Ge=d.browser.getImageData(V),nt={};for(var ze in D){var it=D[ze],bt=it.width,Vt=it.height,gr=it.x,fr=it.y,Er=it.sdf,jr=it.pixelRatio,fn=it.stretchX,tn=it.stretchY,Zn=it.content,si=new d.RGBAImage({width:bt,height:Vt});d.RGBAImage.copy(Ge,si,{x:gr,y:fr},{x:0,y:0},{width:bt,height:Vt}),nt[ze]={data:si,pixelRatio:jr,sdf:Er,stretchX:fn,stretchY:tn,content:Zn}}T(null,nt)}}return{cancel:function(){we&&(we.cancel(),we=null),Pe&&(Pe.cancel(),Pe=null)}}}(o,this.map._requestManager,function(y,b){if(h._spriteRequest=null,y)h.fire(new d.ErrorEvent(y));else if(b)for(var T in b)h.imageManager.addImage(T,b[T]);h.imageManager.setLoaded(!0),h._availableImages=h.imageManager.listImages(),h.dispatcher.broadcast("setImages",h._availableImages),h.fire(new d.Event("data",{dataType:"style"}))})},u.prototype._validateLayer=function(o){var h=this.sourceCaches[o.source];if(h){var y=o.sourceLayer;if(y){var b=h.getSource();(b.type==="geojson"||b.vectorLayerIds&&b.vectorLayerIds.indexOf(y)===-1)&&this.fire(new d.ErrorEvent(new Error('Source layer "'+y+'" does not exist on source "'+b.id+'" as specified by style layer "'+o.id+'"')))}}},u.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()},u.prototype._serializeLayers=function(o){for(var h=[],y=0,b=o;y<b.length;y+=1){var T=this._layers[b[y]];T.type!=="custom"&&h.push(T.serialize())}return h},u.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(var h in this._layers)if(this._layers[h].hasTransition())return!0;return!1},u.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},u.prototype.update=function(o){if(this._loaded){var h=this._changed;if(this._changed){var y=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);for(var T in(y.length||b.length)&&this._updateWorkerLayers(y,b),this._updatedSources){var D=this._updatedSources[T];D==="reload"?this._reloadSource(T):D==="clear"&&this._clearSource(T)}for(var V in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[V].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}var se={};for(var Ce in this.sourceCaches){var we=this.sourceCaches[Ce];se[Ce]=we.used,we.used=!1}for(var Pe=0,He=this._order;Pe<He.length;Pe+=1){var Ge=this._layers[He[Pe]];Ge.recalculate(o,this._availableImages),!Ge.isHidden(o.zoom)&&Ge.source&&(this.sourceCaches[Ge.source].used=!0)}for(var nt in se){var ze=this.sourceCaches[nt];se[nt]!==ze.used&&ze.fire(new d.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:nt}))}this.light.recalculate(o),this.z=o.zoom,h&&this.fire(new d.Event("data",{dataType:"style"}))}},u.prototype._updateTilesForChangedImages=function(){var o=Object.keys(this._changedImages);if(o.length){for(var h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}},u.prototype._updateWorkerLayers=function(o,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:h})},u.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},u.prototype.setState=function(o){var h=this;if(this._checkLoaded(),ws(this,d.validateStyle(o)))return!1;(o=d.clone$1(o)).layers=hn(o.layers);var y=function(T,D){if(!T)return[{command:mn.setStyle,args:[D]}];var V=[];try{if(!d.deepEqual(T.version,D.version))return[{command:mn.setStyle,args:[D]}];d.deepEqual(T.center,D.center)||V.push({command:mn.setCenter,args:[D.center]}),d.deepEqual(T.zoom,D.zoom)||V.push({command:mn.setZoom,args:[D.zoom]}),d.deepEqual(T.bearing,D.bearing)||V.push({command:mn.setBearing,args:[D.bearing]}),d.deepEqual(T.pitch,D.pitch)||V.push({command:mn.setPitch,args:[D.pitch]}),d.deepEqual(T.sprite,D.sprite)||V.push({command:mn.setSprite,args:[D.sprite]}),d.deepEqual(T.glyphs,D.glyphs)||V.push({command:mn.setGlyphs,args:[D.glyphs]}),d.deepEqual(T.transition,D.transition)||V.push({command:mn.setTransition,args:[D.transition]}),d.deepEqual(T.light,D.light)||V.push({command:mn.setLight,args:[D.light]});var se={},Ce=[];(function(Pe,He,Ge,nt){var ze;for(ze in He=He||{},Pe=Pe||{})Pe.hasOwnProperty(ze)&&(He.hasOwnProperty(ze)||An(ze,Ge,nt));for(ze in He)He.hasOwnProperty(ze)&&(Pe.hasOwnProperty(ze)?d.deepEqual(Pe[ze],He[ze])||(Pe[ze].type==="geojson"&&He[ze].type==="geojson"&&ra(Pe,He,ze)?Ge.push({command:mn.setGeoJSONSourceData,args:[ze,He[ze].data]}):Di(ze,He,Ge,nt)):Bi(ze,He,Ge))})(T.sources,D.sources,Ce,se);var we=[];T.layers&&T.layers.forEach(function(Pe){se[Pe.source]?V.push({command:mn.removeLayer,args:[Pe.id]}):we.push(Pe)}),V=V.concat(Ce),function(Pe,He,Ge){He=He||[];var nt,ze,it,bt,Vt,gr,fr,Er=(Pe=Pe||[]).map(na),jr=He.map(na),fn=Pe.reduce(Hi,{}),tn=He.reduce(Hi,{}),Zn=Er.slice(),si=Object.create(null);for(nt=0,ze=0;nt<Er.length;nt++)tn.hasOwnProperty(it=Er[nt])?ze++:(Ge.push({command:mn.removeLayer,args:[it]}),Zn.splice(Zn.indexOf(it,ze),1));for(nt=0,ze=0;nt<jr.length;nt++)Zn[Zn.length-1-nt]!==(it=jr[jr.length-1-nt])&&(fn.hasOwnProperty(it)?(Ge.push({command:mn.removeLayer,args:[it]}),Zn.splice(Zn.lastIndexOf(it,Zn.length-ze),1)):ze++,Ge.push({command:mn.addLayer,args:[tn[it],gr=Zn[Zn.length-nt]]}),Zn.splice(Zn.length-nt,0,it),si[it]=!0);for(nt=0;nt<jr.length;nt++)if(bt=fn[it=jr[nt]],Vt=tn[it],!si[it]&&!d.deepEqual(bt,Vt))if(d.deepEqual(bt.source,Vt.source)&&d.deepEqual(bt["source-layer"],Vt["source-layer"])&&d.deepEqual(bt.type,Vt.type)){for(fr in hi(bt.layout,Vt.layout,Ge,it,null,mn.setLayoutProperty),hi(bt.paint,Vt.paint,Ge,it,null,mn.setPaintProperty),d.deepEqual(bt.filter,Vt.filter)||Ge.push({command:mn.setFilter,args:[it,Vt.filter]}),d.deepEqual(bt.minzoom,Vt.minzoom)&&d.deepEqual(bt.maxzoom,Vt.maxzoom)||Ge.push({command:mn.setLayerZoomRange,args:[it,Vt.minzoom,Vt.maxzoom]}),bt)bt.hasOwnProperty(fr)&&fr!=="layout"&&fr!=="paint"&&fr!=="filter"&&fr!=="metadata"&&fr!=="minzoom"&&fr!=="maxzoom"&&(fr.indexOf("paint.")===0?hi(bt[fr],Vt[fr],Ge,it,fr.slice(6),mn.setPaintProperty):d.deepEqual(bt[fr],Vt[fr])||Ge.push({command:mn.setLayerProperty,args:[it,fr,Vt[fr]]}));for(fr in Vt)Vt.hasOwnProperty(fr)&&!bt.hasOwnProperty(fr)&&fr!=="layout"&&fr!=="paint"&&fr!=="filter"&&fr!=="metadata"&&fr!=="minzoom"&&fr!=="maxzoom"&&(fr.indexOf("paint.")===0?hi(bt[fr],Vt[fr],Ge,it,fr.slice(6),mn.setPaintProperty):d.deepEqual(bt[fr],Vt[fr])||Ge.push({command:mn.setLayerProperty,args:[it,fr,Vt[fr]]}))}else Ge.push({command:mn.removeLayer,args:[it]}),gr=Zn[Zn.lastIndexOf(it)+1],Ge.push({command:mn.addLayer,args:[Vt,gr]})}(we,D.layers,V)}catch(Pe){console.warn("Unable to compute style diff:",Pe),V=[{command:mn.setStyle,args:[D]}]}return V}(this.serialize(),o).filter(function(T){return!(T.command in Us)});if(y.length===0)return!1;var b=y.filter(function(T){return!(T.command in cs)});if(b.length>0)throw new Error("Unimplemented: "+b.map(function(T){return T.command}).join(", ")+".");return y.forEach(function(T){T.command!=="setTransition"&&h[T.command].apply(h,T.args)}),this.stylesheet=o,!0},u.prototype.addImage=function(o,h){if(this.getImage(o))return this.fire(new d.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(o,h),this._afterImageUpdated(o)},u.prototype.updateImage=function(o,h){this.imageManager.updateImage(o,h)},u.prototype.getImage=function(o){return this.imageManager.getImage(o)},u.prototype.removeImage=function(o){if(!this.getImage(o))return this.fire(new d.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(o),this._afterImageUpdated(o)},u.prototype._afterImageUpdated=function(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.Event("data",{dataType:"style"}))},u.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},u.prototype.addSource=function(o,h,y){var b=this;if(y===void 0&&(y={}),this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(h).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(d.validateStyle.source,"sources."+o,h,null,y))){this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);var T=this.sourceCaches[o]=new _e(o,h,this.dispatcher);T.style=this,T.setEventedParent(this,function(){return{isSourceLoaded:b.loaded(),source:T.serialize(),sourceId:o}}),T.onAdd(this.map),this._changed=!0}},u.prototype.removeSource=function(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(var h in this._layers)if(this._layers[h].source===o)return this.fire(new d.ErrorEvent(new Error('Source "'+o+'" cannot be removed while layer "'+h+'" is using it.')));var y=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],y.fire(new d.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),y.setEventedParent(null),y.clearTiles(),y.onRemove&&y.onRemove(this.map),this._changed=!0},u.prototype.setGeoJSONSourceData=function(o,h){this._checkLoaded(),this.sourceCaches[o].getSource().setData(h),this._changed=!0},u.prototype.getSource=function(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()},u.prototype.addLayer=function(o,h,y){y===void 0&&(y={}),this._checkLoaded();var b=o.id;if(this.getLayer(b))this.fire(new d.ErrorEvent(new Error('Layer with id "'+b+'" already exists on this map')));else{var T;if(o.type==="custom"){if(ws(this,d.validateCustomStyleLayer(o)))return;T=d.createStyleLayer(o)}else{if(typeof o.source=="object"&&(this.addSource(b,o.source),o=d.clone$1(o),o=d.extend(o,{source:b})),this._validate(d.validateStyle.layer,"layers."+b,o,{arrayIndex:-1},y))return;T=d.createStyleLayer(o),this._validateLayer(T),T.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[T.id]=T.serialize()}var D=h?this._order.indexOf(h):this._order.length;if(h&&D===-1)this.fire(new d.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.')));else{if(this._order.splice(D,0,b),this._layerOrderChanged=!0,this._layers[b]=T,this._removedLayers[b]&&T.source&&T.type!=="custom"){var V=this._removedLayers[b];delete this._removedLayers[b],V.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}},u.prototype.moveLayer=function(o,h){if(this._checkLoaded(),this._changed=!0,this._layers[o]){if(o!==h){var y=this._order.indexOf(o);this._order.splice(y,1);var b=h?this._order.indexOf(h):this._order.length;h&&b===-1?this.fire(new d.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.'))):(this._order.splice(b,0,o),this._layerOrderChanged=!0)}}else this.fire(new d.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be moved.")))},u.prototype.removeLayer=function(o){this._checkLoaded();var h=this._layers[o];if(h){h.setEventedParent(null);var y=this._order.indexOf(o);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=h,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],h.onRemove&&h.onRemove(this.map)}else this.fire(new d.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be removed.")))},u.prototype.getLayer=function(o){return this._layers[o]},u.prototype.hasLayer=function(o){return o in this._layers},u.prototype.setLayerZoomRange=function(o,h,y){this._checkLoaded();var b=this.getLayer(o);b?b.minzoom===h&&b.maxzoom===y||(h!=null&&(b.minzoom=h),y!=null&&(b.maxzoom=y),this._updateLayer(b)):this.fire(new d.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot have zoom extent.")))},u.prototype.setFilter=function(o,h,y){y===void 0&&(y={}),this._checkLoaded();var b=this.getLayer(o);if(b){if(!d.deepEqual(b.filter,h))return h==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(d.validateStyle.filter,"layers."+b.id+".filter",h,null,y)||(b.filter=d.clone$1(h),this._updateLayer(b)))}else this.fire(new d.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be filtered.")))},u.prototype.getFilter=function(o){return d.clone$1(this.getLayer(o).filter)},u.prototype.setLayoutProperty=function(o,h,y,b){b===void 0&&(b={}),this._checkLoaded();var T=this.getLayer(o);T?d.deepEqual(T.getLayoutProperty(h),y)||(T.setLayoutProperty(h,y,b),this._updateLayer(T)):this.fire(new d.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getLayoutProperty=function(o,h){var y=this.getLayer(o);if(y)return y.getLayoutProperty(h);this.fire(new d.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style.")))},u.prototype.setPaintProperty=function(o,h,y,b){b===void 0&&(b={}),this._checkLoaded();var T=this.getLayer(o);T?d.deepEqual(T.getPaintProperty(h),y)||(T.setPaintProperty(h,y,b)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new d.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getPaintProperty=function(o,h){return this.getLayer(o).getPaintProperty(h)},u.prototype.setFeatureState=function(o,h){this._checkLoaded();var y=o.source,b=o.sourceLayer,T=this.sourceCaches[y];if(T!==void 0){var D=T.getSource().type;D==="geojson"&&b?this.fire(new d.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):D!=="vector"||b?(o.id===void 0&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided."))),T.setFeatureState(b,o.id,h)):this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error("The source '"+y+"' does not exist in the map's style.")))},u.prototype.removeFeatureState=function(o,h){this._checkLoaded();var y=o.source,b=this.sourceCaches[y];if(b!==void 0){var T=b.getSource().type,D=T==="vector"?o.sourceLayer:void 0;T!=="vector"||D?h&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new d.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):b.removeFeatureState(D,o.id,h):this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error("The source '"+y+"' does not exist in the map's style.")))},u.prototype.getFeatureState=function(o){this._checkLoaded();var h=o.source,y=o.sourceLayer,b=this.sourceCaches[h];if(b!==void 0){if(b.getSource().type!=="vector"||y)return o.id===void 0&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided."))),b.getFeatureState(y,o.id);this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error("The source '"+h+"' does not exist in the map's style.")))},u.prototype.getTransition=function(){return d.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},u.prototype.serialize=function(){return d.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:d.mapObject(this.sourceCaches,function(o){return o.serialize()}),layers:this._serializeLayers(this._order)},function(o){return o!==void 0})},u.prototype._updateLayer=function(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._changed=!0},u.prototype._flattenAndSortRenderedFeatures=function(o){for(var h=this,y=function(fn){return h._layers[fn].type==="fill-extrusion"},b={},T=[],D=this._order.length-1;D>=0;D--){var V=this._order[D];if(y(V)){b[V]=D;for(var se=0,Ce=o;se<Ce.length;se+=1){var we=Ce[se][V];if(we)for(var Pe=0,He=we;Pe<He.length;Pe+=1)T.push(He[Pe])}}}T.sort(function(fn,tn){return tn.intersectionZ-fn.intersectionZ});for(var Ge=[],nt=this._order.length-1;nt>=0;nt--){var ze=this._order[nt];if(y(ze))for(var it=T.length-1;it>=0;it--){var bt=T[it].feature;if(b[bt.layer.id]<nt)break;Ge.push(bt),T.pop()}else for(var Vt=0,gr=o;Vt<gr.length;Vt+=1){var fr=gr[Vt][ze];if(fr)for(var Er=0,jr=fr;Er<jr.length;Er+=1)Ge.push(jr[Er].feature)}}return Ge},u.prototype.queryRenderedFeatures=function(o,h,y){h&&h.filter&&this._validate(d.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);var b={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new d.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var T=0,D=h.layers;T<D.length;T+=1){var V=D[T],se=this._layers[V];if(!se)return this.fire(new d.ErrorEvent(new Error("The layer '"+V+"' does not exist in the map's style and cannot be queried for features."))),[];b[se.source]=!0}}var Ce=[];for(var we in h.availableImages=this._availableImages,this.sourceCaches)h.layers&&!b[we]||Ce.push(En(this.sourceCaches[we],this._layers,this._serializedLayers,o,h,y));return this.placement&&Ce.push(function(Pe,He,Ge,nt,ze,it,bt){for(var Vt={},gr=it.queryRenderedSymbols(nt),fr=[],Er=0,jr=Object.keys(gr).map(Number);Er<jr.length;Er+=1)fr.push(bt[jr[Er]]);fr.sort(ea);for(var fn=function(){var dn=Zn[tn],ia=dn.featureIndex.lookupSymbolFeatures(gr[dn.bucketInstanceId],He,dn.bucketIndex,dn.sourceLayerIndex,ze.filter,ze.layers,ze.availableImages,Pe);for(var Wn in ia){var xi=Vt[Wn]=Vt[Wn]||[],ji=ia[Wn];ji.sort(function(Q,J){var O=dn.featureSortOrder;if(O){var F=O.indexOf(Q.featureIndex);return O.indexOf(J.featureIndex)-F}return J.featureIndex-Q.featureIndex});for(var vi=0,Ci=ji;vi<Ci.length;vi+=1)xi.push(Ci[vi])}},tn=0,Zn=fr;tn<Zn.length;tn+=1)fn();var si=function(dn){Vt[dn].forEach(function(ia){var Wn=ia.feature,xi=Ge[Pe[dn].source].getFeatureState(Wn.layer["source-layer"],Wn.id);Wn.source=Wn.layer.source,Wn.layer["source-layer"]&&(Wn.sourceLayer=Wn.layer["source-layer"]),Wn.state=xi})};for(var ui in Vt)si(ui);return Vt}(this._layers,this._serializedLayers,this.sourceCaches,o,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(Ce)},u.prototype.querySourceFeatures=function(o,h){h&&h.filter&&this._validate(d.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);var y=this.sourceCaches[o];return y?function(b,T){for(var D=b.getRenderableIds().map(function(He){return b.getTileByID(He)}),V=[],se={},Ce=0;Ce<D.length;Ce++){var we=D[Ce],Pe=we.tileID.canonical.key;se[Pe]||(se[Pe]=!0,we.querySourceFeatures(V,T))}return V}(y,h):[]},u.prototype.addSourceType=function(o,h,y){return u.getSourceType(o)?y(new Error('A source type called "'+o+'" already exists.')):(u.setSourceType(o,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:h.workerSourceURL},y):y(null,null))},u.prototype.getLight=function(){return this.light.getLight()},u.prototype.setLight=function(o,h){h===void 0&&(h={}),this._checkLoaded();var y=this.light.getLight(),b=!1;for(var T in o)if(!d.deepEqual(o[T],y[T])){b=!0;break}if(b){var D={now:d.browser.now(),transition:d.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,h),this.light.updateTransitions(D)}},u.prototype._validate=function(o,h,y,b,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&ws(this,o.call(d.validateStyle,d.extend({key:h,style:this.serialize(),value:y,styleSpec:d.styleSpec},b)))},u.prototype._remove=function(){for(var o in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),d.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[o].setEventedParent(null);for(var h in this.sourceCaches)this.sourceCaches[h].clearTiles(),this.sourceCaches[h].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},u.prototype._clearSource=function(o){this.sourceCaches[o].clearTiles()},u.prototype._reloadSource=function(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()},u.prototype._updateSources=function(o){for(var h in this.sourceCaches)this.sourceCaches[h].update(o)},u.prototype._generateCollisionBoxes=function(){for(var o in this.sourceCaches)this._reloadSource(o)},u.prototype._updatePlacement=function(o,h,y,b,T){T===void 0&&(T=!1);for(var D=!1,V=!1,se={},Ce=0,we=this._order;Ce<we.length;Ce+=1){var Pe=this._layers[we[Ce]];if(Pe.type==="symbol"){if(!se[Pe.source]){var He=this.sourceCaches[Pe.source];se[Pe.source]=He.getRenderableIds(!0).map(function(bt){return He.getTileByID(bt)}).sort(function(bt,Vt){return Vt.tileID.overscaledZ-bt.tileID.overscaledZ||(bt.tileID.isLessThan(Vt.tileID)?-1:1)})}var Ge=this.crossTileSymbolIndex.addLayer(Pe,se[Pe.source],o.center.lng);D=D||Ge}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||y===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(d.browser.now(),o.zoom))&&(this.pauseablePlacement=new fu(o,this._order,T,h,y,b,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,se),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(d.browser.now()),V=!0),D&&this.pauseablePlacement.placement.setStale()),V||D)for(var nt=0,ze=this._order;nt<ze.length;nt+=1){var it=this._layers[ze[nt]];it.type==="symbol"&&this.placement.updateLayerOpacities(it,se[it.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(d.browser.now())},u.prototype._releaseSymbolFadeTiles=function(){for(var o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()},u.prototype.getImages=function(o,h,y){this.imageManager.getImages(h.icons,y),this._updateTilesForChangedImages();var b=this.sourceCaches[h.source];b&&b.setDependencies(h.tileID.key,h.type,h.icons)},u.prototype.getGlyphs=function(o,h,y){this.glyphManager.getGlyphs(h.stacks,y)},u.prototype.getResource=function(o,h,y){return d.makeRequest(h,y)},u}(d.Evented);As.getSourceType=function(i){return Ur[i]},As.setSourceType=function(i,u){Ur[i]=u},As.registerForPluginStateChange=d.registerForPluginStateChange;var Ea=d.createLayout([{name:"a_pos",type:"Int16",components:2}]),Co=_i(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),dl=_i(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),vl=_i(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ku=_i(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Xl=_i("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),ml=_i(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Du=_i(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Zs=_i("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),gl=_i("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),m=_i("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),A=_i(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),z=_i(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),I=_i(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fe=_i(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Ie=_i(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),lt=_i(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Dt=_i(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Nt=_i(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Dr=_i(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Wr=_i(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),ln=_i(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Li=_i(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Ei=_i(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),ha=_i(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Pa=_i(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),ya=_i(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function _i(i,u){var o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=u.match(/attribute ([\w]+) ([\w]+)/g),y=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=b?b.concat(y):y,D={};return{fragmentSource:i=i.replace(o,function(V,se,Ce,we,Pe){return D[Pe]=!0,se==="define"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
varying `+Ce+" "+we+" "+Pe+`;
#else
uniform `+Ce+" "+we+" u_"+Pe+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Pe+`
    `+Ce+" "+we+" "+Pe+" = u_"+Pe+`;
#endif
`}),vertexSource:u=u.replace(o,function(V,se,Ce,we,Pe){var He=we==="float"?"vec2":"vec4",Ge=Pe.match(/color/)?"color":He;return D[Pe]?se==="define"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
uniform lowp float u_`+Pe+`_t;
attribute `+Ce+" "+He+" a_"+Pe+`;
varying `+Ce+" "+we+" "+Pe+`;
#else
uniform `+Ce+" "+we+" u_"+Pe+`;
#endif
`:Ge==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
    `+Pe+" = a_"+Pe+`;
#else
    `+Ce+" "+we+" "+Pe+" = u_"+Pe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Pe+`
    `+Pe+" = unpack_mix_"+Ge+"(a_"+Pe+", u_"+Pe+`_t);
#else
    `+Ce+" "+we+" "+Pe+" = u_"+Pe+`;
#endif
`:se==="define"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
uniform lowp float u_`+Pe+`_t;
attribute `+Ce+" "+He+" a_"+Pe+`;
#else
uniform `+Ce+" "+we+" u_"+Pe+`;
#endif
`:Ge==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
    `+Ce+" "+we+" "+Pe+" = a_"+Pe+`;
#else
    `+Ce+" "+we+" "+Pe+" = u_"+Pe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Pe+`
    `+Ce+" "+we+" "+Pe+" = unpack_mix_"+Ge+"(a_"+Pe+", u_"+Pe+`_t);
#else
    `+Ce+" "+we+" "+Pe+" = u_"+Pe+`;
#endif
`}),staticAttributes:h,staticUniforms:T}}var mo=Object.freeze({__proto__:null,prelude:Co,background:dl,backgroundPattern:vl,circle:Ku,clippingMask:Xl,heatmap:ml,heatmapTexture:Du,collisionBox:Zs,collisionCircle:gl,debug:m,fill:A,fillOutline:z,fillOutlinePattern:I,fillPattern:fe,fillExtrusion:Ie,fillExtrusionPattern:lt,hillshadePrepare:Dt,hillshade:Nt,line:Dr,lineGradient:Wr,linePattern:ln,lineSDF:Li,raster:Ei,symbolIcon:ha,symbolSDF:Pa,symbolTextAndIcon:ya}),wo=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Js(i){for(var u=[],o=0;o<i.length;o++)if(i[o]!==null){var h=i[o].split(" ");u.push(h.pop())}return u}wo.prototype.bind=function(i,u,o,h,y,b,T,D){this.context=i;for(var V=this.boundPaintVertexBuffers.length!==h.length,se=0;!V&&se<h.length;se++)this.boundPaintVertexBuffers[se]!==h[se]&&(V=!0);i.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===o&&!V&&this.boundIndexBuffer===y&&this.boundVertexOffset===b&&this.boundDynamicVertexBuffer===T&&this.boundDynamicVertexBuffer2===D?(i.bindVertexArrayOES.set(this.vao),T&&T.bind(),y&&y.dynamicDraw&&y.bind(),D&&D.bind()):this.freshBind(u,o,h,y,b,T,D)},wo.prototype.freshBind=function(i,u,o,h,y,b,T){var D,V=i.numAttributes,se=this.context,Ce=se.gl;if(se.extVertexArrayObject)this.vao&&this.destroy(),this.vao=se.extVertexArrayObject.createVertexArrayOES(),se.bindVertexArrayOES.set(this.vao),D=0,this.boundProgram=i,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=h,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=T;else{D=se.currentNumAttributes||0;for(var we=V;we<D;we++)Ce.disableVertexAttribArray(we)}u.enableAttributes(Ce,i);for(var Pe=0,He=o;Pe<He.length;Pe+=1)He[Pe].enableAttributes(Ce,i);b&&b.enableAttributes(Ce,i),T&&T.enableAttributes(Ce,i),u.bind(),u.setVertexAttribPointers(Ce,i,y);for(var Ge=0,nt=o;Ge<nt.length;Ge+=1){var ze=nt[Ge];ze.bind(),ze.setVertexAttribPointers(Ce,i,y)}b&&(b.bind(),b.setVertexAttribPointers(Ce,i,y)),h&&h.bind(),T&&(T.bind(),T.setVertexAttribPointers(Ce,i,y)),se.currentNumAttributes=V},wo.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var hu=function(i,u,o,h,y,b){var T=i.gl;this.program=T.createProgram();for(var D=Js(o.staticAttributes),V=h?h.getBinderAttributes():[],se=D.concat(V),Ce=o.staticUniforms?Js(o.staticUniforms):[],we=h?h.getBinderUniforms():[],Pe=[],He=0,Ge=Ce.concat(we);He<Ge.length;He+=1){var nt=Ge[He];Pe.indexOf(nt)<0&&Pe.push(nt)}var ze=h?h.defines():[];b&&ze.push("#define OVERDRAW_INSPECTOR;");var it=ze.concat(Co.fragmentSource,o.fragmentSource).join(`
`),bt=ze.concat(Co.vertexSource,o.vertexSource).join(`
`),Vt=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(Vt,it),T.compileShader(Vt),T.attachShader(this.program,Vt);var gr=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(gr,bt),T.compileShader(gr),T.attachShader(this.program,gr),this.attributes={};var fr={};this.numAttributes=se.length;for(var Er=0;Er<this.numAttributes;Er++)se[Er]&&(T.bindAttribLocation(this.program,Er,se[Er]),this.attributes[se[Er]]=Er);T.linkProgram(this.program),T.deleteShader(gr),T.deleteShader(Vt);for(var jr=0;jr<Pe.length;jr++){var fn=Pe[jr];if(fn&&!fr[fn]){var tn=T.getUniformLocation(this.program,fn);tn&&(fr[fn]=tn)}}this.fixedUniforms=y(i,fr),this.binderUniforms=h?h.getUniforms(i,fr):[]}}};function Qs(i,u,o){var h=1/xa(o,1,u.transform.tileZoom),y=Math.pow(2,o.tileID.overscaledZ),b=o.tileSize*Math.pow(2,u.transform.tileZoom)/y,T=b*(o.tileID.canonical.x+o.tileID.wrap*y),D=b*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[h,i.fromScale,i.toScale],u_fade:i.t,u_pixel_coord_upper:[T>>16,D>>16],u_pixel_coord_lower:[65535&T,65535&D]}}hu.prototype.draw=function(i,u,o,h,y,b,T,D,V,se,Ce,we,Pe,He,Ge,nt){var ze,it=i.gl;if(!this.failedToCreate){for(var bt in i.program.set(this.program),i.setDepthMode(o),i.setStencilMode(h),i.setColorMode(y),i.setCullFace(b),this.fixedUniforms)this.fixedUniforms[bt].set(T[bt]);He&&He.setUniforms(i,this.binderUniforms,we,{zoom:Pe});for(var Vt=(ze={},ze[it.LINES]=2,ze[it.TRIANGLES]=3,ze[it.LINE_STRIP]=1,ze)[u],gr=0,fr=Ce.get();gr<fr.length;gr+=1){var Er=fr[gr],jr=Er.vaos||(Er.vaos={});(jr[D]||(jr[D]=new wo)).bind(i,this,V,He?He.getPaintVertexBuffers():[],se,Er.vertexOffset,Ge,nt),it.drawElements(u,Er.primitiveLength*Vt,it.UNSIGNED_SHORT,Er.primitiveOffset*Vt*2)}}};var ku=function(i,u,o,h){var y=u.style.light,b=y.properties.get("position"),T=[b.x,b.y,b.z],D=d.create$1();y.properties.get("anchor")==="viewport"&&d.fromRotation(D,-u.transform.angle),d.transformMat3(T,T,D);var V=y.properties.get("color");return{u_matrix:i,u_lightpos:T,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[V.r,V.g,V.b],u_vertical_gradient:+o,u_opacity:h}},Yo=function(i,u,o,h,y,b,T){return d.extend(ku(i,u,o,h),Qs(b,u,T),{u_height_factor:-Math.pow(2,y.overscaledZ)/T.tileSize/8})},ms=function(i){return{u_matrix:i}},no=function(i,u,o,h){return d.extend(ms(i),Qs(o,u,h))},Ma=function(i,u){return{u_matrix:i,u_world:u}},qs=function(i,u,o,h,y){return d.extend(no(i,u,o,h),{u_world:y})},yl=function(i,u,o,h){var y,b,T=i.transform;if(h.paint.get("circle-pitch-alignment")==="map"){var D=xa(o,1,T.zoom);y=!0,b=[D,D]}else y=!1,b=T.pixelsToGLUnits;return{u_camera_to_center_distance:T.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:i.translatePosMatrix(u.posMatrix,o,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:d.browser.devicePixelRatio,u_extrude_scale:b}},gs=function(i,u,o){var h=xa(o,1,u.zoom),y=Math.pow(2,u.zoom-o.tileID.overscaledZ),b=o.tileID.overscaleFactor();return{u_matrix:i,u_camera_to_center_distance:u.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[u.pixelsToGLUnits[0]/(h*y),u.pixelsToGLUnits[1]/(h*y)],u_overscale_factor:b}},Ol=function(i,u,o){return{u_matrix:i,u_inv_matrix:u,u_camera_to_center_distance:o.cameraToCenterDistance,u_viewport_size:[o.width,o.height]}},eu=function(i,u,o){return o===void 0&&(o=1),{u_matrix:i,u_color:u,u_overlay:0,u_overlay_scale:o}},tu=function(i){return{u_matrix:i}},mc=function(i,u,o,h){return{u_matrix:i,u_extrude_scale:xa(u,1,o),u_intensity:h}},Fu=function(i,u,o){var h=i.transform;return{u_matrix:xl(i,u,o),u_ratio:1/xa(u,1,h.zoom),u_device_pixel_ratio:d.browser.devicePixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Ia=function(i,u,o,h){return d.extend(Fu(i,u,o),{u_image:0,u_image_height:h})},_l=function(i,u,o,h){var y=i.transform,b=Bu(u,y);return{u_matrix:xl(i,u,o),u_texsize:u.imageAtlasTexture.size,u_ratio:1/xa(u,1,y.zoom),u_device_pixel_ratio:d.browser.devicePixelRatio,u_image:0,u_scale:[b,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},$c=function(i,u,o,h,y){var b=i.lineAtlas,T=Bu(u,i.transform),D=o.layout.get("line-cap")==="round",V=b.getDash(h.from,D),se=b.getDash(h.to,D),Ce=V.width*y.fromScale,we=se.width*y.toScale;return d.extend(Fu(i,u,o),{u_patternscale_a:[T/Ce,-V.height/2],u_patternscale_b:[T/we,-se.height/2],u_sdfgamma:b.width/(256*Math.min(Ce,we)*d.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:V.y,u_tex_y_b:se.y,u_mix:y.t})};function Bu(i,u){return 1/xa(i,1,u.tileZoom)}function xl(i,u,o){return i.translatePosMatrix(u.tileID.posMatrix,u,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}var Jc=function(i,u,o,h,y){return{u_matrix:i,u_tl_parent:u,u_scale_parent:o,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(T=y.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(b=y.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:$u(y.paint.get("raster-hue-rotate"))};var b,T};function $u(i){i*=Math.PI/180;var u=Math.sin(i),o=Math.cos(i);return[(2*o+1)/3,(-Math.sqrt(3)*u-o+1)/3,(Math.sqrt(3)*u-o+1)/3]}var Yl,Iu=function(i,u,o,h,y,b,T,D,V,se){var Ce=y.transform;return{u_is_size_zoom_constant:+(i==="constant"||i==="source"),u_is_size_feature_constant:+(i==="constant"||i==="camera"),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:Ce.cameraToCenterDistance,u_pitch:Ce.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:Ce.width/Ce.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:T,u_coord_matrix:D,u_is_text:+V,u_pitch_with_map:+h,u_texsize:se,u_texture:0}},Ju=function(i,u,o,h,y,b,T,D,V,se,Ce){var we=y.transform;return d.extend(Iu(i,u,o,h,y,b,T,D,V,se),{u_gamma_scale:h?Math.cos(we._pitch)*we.cameraToCenterDistance:1,u_device_pixel_ratio:d.browser.devicePixelRatio,u_is_halo:+Ce})},bl=function(i,u,o,h,y,b,T,D,V,se){return d.extend(Ju(i,u,o,h,y,b,T,D,!0,V,!0),{u_texsize_icon:se,u_texture_icon:1})},Sl=function(i,u,o){return{u_matrix:i,u_opacity:u,u_color:o}},Qu=function(i,u,o,h,y,b){return d.extend(function(T,D,V,se){var Ce=V.imageManager.getPattern(T.from.toString()),we=V.imageManager.getPattern(T.to.toString()),Pe=V.imageManager.getPixelSize(),He=Pe.width,Ge=Pe.height,nt=Math.pow(2,se.tileID.overscaledZ),ze=se.tileSize*Math.pow(2,V.transform.tileZoom)/nt,it=ze*(se.tileID.canonical.x+se.tileID.wrap*nt),bt=ze*se.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Ce.tl,u_pattern_br_a:Ce.br,u_pattern_tl_b:we.tl,u_pattern_br_b:we.br,u_texsize:[He,Ge],u_mix:D.t,u_pattern_size_a:Ce.displaySize,u_pattern_size_b:we.displaySize,u_scale_a:D.fromScale,u_scale_b:D.toScale,u_tile_units_to_pixels:1/xa(se,1,V.transform.tileZoom),u_pixel_coord_upper:[it>>16,bt>>16],u_pixel_coord_lower:[65535&it,65535&bt]}}(h,b,o,y),{u_matrix:i,u_opacity:u})},El={fillExtrusion:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_lightpos:new d.Uniform3f(i,u.u_lightpos),u_lightintensity:new d.Uniform1f(i,u.u_lightintensity),u_lightcolor:new d.Uniform3f(i,u.u_lightcolor),u_vertical_gradient:new d.Uniform1f(i,u.u_vertical_gradient),u_opacity:new d.Uniform1f(i,u.u_opacity)}},fillExtrusionPattern:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_lightpos:new d.Uniform3f(i,u.u_lightpos),u_lightintensity:new d.Uniform1f(i,u.u_lightintensity),u_lightcolor:new d.Uniform3f(i,u.u_lightcolor),u_vertical_gradient:new d.Uniform1f(i,u.u_vertical_gradient),u_height_factor:new d.Uniform1f(i,u.u_height_factor),u_image:new d.Uniform1i(i,u.u_image),u_texsize:new d.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new d.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new d.Uniform3f(i,u.u_scale),u_fade:new d.Uniform1f(i,u.u_fade),u_opacity:new d.Uniform1f(i,u.u_opacity)}},fill:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix)}},fillPattern:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_image:new d.Uniform1i(i,u.u_image),u_texsize:new d.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new d.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new d.Uniform3f(i,u.u_scale),u_fade:new d.Uniform1f(i,u.u_fade)}},fillOutline:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_world:new d.Uniform2f(i,u.u_world)}},fillOutlinePattern:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_world:new d.Uniform2f(i,u.u_world),u_image:new d.Uniform1i(i,u.u_image),u_texsize:new d.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new d.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new d.Uniform3f(i,u.u_scale),u_fade:new d.Uniform1f(i,u.u_fade)}},circle:function(i,u){return{u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_scale_with_map:new d.Uniform1i(i,u.u_scale_with_map),u_pitch_with_map:new d.Uniform1i(i,u.u_pitch_with_map),u_extrude_scale:new d.Uniform2f(i,u.u_extrude_scale),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_matrix:new d.UniformMatrix4f(i,u.u_matrix)}},collisionBox:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_pixels_to_tile_units:new d.Uniform1f(i,u.u_pixels_to_tile_units),u_extrude_scale:new d.Uniform2f(i,u.u_extrude_scale),u_overscale_factor:new d.Uniform1f(i,u.u_overscale_factor)}},collisionCircle:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_inv_matrix:new d.UniformMatrix4f(i,u.u_inv_matrix),u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_viewport_size:new d.Uniform2f(i,u.u_viewport_size)}},debug:function(i,u){return{u_color:new d.UniformColor(i,u.u_color),u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_overlay:new d.Uniform1i(i,u.u_overlay),u_overlay_scale:new d.Uniform1f(i,u.u_overlay_scale)}},clippingMask:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix)}},heatmap:function(i,u){return{u_extrude_scale:new d.Uniform1f(i,u.u_extrude_scale),u_intensity:new d.Uniform1f(i,u.u_intensity),u_matrix:new d.UniformMatrix4f(i,u.u_matrix)}},heatmapTexture:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_world:new d.Uniform2f(i,u.u_world),u_image:new d.Uniform1i(i,u.u_image),u_color_ramp:new d.Uniform1i(i,u.u_color_ramp),u_opacity:new d.Uniform1f(i,u.u_opacity)}},hillshade:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_image:new d.Uniform1i(i,u.u_image),u_latrange:new d.Uniform2f(i,u.u_latrange),u_light:new d.Uniform2f(i,u.u_light),u_shadow:new d.UniformColor(i,u.u_shadow),u_highlight:new d.UniformColor(i,u.u_highlight),u_accent:new d.UniformColor(i,u.u_accent)}},hillshadePrepare:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_image:new d.Uniform1i(i,u.u_image),u_dimension:new d.Uniform2f(i,u.u_dimension),u_zoom:new d.Uniform1f(i,u.u_zoom),u_unpack:new d.Uniform4f(i,u.u_unpack)}},line:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_ratio:new d.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(i,u.u_units_to_pixels)}},lineGradient:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_ratio:new d.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(i,u.u_units_to_pixels),u_image:new d.Uniform1i(i,u.u_image),u_image_height:new d.Uniform1f(i,u.u_image_height)}},linePattern:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_texsize:new d.Uniform2f(i,u.u_texsize),u_ratio:new d.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_image:new d.Uniform1i(i,u.u_image),u_units_to_pixels:new d.Uniform2f(i,u.u_units_to_pixels),u_scale:new d.Uniform3f(i,u.u_scale),u_fade:new d.Uniform1f(i,u.u_fade)}},lineSDF:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_ratio:new d.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(i,u.u_units_to_pixels),u_patternscale_a:new d.Uniform2f(i,u.u_patternscale_a),u_patternscale_b:new d.Uniform2f(i,u.u_patternscale_b),u_sdfgamma:new d.Uniform1f(i,u.u_sdfgamma),u_image:new d.Uniform1i(i,u.u_image),u_tex_y_a:new d.Uniform1f(i,u.u_tex_y_a),u_tex_y_b:new d.Uniform1f(i,u.u_tex_y_b),u_mix:new d.Uniform1f(i,u.u_mix)}},raster:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_tl_parent:new d.Uniform2f(i,u.u_tl_parent),u_scale_parent:new d.Uniform1f(i,u.u_scale_parent),u_buffer_scale:new d.Uniform1f(i,u.u_buffer_scale),u_fade_t:new d.Uniform1f(i,u.u_fade_t),u_opacity:new d.Uniform1f(i,u.u_opacity),u_image0:new d.Uniform1i(i,u.u_image0),u_image1:new d.Uniform1i(i,u.u_image1),u_brightness_low:new d.Uniform1f(i,u.u_brightness_low),u_brightness_high:new d.Uniform1f(i,u.u_brightness_high),u_saturation_factor:new d.Uniform1f(i,u.u_saturation_factor),u_contrast_factor:new d.Uniform1f(i,u.u_contrast_factor),u_spin_weights:new d.Uniform3f(i,u.u_spin_weights)}},symbolIcon:function(i,u){return{u_is_size_zoom_constant:new d.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new d.Uniform1f(i,u.u_size_t),u_size:new d.Uniform1f(i,u.u_size),u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new d.Uniform1f(i,u.u_pitch),u_rotate_symbol:new d.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new d.Uniform1f(i,u.u_fade_change),u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new d.Uniform1i(i,u.u_is_text),u_pitch_with_map:new d.Uniform1i(i,u.u_pitch_with_map),u_texsize:new d.Uniform2f(i,u.u_texsize),u_texture:new d.Uniform1i(i,u.u_texture)}},symbolSDF:function(i,u){return{u_is_size_zoom_constant:new d.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new d.Uniform1f(i,u.u_size_t),u_size:new d.Uniform1f(i,u.u_size),u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new d.Uniform1f(i,u.u_pitch),u_rotate_symbol:new d.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new d.Uniform1f(i,u.u_fade_change),u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new d.Uniform1i(i,u.u_is_text),u_pitch_with_map:new d.Uniform1i(i,u.u_pitch_with_map),u_texsize:new d.Uniform2f(i,u.u_texsize),u_texture:new d.Uniform1i(i,u.u_texture),u_gamma_scale:new d.Uniform1f(i,u.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_is_halo:new d.Uniform1i(i,u.u_is_halo)}},symbolTextAndIcon:function(i,u){return{u_is_size_zoom_constant:new d.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new d.Uniform1f(i,u.u_size_t),u_size:new d.Uniform1f(i,u.u_size),u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new d.Uniform1f(i,u.u_pitch),u_rotate_symbol:new d.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new d.Uniform1f(i,u.u_fade_change),u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new d.Uniform1i(i,u.u_is_text),u_pitch_with_map:new d.Uniform1i(i,u.u_pitch_with_map),u_texsize:new d.Uniform2f(i,u.u_texsize),u_texsize_icon:new d.Uniform2f(i,u.u_texsize_icon),u_texture:new d.Uniform1i(i,u.u_texture),u_texture_icon:new d.Uniform1i(i,u.u_texture_icon),u_gamma_scale:new d.Uniform1f(i,u.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_is_halo:new d.Uniform1i(i,u.u_is_halo)}},background:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_opacity:new d.Uniform1f(i,u.u_opacity),u_color:new d.UniformColor(i,u.u_color)}},backgroundPattern:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_opacity:new d.Uniform1f(i,u.u_opacity),u_image:new d.Uniform1i(i,u.u_image),u_pattern_tl_a:new d.Uniform2f(i,u.u_pattern_tl_a),u_pattern_br_a:new d.Uniform2f(i,u.u_pattern_br_a),u_pattern_tl_b:new d.Uniform2f(i,u.u_pattern_tl_b),u_pattern_br_b:new d.Uniform2f(i,u.u_pattern_br_b),u_texsize:new d.Uniform2f(i,u.u_texsize),u_mix:new d.Uniform1f(i,u.u_mix),u_pattern_size_a:new d.Uniform2f(i,u.u_pattern_size_a),u_pattern_size_b:new d.Uniform2f(i,u.u_pattern_size_b),u_scale_a:new d.Uniform1f(i,u.u_scale_a),u_scale_b:new d.Uniform1f(i,u.u_scale_b),u_pixel_coord_upper:new d.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(i,u.u_pixel_coord_lower),u_tile_units_to_pixels:new d.Uniform1f(i,u.u_tile_units_to_pixels)}}};function qu(i,u,o,h,y,b,T){for(var D=i.context,V=D.gl,se=i.useProgram("collisionBox"),Ce=[],we=0,Pe=0,He=0;He<h.length;He++){var Ge=h[He],nt=u.getTile(Ge),ze=nt.getBucket(o);if(ze){var it=Ge.posMatrix;y[0]===0&&y[1]===0||(it=i.translatePosMatrix(Ge.posMatrix,nt,y,b));var bt=T?ze.textCollisionBox:ze.iconCollisionBox,Vt=ze.collisionCircleArray;if(Vt.length>0){var gr=d.create(),fr=it;d.mul(gr,ze.placementInvProjMatrix,i.transform.glCoordMatrix),d.mul(gr,gr,ze.placementViewportMatrix),Ce.push({circleArray:Vt,circleOffset:Pe,transform:fr,invTransform:gr}),Pe=we+=Vt.length/4}bt&&se.draw(D,V.LINES,B.disabled,ee.disabled,i.colorModeForRenderPass(),Ae.disabled,gs(it,i.transform,nt),o.id,bt.layoutVertexBuffer,bt.indexBuffer,bt.segments,null,i.transform.zoom,null,null,bt.collisionVertexBuffer)}}if(T&&Ce.length){var Er=i.useProgram("collisionCircle"),jr=new d.StructArrayLayout2f1f2i16;jr.resize(4*we),jr._trim();for(var fn=0,tn=0,Zn=Ce;tn<Zn.length;tn+=1)for(var si=Zn[tn],ui=0;ui<si.circleArray.length/4;ui++){var dn=4*ui,ia=si.circleArray[dn+0],Wn=si.circleArray[dn+1],xi=si.circleArray[dn+2],ji=si.circleArray[dn+3];jr.emplace(fn++,ia,Wn,xi,ji,0),jr.emplace(fn++,ia,Wn,xi,ji,1),jr.emplace(fn++,ia,Wn,xi,ji,2),jr.emplace(fn++,ia,Wn,xi,ji,3)}(!Yl||Yl.length<2*we)&&(Yl=function(ne){var xe=2*ne,pt=new d.StructArrayLayout3ui6;pt.resize(xe),pt._trim();for(var Pt=0;Pt<xe;Pt++){var xt=6*Pt;pt.uint16[xt+0]=4*Pt+0,pt.uint16[xt+1]=4*Pt+1,pt.uint16[xt+2]=4*Pt+2,pt.uint16[xt+3]=4*Pt+2,pt.uint16[xt+4]=4*Pt+3,pt.uint16[xt+5]=4*Pt+0}return pt}(we));for(var vi=D.createIndexBuffer(Yl,!0),Ci=D.createVertexBuffer(jr,d.collisionCircleLayout.members,!0),Q=0,J=Ce;Q<J.length;Q+=1){var O=J[Q],F=Ol(O.transform,O.invTransform,i.transform);Er.draw(D,V.TRIANGLES,B.disabled,ee.disabled,i.colorModeForRenderPass(),Ae.disabled,F,o.id,Ci,vi,d.SegmentVector.simpleSegment(0,2*O.circleOffset,O.circleArray.length,O.circleArray.length/2),null,i.transform.zoom,null,null,null)}Ci.destroy(),vi.destroy()}}var ru=d.identity(new Float32Array(16));function Kl(i,u,o,h,y,b){var T=d.getAnchorAlignment(i),D=-(T.horizontalAlign-.5)*u,V=-(T.verticalAlign-.5)*o,se=d.evaluateVariableOffset(i,h);return new d.Point((D/y+se[0])*b,(V/y+se[1])*b)}function Nu(i,u,o,h,y,b,T,D,V,se,Ce){var we=i.text.placedSymbolArray,Pe=i.text.dynamicLayoutVertexArray,He=i.icon.dynamicLayoutVertexArray,Ge={};Pe.clear();for(var nt=0;nt<we.length;nt++){var ze=we.get(nt),it=ze.hidden||!ze.crossTileID||i.allowVerticalPlacement&&!ze.placedOrientation?null:h[ze.crossTileID];if(it){var bt=new d.Point(ze.anchorX,ze.anchorY),Vt=Ni(bt,o?D:T),gr=Xi(b.cameraToCenterDistance,Vt.signedDistanceFromCamera),fr=y.evaluateSizeForFeature(i.textSizeData,se,ze)*gr/d.ONE_EM;o&&(fr*=i.tilePixelRatio/V);for(var Er=Kl(it.anchor,it.width,it.height,it.textOffset,it.textBoxScale,fr),jr=o?Ni(bt.add(Er),T).point:Vt.point.add(u?Er.rotate(-b.angle):Er),fn=i.allowVerticalPlacement&&ze.placedOrientation===d.WritingMode.vertical?Math.PI/2:0,tn=0;tn<ze.numGlyphs;tn++)d.addDynamicAttributes(Pe,jr,fn);Ce&&ze.associatedIconIndex>=0&&(Ge[ze.associatedIconIndex]={shiftedAnchor:jr,angle:fn})}else Ki(ze.numGlyphs,Pe)}if(Ce){He.clear();for(var Zn=i.icon.placedSymbolArray,si=0;si<Zn.length;si++){var ui=Zn.get(si);if(ui.hidden)Ki(ui.numGlyphs,He);else{var dn=Ge[si];if(dn)for(var ia=0;ia<ui.numGlyphs;ia++)d.addDynamicAttributes(He,dn.shiftedAnchor,dn.angle);else Ki(ui.numGlyphs,He)}}i.icon.dynamicLayoutVertexBuffer.updateData(He)}i.text.dynamicLayoutVertexBuffer.updateData(Pe)}function Dc(i,u,o){return o.iconsInText&&u?"symbolTextAndIcon":i?"symbolSDF":"symbolIcon"}function el(i,u,o,h,y,b,T,D,V,se,Ce,we){for(var Pe=i.context,He=Pe.gl,Ge=i.transform,nt=D==="map",ze=V==="map",it=nt&&o.layout.get("symbol-placement")!=="point",bt=nt&&!ze&&!it,Vt=o.layout.get("symbol-sort-key").constantOr(1)!==void 0,gr=!1,fr=i.depthModeForSublayer(0,B.ReadOnly),Er=o.layout.get("text-variable-anchor"),jr=[],fn=0,tn=h;fn<tn.length;fn+=1){var Zn=tn[fn],si=u.getTile(Zn),ui=si.getBucket(o);if(ui){var dn=y?ui.text:ui.icon;if(dn&&dn.segments.get().length){var ia=dn.programConfigurations.get(o.id),Wn=y||ui.sdfIcons,xi=y?ui.textSizeData:ui.iconSizeData,ji=ze||Ge.pitch!==0,vi=i.useProgram(Dc(Wn,y,ui),ia),Ci=d.evaluateSizeForZoom(xi,Ge.zoom),Q=void 0,J=[0,0],O=void 0,F=void 0,ne=null,xe=void 0;if(y)O=si.glyphAtlasTexture,F=He.LINEAR,Q=si.glyphAtlasTexture.size,ui.iconsInText&&(J=si.imageAtlasTexture.size,ne=si.imageAtlasTexture,xe=ji||i.options.rotating||i.options.zooming||xi.kind==="composite"||xi.kind==="camera"?He.LINEAR:He.NEAREST);else{var pt=o.layout.get("icon-size").constantOr(0)!==1||ui.iconsNeedLinear;O=si.imageAtlasTexture,F=Wn||i.options.rotating||i.options.zooming||pt||ji?He.LINEAR:He.NEAREST,Q=si.imageAtlasTexture.size}var Pt=xa(si,1,i.transform.zoom),xt=Ra(Zn.posMatrix,ze,nt,i.transform,Pt),ur=Wi(Zn.posMatrix,ze,nt,i.transform,Pt),Vr=Er&&ui.hasTextData(),Jn=o.layout.get("icon-text-fit")!=="none"&&Vr&&ui.hasIconData();it&&Qo(ui,Zn.posMatrix,i,y,xt,ur,ze,se);var Xn=i.translatePosMatrix(Zn.posMatrix,si,b,T),li=it||y&&Er||Jn?ru:xt,mi=i.translatePosMatrix(ur,si,b,T,!0),Ri=Wn&&o.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0,aa={program:vi,buffers:dn,uniformValues:Wn?ui.iconsInText?bl(xi.kind,Ci,bt,ze,i,Xn,li,mi,Q,J):Ju(xi.kind,Ci,bt,ze,i,Xn,li,mi,y,Q,!0):Iu(xi.kind,Ci,bt,ze,i,Xn,li,mi,y,Q),atlasTexture:O,atlasTextureIcon:ne,atlasInterpolation:F,atlasInterpolationIcon:xe,isSDF:Wn,hasHalo:Ri};if(Vt&&ui.canOverlap){gr=!0;for(var pa=0,ba=dn.segments.get();pa<ba.length;pa+=1){var go=ba[pa];jr.push({segments:new d.SegmentVector([go]),sortKey:go.sortKey,state:aa})}}else jr.push({segments:dn.segments,sortKey:0,state:aa})}}}gr&&jr.sort(function($a,yo){return $a.sortKey-yo.sortKey});for(var Ca=0,Bo=jr;Ca<Bo.length;Ca+=1){var ka=Bo[Ca],Zi=ka.state;if(Pe.activeTexture.set(He.TEXTURE0),Zi.atlasTexture.bind(Zi.atlasInterpolation,He.CLAMP_TO_EDGE),Zi.atlasTextureIcon&&(Pe.activeTexture.set(He.TEXTURE1),Zi.atlasTextureIcon&&Zi.atlasTextureIcon.bind(Zi.atlasInterpolationIcon,He.CLAMP_TO_EDGE)),Zi.isSDF){var da=Zi.uniformValues;Zi.hasHalo&&(da.u_is_halo=1,Cl(Zi.buffers,ka.segments,o,i,Zi.program,fr,Ce,we,da)),da.u_is_halo=0}Cl(Zi.buffers,ka.segments,o,i,Zi.program,fr,Ce,we,Zi.uniformValues)}}function Cl(i,u,o,h,y,b,T,D,V){var se=h.context;y.draw(se,se.gl.TRIANGLES,b,T,D,Ae.disabled,V,o.id,i.layoutVertexBuffer,i.indexBuffer,u,o.paint,h.transform.zoom,i.programConfigurations.get(o.id),i.dynamicLayoutVertexBuffer,i.opacityVertexBuffer)}function Ll(i,u,o,h,y,b,T){var D,V,se,Ce,we,Pe=i.context.gl,He=o.paint.get("fill-pattern"),Ge=He&&He.constantOr(1),nt=o.getCrossfadeParameters();T?(V=Ge&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",D=Pe.LINES):(V=Ge?"fillPattern":"fill",D=Pe.TRIANGLES);for(var ze=0,it=h;ze<it.length;ze+=1){var bt=it[ze],Vt=u.getTile(bt);if(!Ge||Vt.patternsLoaded()){var gr=Vt.getBucket(o);if(gr){var fr=gr.programConfigurations.get(o.id),Er=i.useProgram(V,fr);Ge&&(i.context.activeTexture.set(Pe.TEXTURE0),Vt.imageAtlasTexture.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE),fr.updatePaintBuffers(nt));var jr=He.constantOr(null);if(jr&&Vt.imageAtlas){var fn=Vt.imageAtlas,tn=fn.patternPositions[jr.to.toString()],Zn=fn.patternPositions[jr.from.toString()];tn&&Zn&&fr.setConstantPatternPositions(tn,Zn)}var si=i.translatePosMatrix(bt.posMatrix,Vt,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(T){Ce=gr.indexBuffer2,we=gr.segments2;var ui=[Pe.drawingBufferWidth,Pe.drawingBufferHeight];se=V==="fillOutlinePattern"&&Ge?qs(si,i,nt,Vt,ui):Ma(si,ui)}else Ce=gr.indexBuffer,we=gr.segments,se=Ge?no(si,i,nt,Vt):ms(si);Er.draw(i.context,D,y,i.stencilModeForClipping(bt),b,Ae.disabled,se,o.id,gr.layoutVertexBuffer,Ce,we,o.paint,i.transform.zoom,fr)}}}}function gc(i,u,o,h,y,b,T){for(var D=i.context,V=D.gl,se=o.paint.get("fill-extrusion-pattern"),Ce=se.constantOr(1),we=o.getCrossfadeParameters(),Pe=o.paint.get("fill-extrusion-opacity"),He=0,Ge=h;He<Ge.length;He+=1){var nt=Ge[He],ze=u.getTile(nt),it=ze.getBucket(o);if(it){var bt=it.programConfigurations.get(o.id),Vt=i.useProgram(Ce?"fillExtrusionPattern":"fillExtrusion",bt);Ce&&(i.context.activeTexture.set(V.TEXTURE0),ze.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),bt.updatePaintBuffers(we));var gr=se.constantOr(null);if(gr&&ze.imageAtlas){var fr=ze.imageAtlas,Er=fr.patternPositions[gr.to.toString()],jr=fr.patternPositions[gr.from.toString()];Er&&jr&&bt.setConstantPatternPositions(Er,jr)}var fn=i.translatePosMatrix(nt.posMatrix,ze,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),tn=o.paint.get("fill-extrusion-vertical-gradient"),Zn=Ce?Yo(fn,i,tn,Pe,nt,we,ze):ku(fn,i,tn,Pe);Vt.draw(D,D.gl.TRIANGLES,y,b,T,Ae.backCCW,Zn,o.id,it.layoutVertexBuffer,it.indexBuffer,it.segments,o.paint,i.transform.zoom,bt)}}}function Rl(i,u,o,h,y,b){var T=i.context,D=T.gl,V=u.fbo;if(V){var se=i.useProgram("hillshade");T.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,V.colorAttachment.get());var Ce=function(we,Pe,He){var Ge=He.paint.get("hillshade-shadow-color"),nt=He.paint.get("hillshade-highlight-color"),ze=He.paint.get("hillshade-accent-color"),it=He.paint.get("hillshade-illumination-direction")*(Math.PI/180);He.paint.get("hillshade-illumination-anchor")==="viewport"&&(it-=we.transform.angle);var bt,Vt,gr,fr=!we.options.moving;return{u_matrix:we.transform.calculatePosMatrix(Pe.tileID.toUnwrapped(),fr),u_image:0,u_latrange:(bt=Pe.tileID,Vt=Math.pow(2,bt.canonical.z),gr=bt.canonical.y,[new d.MercatorCoordinate(0,gr/Vt).toLngLat().lat,new d.MercatorCoordinate(0,(gr+1)/Vt).toLngLat().lat]),u_light:[He.paint.get("hillshade-exaggeration"),it],u_shadow:Ge,u_highlight:nt,u_accent:ze}}(i,u,o);se.draw(T,D.TRIANGLES,h,y,b,Ae.disabled,Ce,o.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments)}}function kc(i,u,o,h,y,b){var T=i.context,D=T.gl,V=u.dem;if(V&&V.data){var se=V.dim,Ce=V.stride,we=V.getPixels();if(T.activeTexture.set(D.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),u.demTexture=u.demTexture||i.getTileTexture(Ce),u.demTexture){var Pe=u.demTexture;Pe.update(we,{premultiply:!1}),Pe.bind(D.NEAREST,D.CLAMP_TO_EDGE)}else u.demTexture=new d.Texture(T,we,D.RGBA,{premultiply:!1}),u.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE);T.activeTexture.set(D.TEXTURE0);var He=u.fbo;if(!He){var Ge=new d.Texture(T,{width:se,height:se,data:null},D.RGBA);Ge.bind(D.LINEAR,D.CLAMP_TO_EDGE),(He=u.fbo=T.createFramebuffer(se,se,!0)).colorAttachment.set(Ge.texture)}T.bindFramebuffer.set(He.framebuffer),T.viewport.set([0,0,se,se]),i.useProgram("hillshadePrepare").draw(T,D.TRIANGLES,h,y,b,Ae.disabled,function(nt,ze){var it=ze.stride,bt=d.create();return d.ortho(bt,0,d.EXTENT,-d.EXTENT,0,0,1),d.translate(bt,bt,[0,-d.EXTENT,0]),{u_matrix:bt,u_image:1,u_dimension:[it,it],u_zoom:nt.overscaledZ,u_unpack:ze.getUnpackVector()}}(u.tileID,V),o.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments),u.needsHillshadePrepare=!1}}function $l(i,u,o,h,y){var b=h.paint.get("raster-fade-duration");if(b>0){var T=d.browser.now(),D=(T-i.timeAdded)/b,V=u?(T-u.timeAdded)/b:-1,se=o.getSource(),Ce=y.coveringZoomLevel({tileSize:se.tileSize,roundZoom:se.roundZoom}),we=!u||Math.abs(u.tileID.overscaledZ-Ce)>Math.abs(i.tileID.overscaledZ-Ce),Pe=we&&i.refreshedUponExpiration?1:d.clamp(we?D:1-V,0,1);return i.refreshedUponExpiration&&D>=1&&(i.refreshedUponExpiration=!1),u?{opacity:1,mix:1-Pe}:{opacity:Pe,mix:0}}return{opacity:1,mix:0}}var js=new d.Color(1,0,0,1),io=new d.Color(0,1,0,1),bo=new d.Color(0,0,1,1),zu=new d.Color(1,0,1,1),Ds=new d.Color(0,1,1,1);function Dl(i,u,o,h){_u(i,0,u+o/2,i.transform.width,o,h)}function Jl(i,u,o,h){_u(i,u-o/2,0,o,i.transform.height,h)}function _u(i,u,o,h,y,b){var T=i.context,D=T.gl;D.enable(D.SCISSOR_TEST),D.scissor(u*d.browser.devicePixelRatio,o*d.browser.devicePixelRatio,h*d.browser.devicePixelRatio,y*d.browser.devicePixelRatio),T.clear({color:b}),D.disable(D.SCISSOR_TEST)}function Ql(i,u,o){var h=i.context,y=h.gl,b=o.posMatrix,T=i.useProgram("debug"),D=B.disabled,V=ee.disabled,se=i.colorModeForRenderPass();h.activeTexture.set(y.TEXTURE0),i.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),T.draw(h,y.LINE_STRIP,D,V,se,Ae.disabled,eu(b,d.Color.red),"$debug",i.debugBuffer,i.tileBorderIndexBuffer,i.debugSegments);var Ce=u.getTileByID(o.key).latestRawTileData,we=Math.floor((Ce&&Ce.byteLength||0)/1024),Pe=u.getTile(o).tileSize,He=512/Math.min(Pe,512)*(o.overscaledZ/i.transform.zoom)*.5,Ge=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(Ge+=" => "+o.overscaledZ),function(nt,ze){nt.initDebugOverlayCanvas();var it=nt.debugOverlayCanvas,bt=nt.context.gl,Vt=nt.debugOverlayCanvas.getContext("2d");Vt.clearRect(0,0,it.width,it.height),Vt.shadowColor="white",Vt.shadowBlur=2,Vt.lineWidth=1.5,Vt.strokeStyle="white",Vt.textBaseline="top",Vt.font="bold 36px Open Sans, sans-serif",Vt.fillText(ze,5,5),Vt.strokeText(ze,5,5),nt.debugOverlayTexture.update(it),nt.debugOverlayTexture.bind(bt.LINEAR,bt.CLAMP_TO_EDGE)}(i,Ge+" "+we+"kb"),T.draw(h,y.TRIANGLES,D,V,de.alphaBlended,Ae.disabled,eu(b,d.Color.transparent,He),"$debug",i.debugBuffer,i.quadTriangleIndexBuffer,i.debugSegments)}var Uu={symbol:function(i,u,o,h,y){if(i.renderPass==="translucent"){var b=ee.disabled,T=i.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(D,V,se,Ce,we,Pe,He){for(var Ge=V.transform,nt=we==="map",ze=Pe==="map",it=0,bt=D;it<bt.length;it+=1){var Vt=bt[it],gr=Ce.getTile(Vt),fr=gr.getBucket(se);if(fr&&fr.text&&fr.text.segments.get().length){var Er=d.evaluateSizeForZoom(fr.textSizeData,Ge.zoom),jr=xa(gr,1,V.transform.zoom),fn=Ra(Vt.posMatrix,ze,nt,V.transform,jr),tn=se.layout.get("icon-text-fit")!=="none"&&fr.hasIconData();if(Er){var Zn=Math.pow(2,Ge.zoom-gr.tileID.overscaledZ);Nu(fr,nt,ze,He,d.symbolSize,Ge,fn,Vt.posMatrix,Zn,Er,tn)}}}}(h,i,o,u,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),y),o.paint.get("icon-opacity").constantOr(1)!==0&&el(i,u,o,h,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),b,T),o.paint.get("text-opacity").constantOr(1)!==0&&el(i,u,o,h,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),b,T),u.map.showCollisionBoxes&&(qu(i,u,o,h,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),qu(i,u,o,h,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))}},circle:function(i,u,o,h){if(i.renderPass==="translucent"){var y=o.paint.get("circle-opacity"),b=o.paint.get("circle-stroke-width"),T=o.paint.get("circle-stroke-opacity"),D=o.layout.get("circle-sort-key").constantOr(1)!==void 0;if(y.constantOr(1)!==0||b.constantOr(1)!==0&&T.constantOr(1)!==0){for(var V=i.context,se=V.gl,Ce=i.depthModeForSublayer(0,B.ReadOnly),we=ee.disabled,Pe=i.colorModeForRenderPass(),He=[],Ge=0;Ge<h.length;Ge++){var nt=h[Ge],ze=u.getTile(nt),it=ze.getBucket(o);if(it){var bt=it.programConfigurations.get(o.id),Vt={programConfiguration:bt,program:i.useProgram("circle",bt),layoutVertexBuffer:it.layoutVertexBuffer,indexBuffer:it.indexBuffer,uniformValues:yl(i,nt,ze,o)};if(D)for(var gr=0,fr=it.segments.get();gr<fr.length;gr+=1){var Er=fr[gr];He.push({segments:new d.SegmentVector([Er]),sortKey:Er.sortKey,state:Vt})}else He.push({segments:it.segments,sortKey:0,state:Vt})}}D&&He.sort(function(si,ui){return si.sortKey-ui.sortKey});for(var jr=0,fn=He;jr<fn.length;jr+=1){var tn=fn[jr],Zn=tn.state;Zn.program.draw(V,se.TRIANGLES,Ce,we,Pe,Ae.disabled,Zn.uniformValues,o.id,Zn.layoutVertexBuffer,Zn.indexBuffer,tn.segments,o.paint,i.transform.zoom,Zn.programConfiguration)}}}},heatmap:function(i,u,o,h){if(o.paint.get("heatmap-opacity")!==0)if(i.renderPass==="offscreen"){var y=i.context,b=y.gl,T=ee.disabled,D=new de([b.ONE,b.ONE],d.Color.transparent,[!0,!0,!0,!0]);(function(He,Ge,nt){var ze=He.gl;He.activeTexture.set(ze.TEXTURE1),He.viewport.set([0,0,Ge.width/4,Ge.height/4]);var it=nt.heatmapFbo;if(it)ze.bindTexture(ze.TEXTURE_2D,it.colorAttachment.get()),He.bindFramebuffer.set(it.framebuffer);else{var bt=ze.createTexture();ze.bindTexture(ze.TEXTURE_2D,bt),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_WRAP_S,ze.CLAMP_TO_EDGE),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_WRAP_T,ze.CLAMP_TO_EDGE),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_MIN_FILTER,ze.LINEAR),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_MAG_FILTER,ze.LINEAR),it=nt.heatmapFbo=He.createFramebuffer(Ge.width/4,Ge.height/4,!1),function(Vt,gr,fr,Er){var jr=Vt.gl;jr.texImage2D(jr.TEXTURE_2D,0,jr.RGBA,gr.width/4,gr.height/4,0,jr.RGBA,Vt.extRenderToTextureHalfFloat?Vt.extTextureHalfFloat.HALF_FLOAT_OES:jr.UNSIGNED_BYTE,null),Er.colorAttachment.set(fr)}(He,Ge,bt,it)}})(y,i,o),y.clear({color:d.Color.transparent});for(var V=0;V<h.length;V++){var se=h[V];if(!u.hasRenderableParent(se)){var Ce=u.getTile(se),we=Ce.getBucket(o);if(we){var Pe=we.programConfigurations.get(o.id);i.useProgram("heatmap",Pe).draw(y,b.TRIANGLES,B.disabled,T,D,Ae.disabled,mc(se.posMatrix,Ce,i.transform.zoom,o.paint.get("heatmap-intensity")),o.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,o.paint,i.transform.zoom,Pe)}}}y.viewport.set([0,0,i.width,i.height])}else i.renderPass==="translucent"&&(i.context.setColorMode(i.colorModeForRenderPass()),function(He,Ge){var nt=He.context,ze=nt.gl,it=Ge.heatmapFbo;if(it){nt.activeTexture.set(ze.TEXTURE0),ze.bindTexture(ze.TEXTURE_2D,it.colorAttachment.get()),nt.activeTexture.set(ze.TEXTURE1);var bt=Ge.colorRampTexture;bt||(bt=Ge.colorRampTexture=new d.Texture(nt,Ge.colorRamp,ze.RGBA)),bt.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),He.useProgram("heatmapTexture").draw(nt,ze.TRIANGLES,B.disabled,ee.disabled,He.colorModeForRenderPass(),Ae.disabled,function(Vt,gr,fr,Er){var jr=d.create();d.ortho(jr,0,Vt.width,Vt.height,0,0,1);var fn=Vt.context.gl;return{u_matrix:jr,u_world:[fn.drawingBufferWidth,fn.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:gr.paint.get("heatmap-opacity")}}(He,Ge),Ge.id,He.viewportBuffer,He.quadTriangleIndexBuffer,He.viewportSegments,Ge.paint,He.transform.zoom)}}(i,o))},line:function(i,u,o,h){if(i.renderPass==="translucent"){var y=o.paint.get("line-opacity"),b=o.paint.get("line-width");if(y.constantOr(1)!==0&&b.constantOr(1)!==0)for(var T=i.depthModeForSublayer(0,B.ReadOnly),D=i.colorModeForRenderPass(),V=o.paint.get("line-dasharray"),se=o.paint.get("line-pattern"),Ce=se.constantOr(1),we=o.paint.get("line-gradient"),Pe=o.getCrossfadeParameters(),He=Ce?"linePattern":V?"lineSDF":we?"lineGradient":"line",Ge=i.context,nt=Ge.gl,ze=!0,it=0,bt=h;it<bt.length;it+=1){var Vt=bt[it],gr=u.getTile(Vt);if(!Ce||gr.patternsLoaded()){var fr=gr.getBucket(o);if(fr){var Er=fr.programConfigurations.get(o.id),jr=i.context.program.get(),fn=i.useProgram(He,Er),tn=ze||fn.program!==jr,Zn=se.constantOr(null);if(Zn&&gr.imageAtlas){var si=gr.imageAtlas,ui=si.patternPositions[Zn.to.toString()],dn=si.patternPositions[Zn.from.toString()];ui&&dn&&Er.setConstantPatternPositions(ui,dn)}var ia=Ce?_l(i,gr,o,Pe):V?$c(i,gr,o,V,Pe):we?Ia(i,gr,o,fr.lineClipsArray.length):Fu(i,gr,o);if(Ce)Ge.activeTexture.set(nt.TEXTURE0),gr.imageAtlasTexture.bind(nt.LINEAR,nt.CLAMP_TO_EDGE),Er.updatePaintBuffers(Pe);else if(V&&(tn||i.lineAtlas.dirty))Ge.activeTexture.set(nt.TEXTURE0),i.lineAtlas.bind(Ge);else if(we){var Wn=fr.gradients[o.id],xi=Wn.texture;if(o.gradientVersion!==Wn.version){var ji=256;if(o.stepInterpolant){var vi=u.getSource().maxzoom,Ci=Vt.canonical.z===vi?Math.ceil(1<<i.transform.maxZoom-Vt.canonical.z):1;ji=d.clamp(d.nextPowerOfTwo(fr.maxLineLength/d.EXTENT*1024*Ci),256,Ge.maxTextureSize)}Wn.gradient=d.renderColorRamp({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:ji,image:Wn.gradient||void 0,clips:fr.lineClipsArray}),Wn.texture?Wn.texture.update(Wn.gradient):Wn.texture=new d.Texture(Ge,Wn.gradient,nt.RGBA),Wn.version=o.gradientVersion,xi=Wn.texture}Ge.activeTexture.set(nt.TEXTURE0),xi.bind(o.stepInterpolant?nt.NEAREST:nt.LINEAR,nt.CLAMP_TO_EDGE)}fn.draw(Ge,nt.TRIANGLES,T,i.stencilModeForClipping(Vt),D,Ae.disabled,ia,o.id,fr.layoutVertexBuffer,fr.indexBuffer,fr.segments,o.paint,i.transform.zoom,Er,fr.layoutVertexBuffer2),ze=!1}}}}},fill:function(i,u,o,h){var y=o.paint.get("fill-color"),b=o.paint.get("fill-opacity");if(b.constantOr(1)!==0){var T=i.colorModeForRenderPass(),D=o.paint.get("fill-pattern"),V=i.opaquePassEnabledForLayer()&&!D.constantOr(1)&&y.constantOr(d.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(i.renderPass===V){var se=i.depthModeForSublayer(1,i.renderPass==="opaque"?B.ReadWrite:B.ReadOnly);Ll(i,u,o,h,se,T,!1)}if(i.renderPass==="translucent"&&o.paint.get("fill-antialias")){var Ce=i.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,B.ReadOnly);Ll(i,u,o,h,Ce,T,!0)}}},"fill-extrusion":function(i,u,o,h){var y=o.paint.get("fill-extrusion-opacity");if(y!==0&&i.renderPass==="translucent"){var b=new B(i.context.gl.LEQUAL,B.ReadWrite,i.depthRangeFor3D);if(y!==1||o.paint.get("fill-extrusion-pattern").constantOr(1))gc(i,u,o,h,b,ee.disabled,de.disabled),gc(i,u,o,h,b,i.stencilModeFor3D(),i.colorModeForRenderPass());else{var T=i.colorModeForRenderPass();gc(i,u,o,h,b,ee.disabled,T)}}},hillshade:function(i,u,o,h){if(i.renderPass==="offscreen"||i.renderPass==="translucent"){for(var y=i.context,b=i.depthModeForSublayer(0,B.ReadOnly),T=i.colorModeForRenderPass(),D=i.renderPass==="translucent"?i.stencilConfigForOverlap(h):[{},h],V=D[0],se=0,Ce=D[1];se<Ce.length;se+=1){var we=Ce[se],Pe=u.getTile(we);Pe.needsHillshadePrepare&&i.renderPass==="offscreen"?kc(i,Pe,o,b,ee.disabled,T):i.renderPass==="translucent"&&Rl(i,Pe,o,b,V[we.overscaledZ],T)}y.viewport.set([0,0,i.width,i.height])}},raster:function(i,u,o,h){if(i.renderPass==="translucent"&&o.paint.get("raster-opacity")!==0&&h.length)for(var y=i.context,b=y.gl,T=u.getSource(),D=i.useProgram("raster"),V=i.colorModeForRenderPass(),se=T instanceof dt?[{},h]:i.stencilConfigForOverlap(h),Ce=se[0],we=se[1],Pe=we[we.length-1].overscaledZ,He=!i.options.moving,Ge=0,nt=we;Ge<nt.length;Ge+=1){var ze=nt[Ge],it=i.depthModeForSublayer(ze.overscaledZ-Pe,o.paint.get("raster-opacity")===1?B.ReadWrite:B.ReadOnly,b.LESS),bt=u.getTile(ze),Vt=i.transform.calculatePosMatrix(ze.toUnwrapped(),He);bt.registerFadeDuration(o.paint.get("raster-fade-duration"));var gr=u.findLoadedParent(ze,0),fr=$l(bt,gr,u,o,i.transform),Er=void 0,jr=void 0,fn=o.paint.get("raster-resampling")==="nearest"?b.NEAREST:b.LINEAR;y.activeTexture.set(b.TEXTURE0),bt.texture.bind(fn,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),y.activeTexture.set(b.TEXTURE1),gr?(gr.texture.bind(fn,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),Er=Math.pow(2,gr.tileID.overscaledZ-bt.tileID.overscaledZ),jr=[bt.tileID.canonical.x*Er%1,bt.tileID.canonical.y*Er%1]):bt.texture.bind(fn,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST);var tn=Jc(Vt,jr||[0,0],Er||1,fr,o);T instanceof dt?D.draw(y,b.TRIANGLES,it,ee.disabled,V,Ae.disabled,tn,o.id,T.boundsBuffer,i.quadTriangleIndexBuffer,T.boundsSegments):D.draw(y,b.TRIANGLES,it,Ce[ze.overscaledZ],V,Ae.disabled,tn,o.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments)}},background:function(i,u,o){var h=o.paint.get("background-color"),y=o.paint.get("background-opacity");if(y!==0){var b=i.context,T=b.gl,D=i.transform,V=D.tileSize,se=o.paint.get("background-pattern");if(!i.isPatternMissing(se)){var Ce=!se&&h.a===1&&y===1&&i.opaquePassEnabledForLayer()?"opaque":"translucent";if(i.renderPass===Ce){var we=ee.disabled,Pe=i.depthModeForSublayer(0,Ce==="opaque"?B.ReadWrite:B.ReadOnly),He=i.colorModeForRenderPass(),Ge=i.useProgram(se?"backgroundPattern":"background"),nt=D.coveringTiles({tileSize:V});se&&(b.activeTexture.set(T.TEXTURE0),i.imageManager.bind(i.context));for(var ze=o.getCrossfadeParameters(),it=0,bt=nt;it<bt.length;it+=1){var Vt=bt[it],gr=i.transform.calculatePosMatrix(Vt.toUnwrapped()),fr=se?Qu(gr,y,i,se,{tileID:Vt,tileSize:V},ze):Sl(gr,y,h);Ge.draw(b,T.TRIANGLES,Pe,we,He,Ae.disabled,fr,o.id,i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}}}},debug:function(i,u,o){for(var h=0;h<o.length;h++)Ql(i,u,o[h])},custom:function(i,u,o){var h=i.context,y=o.implementation;if(i.renderPass==="offscreen"){var b=y.prerender;b&&(i.setCustomLayerDefaults(),h.setColorMode(i.colorModeForRenderPass()),b.call(y,h.gl,i.transform.customLayerMatrix()),h.setDirty(),i.setBaseState())}else if(i.renderPass==="translucent"){i.setCustomLayerDefaults(),h.setColorMode(i.colorModeForRenderPass()),h.setStencilMode(ee.disabled);var T=y.renderingMode==="3d"?new B(i.context.gl.LEQUAL,B.ReadWrite,i.depthRangeFor3D):i.depthModeForSublayer(0,B.ReadOnly);h.setDepthMode(T),y.render(h.gl,i.transform.customLayerMatrix()),h.setDirty(),i.setBaseState(),h.bindFramebuffer.set(null)}}},ao=function(i,u){this.context=new ae(i),this.transform=u,this._tileTextures={},this.setup(),this.numSublayers=_e.maxUnderzooming+_e.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ls,this.gpuTimers={}};ao.prototype.resize=function(i,u){if(this.width=i*d.browser.devicePixelRatio,this.height=u*d.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var o=0,h=this.style._order;o<h.length;o+=1)this.style._layers[h[o]].resize()},ao.prototype.setup=function(){var i=this.context,u=new d.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(d.EXTENT,0),u.emplaceBack(0,d.EXTENT),u.emplaceBack(d.EXTENT,d.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(u,Ea.members),this.tileExtentSegments=d.SegmentVector.simpleSegment(0,0,4,2);var o=new d.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(d.EXTENT,0),o.emplaceBack(0,d.EXTENT),o.emplaceBack(d.EXTENT,d.EXTENT),this.debugBuffer=i.createVertexBuffer(o,Ea.members),this.debugSegments=d.SegmentVector.simpleSegment(0,0,4,5);var h=new d.StructArrayLayout4i8;h.emplaceBack(0,0,0,0),h.emplaceBack(d.EXTENT,0,d.EXTENT,0),h.emplaceBack(0,d.EXTENT,0,d.EXTENT),h.emplaceBack(d.EXTENT,d.EXTENT,d.EXTENT,d.EXTENT),this.rasterBoundsBuffer=i.createVertexBuffer(h,_t.members),this.rasterBoundsSegments=d.SegmentVector.simpleSegment(0,0,4,2);var y=new d.StructArrayLayout2i4;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(y,Ea.members),this.viewportSegments=d.SegmentVector.simpleSegment(0,0,4,2);var b=new d.StructArrayLayout1ui2;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(b);var T=new d.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(T),this.emptyTexture=new d.Texture(i,{width:1,height:1,data:new Uint8Array([0,0,0,0])},i.gl.RGBA);var D=this.context.gl;this.stencilClearMode=new ee({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO)},ao.prototype.clearStencil=function(){var i=this.context,u=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var o=d.create();d.ortho(o,0,this.width,this.height,0,0,1),d.scale(o,o,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,u.TRIANGLES,B.disabled,this.stencilClearMode,de.disabled,Ae.disabled,tu(o),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},ao.prototype._renderTileClippingMasks=function(i,u){if(this.currentStencilSource!==i.source&&i.isTileClipped()&&u&&u.length){this.currentStencilSource=i.source;var o=this.context,h=o.gl;this.nextStencilID+u.length>256&&this.clearStencil(),o.setColorMode(de.disabled),o.setDepthMode(B.disabled);var y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var b=0,T=u;b<T.length;b+=1){var D=T[b],V=this._tileClippingMaskIDs[D.key]=this.nextStencilID++;y.draw(o,h.TRIANGLES,B.disabled,new ee({func:h.ALWAYS,mask:0},V,255,h.KEEP,h.KEEP,h.REPLACE),de.disabled,Ae.disabled,tu(D.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},ao.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var i=this.nextStencilID++,u=this.context.gl;return new ee({func:u.NOTEQUAL,mask:255},i,255,u.KEEP,u.KEEP,u.REPLACE)},ao.prototype.stencilModeForClipping=function(i){var u=this.context.gl;return new ee({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,u.KEEP,u.KEEP,u.REPLACE)},ao.prototype.stencilConfigForOverlap=function(i){var u,o=this.context.gl,h=i.sort(function(V,se){return se.overscaledZ-V.overscaledZ}),y=h[h.length-1].overscaledZ,b=h[0].overscaledZ-y+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();for(var T={},D=0;D<b;D++)T[D+y]=new ee({func:o.GEQUAL,mask:255},D+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=b,[T,h]}return[(u={},u[y]=ee.disabled,u),h]},ao.prototype.colorModeForRenderPass=function(){var i=this.context.gl;return this._showOverdrawInspector?new de([i.CONSTANT_COLOR,i.ONE],new d.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?de.unblended:de.alphaBlended},ao.prototype.depthModeForSublayer=function(i,u,o){if(!this.opaquePassEnabledForLayer())return B.disabled;var h=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new B(o||this.context.gl.LEQUAL,u,[h,h])},ao.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},ao.prototype.render=function(i,u){var o=this;this.style=i,this.options=u,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(d.browser.now()),this.imageManager.beginFrame();var h=this.style._order,y=this.style.sourceCaches;for(var b in y){var T=y[b];T.used&&T.prepare(this.context)}var D,V,se={},Ce={},we={};for(var Pe in y){var He=y[Pe];se[Pe]=He.getVisibleCoordinates(),Ce[Pe]=se[Pe].slice().reverse(),we[Pe]=He.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ge=0;Ge<h.length;Ge++)if(this.style._layers[h[Ge]].is3D()){this.opaquePassCutoff=Ge;break}this.renderPass="offscreen";for(var nt=0,ze=h;nt<ze.length;nt+=1){var it=this.style._layers[ze[nt]];if(it.hasOffscreenPass()&&!it.isHidden(this.transform.zoom)){var bt=Ce[it.source];(it.type==="custom"||bt.length)&&this.renderLayer(this,y[it.source],it,bt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?d.Color.black:d.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){var Vt=this.style._layers[h[this.currentLayer]],gr=y[Vt.source],fr=se[Vt.source];this._renderTileClippingMasks(Vt,fr),this.renderLayer(this,gr,Vt,fr)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){var Er=this.style._layers[h[this.currentLayer]],jr=y[Er.source],fn=(Er.type==="symbol"?we:Ce)[Er.source];this._renderTileClippingMasks(Er,se[Er.source]),this.renderLayer(this,jr,Er,fn)}this.options.showTileBoundaries&&(d.values(this.style._layers).forEach(function(tn){tn.source&&!tn.isHidden(o.transform.zoom)&&(tn.source!==(V&&V.id)&&(V=o.style.sourceCaches[tn.source]),(!D||D.getSource().maxzoom<V.getSource().maxzoom)&&(D=V))}),D&&Uu.debug(this,D,D.getVisibleCoordinates())),this.options.showPadding&&function(tn){var Zn=tn.transform.padding;Dl(tn,tn.transform.height-(Zn.top||0),3,js),Dl(tn,Zn.bottom||0,3,io),Jl(tn,Zn.left||0,3,bo),Jl(tn,tn.transform.width-(Zn.right||0),3,zu);var si=tn.transform.centerPoint;(function(ui,dn,ia,Wn){_u(ui,dn-1,ia-10,2,20,Wn),_u(ui,dn-10,ia-1,20,2,Wn)})(tn,si.x,tn.transform.height-si.y,Ds)}(this),this.context.setDefault()},ao.prototype.renderLayer=function(i,u,o,h){o.isHidden(this.transform.zoom)||(o.type==="background"||o.type==="custom"||h.length)&&(this.id=o.id,this.gpuTimingStart(o),Uu[o.type](i,u,o,h,this.style.placement.variableOffsets),this.gpuTimingEnd())},ao.prototype.gpuTimingStart=function(i){if(this.options.gpuTiming){var u=this.context.extTimerQuery,o=this.gpuTimers[i.id];o||(o=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),o.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,o.query)}},ao.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}},ao.prototype.collectGpuTimers=function(){var i=this.gpuTimers;return this.gpuTimers={},i},ao.prototype.queryGpuTimers=function(i){var u={};for(var o in i){var h=i[o],y=this.context.extTimerQuery,b=y.getQueryObjectEXT(h.query,y.QUERY_RESULT_EXT)/1e6;y.deleteQueryEXT(h.query),u[o]=b}return u},ao.prototype.translatePosMatrix=function(i,u,o,h,y){if(!o[0]&&!o[1])return i;var b=y?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(b){var T=Math.sin(b),D=Math.cos(b);o=[o[0]*D-o[1]*T,o[0]*T+o[1]*D]}var V=[y?o[0]:xa(u,o[0],this.transform.zoom),y?o[1]:xa(u,o[1],this.transform.zoom),0],se=new Float32Array(16);return d.translate(se,i,V),se},ao.prototype.saveTileTexture=function(i){var u=this._tileTextures[i.size[0]];u?u.push(i):this._tileTextures[i.size[0]]=[i]},ao.prototype.getTileTexture=function(i){var u=this._tileTextures[i];return u&&u.length>0?u.pop():null},ao.prototype.isPatternMissing=function(i){if(!i)return!1;if(!i.from||!i.to)return!0;var u=this.imageManager.getPattern(i.from.toString()),o=this.imageManager.getPattern(i.to.toString());return!u||!o},ao.prototype.useProgram=function(i,u){this.cache=this.cache||{};var o=""+i+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[o]||(this.cache[o]=new hu(this.context,i,mo[i],u,El[i],this._showOverdrawInspector)),this.cache[o]},ao.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},ao.prototype.setBaseState=function(){var i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)},ao.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=d.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},ao.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var kl=function(i,u){this.points=i,this.planes=u};kl.fromInvProjectionMatrix=function(i,u,o){var h=Math.pow(2,o),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(T){return d.transformMat4([],T,i)}).map(function(T){return d.scale$1([],T,1/T[3]/u*h)}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(T){var D=d.sub([],y[T[0]],y[T[1]]),V=d.sub([],y[T[2]],y[T[1]]),se=d.normalize([],d.cross([],D,V)),Ce=-d.dot(se,y[T[1]]);return se.concat(Ce)});return new kl(y,b)};var Vs=function(i,u){this.min=i,this.max=u,this.center=d.scale$2([],d.add([],this.min,this.max),.5)};Vs.prototype.quadrant=function(i){for(var u=[i%2==0,i<2],o=d.clone$2(this.min),h=d.clone$2(this.max),y=0;y<u.length;y++)o[y]=u[y]?this.min[y]:this.center[y],h[y]=u[y]?this.center[y]:this.max[y];return h[2]=this.max[2],new Vs(o,h)},Vs.prototype.distanceX=function(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]},Vs.prototype.distanceY=function(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]},Vs.prototype.intersects=function(i){for(var u=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],o=!0,h=0;h<i.planes.length;h++){for(var y=i.planes[h],b=0,T=0;T<u.length;T++)b+=d.dot$1(y,u[T])>=0;if(b===0)return 0;b!==u.length&&(o=!1)}if(o)return 2;for(var D=0;D<3;D++){for(var V=Number.MAX_VALUE,se=-Number.MAX_VALUE,Ce=0;Ce<i.points.length;Ce++){var we=i.points[Ce][D]-this.min[D];V=Math.min(V,we),se=Math.max(se,we)}if(se<0||V>this.max[D]-this.min[D])return 0}return 1};var pu=function(i,u,o,h){if(i===void 0&&(i=0),u===void 0&&(u=0),o===void 0&&(o=0),h===void 0&&(h=0),isNaN(i)||i<0||isNaN(u)||u<0||isNaN(o)||o<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=u,this.left=o,this.right=h};pu.prototype.interpolate=function(i,u,o){return u.top!=null&&i.top!=null&&(this.top=d.number(i.top,u.top,o)),u.bottom!=null&&i.bottom!=null&&(this.bottom=d.number(i.bottom,u.bottom,o)),u.left!=null&&i.left!=null&&(this.left=d.number(i.left,u.left,o)),u.right!=null&&i.right!=null&&(this.right=d.number(i.right,u.right,o)),this},pu.prototype.getCenter=function(i,u){var o=d.clamp((this.left+i-this.right)/2,0,i),h=d.clamp((this.top+u-this.bottom)/2,0,u);return new d.Point(o,h)},pu.prototype.equals=function(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right},pu.prototype.clone=function(){return new pu(this.top,this.bottom,this.left,this.right)},pu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var sa=function(i,u,o,h,y){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=y===void 0||y,this._minZoom=i||0,this._maxZoom=u||22,this._minPitch=o==null?0:o,this._maxPitch=h==null?60:h,this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new pu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ai={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};sa.prototype.clone=function(){var i=new sa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.tileSize=this.tileSize,i.latRange=this.latRange,i.width=this.width,i.height=this.height,i._center=this._center,i.zoom=this.zoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._calcMatrices(),i},Ai.minZoom.get=function(){return this._minZoom},Ai.minZoom.set=function(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))},Ai.maxZoom.get=function(){return this._maxZoom},Ai.maxZoom.set=function(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))},Ai.minPitch.get=function(){return this._minPitch},Ai.minPitch.set=function(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))},Ai.maxPitch.get=function(){return this._maxPitch},Ai.maxPitch.set=function(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))},Ai.renderWorldCopies.get=function(){return this._renderWorldCopies},Ai.renderWorldCopies.set=function(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i},Ai.worldSize.get=function(){return this.tileSize*this.scale},Ai.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ai.size.get=function(){return new d.Point(this.width,this.height)},Ai.bearing.get=function(){return-this.angle/Math.PI*180},Ai.bearing.set=function(i){var u=-d.wrap(i,-180,180)*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=d.create$2(),d.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ai.pitch.get=function(){return this._pitch/Math.PI*180},Ai.pitch.set=function(i){var u=d.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())},Ai.fov.get=function(){return this._fov/Math.PI*180},Ai.fov.set=function(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())},Ai.zoom.get=function(){return this._zoom},Ai.zoom.set=function(i){var u=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom,this._constrain(),this._calcMatrices())},Ai.center.get=function(){return this._center},Ai.center.set=function(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())},Ai.padding.get=function(){return this._edgeInsets.toJSON()},Ai.padding.set=function(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())},Ai.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},sa.prototype.isPaddingEqual=function(i){return this._edgeInsets.equals(i)},sa.prototype.interpolatePadding=function(i,u,o){this._unmodified=!1,this._edgeInsets.interpolate(i,u,o),this._constrain(),this._calcMatrices()},sa.prototype.coveringZoomLevel=function(i){var u=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,u)},sa.prototype.getVisibleUnwrappedCoordinates=function(i){var u=[new d.UnwrappedTileID(0,i)];if(this._renderWorldCopies)for(var o=this.pointCoordinate(new d.Point(0,0)),h=this.pointCoordinate(new d.Point(this.width,0)),y=this.pointCoordinate(new d.Point(this.width,this.height)),b=this.pointCoordinate(new d.Point(0,this.height)),T=Math.floor(Math.min(o.x,h.x,y.x,b.x)),D=Math.floor(Math.max(o.x,h.x,y.x,b.x)),V=T-1;V<=D+1;V++)V!==0&&u.push(new d.UnwrappedTileID(V,i));return u},sa.prototype.coveringTiles=function(i){var u=this.coveringZoomLevel(i),o=u;if(i.minzoom!==void 0&&u<i.minzoom)return[];i.maxzoom!==void 0&&u>i.maxzoom&&(u=i.maxzoom);var h=d.MercatorCoordinate.fromLngLat(this.center),y=Math.pow(2,u),b=[y*h.x,y*h.y,0],T=kl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u),D=i.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(D=u);var V=function(tn){return{aabb:new Vs([tn*y,0,0],[(tn+1)*y,y,0]),zoom:0,x:0,y:0,wrap:tn,fullyVisible:!1}},se=[],Ce=[],we=u,Pe=i.reparseOverscaled?o:u;if(this._renderWorldCopies)for(var He=1;He<=3;He++)se.push(V(-He)),se.push(V(He));for(se.push(V(0));se.length>0;){var Ge=se.pop(),nt=Ge.x,ze=Ge.y,it=Ge.fullyVisible;if(!it){var bt=Ge.aabb.intersects(T);if(bt===0)continue;it=bt===2}var Vt=Ge.aabb.distanceX(b),gr=Ge.aabb.distanceY(b),fr=Math.max(Math.abs(Vt),Math.abs(gr));if(Ge.zoom===we||fr>3+(1<<we-Ge.zoom)-2&&Ge.zoom>=D)Ce.push({tileID:new d.OverscaledTileID(Ge.zoom===we?Pe:Ge.zoom,Ge.wrap,Ge.zoom,nt,ze),distanceSq:d.sqrLen([b[0]-.5-nt,b[1]-.5-ze])});else for(var Er=0;Er<4;Er++){var jr=(nt<<1)+Er%2,fn=(ze<<1)+(Er>>1);se.push({aabb:Ge.aabb.quadrant(Er),zoom:Ge.zoom+1,x:jr,y:fn,wrap:Ge.wrap,fullyVisible:it})}}return Ce.sort(function(tn,Zn){return tn.distanceSq-Zn.distanceSq}).map(function(tn){return tn.tileID})},sa.prototype.resize=function(i,u){this.width=i,this.height=u,this.pixelsToGLUnits=[2/i,-2/u],this._constrain(),this._calcMatrices()},Ai.unmodified.get=function(){return this._unmodified},sa.prototype.zoomScale=function(i){return Math.pow(2,i)},sa.prototype.scaleZoom=function(i){return Math.log(i)/Math.LN2},sa.prototype.project=function(i){var u=d.clamp(i.lat,-this.maxValidLatitude,this.maxValidLatitude);return new d.Point(d.mercatorXfromLng(i.lng)*this.worldSize,d.mercatorYfromLat(u)*this.worldSize)},sa.prototype.unproject=function(i){return new d.MercatorCoordinate(i.x/this.worldSize,i.y/this.worldSize).toLngLat()},Ai.point.get=function(){return this.project(this.center)},sa.prototype.setLocationAtPoint=function(i,u){var o=this.pointCoordinate(u),h=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(i),b=new d.MercatorCoordinate(y.x-(o.x-h.x),y.y-(o.y-h.y));this.center=this.coordinateLocation(b),this._renderWorldCopies&&(this.center=this.center.wrap())},sa.prototype.locationPoint=function(i){return this.coordinatePoint(this.locationCoordinate(i))},sa.prototype.pointLocation=function(i){return this.coordinateLocation(this.pointCoordinate(i))},sa.prototype.locationCoordinate=function(i){return d.MercatorCoordinate.fromLngLat(i)},sa.prototype.coordinateLocation=function(i){return i.toLngLat()},sa.prototype.pointCoordinate=function(i){var u=[i.x,i.y,0,1],o=[i.x,i.y,1,1];d.transformMat4(u,u,this.pixelMatrixInverse),d.transformMat4(o,o,this.pixelMatrixInverse);var h=u[3],y=o[3],b=u[1]/h,T=o[1]/y,D=u[2]/h,V=o[2]/y,se=D===V?0:(0-D)/(V-D);return new d.MercatorCoordinate(d.number(u[0]/h,o[0]/y,se)/this.worldSize,d.number(b,T,se)/this.worldSize)},sa.prototype.coordinatePoint=function(i){var u=[i.x*this.worldSize,i.y*this.worldSize,0,1];return d.transformMat4(u,u,this.pixelMatrix),new d.Point(u[0]/u[3],u[1]/u[3])},sa.prototype.getBounds=function(){return new d.LngLatBounds().extend(this.pointLocation(new d.Point(0,0))).extend(this.pointLocation(new d.Point(this.width,0))).extend(this.pointLocation(new d.Point(this.width,this.height))).extend(this.pointLocation(new d.Point(0,this.height)))},sa.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new d.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},sa.prototype.setMaxBounds=function(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},sa.prototype.calculatePosMatrix=function(i,u){u===void 0&&(u=!1);var o=i.key,h=u?this._alignedPosMatrixCache:this._posMatrixCache;if(h[o])return h[o];var y=i.canonical,b=this.worldSize/this.zoomScale(y.z),T=y.x+Math.pow(2,y.z)*i.wrap,D=d.identity(new Float64Array(16));return d.translate(D,D,[T*b,y.y*b,0]),d.scale(D,D,[b/d.EXTENT,b/d.EXTENT,1]),d.multiply(D,u?this.alignedProjMatrix:this.projMatrix,D),h[o]=new Float32Array(D),h[o]},sa.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},sa.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var i,u,o,h,y=-90,b=90,T=-180,D=180,V=this.size,se=this._unmodified;if(this.latRange){var Ce=this.latRange;y=d.mercatorYfromLat(Ce[1])*this.worldSize,i=(b=d.mercatorYfromLat(Ce[0])*this.worldSize)-y<V.y?V.y/(b-y):0}if(this.lngRange){var we=this.lngRange;T=d.mercatorXfromLng(we[0])*this.worldSize,u=(D=d.mercatorXfromLng(we[1])*this.worldSize)-T<V.x?V.x/(D-T):0}var Pe=this.point,He=Math.max(u||0,i||0);if(He)return this.center=this.unproject(new d.Point(u?(D+T)/2:Pe.x,i?(b+y)/2:Pe.y)),this.zoom+=this.scaleZoom(He),this._unmodified=se,void(this._constraining=!1);if(this.latRange){var Ge=Pe.y,nt=V.y/2;Ge-nt<y&&(h=y+nt),Ge+nt>b&&(h=b-nt)}if(this.lngRange){var ze=Pe.x,it=V.x/2;ze-it<T&&(o=T+it),ze+it>D&&(o=D-it)}o===void 0&&h===void 0||(this.center=this.unproject(new d.Point(o!==void 0?o:Pe.x,h!==void 0?h:Pe.y))),this._unmodified=se,this._constraining=!1}},sa.prototype._calcMatrices=function(){if(this.height){var i=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var u=Math.PI/2+this._pitch,o=this._fov*(.5+i.y/this.height),h=Math.sin(o)*this.cameraToCenterDistance/Math.sin(d.clamp(Math.PI-u-o,.01,Math.PI-.01)),y=this.point,b=y.x,T=y.y,D=1.01*(Math.cos(Math.PI/2-this._pitch)*h+this.cameraToCenterDistance),V=this.height/50,se=new Float64Array(16);d.perspective(se,this._fov,this.width/this.height,V,D),se[8]=2*-i.x/this.width,se[9]=2*i.y/this.height,d.scale(se,se,[1,-1,1]),d.translate(se,se,[0,0,-this.cameraToCenterDistance]),d.rotateX(se,se,this._pitch),d.rotateZ(se,se,this.angle),d.translate(se,se,[-b,-T,0]),this.mercatorMatrix=d.scale([],se,[this.worldSize,this.worldSize,this.worldSize]),d.scale(se,se,[1,1,d.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=se,this.invProjMatrix=d.invert([],this.projMatrix);var Ce=this.width%2/2,we=this.height%2/2,Pe=Math.cos(this.angle),He=Math.sin(this.angle),Ge=b-Math.round(b)+Pe*Ce+He*we,nt=T-Math.round(T)+Pe*we+He*Ce,ze=new Float64Array(se);if(d.translate(ze,ze,[Ge>.5?Ge-1:Ge,nt>.5?nt-1:nt,0]),this.alignedProjMatrix=ze,se=d.create(),d.scale(se,se,[this.width/2,-this.height/2,1]),d.translate(se,se,[1,-1,0]),this.labelPlaneMatrix=se,se=d.create(),d.scale(se,se,[1,-1,1]),d.translate(se,se,[-1,-1,0]),d.scale(se,se,[2/this.width,2/this.height,1]),this.glCoordMatrix=se,this.pixelMatrix=d.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(se=d.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=se,this._posMatrixCache={},this._alignedPosMatrixCache={}}},sa.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var i=this.pointCoordinate(new d.Point(0,0)),u=[i.x*this.worldSize,i.y*this.worldSize,0,1];return d.transformMat4(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance},sa.prototype.getCameraPoint=function(){var i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.Point(0,i))},sa.prototype.getCameraQueryGeometry=function(i){var u=this.getCameraPoint();if(i.length===1)return[i[0],u];for(var o=u.x,h=u.y,y=u.x,b=u.y,T=0,D=i;T<D.length;T+=1){var V=D[T];o=Math.min(o,V.x),h=Math.min(h,V.y),y=Math.max(y,V.x),b=Math.max(b,V.y)}return[new d.Point(o,h),new d.Point(y,h),new d.Point(y,b),new d.Point(o,b),new d.Point(o,h)]},Object.defineProperties(sa.prototype,Ai);var ys=function(i){var u,o,h,y;this._hashName=i&&encodeURIComponent(i),d.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(u=this._updateHashUnthrottled.bind(this),o=!1,h=null,y=function(){h=null,o&&(u(),h=setTimeout(y,300),o=!1)},function(){return o=!0,h||y(),h})};ys.prototype.addTo=function(i){return this._map=i,d.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},ys.prototype.remove=function(){return d.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},ys.prototype.getHashString=function(i){var u=this._map.getCenter(),o=Math.round(100*this._map.getZoom())/100,h=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,h),b=Math.round(u.lng*y)/y,T=Math.round(u.lat*y)/y,D=this._map.getBearing(),V=this._map.getPitch(),se="";if(se+=i?"/"+b+"/"+T+"/"+o:o+"/"+T+"/"+b,(D||V)&&(se+="/"+Math.round(10*D)/10),V&&(se+="/"+Math.round(V)),this._hashName){var Ce=this._hashName,we=!1,Pe=d.window.location.hash.slice(1).split("&").map(function(He){var Ge=He.split("=")[0];return Ge===Ce?(we=!0,Ge+"="+se):He}).filter(function(He){return He});return we||Pe.push(Ce+"="+se),"#"+Pe.join("&")}return"#"+se},ys.prototype._getCurrentHash=function(){var i,u=this,o=d.window.location.hash.replace("#","");return this._hashName?(o.split("&").map(function(h){return h.split("=")}).forEach(function(h){h[0]===u._hashName&&(i=h)}),(i&&i[1]||"").split("/")):o.split("/")},ys.prototype._onHashChange=function(){var i=this._getCurrentHash();if(i.length>=3&&!i.some(function(o){return isNaN(o)})){var u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:u,pitch:+(i[4]||0)}),!0}return!1},ys.prototype._updateHashUnthrottled=function(){var i=d.window.location.href.replace(/(#.+)?$/,this.getHashString());try{d.window.history.replaceState(d.window.history.state,null,i)}catch(u){}};var du={linearity:.3,easing:d.bezier(0,0,.3,1)},tl=d.extend({deceleration:2500,maxSpeed:1400},du),rs=d.extend({deceleration:20,maxSpeed:1400},du),Qc=d.extend({deceleration:1e3,maxSpeed:360},du),Fc=d.extend({deceleration:1e3,maxSpeed:90},du),wl=function(i){this._map=i,this.clear()};function Fl(i,u){(!i.duration||i.duration<u.duration)&&(i.duration=u.duration,i.easing=u.easing)}function xu(i,u,o){var h=o.maxSpeed,y=o.linearity,b=o.deceleration,T=d.clamp(i*y/(u/1e3),-h,h),D=Math.abs(T)/(b*y);return{easing:o.easing,duration:1e3*D,amount:T*(D/2)}}wl.prototype.clear=function(){this._inertiaBuffer=[]},wl.prototype.record=function(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:d.browser.now(),settings:i})},wl.prototype._drainInertiaBuffer=function(){for(var i=this._inertiaBuffer,u=d.browser.now();i.length>0&&u-i[0].time>160;)i.shift()},wl.prototype._onMoveEnd=function(i){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var u={zoom:0,bearing:0,pitch:0,pan:new d.Point(0,0),pinchAround:void 0,around:void 0},o=0,h=this._inertiaBuffer;o<h.length;o+=1){var y=h[o].settings;u.zoom+=y.zoomDelta||0,u.bearing+=y.bearingDelta||0,u.pitch+=y.pitchDelta||0,y.panDelta&&u.pan._add(y.panDelta),y.around&&(u.around=y.around),y.pinchAround&&(u.pinchAround=y.pinchAround)}var b=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};if(u.pan.mag()){var D=xu(u.pan.mag(),b,d.extend({},tl,i||{}));T.offset=u.pan.mult(D.amount/u.pan.mag()),T.center=this._map.transform.center,Fl(T,D)}if(u.zoom){var V=xu(u.zoom,b,rs);T.zoom=this._map.transform.zoom+V.amount,Fl(T,V)}if(u.bearing){var se=xu(u.bearing,b,Qc);T.bearing=this._map.transform.bearing+d.clamp(se.amount,-179,179),Fl(T,se)}if(u.pitch){var Ce=xu(u.pitch,b,Fc);T.pitch=this._map.transform.pitch+Ce.amount,Fl(T,Ce)}if(T.zoom||T.bearing){var we=u.pinchAround===void 0?u.around:u.pinchAround;T.around=we?this._map.unproject(we):this._map.getCenter()}return this.clear(),d.extend(T,{noMoveStart:!0})}};var Ao=function(i){function u(h,y,b,T){T===void 0&&(T={});var D=te.mousePos(y.getCanvasContainer(),b),V=y.unproject(D);i.call(this,h,d.extend({point:D,lngLat:V,originalEvent:b},T)),this._defaultPrevented=!1,this.target=y}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,o),u}(d.Event),Zu=function(i){function u(h,y,b){var T=h==="touchend"?b.changedTouches:b.touches,D=te.touchPos(y.getCanvasContainer(),T),V=D.map(function(we){return y.unproject(we)}),se=D.reduce(function(we,Pe,He,Ge){return we.add(Pe.div(Ge.length))},new d.Point(0,0)),Ce=y.unproject(se);i.call(this,h,{points:D,point:se,lngLats:V,lngLat:Ce,originalEvent:b}),this._defaultPrevented=!1}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,o),u}(d.Event),Al=function(i){function u(h,y,b){i.call(this,h,{originalEvent:b}),this._defaultPrevented=!1}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,o),u}(d.Event),To=function(i,u){this._map=i,this._clickTolerance=u.clickTolerance};To.prototype.reset=function(){delete this._mousedownPos},To.prototype.wheel=function(i){return this._firePreventable(new Al(i.type,this._map,i))},To.prototype.mousedown=function(i,u){return this._mousedownPos=u,this._firePreventable(new Ao(i.type,this._map,i))},To.prototype.mouseup=function(i){this._map.fire(new Ao(i.type,this._map,i))},To.prototype.click=function(i,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new Ao(i.type,this._map,i))},To.prototype.dblclick=function(i){return this._firePreventable(new Ao(i.type,this._map,i))},To.prototype.mouseover=function(i){this._map.fire(new Ao(i.type,this._map,i))},To.prototype.mouseout=function(i){this._map.fire(new Ao(i.type,this._map,i))},To.prototype.touchstart=function(i){return this._firePreventable(new Zu(i.type,this._map,i))},To.prototype.touchmove=function(i){this._map.fire(new Zu(i.type,this._map,i))},To.prototype.touchend=function(i){this._map.fire(new Zu(i.type,this._map,i))},To.prototype.touchcancel=function(i){this._map.fire(new Zu(i.type,this._map,i))},To.prototype._firePreventable=function(i){if(this._map.fire(i),i.defaultPrevented)return{}},To.prototype.isEnabled=function(){return!0},To.prototype.isActive=function(){return!1},To.prototype.enable=function(){},To.prototype.disable=function(){};var Dn=function(i){this._map=i};Dn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Dn.prototype.mousemove=function(i){this._map.fire(new Ao(i.type,this._map,i))},Dn.prototype.mousedown=function(){this._delayContextMenu=!0},Dn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ao("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Dn.prototype.contextmenu=function(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Ao(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()},Dn.prototype.isEnabled=function(){return!0},Dn.prototype.isActive=function(){return!1},Dn.prototype.enable=function(){},Dn.prototype.disable=function(){};var ho=function(i,u){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=u.clickTolerance||1};function bu(i,u){for(var o={},h=0;h<i.length;h++)o[i[h].identifier]=u[h];return o}ho.prototype.isEnabled=function(){return!!this._enabled},ho.prototype.isActive=function(){return!!this._active},ho.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},ho.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ho.prototype.mousedown=function(i,u){this.isEnabled()&&i.shiftKey&&i.button===0&&(te.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)},ho.prototype.mousemoveWindow=function(i,u){if(this._active){var o=u;if(!(this._lastPos.equals(o)||!this._box&&o.dist(this._startPos)<this._clickTolerance)){var h=this._startPos;this._lastPos=o,this._box||(this._box=te.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));var y=Math.min(h.x,o.x),b=Math.max(h.x,o.x),T=Math.min(h.y,o.y),D=Math.max(h.y,o.y);te.setTransform(this._box,"translate("+y+"px,"+T+"px)"),this._box.style.width=b-y+"px",this._box.style.height=D-T+"px"}}},ho.prototype.mouseupWindow=function(i,u){var o=this;if(this._active&&i.button===0){var h=this._startPos,y=u;if(this.reset(),te.suppressClick(),h.x!==y.x||h.y!==y.y)return this._map.fire(new d.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:function(b){return b.fitScreenCoordinates(h,y,o._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",i)}},ho.prototype.keydown=function(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))},ho.prototype.blur=function(){this.reset()},ho.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(te.remove(this._box),this._box=null),te.enableDrag(),delete this._startPos,delete this._lastPos},ho.prototype._fireEvent=function(i,u){return this._map.fire(new d.Event(i,{originalEvent:u}))};var ju=function(i){this.reset(),this.numTouches=i.numTouches};ju.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},ju.prototype.touchstart=function(i,u,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),o.length===this.numTouches&&(this.centroid=function(h){for(var y=new d.Point(0,0),b=0,T=h;b<T.length;b+=1)y._add(T[b]);return y.div(h.length)}(u),this.touches=bu(o,u)))},ju.prototype.touchmove=function(i,u,o){if(!this.aborted&&this.centroid){var h=bu(o,u);for(var y in this.touches){var b=h[y];(!b||b.dist(this.touches[y])>30)&&(this.aborted=!0)}}},ju.prototype.touchend=function(i,u,o){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){var h=!this.aborted&&this.centroid;if(this.reset(),h)return h}};var Ka=function(i){this.singleTap=new ju(i),this.numTaps=i.numTaps,this.reset()};Ka.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Ka.prototype.touchstart=function(i,u,o){this.singleTap.touchstart(i,u,o)},Ka.prototype.touchmove=function(i,u,o){this.singleTap.touchmove(i,u,o)},Ka.prototype.touchend=function(i,u,o){var h=this.singleTap.touchend(i,u,o);if(h){var y=i.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(h)<30;if(y&&b||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}};var ks=function(){this._zoomIn=new Ka({numTouches:1,numTaps:2}),this._zoomOut=new Ka({numTouches:2,numTaps:1}),this.reset()};ks.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},ks.prototype.touchstart=function(i,u,o){this._zoomIn.touchstart(i,u,o),this._zoomOut.touchstart(i,u,o)},ks.prototype.touchmove=function(i,u,o){this._zoomIn.touchmove(i,u,o),this._zoomOut.touchmove(i,u,o)},ks.prototype.touchend=function(i,u,o){var h=this,y=this._zoomIn.touchend(i,u,o),b=this._zoomOut.touchend(i,u,o);return y?(this._active=!0,i.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(y)},{originalEvent:i})}}):b?(this._active=!0,i.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(b)},{originalEvent:i})}}):void 0},ks.prototype.touchcancel=function(){this.reset()},ks.prototype.enable=function(){this._enabled=!0},ks.prototype.disable=function(){this._enabled=!1,this.reset()},ks.prototype.isEnabled=function(){return this._enabled},ks.prototype.isActive=function(){return this._active};var yc={0:1,2:2},xn=function(i){this.reset(),this._clickTolerance=i.clickTolerance||1};xn.prototype.blur=function(){this.reset()},xn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},xn.prototype._correctButton=function(i,u){return!1},xn.prototype._move=function(i,u){return{}},xn.prototype.mousedown=function(i,u){if(!this._lastPoint){var o=te.mouseButton(i);this._correctButton(i,o)&&(this._lastPoint=u,this._eventButton=o)}},xn.prototype.mousemoveWindow=function(i,u){var o=this._lastPoint;if(o){if(i.preventDefault(),function(h,y){var b=yc[y];return h.buttons===void 0||(h.buttons&b)!==b}(i,this._eventButton))this.reset();else if(this._moved||!(u.dist(o)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(o,u)}},xn.prototype.mouseupWindow=function(i){this._lastPoint&&te.mouseButton(i)===this._eventButton&&(this._moved&&te.suppressClick(),this.reset())},xn.prototype.enable=function(){this._enabled=!0},xn.prototype.disable=function(){this._enabled=!1,this.reset()},xn.prototype.isEnabled=function(){return this._enabled},xn.prototype.isActive=function(){return this._active};var Ou=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.mousedown=function(o,h){i.prototype.mousedown.call(this,o,h),this._lastPoint&&(this._active=!0)},u.prototype._correctButton=function(o,h){return h===0&&!o.ctrlKey},u.prototype._move=function(o,h){return{around:h,panDelta:h.sub(o)}},u}(xn),_c=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype._correctButton=function(o,h){return h===0&&o.ctrlKey||h===2},u.prototype._move=function(o,h){var y=.8*(h.x-o.x);if(y)return this._active=!0,{bearingDelta:y}},u.prototype.contextmenu=function(o){o.preventDefault()},u}(xn),nu=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype._correctButton=function(o,h){return h===0&&o.ctrlKey||h===2},u.prototype._move=function(o,h){var y=-.5*(h.y-o.y);if(y)return this._active=!0,{pitchDelta:y}},u.prototype.contextmenu=function(o){o.preventDefault()},u}(xn),Za=function(i){this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset()};Za.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new d.Point(0,0)},Za.prototype.touchstart=function(i,u,o){return this._calculateTransform(i,u,o)},Za.prototype.touchmove=function(i,u,o){if(this._active&&!(o.length<this._minTouches))return i.preventDefault(),this._calculateTransform(i,u,o)},Za.prototype.touchend=function(i,u,o){this._calculateTransform(i,u,o),this._active&&o.length<this._minTouches&&this.reset()},Za.prototype.touchcancel=function(){this.reset()},Za.prototype._calculateTransform=function(i,u,o){o.length>0&&(this._active=!0);var h=bu(o,u),y=new d.Point(0,0),b=new d.Point(0,0),T=0;for(var D in h){var V=h[D],se=this._touches[D];se&&(y._add(V),b._add(V.sub(se)),T++,h[D]=V)}if(this._touches=h,!(T<this._minTouches)&&b.mag()){var Ce=b.div(T);if(this._sum._add(Ce),!(this._sum.mag()<this._clickTolerance))return{around:y.div(T),panDelta:Ce}}},Za.prototype.enable=function(){this._enabled=!0},Za.prototype.disable=function(){this._enabled=!1,this.reset()},Za.prototype.isEnabled=function(){return this._enabled},Za.prototype.isActive=function(){return this._active};var _s=function(){this.reset()};function Tl(i,u,o){for(var h=0;h<i.length;h++)if(i[h].identifier===o)return u[h]}function iu(i,u){return Math.log(i/u)/Math.LN2}_s.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},_s.prototype._start=function(i){},_s.prototype._move=function(i,u,o){return{}},_s.prototype.touchstart=function(i,u,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([u[0],u[1]]))},_s.prototype.touchmove=function(i,u,o){if(this._firstTwoTouches){i.preventDefault();var h=this._firstTwoTouches,y=h[1],b=Tl(o,u,h[0]),T=Tl(o,u,y);if(b&&T){var D=this._aroundCenter?null:b.add(T).div(2);return this._move([b,T],D,i)}}},_s.prototype.touchend=function(i,u,o){if(this._firstTwoTouches){var h=this._firstTwoTouches,y=h[1],b=Tl(o,u,h[0]),T=Tl(o,u,y);b&&T||(this._active&&te.suppressClick(),this.reset())}},_s.prototype.touchcancel=function(){this.reset()},_s.prototype.enable=function(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"},_s.prototype.disable=function(){this._enabled=!1,this.reset()},_s.prototype.isEnabled=function(){return this._enabled},_s.prototype.isActive=function(){return this._active};var Ts=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),delete this._distance,delete this._startDistance},u.prototype._start=function(o){this._startDistance=this._distance=o[0].dist(o[1])},u.prototype._move=function(o,h){var y=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(iu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:iu(this._distance,y),pinchAround:h}},u}(_s);function Su(i,u){return 180*i.angleWith(u)/Math.PI}var qc=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},u.prototype._start=function(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])},u.prototype._move=function(o,h){var y=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Su(this._vector,y),pinchAround:h}},u.prototype._isBelowThreshold=function(o){this._minDiameter=Math.min(this._minDiameter,o.mag());var h=25/(Math.PI*this._minDiameter)*360,y=Su(o,this._startVector);return Math.abs(y)<h},u}(_s);function ql(i){return Math.abs(i.y)>Math.abs(i.x)}var ec=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},u.prototype._start=function(o){this._lastPoints=o,ql(o[0].sub(o[1]))&&(this._valid=!1)},u.prototype._move=function(o,h,y){var b=o[0].sub(this._lastPoints[0]),T=o[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(b,T,y.timeStamp),this._valid)return this._lastPoints=o,this._active=!0,{pitchDelta:(b.y+T.y)/2*-.5}},u.prototype.gestureBeginsVertically=function(o,h,y){if(this._valid!==void 0)return this._valid;var b=o.mag()>=2,T=h.mag()>=2;if(b||T){if(!b||!T)return this._firstMove===void 0&&(this._firstMove=y),y-this._firstMove<100&&void 0;var D=o.y>0==h.y>0;return ql(o)&&ql(h)&&D}},u}(_s),Po={panStep:100,bearingStep:15,pitchStep:10},Gs=function(){var i=Po;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1};function Mo(i){return i*(2-i)}Gs.prototype.blur=function(){this.reset()},Gs.prototype.reset=function(){this._active=!1},Gs.prototype.keydown=function(i){var u=this;if(!(i.altKey||i.ctrlKey||i.metaKey)){var o=0,h=0,y=0,b=0,T=0;switch(i.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:i.shiftKey?h=-1:(i.preventDefault(),b=-1);break;case 39:i.shiftKey?h=1:(i.preventDefault(),b=1);break;case 38:i.shiftKey?y=1:(i.preventDefault(),T=-1);break;case 40:i.shiftKey?y=-1:(i.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(h=0,y=0),{cameraAnimation:function(D){var V=D.getZoom();D.easeTo({duration:300,easeId:"keyboardHandler",easing:Mo,zoom:o?Math.round(V)+o*(i.shiftKey?2:1):V,bearing:D.getBearing()+h*u._bearingStep,pitch:D.getPitch()+y*u._pitchStep,offset:[-b*u._panStep,-T*u._panStep],center:D.getCenter()},{originalEvent:i})}}}},Gs.prototype.enable=function(){this._enabled=!0},Gs.prototype.disable=function(){this._enabled=!1,this.reset()},Gs.prototype.isEnabled=function(){return this._enabled},Gs.prototype.isActive=function(){return this._active},Gs.prototype.disableRotation=function(){this._rotationDisabled=!0},Gs.prototype.enableRotation=function(){this._rotationDisabled=!1};var ta=function(i,u){this._map=i,this._el=i.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,d.bindAll(["_onTimeout"],this)};ta.prototype.setZoomRate=function(i){this._defaultZoomRate=i},ta.prototype.setWheelZoomRate=function(i){this._wheelZoomRate=i},ta.prototype.isEnabled=function(){return!!this._enabled},ta.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},ta.prototype.isZooming=function(){return!!this._zooming},ta.prototype.enable=function(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=i&&i.around==="center")},ta.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ta.prototype.wheel=function(i){if(this.isEnabled()){var u=i.deltaMode===d.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY,o=d.browser.now(),h=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,u!==0&&u%4.000244140625==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(h*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),i.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=i,this._delta-=u,this._active||this._start(i)),i.preventDefault()}},ta.prototype._onTimeout=function(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)},ta.prototype._start=function(i){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var u=te.mousePos(this._el,i);this._around=d.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(u)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},ta.prototype.renderFrame=function(){var i=this;if(this._frameId&&(this._frameId=null,this.isActive())){var u=this._map.transform;if(this._delta!==0){var o=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,h=2/(1+Math.exp(-Math.abs(this._delta*o)));this._delta<0&&h!==0&&(h=1/h);var y=typeof this._targetZoom=="number"?u.zoomScale(this._targetZoom):u.scale;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(y*h))),this._type==="wheel"&&(this._startZoom=u.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var b,T=typeof this._targetZoom=="number"?this._targetZoom:u.zoom,D=this._startZoom,V=this._easing,se=!1;if(this._type==="wheel"&&D&&V){var Ce=Math.min((d.browser.now()-this._lastWheelEventTime)/200,1),we=V(Ce);b=d.number(D,T,we),Ce<1?this._frameId||(this._frameId=!0):se=!0}else b=T,se=!0;return this._active=!0,se&&(this._active=!1,this._finishTimeout=setTimeout(function(){i._zooming=!1,i._handler._triggerRenderFrame(),delete i._targetZoom,delete i._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!se,zoomDelta:b-u.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},ta.prototype._smoothOutEasing=function(i){var u=d.ease;if(this._prevEase){var o=this._prevEase,h=(d.browser.now()-o.start)/o.duration,y=o.easing(h+.01)-o.easing(h),b=.27/Math.sqrt(y*y+1e-4)*.01,T=Math.sqrt(.0729-b*b);u=d.bezier(b,T,.25,1)}return this._prevEase={start:d.browser.now(),duration:i,easing:u},u},ta.prototype.blur=function(){this.reset()},ta.prototype.reset=function(){this._active=!1};var Vu=function(i,u){this._clickZoom=i,this._tapZoom=u};Vu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Vu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Vu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Vu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var vu=function(){this.reset()};vu.prototype.reset=function(){this._active=!1},vu.prototype.blur=function(){this.reset()},vu.prototype.dblclick=function(i,u){return i.preventDefault(),{cameraAnimation:function(o){o.easeTo({duration:300,zoom:o.getZoom()+(i.shiftKey?-1:1),around:o.unproject(u)},{originalEvent:i})}}},vu.prototype.enable=function(){this._enabled=!0},vu.prototype.disable=function(){this._enabled=!1,this.reset()},vu.prototype.isEnabled=function(){return this._enabled},vu.prototype.isActive=function(){return this._active};var Ko=function(){this._tap=new Ka({numTouches:1,numTaps:1}),this.reset()};Ko.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Ko.prototype.touchstart=function(i,u,o){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?o.length>0&&(this._swipePoint=u[0],this._swipeTouch=o[0].identifier):this._tap.touchstart(i,u,o))},Ko.prototype.touchmove=function(i,u,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;var h=u[0],y=h.y-this._swipePoint.y;return this._swipePoint=h,i.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(i,u,o)},Ko.prototype.touchend=function(i,u,o){this._tapTime?this._swipePoint&&o.length===0&&this.reset():this._tap.touchend(i,u,o)&&(this._tapTime=i.timeStamp)},Ko.prototype.touchcancel=function(){this.reset()},Ko.prototype.enable=function(){this._enabled=!0},Ko.prototype.disable=function(){this._enabled=!1,this.reset()},Ko.prototype.isEnabled=function(){return this._enabled},Ko.prototype.isActive=function(){return this._active};var rl=function(i,u,o){this._el=i,this._mousePan=u,this._touchPan=o};rl.prototype.enable=function(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},rl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},rl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},rl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Eu=function(i,u,o){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=u,this._mousePitch=o};Eu.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Eu.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Eu.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Eu.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var bi=function(i,u,o,h){this._el=i,this._touchZoom=u,this._touchRotate=o,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0};bi.prototype.enable=function(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},bi.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},bi.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},bi.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},bi.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},bi.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var po=function(i){return i.zoom||i.drag||i.pitch||i.rotate},Pl=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u}(d.Event);function jn(i){return i.panDelta&&i.panDelta.mag()||i.zoomDelta||i.bearingDelta||i.pitchDelta}var Hn=function(i,u){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new wl(i),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u),d.bindAll(["handleEvent","handleWindowEvent"],this);var o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[d.window.document,"mousemove",{capture:!0}],[d.window.document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[d.window,"blur",void 0]];for(var h=0,y=this._listeners;h<y.length;h+=1){var b=y[h],T=b[0];te.addEventListener(T,b[1],T===d.window.document?this.handleWindowEvent:this.handleEvent,b[2])}};Hn.prototype.destroy=function(){for(var i=0,u=this._listeners;i<u.length;i+=1){var o=u[i],h=o[0];te.removeEventListener(h,o[1],h===d.window.document?this.handleWindowEvent:this.handleEvent,o[2])}},Hn.prototype._addDefaultHandlers=function(i){var u=this._map,o=u.getCanvasContainer();this._add("mapEvent",new To(u,i));var h=u.boxZoom=new ho(u,i);this._add("boxZoom",h);var y=new ks,b=new vu;u.doubleClickZoom=new Vu(b,y),this._add("tapZoom",y),this._add("clickZoom",b);var T=new Ko;this._add("tapDragZoom",T);var D=u.touchPitch=new ec;this._add("touchPitch",D);var V=new _c(i),se=new nu(i);u.dragRotate=new Eu(i,V,se),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",se,["mouseRotate"]);var Ce=new Ou(i),we=new Za(i);u.dragPan=new rl(o,Ce,we),this._add("mousePan",Ce),this._add("touchPan",we,["touchZoom","touchRotate"]);var Pe=new qc,He=new Ts;u.touchZoomRotate=new bi(o,He,Pe,T),this._add("touchRotate",Pe,["touchPan","touchZoom"]),this._add("touchZoom",He,["touchPan","touchRotate"]);var Ge=u.scrollZoom=new ta(u,this);this._add("scrollZoom",Ge,["mousePan"]);var nt=u.keyboard=new Gs;this._add("keyboard",nt),this._add("blockableMapEvent",new Dn(u));for(var ze=0,it=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];ze<it.length;ze+=1){var bt=it[ze];i.interactive&&i[bt]&&u[bt].enable(i[bt])}},Hn.prototype._add=function(i,u,o){this._handlers.push({handlerName:i,handler:u,allowed:o}),this._handlersById[i]=u},Hn.prototype.stop=function(i){if(!this._updatingCamera){for(var u=0,o=this._handlers;u<o.length;u+=1)o[u].handler.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}},Hn.prototype.isActive=function(){for(var i=0,u=this._handlers;i<u.length;i+=1)if(u[i].handler.isActive())return!0;return!1},Hn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Hn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Hn.prototype.isMoving=function(){return Boolean(po(this._eventsInProgress))||this.isZooming()},Hn.prototype._blockedByActive=function(i,u,o){for(var h in i)if(h!==o&&(!u||u.indexOf(h)<0))return!0;return!1},Hn.prototype.handleWindowEvent=function(i){this.handleEvent(i,i.type+"Window")},Hn.prototype._getMapTouches=function(i){for(var u=[],o=0,h=i;o<h.length;o+=1){var y=h[o];this._el.contains(y.target)&&u.push(y)}return u},Hn.prototype.handleEvent=function(i,u){this._updatingCamera=!0;for(var o=i.type==="renderFrame"?void 0:i,h={needsRenderFrame:!1},y={},b={},T=i.touches?this._getMapTouches(i.touches):void 0,D=T?te.touchPos(this._el,T):te.mousePos(this._el,i),V=0,se=this._handlers;V<se.length;V+=1){var Ce=se[V],we=Ce.handlerName,Pe=Ce.handler,He=Ce.allowed;if(Pe.isEnabled()){var Ge=void 0;this._blockedByActive(b,He,we)?Pe.reset():Pe[u||i.type]&&(Ge=Pe[u||i.type](i,D,T),this.mergeHandlerResult(h,y,Ge,we,o),Ge&&Ge.needsRenderFrame&&this._triggerRenderFrame()),(Ge||Pe.isActive())&&(b[we]=Pe)}}var nt={};for(var ze in this._previousActiveHandlers)b[ze]||(nt[ze]=o);this._previousActiveHandlers=b,(Object.keys(nt).length||jn(h))&&(this._changes.push([h,y,nt]),this._triggerRenderFrame()),(Object.keys(b).length||jn(h))&&this._map._stop(!0),this._updatingCamera=!1;var it=h.cameraAnimation;it&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],it(this._map))},Hn.prototype.mergeHandlerResult=function(i,u,o,h,y){if(o){d.extend(i,o);var b={handlerName:h,originalEvent:o.originalEvent||y};o.zoomDelta!==void 0&&(u.zoom=b),o.panDelta!==void 0&&(u.drag=b),o.pitchDelta!==void 0&&(u.pitch=b),o.bearingDelta!==void 0&&(u.rotate=b)}},Hn.prototype._applyChanges=function(){for(var i={},u={},o={},h=0,y=this._changes;h<y.length;h+=1){var b=y[h],T=b[0],D=b[1],V=b[2];T.panDelta&&(i.panDelta=(i.panDelta||new d.Point(0,0))._add(T.panDelta)),T.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+T.zoomDelta),T.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+T.bearingDelta),T.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+T.pitchDelta),T.around!==void 0&&(i.around=T.around),T.pinchAround!==void 0&&(i.pinchAround=T.pinchAround),T.noInertia&&(i.noInertia=T.noInertia),d.extend(u,D),d.extend(o,V)}this._updateMapTransform(i,u,o),this._changes=[]},Hn.prototype._updateMapTransform=function(i,u,o){var h=this._map,y=h.transform;if(!jn(i))return this._fireEvents(u,o,!0);var b=i.panDelta,T=i.zoomDelta,D=i.bearingDelta,V=i.pitchDelta,se=i.around,Ce=i.pinchAround;Ce!==void 0&&(se=Ce),h._stop(!0),se=se||h.transform.centerPoint;var we=y.pointLocation(b?se.sub(b):se);D&&(y.bearing+=D),V&&(y.pitch+=V),T&&(y.zoom+=T),y.setLocationAtPoint(we,se),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(u,o,!0)},Hn.prototype._fireEvents=function(i,u,o){var h=this,y=po(this._eventsInProgress),b=po(i),T={};for(var D in i)this._eventsInProgress[D]||(T[D+"start"]=i[D].originalEvent),this._eventsInProgress[D]=i[D];for(var V in!y&&b&&this._fireEvent("movestart",b.originalEvent),T)this._fireEvent(V,T[V]);for(var se in b&&this._fireEvent("move",b.originalEvent),i)this._fireEvent(se,i[se].originalEvent);var Ce,we={};for(var Pe in this._eventsInProgress){var He=this._eventsInProgress[Pe],Ge=He.handlerName,nt=He.originalEvent;this._handlersById[Ge].isActive()||(delete this._eventsInProgress[Pe],we[Pe+"end"]=Ce=u[Ge]||nt)}for(var ze in we)this._fireEvent(ze,we[ze]);var it=po(this._eventsInProgress);if(o&&(y||b)&&!it){this._updatingCamera=!0;var bt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Vt=function(gr){return gr!==0&&-h._bearingSnap<gr&&gr<h._bearingSnap};bt?(Vt(bt.bearing||this._map.getBearing())&&(bt.bearing=0),this._map.easeTo(bt,{originalEvent:Ce})):(this._map.fire(new d.Event("moveend",{originalEvent:Ce})),Vt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Hn.prototype._fireEvent=function(i,u){this._map.fire(new d.Event(i,u?{originalEvent:u}:{}))},Hn.prototype._requestFrame=function(){var i=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(u){delete i._frameId,i.handleEvent(new Pl("renderFrame",{timeStamp:u})),i._applyChanges()})},Hn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var nl=function(i){function u(o,h){i.call(this),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,d.bindAll(["_renderFrameCallback"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getCenter=function(){return new d.LngLat(this.transform.center.lng,this.transform.center.lat)},u.prototype.setCenter=function(o,h){return this.jumpTo({center:o},h)},u.prototype.panBy=function(o,h,y){return o=d.Point.convert(o).mult(-1),this.panTo(this.transform.center,d.extend({offset:o},h),y)},u.prototype.panTo=function(o,h,y){return this.easeTo(d.extend({center:o},h),y)},u.prototype.getZoom=function(){return this.transform.zoom},u.prototype.setZoom=function(o,h){return this.jumpTo({zoom:o},h),this},u.prototype.zoomTo=function(o,h,y){return this.easeTo(d.extend({zoom:o},h),y)},u.prototype.zoomIn=function(o,h){return this.zoomTo(this.getZoom()+1,o,h),this},u.prototype.zoomOut=function(o,h){return this.zoomTo(this.getZoom()-1,o,h),this},u.prototype.getBearing=function(){return this.transform.bearing},u.prototype.setBearing=function(o,h){return this.jumpTo({bearing:o},h),this},u.prototype.getPadding=function(){return this.transform.padding},u.prototype.setPadding=function(o,h){return this.jumpTo({padding:o},h),this},u.prototype.rotateTo=function(o,h,y){return this.easeTo(d.extend({bearing:o},h),y)},u.prototype.resetNorth=function(o,h){return this.rotateTo(0,d.extend({duration:1e3},o),h),this},u.prototype.resetNorthPitch=function(o,h){return this.easeTo(d.extend({bearing:0,pitch:0,duration:1e3},o),h),this},u.prototype.snapToNorth=function(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this},u.prototype.getPitch=function(){return this.transform.pitch},u.prototype.setPitch=function(o,h){return this.jumpTo({pitch:o},h),this},u.prototype.cameraForBounds=function(o,h){o=d.LngLatBounds.convert(o);var y=h&&h.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),y,h)},u.prototype._cameraForBoxAndBearing=function(o,h,y,b){var T={top:0,bottom:0,right:0,left:0};if(typeof(b=d.extend({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},b)).padding=="number"){var D=b.padding;b.padding={top:D,bottom:D,right:D,left:D}}b.padding=d.extend(T,b.padding);var V=this.transform,se=V.padding,Ce=V.project(d.LngLat.convert(o)),we=V.project(d.LngLat.convert(h)),Pe=Ce.rotate(-y*Math.PI/180),He=we.rotate(-y*Math.PI/180),Ge=new d.Point(Math.max(Pe.x,He.x),Math.max(Pe.y,He.y)),nt=new d.Point(Math.min(Pe.x,He.x),Math.min(Pe.y,He.y)),ze=Ge.sub(nt),it=(V.width-(se.left+se.right+b.padding.left+b.padding.right))/ze.x,bt=(V.height-(se.top+se.bottom+b.padding.top+b.padding.bottom))/ze.y;if(!(bt<0||it<0)){var Vt=Math.min(V.scaleZoom(V.scale*Math.min(it,bt)),b.maxZoom),gr=typeof b.offset.x=="number"?new d.Point(b.offset.x,b.offset.y):d.Point.convert(b.offset),fr=new d.Point((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(y*Math.PI/180),Er=gr.add(fr).mult(V.scale/V.zoomScale(Vt));return{center:V.unproject(Ce.add(we).div(2).sub(Er)),zoom:Vt,bearing:y}}d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},u.prototype.fitBounds=function(o,h,y){return this._fitInternal(this.cameraForBounds(o,h),h,y)},u.prototype.fitScreenCoordinates=function(o,h,y,b,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(d.Point.convert(o)),this.transform.pointLocation(d.Point.convert(h)),y,b),b,T)},u.prototype._fitInternal=function(o,h,y){return o?(delete(h=d.extend(o,h)).padding,h.linear?this.easeTo(h,y):this.flyTo(h,y)):this},u.prototype.jumpTo=function(o,h){this.stop();var y=this.transform,b=!1,T=!1,D=!1;return"zoom"in o&&y.zoom!==+o.zoom&&(b=!0,y.zoom=+o.zoom),o.center!==void 0&&(y.center=d.LngLat.convert(o.center)),"bearing"in o&&y.bearing!==+o.bearing&&(T=!0,y.bearing=+o.bearing),"pitch"in o&&y.pitch!==+o.pitch&&(D=!0,y.pitch=+o.pitch),o.padding==null||y.isPaddingEqual(o.padding)||(y.padding=o.padding),this.fire(new d.Event("movestart",h)).fire(new d.Event("move",h)),b&&this.fire(new d.Event("zoomstart",h)).fire(new d.Event("zoom",h)).fire(new d.Event("zoomend",h)),T&&this.fire(new d.Event("rotatestart",h)).fire(new d.Event("rotate",h)).fire(new d.Event("rotateend",h)),D&&this.fire(new d.Event("pitchstart",h)).fire(new d.Event("pitch",h)).fire(new d.Event("pitchend",h)),this.fire(new d.Event("moveend",h))},u.prototype.easeTo=function(o,h){var y=this;this._stop(!1,o.easeId),((o=d.extend({offset:[0,0],duration:500,easing:d.ease},o)).animate===!1||!o.essential&&d.browser.prefersReducedMotion)&&(o.duration=0);var b=this.transform,T=this.getZoom(),D=this.getBearing(),V=this.getPitch(),se=this.getPadding(),Ce="zoom"in o?+o.zoom:T,we="bearing"in o?this._normalizeBearing(o.bearing,D):D,Pe="pitch"in o?+o.pitch:V,He="padding"in o?o.padding:b.padding,Ge=d.Point.convert(o.offset),nt=b.centerPoint.add(Ge),ze=b.pointLocation(nt),it=d.LngLat.convert(o.center||ze);this._normalizeCenter(it);var bt,Vt,gr=b.project(ze),fr=b.project(it).sub(gr),Er=b.zoomScale(Ce-T);o.around&&(bt=d.LngLat.convert(o.around),Vt=b.locationPoint(bt));var jr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Ce!==T,this._rotating=this._rotating||D!==we,this._pitching=this._pitching||Pe!==V,this._padding=!b.isPaddingEqual(He),this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,jr),this._ease(function(fn){if(y._zooming&&(b.zoom=d.number(T,Ce,fn)),y._rotating&&(b.bearing=d.number(D,we,fn)),y._pitching&&(b.pitch=d.number(V,Pe,fn)),y._padding&&(b.interpolatePadding(se,He,fn),nt=b.centerPoint.add(Ge)),bt)b.setLocationAtPoint(bt,Vt);else{var tn=b.zoomScale(b.zoom-T),Zn=Ce>T?Math.min(2,Er):Math.max(.5,Er),si=Math.pow(Zn,1-fn),ui=b.unproject(gr.add(fr.mult(fn*si)).mult(tn));b.setLocationAtPoint(b.renderWorldCopies?ui.wrap():ui,nt)}y._fireMoveEvents(h)},function(fn){y._afterEase(h,fn)},o),this},u.prototype._prepareEase=function(o,h,y){y===void 0&&(y={}),this._moving=!0,h||y.moving||this.fire(new d.Event("movestart",o)),this._zooming&&!y.zooming&&this.fire(new d.Event("zoomstart",o)),this._rotating&&!y.rotating&&this.fire(new d.Event("rotatestart",o)),this._pitching&&!y.pitching&&this.fire(new d.Event("pitchstart",o))},u.prototype._fireMoveEvents=function(o){this.fire(new d.Event("move",o)),this._zooming&&this.fire(new d.Event("zoom",o)),this._rotating&&this.fire(new d.Event("rotate",o)),this._pitching&&this.fire(new d.Event("pitch",o))},u.prototype._afterEase=function(o,h){if(!this._easeId||!h||this._easeId!==h){delete this._easeId;var y=this._zooming,b=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new d.Event("zoomend",o)),b&&this.fire(new d.Event("rotateend",o)),T&&this.fire(new d.Event("pitchend",o)),this.fire(new d.Event("moveend",o))}},u.prototype.flyTo=function(o,h){var y=this;if(!o.essential&&d.browser.prefersReducedMotion){var b=d.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(b,h)}this.stop(),o=d.extend({offset:[0,0],speed:1.2,curve:1.42,easing:d.ease},o);var T=this.transform,D=this.getZoom(),V=this.getBearing(),se=this.getPitch(),Ce=this.getPadding(),we="zoom"in o?d.clamp(+o.zoom,T.minZoom,T.maxZoom):D,Pe="bearing"in o?this._normalizeBearing(o.bearing,V):V,He="pitch"in o?+o.pitch:se,Ge="padding"in o?o.padding:T.padding,nt=T.zoomScale(we-D),ze=d.Point.convert(o.offset),it=T.centerPoint.add(ze),bt=T.pointLocation(it),Vt=d.LngLat.convert(o.center||bt);this._normalizeCenter(Vt);var gr=T.project(bt),fr=T.project(Vt).sub(gr),Er=o.curve,jr=Math.max(T.width,T.height),fn=jr/nt,tn=fr.mag();if("minZoom"in o){var Zn=d.clamp(Math.min(o.minZoom,D,we),T.minZoom,T.maxZoom),si=jr/T.zoomScale(Zn-D);Er=Math.sqrt(si/tn*2)}var ui=Er*Er;function dn(J){var O=(fn*fn-jr*jr+(J?-1:1)*ui*ui*tn*tn)/(2*(J?fn:jr)*ui*tn);return Math.log(Math.sqrt(O*O+1)-O)}function ia(J){return(Math.exp(J)-Math.exp(-J))/2}function Wn(J){return(Math.exp(J)+Math.exp(-J))/2}var xi=dn(0),ji=function(J){return Wn(xi)/Wn(xi+Er*J)},vi=function(J){return jr*((Wn(xi)*(ia(O=xi+Er*J)/Wn(O))-ia(xi))/ui)/tn;var O},Ci=(dn(1)-xi)/Er;if(Math.abs(tn)<1e-6||!isFinite(Ci)){if(Math.abs(jr-fn)<1e-6)return this.easeTo(o,h);var Q=fn<jr?-1:1;Ci=Math.abs(Math.log(fn/jr))/Er,vi=function(){return 0},ji=function(J){return Math.exp(Q*Er*J)}}return o.duration="duration"in o?+o.duration:1e3*Ci/("screenSpeed"in o?+o.screenSpeed/Er:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=V!==Pe,this._pitching=He!==se,this._padding=!T.isPaddingEqual(Ge),this._prepareEase(h,!1),this._ease(function(J){var O=J*Ci,F=1/ji(O);T.zoom=J===1?we:D+T.scaleZoom(F),y._rotating&&(T.bearing=d.number(V,Pe,J)),y._pitching&&(T.pitch=d.number(se,He,J)),y._padding&&(T.interpolatePadding(Ce,Ge,J),it=T.centerPoint.add(ze));var ne=J===1?Vt:T.unproject(gr.add(fr.mult(vi(O))).mult(F));T.setLocationAtPoint(T.renderWorldCopies?ne.wrap():ne,it),y._fireMoveEvents(h)},function(){return y._afterEase(h)},o),this},u.prototype.isEasing=function(){return!!this._easeFrameId},u.prototype.stop=function(){return this._stop()},u.prototype._stop=function(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,h)}if(!o){var b=this.handlers;b&&b.stop(!1)}return this},u.prototype._ease=function(o,h,y){y.animate===!1||y.duration===0?(o(1),h()):(this._easeStart=d.browser.now(),this._easeOptions=y,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},u.prototype._renderFrameCallback=function(){var o=Math.min((d.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},u.prototype._normalizeBearing=function(o,h){o=d.wrap(o,-180,180);var y=Math.abs(o-h);return Math.abs(o-360-h)<y&&(o-=360),Math.abs(o+360-h)<y&&(o+=360),o},u.prototype._normalizeCenter=function(o){var h=this.transform;if(h.renderWorldCopies&&!h.lngRange){var y=o.lng-h.center.lng;o.lng+=y>180?-360:y<-180?360:0}},u}(d.Evented),ns=function(i){i===void 0&&(i={}),this.options=i,d.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};ns.prototype.getDefaultPosition=function(){return"bottom-right"},ns.prototype.onAdd=function(i){var u=this.options&&this.options.compact;return this._map=i,this._container=te.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=te.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=te.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ns.prototype.onRemove=function(){te.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},ns.prototype._setElementTitle=function(i,u){var o=this._map._getUIString("AttributionControl."+u);i.title=o,i.setAttribute("aria-label",o)},ns.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},ns.prototype._updateEditLink=function(){var i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));var u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||d.config.ACCESS_TOKEN}];if(i){var o=u.reduce(function(h,y,b){return y.value&&(h+=y.key+"="+y.value+(b<u.length-1?"&":"")),h},"?");i.href=d.config.FEEDBACK_URL+"/"+o+(this._map._hash?this._map._hash.getHashString(!0):""),i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}},ns.prototype._updateData=function(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},ns.prototype._updateAttributions=function(){if(this._map.style){var i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(function(D){return typeof D!="string"?"":D})):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){var u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}var o=this._map.style.sourceCaches;for(var h in o){var y=o[h];if(y.used){var b=y.getSource();b.attribution&&i.indexOf(b.attribution)<0&&i.push(b.attribution)}}i.sort(function(D,V){return D.length-V.length});var T=(i=i.filter(function(D,V){for(var se=V+1;se<i.length;se++)if(i[se].indexOf(D)>=0)return!1;return!0})).join(" | ");T!==this._attribHTML&&(this._attribHTML=T,i.length?(this._innerContainer.innerHTML=T,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},ns.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var fs=function(){d.bindAll(["_updateLogo"],this),d.bindAll(["_updateCompact"],this)};fs.prototype.onAdd=function(i){this._map=i,this._container=te.create("div","mapboxgl-ctrl");var u=te.create("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},fs.prototype.onRemove=function(){te.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},fs.prototype.getDefaultPosition=function(){return"bottom-left"},fs.prototype._updateLogo=function(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},fs.prototype._logoRequired=function(){if(this._map.style){var i=this._map.style.sourceCaches;for(var u in i)if(i[u].getSource().mapbox_logo)return!0;return!1}},fs.prototype._updateCompact=function(){var i=this._container.children;if(i.length){var u=i[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}};var Io=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Io.prototype.add=function(i){var u=++this._id;return this._queue.push({callback:i,id:u,cancelled:!1}),u},Io.prototype.remove=function(i){for(var u=this._currentlyRunning,o=0,h=u?this._queue.concat(u):this._queue;o<h.length;o+=1){var y=h[o];if(y.id===i)return void(y.cancelled=!0)}},Io.prototype.run=function(i){i===void 0&&(i=0);var u=this._currentlyRunning=this._queue;this._queue=[];for(var o=0,h=u;o<h.length;o+=1){var y=h[o];if(!y.cancelled&&(y.callback(i),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Io.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var au={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Bc=d.window.HTMLImageElement,tc=d.window.HTMLElement,Gi=d.window.ImageBitmap,Ui={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},ef=function(i){function u(h){var y=this;if((h=d.extend({},Ui,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var b=new sa(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies);if(i.call(this,b,h),this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new Io,this._controls=[],this._mapId=d.uniqueId(),this._locale=d.extend({},au,h.locale),this._clickTolerance=h.clickTolerance,this._requestManager=new d.RequestManager(h.transformRequest,h.accessToken),typeof h.container=="string"){if(this._container=d.window.document.getElementById(h.container),!this._container)throw new Error("Container '"+h.container+"' not found.")}else{if(!(h.container instanceof tc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),d.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return y._update(!1)}),this.on("moveend",function(){return y._update(!1)}),this.on("zoom",function(){return y._update(!0)}),d.window!==void 0&&(d.window.addEventListener("online",this._onWindowOnline,!1),d.window.addEventListener("resize",this._onWindowResize,!1),d.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Hn(this,h),this._hash=h.hash&&new ys(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,d.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new ns({customAttribution:h.customAttribution})),this.addControl(new fs,h.logoPosition),this.on("style.load",function(){y.transform.unmodified&&y.jumpTo(y.style.stylesheet)}),this.on("data",function(T){y._update(T.dataType==="style"),y.fire(new d.Event(T.dataType+"data",T))}),this.on("dataloading",function(T){y.fire(new d.Event(T.dataType+"dataloading",T))})}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return u.prototype._getMapId=function(){return this._mapId},u.prototype.addControl=function(h,y){if(y===void 0&&(y=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var b=h.onAdd(this);this._controls.push(h);var T=this._controlPositions[y];return y.indexOf("bottom")!==-1?T.insertBefore(b,T.firstChild):T.appendChild(b),this},u.prototype.removeControl=function(h){if(!h||!h.onRemove)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var y=this._controls.indexOf(h);return y>-1&&this._controls.splice(y,1),h.onRemove(this),this},u.prototype.hasControl=function(h){return this._controls.indexOf(h)>-1},u.prototype.resize=function(h){var y=this._containerDimensions(),b=y[0],T=y[1];if(b===this.transform.width&&T===this.transform.height)return this;this._resizeCanvas(b,T),this.transform.resize(b,T),this.painter.resize(b,T);var D=!this._moving;return D&&this.fire(new d.Event("movestart",h)).fire(new d.Event("move",h)),this.fire(new d.Event("resize",h)),D&&this.fire(new d.Event("moveend",h)),this},u.prototype.getBounds=function(){return this.transform.getBounds()},u.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},u.prototype.setMaxBounds=function(h){return this.transform.setMaxBounds(d.LngLatBounds.convert(h)),this._update()},u.prototype.setMinZoom=function(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},u.prototype.getMinZoom=function(){return this.transform.minZoom},u.prototype.setMaxZoom=function(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")},u.prototype.getMaxZoom=function(){return this.transform.maxZoom},u.prototype.setMinPitch=function(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},u.prototype.getMinPitch=function(){return this.transform.minPitch},u.prototype.setMaxPitch=function(h){if((h=h==null?60:h)>60)throw new Error("maxPitch must be less than or equal to 60");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")},u.prototype.getMaxPitch=function(){return this.transform.maxPitch},u.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},u.prototype.setRenderWorldCopies=function(h){return this.transform.renderWorldCopies=h,this._update()},u.prototype.project=function(h){return this.transform.locationPoint(d.LngLat.convert(h))},u.prototype.unproject=function(h){return this.transform.pointLocation(d.Point.convert(h))},u.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},u.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},u.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},u.prototype._createDelegatedListener=function(h,y,b){var T,D=this;if(h==="mouseenter"||h==="mouseover"){var V=!1;return{layer:y,listener:b,delegates:{mousemove:function(Ce){var we=D.getLayer(y)?D.queryRenderedFeatures(Ce.point,{layers:[y]}):[];we.length?V||(V=!0,b.call(D,new Ao(h,D,Ce.originalEvent,{features:we}))):V=!1},mouseout:function(){V=!1}}}}if(h==="mouseleave"||h==="mouseout"){var se=!1;return{layer:y,listener:b,delegates:{mousemove:function(Ce){(D.getLayer(y)?D.queryRenderedFeatures(Ce.point,{layers:[y]}):[]).length?se=!0:se&&(se=!1,b.call(D,new Ao(h,D,Ce.originalEvent)))},mouseout:function(Ce){se&&(se=!1,b.call(D,new Ao(h,D,Ce.originalEvent)))}}}}return{layer:y,listener:b,delegates:(T={},T[h]=function(Ce){var we=D.getLayer(y)?D.queryRenderedFeatures(Ce.point,{layers:[y]}):[];we.length&&(Ce.features=we,b.call(D,Ce),delete Ce.features)},T)}},u.prototype.on=function(h,y,b){if(b===void 0)return i.prototype.on.call(this,h,y);var T=this._createDelegatedListener(h,y,b);for(var D in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(T),T.delegates)this.on(D,T.delegates[D]);return this},u.prototype.once=function(h,y,b){if(b===void 0)return i.prototype.once.call(this,h,y);var T=this._createDelegatedListener(h,y,b);for(var D in T.delegates)this.once(D,T.delegates[D]);return this},u.prototype.off=function(h,y,b){var T=this;return b===void 0?i.prototype.off.call(this,h,y):(this._delegatedListeners&&this._delegatedListeners[h]&&function(D){for(var V=D[h],se=0;se<V.length;se++){var Ce=V[se];if(Ce.layer===y&&Ce.listener===b){for(var we in Ce.delegates)T.off(we,Ce.delegates[we]);return V.splice(se,1),T}}}(this._delegatedListeners),this)},u.prototype.queryRenderedFeatures=function(h,y){if(!this.style)return[];var b;if(y!==void 0||h===void 0||h instanceof d.Point||Array.isArray(h)||(y=h,h=void 0),y=y||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof d.Point||typeof h[0]=="number")b=[d.Point.convert(h)];else{var T=d.Point.convert(h[0]),D=d.Point.convert(h[1]);b=[T,new d.Point(D.x,T.y),D,new d.Point(T.x,D.y),T]}return this.style.queryRenderedFeatures(b,y,this.transform)},u.prototype.querySourceFeatures=function(h,y){return this.style.querySourceFeatures(h,y)},u.prototype.setStyle=function(h,y){return(y=d.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},y)).diff!==!1&&y.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,y),this):(this._localIdeographFontFamily=y.localIdeographFontFamily,this._updateStyle(h,y))},u.prototype._getUIString=function(h){var y=this._locale[h];if(y==null)throw new Error("Missing UI string '"+h+"'");return y},u.prototype._updateStyle=function(h,y){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new As(this,y||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)},u.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new As(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},u.prototype._diffStyle=function(h,y){var b=this;if(typeof h=="string"){var T=this._requestManager.normalizeStyleURL(h),D=this._requestManager.transformRequest(T,d.ResourceType.Style);d.getJSON(D,function(V,se){V?b.fire(new d.ErrorEvent(V)):se&&b._updateDiff(se,y)})}else typeof h=="object"&&this._updateDiff(h,y)},u.prototype._updateDiff=function(h,y){try{this.style.setState(h)&&this._update(!0)}catch(b){d.warnOnce("Unable to perform style diff: "+(b.message||b.error||b)+".  Rebuilding the style from scratch."),this._updateStyle(h,y)}},u.prototype.getStyle=function(){if(this.style)return this.style.serialize()},u.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():d.warnOnce("There is no style added to the map.")},u.prototype.addSource=function(h,y){return this._lazyInitEmptyStyle(),this.style.addSource(h,y),this._update(!0)},u.prototype.isSourceLoaded=function(h){var y=this.style&&this.style.sourceCaches[h];if(y!==void 0)return y.loaded();this.fire(new d.ErrorEvent(new Error("There is no source with ID '"+h+"'")))},u.prototype.areTilesLoaded=function(){var h=this.style&&this.style.sourceCaches;for(var y in h){var b=h[y]._tiles;for(var T in b){var D=b[T];if(D.state!=="loaded"&&D.state!=="errored")return!1}}return!0},u.prototype.addSourceType=function(h,y,b){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,y,b)},u.prototype.removeSource=function(h){return this.style.removeSource(h),this._update(!0)},u.prototype.getSource=function(h){return this.style.getSource(h)},u.prototype.addImage=function(h,y,b){b===void 0&&(b={});var T=b.pixelRatio;T===void 0&&(T=1);var D=b.sdf;D===void 0&&(D=!1);var V=b.stretchX,se=b.stretchY,Ce=b.content;if(this._lazyInitEmptyStyle(),y instanceof Bc||Gi&&y instanceof Gi){var we=d.browser.getImageData(y);this.style.addImage(h,{data:new d.RGBAImage({width:we.width,height:we.height},we.data),pixelRatio:T,stretchX:V,stretchY:se,content:Ce,sdf:D,version:0})}else{if(y.width===void 0||y.height===void 0)return this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Pe=y;this.style.addImage(h,{data:new d.RGBAImage({width:y.width,height:y.height},new Uint8Array(y.data)),pixelRatio:T,stretchX:V,stretchY:se,content:Ce,sdf:D,version:0,userImage:Pe}),Pe.onAdd&&Pe.onAdd(this,h)}},u.prototype.updateImage=function(h,y){var b=this.style.getImage(h);if(!b)return this.fire(new d.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var T=y instanceof Bc||Gi&&y instanceof Gi?d.browser.getImageData(y):y,D=T.width,V=T.height,se=T.data;return D===void 0||V===void 0?this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):D!==b.data.width||V!==b.data.height?this.fire(new d.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(b.data.replace(se,!(y instanceof Bc||Gi&&y instanceof Gi)),void this.style.updateImage(h,b))},u.prototype.hasImage=function(h){return h?!!this.style.getImage(h):(this.fire(new d.ErrorEvent(new Error("Missing required image id"))),!1)},u.prototype.removeImage=function(h){this.style.removeImage(h)},u.prototype.loadImage=function(h,y){d.getImage(this._requestManager.transformRequest(h,d.ResourceType.Image),y)},u.prototype.listImages=function(){return this.style.listImages()},u.prototype.addLayer=function(h,y){return this._lazyInitEmptyStyle(),this.style.addLayer(h,y),this._update(!0)},u.prototype.moveLayer=function(h,y){return this.style.moveLayer(h,y),this._update(!0)},u.prototype.removeLayer=function(h){return this.style.removeLayer(h),this._update(!0)},u.prototype.getLayer=function(h){return this.style.getLayer(h)},u.prototype.setLayerZoomRange=function(h,y,b){return this.style.setLayerZoomRange(h,y,b),this._update(!0)},u.prototype.setFilter=function(h,y,b){return b===void 0&&(b={}),this.style.setFilter(h,y,b),this._update(!0)},u.prototype.getFilter=function(h){return this.style.getFilter(h)},u.prototype.setPaintProperty=function(h,y,b,T){return T===void 0&&(T={}),this.style.setPaintProperty(h,y,b,T),this._update(!0)},u.prototype.getPaintProperty=function(h,y){return this.style.getPaintProperty(h,y)},u.prototype.setLayoutProperty=function(h,y,b,T){return T===void 0&&(T={}),this.style.setLayoutProperty(h,y,b,T),this._update(!0)},u.prototype.getLayoutProperty=function(h,y){return this.style.getLayoutProperty(h,y)},u.prototype.setLight=function(h,y){return y===void 0&&(y={}),this._lazyInitEmptyStyle(),this.style.setLight(h,y),this._update(!0)},u.prototype.getLight=function(){return this.style.getLight()},u.prototype.setFeatureState=function(h,y){return this.style.setFeatureState(h,y),this._update()},u.prototype.removeFeatureState=function(h,y){return this.style.removeFeatureState(h,y),this._update()},u.prototype.getFeatureState=function(h){return this.style.getFeatureState(h)},u.prototype.getContainer=function(){return this._container},u.prototype.getCanvasContainer=function(){return this._canvasContainer},u.prototype.getCanvas=function(){return this._canvas},u.prototype._containerDimensions=function(){var h=0,y=0;return this._container&&(h=this._container.clientWidth||400,y=this._container.clientHeight||300),[h,y]},u.prototype._detectMissingCSS=function(){d.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&d.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},u.prototype._setupContainer=function(){var h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=te.create("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();var y=this._canvasContainer=te.create("div","mapboxgl-canvas-container",h);this._interactive&&y.classList.add("mapboxgl-interactive"),this._canvas=te.create("canvas","mapboxgl-canvas",y),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var b=this._containerDimensions();this._resizeCanvas(b[0],b[1]);var T=this._controlContainer=te.create("div","mapboxgl-control-container",h),D=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(V){D[V]=te.create("div","mapboxgl-ctrl-"+V,T)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},u.prototype._resizeCanvas=function(h,y){var b=d.browser.devicePixelRatio||1;this._canvas.width=b*h,this._canvas.height=b*y,this._canvas.style.width=h+"px",this._canvas.style.height=y+"px"},u.prototype._setupPainter=function(){var h=d.extend({},me.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),y=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);y?(this.painter=new ao(y,this.transform),d.webpSupported.testSupport(y)):this.fire(new d.ErrorEvent(new Error("Failed to initialize WebGL")))},u.prototype._contextLost=function(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new d.Event("webglcontextlost",{originalEvent:h}))},u.prototype._contextRestored=function(h){this._setupPainter(),this.resize(),this._update(),this.fire(new d.Event("webglcontextrestored",{originalEvent:h}))},u.prototype._onMapScroll=function(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},u.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},u.prototype._update=function(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this},u.prototype._requestRenderFrame=function(h){return this._update(),this._renderTaskQueue.add(h)},u.prototype._cancelRenderFrame=function(h){this._renderTaskQueue.remove(h)},u.prototype._render=function(h){var y,b=this,T=0,D=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(y=D.createQueryEXT(),D.beginQueryEXT(D.TIME_ELAPSED_EXT,y),T=d.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),!this._removed){var V=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var se=this.transform.zoom,Ce=d.browser.now();this.style.zoomHistory.update(se,Ce);var we=new d.EvaluationParameters(se,{now:Ce,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Pe=we.crossFadingFactor();Pe===1&&Pe===this._crossFadingFactor||(V=!0,this._crossFadingFactor=Pe),this.style.update(we)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new d.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new d.Event("load"))),this.style&&(this.style.hasTransitions()||V)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var He=d.browser.now()-T;D.endQueryEXT(D.TIME_ELAPSED_EXT,y),setTimeout(function(){var ze=D.getQueryObjectEXT(y,D.QUERY_RESULT_EXT)/1e6;D.deleteQueryEXT(y),b.fire(new d.Event("gpu-timing-frame",{cpuTime:He,gpuTime:ze}))},50)}if(this.listens("gpu-timing-layer")){var Ge=this.painter.collectGpuTimers();setTimeout(function(){var ze=b.painter.queryGpuTimers(Ge);b.fire(new d.Event("gpu-timing-layer",{layerTimes:ze}))},50)}var nt=this._sourcesDirty||this._styleDirty||this._placementDirty;return nt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.Event("idle")),!this._loaded||this._fullyLoaded||nt||(this._fullyLoaded=!0),this}},u.prototype.remove=function(){this._hash&&this._hash.remove();for(var h=0,y=this._controls;h<y.length;h+=1)y[h].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),d.window!==void 0&&(d.window.removeEventListener("resize",this._onWindowResize,!1),d.window.removeEventListener("orientationchange",this._onWindowResize,!1),d.window.removeEventListener("online",this._onWindowOnline,!1));var b=this.painter.context.gl.getExtension("WEBGL_lose_context");b&&b.loseContext(),Ps(this._canvasContainer),Ps(this._controlContainer),Ps(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new d.Event("remove"))},u.prototype.triggerRepaint=function(){var h=this;this.style&&!this._frame&&(this._frame=d.browser.frame(function(y){h._frame=null,h._render(y)}))},u.prototype._onWindowOnline=function(){this._update()},u.prototype._onWindowResize=function(h){this._trackResize&&this.resize({originalEvent:h})._update()},o.showTileBoundaries.get=function(){return!!this._showTileBoundaries},o.showTileBoundaries.set=function(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())},o.showPadding.get=function(){return!!this._showPadding},o.showPadding.set=function(h){this._showPadding!==h&&(this._showPadding=h,this._update())},o.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},o.showCollisionBoxes.set=function(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())},o.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},o.showOverdrawInspector.set=function(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())},o.repaint.get=function(){return!!this._repaint},o.repaint.set=function(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())},o.vertices.get=function(){return!!this._vertices},o.vertices.set=function(h){this._vertices=h,this._update()},u.prototype._setCacheLimits=function(h,y){d.setCacheLimits(h,y)},o.version.get=function(){return d.version},Object.defineProperties(u.prototype,o),u}(nl);function Ps(i){i.parentNode&&i.parentNode.removeChild(i)}var Ml={showCompass:!0,showZoom:!0,visualizePitch:!1},Ms=function(i){var u=this;this.options=d.extend({},Ml,i),this._container=te.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(o){return o.preventDefault()}),this.options.showZoom&&(d.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(o){return u._map.zoomIn({},{originalEvent:o})}),te.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(o){return u._map.zoomOut({},{originalEvent:o})}),te.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(d.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(o){u.options.visualizePitch?u._map.resetNorthPitch({},{originalEvent:o}):u._map.resetNorth({},{originalEvent:o})}),this._compassIcon=te.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Ms.prototype._updateZoomButtons=function(){var i=this._map.getZoom(),u=i===this._map.getMaxZoom(),o=i===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString())},Ms.prototype._rotateCompassArrow=function(){var i=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=i},Ms.prototype.onAdd=function(i){return this._map=i,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Va(this._map,this._compass,this.options.visualizePitch)),this._container},Ms.prototype.onRemove=function(){te.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Ms.prototype._createButton=function(i,u){var o=te.create("button",i,this._container);return o.type="button",o.addEventListener("click",u),o},Ms.prototype._setButtonTitle=function(i,u){var o=this._map._getUIString("NavigationControl."+u);i.title=o,i.setAttribute("aria-label",o)};var Va=function(i,u,o){o===void 0&&(o=!1),this._clickTolerance=10,this.element=u,this.mouseRotate=new _c({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,o&&(this.mousePitch=new nu({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),d.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),te.addEventListener(u,"mousedown",this.mousedown),te.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),te.addEventListener(u,"touchmove",this.touchmove),te.addEventListener(u,"touchend",this.touchend),te.addEventListener(u,"touchcancel",this.reset)};function ou(i,u,o){if(i=new d.LngLat(i.lng,i.lat),u){var h=new d.LngLat(i.lng-360,i.lat),y=new d.LngLat(i.lng+360,i.lat),b=o.locationPoint(i).distSqr(u);o.locationPoint(h).distSqr(u)<b?i=h:o.locationPoint(y).distSqr(u)<b&&(i=y)}for(;Math.abs(i.lng-o.center.lng)>180;){var T=o.locationPoint(i);if(T.x>=0&&T.y>=0&&T.x<=o.width&&T.y<=o.height)break;i.lng>o.center.lng?i.lng-=360:i.lng+=360}return i}Va.prototype.down=function(i,u){this.mouseRotate.mousedown(i,u),this.mousePitch&&this.mousePitch.mousedown(i,u),te.disableDrag()},Va.prototype.move=function(i,u){var o=this.map,h=this.mouseRotate.mousemoveWindow(i,u);if(h&&h.bearingDelta&&o.setBearing(o.getBearing()+h.bearingDelta),this.mousePitch){var y=this.mousePitch.mousemoveWindow(i,u);y&&y.pitchDelta&&o.setPitch(o.getPitch()+y.pitchDelta)}},Va.prototype.off=function(){var i=this.element;te.removeEventListener(i,"mousedown",this.mousedown),te.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),te.removeEventListener(i,"touchmove",this.touchmove),te.removeEventListener(i,"touchend",this.touchend),te.removeEventListener(i,"touchcancel",this.reset),this.offTemp()},Va.prototype.offTemp=function(){te.enableDrag(),te.removeEventListener(d.window,"mousemove",this.mousemove),te.removeEventListener(d.window,"mouseup",this.mouseup)},Va.prototype.mousedown=function(i){this.down(d.extend({},i,{ctrlKey:!0,preventDefault:function(){return i.preventDefault()}}),te.mousePos(this.element,i)),te.addEventListener(d.window,"mousemove",this.mousemove),te.addEventListener(d.window,"mouseup",this.mouseup)},Va.prototype.mousemove=function(i){this.move(i,te.mousePos(this.element,i))},Va.prototype.mouseup=function(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()},Va.prototype.touchstart=function(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=te.touchPos(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return i.preventDefault()}},this._startPos))},Va.prototype.touchmove=function(i){i.targetTouches.length!==1?this.reset():(this._lastPos=te.touchPos(this.element,i.targetTouches)[0],this.move({preventDefault:function(){return i.preventDefault()}},this._lastPos))},Va.prototype.touchend=function(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Va.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var xs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Gu(i,u,o){var h=i.classList;for(var y in xs)h.remove("mapboxgl-"+o+"-anchor-"+y);h.add("mapboxgl-"+o+"-anchor-"+u)}var il,Il=function(i){function u(o,h){if(i.call(this),(o instanceof d.window.HTMLElement||h)&&(o=d.extend({element:o},h)),d.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,o&&o.element)this._element=o.element,this._offset=d.Point.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=te.create("div"),this._element.setAttribute("aria-label","Map marker");var y=te.createNS("http://www.w3.org/2000/svg","svg");y.setAttributeNS(null,"display","block"),y.setAttributeNS(null,"height","41px"),y.setAttributeNS(null,"width","27px"),y.setAttributeNS(null,"viewBox","0 0 27 41");var b=te.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");var T=te.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");var D=te.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"transform","translate(3.0, 29.0)"),D.setAttributeNS(null,"fill","#000000");for(var V=0,se=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];V<se.length;V+=1){var Ce=se[V],we=te.createNS("http://www.w3.org/2000/svg","ellipse");we.setAttributeNS(null,"opacity","0.04"),we.setAttributeNS(null,"cx","10.5"),we.setAttributeNS(null,"cy","5.80029008"),we.setAttributeNS(null,"rx",Ce.rx),we.setAttributeNS(null,"ry",Ce.ry),D.appendChild(we)}var Pe=te.createNS("http://www.w3.org/2000/svg","g");Pe.setAttributeNS(null,"fill",this._color);var He=te.createNS("http://www.w3.org/2000/svg","path");He.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Pe.appendChild(He);var Ge=te.createNS("http://www.w3.org/2000/svg","g");Ge.setAttributeNS(null,"opacity","0.25"),Ge.setAttributeNS(null,"fill","#000000");var nt=te.createNS("http://www.w3.org/2000/svg","path");nt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ge.appendChild(nt);var ze=te.createNS("http://www.w3.org/2000/svg","g");ze.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ze.setAttributeNS(null,"fill","#FFFFFF");var it=te.createNS("http://www.w3.org/2000/svg","g");it.setAttributeNS(null,"transform","translate(8.0, 8.0)");var bt=te.createNS("http://www.w3.org/2000/svg","circle");bt.setAttributeNS(null,"fill","#000000"),bt.setAttributeNS(null,"opacity","0.25"),bt.setAttributeNS(null,"cx","5.5"),bt.setAttributeNS(null,"cy","5.5"),bt.setAttributeNS(null,"r","5.4999962");var Vt=te.createNS("http://www.w3.org/2000/svg","circle");Vt.setAttributeNS(null,"fill","#FFFFFF"),Vt.setAttributeNS(null,"cx","5.5"),Vt.setAttributeNS(null,"cy","5.5"),Vt.setAttributeNS(null,"r","5.4999962"),it.appendChild(bt),it.appendChild(Vt),T.appendChild(D),T.appendChild(Pe),T.appendChild(Ge),T.appendChild(ze),T.appendChild(it),y.appendChild(T),y.setAttributeNS(null,"height",41*this._scale+"px"),y.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(y),this._offset=d.Point.convert(o&&o.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(gr){gr.preventDefault()}),this._element.addEventListener("mousedown",function(gr){gr.preventDefault()}),Gu(this._element,this._anchor,"marker"),this._popup=null}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.addTo=function(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},u.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),te.remove(this._element),this._popup&&this._popup.remove(),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(o){return this._lngLat=d.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},u.prototype.getElement=function(){return this._element},u.prototype.setPopup=function(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){var h=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(24.6+h)],"bottom-right":[-h,-1*(24.6+h)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},u.prototype._onKeyPress=function(o){var h=o.code,y=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&y!==32&&y!==13||this.togglePopup()},u.prototype._onMapClick=function(o){var h=o.originalEvent.target,y=this._element;this._popup&&(h===y||y.contains(h))&&this.togglePopup()},u.prototype.getPopup=function(){return this._popup},u.prototype.togglePopup=function(){var o=this._popup;return o?(o.isOpen()?o.remove():o.addTo(this._map),this):this},u.prototype._update=function(o){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=ou(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(h="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y="rotateX("+this._map.getPitch()+"deg)"),o&&o.type!=="moveend"||(this._pos=this._pos.round()),te.setTransform(this._element,xs[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+y+" "+h)}},u.prototype.getOffset=function(){return this._offset},u.prototype.setOffset=function(o){return this._offset=d.Point.convert(o),this._update(),this},u.prototype._onMove=function(o){if(!this._isDragging){var h=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.Event("dragstart"))),this.fire(new d.Event("drag")))},u.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.Event("dragend")),this._state="inactive"},u.prototype._addDragHandler=function(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},u.prototype.setDraggable=function(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},u.prototype.isDraggable=function(){return this._draggable},u.prototype.setRotation=function(o){return this._rotation=o||0,this._update(),this},u.prototype.getRotation=function(){return this._rotation},u.prototype.setRotationAlignment=function(o){return this._rotationAlignment=o||"auto",this._update(),this},u.prototype.getRotationAlignment=function(){return this._rotationAlignment},u.prototype.setPitchAlignment=function(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this},u.prototype.getPitchAlignment=function(){return this._pitchAlignment},u}(d.Evented),rc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},al=0,ol=!1,sl=function(i){function u(o){i.call(this),this.options=d.extend({},rc,o),d.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.onAdd=function(o){var h;return this._map=o,this._container=te.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),h=this._setupUI,il!==void 0?h(il):d.window.navigator.permissions!==void 0?d.window.navigator.permissions.query({name:"geolocation"}).then(function(y){h(il=y.state!=="denied")}):h(il=!!d.window.navigator.geolocation),this._container},u.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(d.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),te.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,al=0,ol=!1},u.prototype._isOutOfMapMaxBounds=function(o){var h=this._map.getMaxBounds(),y=o.coords;return h&&(y.longitude<h.getWest()||y.longitude>h.getEast()||y.latitude<h.getSouth()||y.latitude>h.getNorth())},u.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},u.prototype._onSuccess=function(o){if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new d.Event("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("geolocate",o)),this._finish()}},u.prototype._updateCamera=function(o){var h=new d.LngLat(o.coords.longitude,o.coords.latitude),y=o.coords.accuracy,b=this._map.getBearing(),T=d.extend({bearing:b},this.options.fitBoundsOptions);this._map.fitBounds(h.toBounds(y),T,{geolocateSource:!0})},u.prototype._updateMarker=function(o){if(o){var h=new d.LngLat(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},u.prototype._updateCircleRadius=function(){var o=this._map._container.clientHeight/2,h=this._map.unproject([0,o]),y=this._map.unproject([1,o]),b=h.distanceTo(y),T=Math.ceil(2*this._accuracy/b);this._circleElement.style.width=T+"px",this._circleElement.style.height=T+"px"},u.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},u.prototype._onError=function(o){if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&ol)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("error",o)),this._finish()}},u.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},u.prototype._setupUI=function(o){var h=this;if(this._container.addEventListener("contextmenu",function(T){return T.preventDefault()}),this._geolocateButton=te.create("button","mapboxgl-ctrl-geolocate",this._container),te.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",o===!1){d.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var y=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=y,this._geolocateButton.setAttribute("aria-label",y)}else{var b=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=te.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Il(this._dotElement),this._circleElement=te.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Il({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(T){T.geolocateSource||h._watchState!=="ACTIVE_LOCK"||T.originalEvent&&T.originalEvent.type==="resize"||(h._watchState="BACKGROUND",h._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),h._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),h.fire(new d.Event("trackuserlocationend")))})},u.prototype.trigger=function(){if(!this._setup)return d.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":al--,ol=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new d.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var o;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++al>1?(o={maximumAge:6e5,timeout:0},ol=!0):(o=this.options.positionOptions,ol=!1),this._geolocationWatchID=d.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,o)}}else d.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},u.prototype._clearWatch=function(){d.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},u}(d.Evented),Cu={maxWidth:100,unit:"metric"},Hu=function(i){this.options=d.extend({},Cu,i),d.bindAll(["_onMove","setUnit"],this)};function xc(i,u,o){var h=o&&o.maxWidth||100,y=i._container.clientHeight/2,b=i.unproject([0,y]),T=i.unproject([h,y]),D=b.distanceTo(T);if(o&&o.unit==="imperial"){var V=3.2808*D;V>5280?wu(u,h,V/5280,i._getUIString("ScaleControl.Miles")):wu(u,h,V,i._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?wu(u,h,D/1852,i._getUIString("ScaleControl.NauticalMiles")):D>=1e3?wu(u,h,D/1e3,i._getUIString("ScaleControl.Kilometers")):wu(u,h,D,i._getUIString("ScaleControl.Meters"))}function wu(i,u,o,h){var y,b,T,D=(y=o,(b=Math.pow(10,(""+Math.floor(y)).length-1))*(T=(T=y/b)>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(V){var se=Math.pow(10,Math.ceil(-Math.log(V)/Math.LN10));return Math.round(V*se)/se}(T)));i.style.width=u*(D/o)+"px",i.innerHTML=D+"&nbsp;"+h}Hu.prototype.getDefaultPosition=function(){return"bottom-left"},Hu.prototype._onMove=function(){xc(this._map,this._container,this.options)},Hu.prototype.onAdd=function(i){return this._map=i,this._container=te.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",i.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Hu.prototype.onRemove=function(){te.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Hu.prototype.setUnit=function(i){this.options.unit=i,xc(this._map,this._container,this.options)};var Fs=function(i){this._fullscreen=!1,i&&i.container&&(i.container instanceof d.window.HTMLElement?this._container=i.container:d.warnOnce("Full screen control 'container' must be a DOM element.")),d.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in d.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in d.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in d.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in d.window.document&&(this._fullscreenchange="MSFullscreenChange")};Fs.prototype.onAdd=function(i){return this._map=i,this._container||(this._container=this._map.getContainer()),this._controlContainer=te.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",d.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Fs.prototype.onRemove=function(){te.remove(this._controlContainer),this._map=null,d.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Fs.prototype._checkFullscreenSupport=function(){return!!(d.window.document.fullscreenEnabled||d.window.document.mozFullScreenEnabled||d.window.document.msFullscreenEnabled||d.window.document.webkitFullscreenEnabled)},Fs.prototype._setupUI=function(){var i=this._fullscreenButton=te.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);te.create("span","mapboxgl-ctrl-icon",i).setAttribute("aria-hidden",!0),i.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),d.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Fs.prototype._updateTitle=function(){var i=this._getTitle();this._fullscreenButton.setAttribute("aria-label",i),this._fullscreenButton.title=i},Fs.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Fs.prototype._isFullscreen=function(){return this._fullscreen},Fs.prototype._changeIcon=function(){(d.window.document.fullscreenElement||d.window.document.mozFullScreenElement||d.window.document.webkitFullscreenElement||d.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Fs.prototype._onClickFullscreen=function(){this._isFullscreen()?d.window.document.exitFullscreen?d.window.document.exitFullscreen():d.window.document.mozCancelFullScreen?d.window.document.mozCancelFullScreen():d.window.document.msExitFullscreen?d.window.document.msExitFullscreen():d.window.document.webkitCancelFullScreen&&d.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Nc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},nc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Bl=function(i){function u(o){i.call(this),this.options=d.extend(Object.create(Nc),o),d.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.addTo=function(o){return this._map&&this.remove(),this._map=o,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new d.Event("open")),this},u.prototype.isOpen=function(){return!!this._map},u.prototype.remove=function(){return this._content&&te.remove(this._content),this._container&&(te.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new d.Event("close")),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(o){return this._lngLat=d.LngLat.convert(o),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},u.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},u.prototype.getElement=function(){return this._container},u.prototype.setText=function(o){return this.setDOMContent(d.window.document.createTextNode(o))},u.prototype.setHTML=function(o){var h,y=d.window.document.createDocumentFragment(),b=d.window.document.createElement("body");for(b.innerHTML=o;h=b.firstChild;)y.appendChild(h);return this.setDOMContent(y)},u.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},u.prototype.setMaxWidth=function(o){return this.options.maxWidth=o,this._update(),this},u.prototype.setDOMContent=function(o){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=te.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(o),this._createCloseButton(),this._update(),this._focusFirstElement(),this},u.prototype.addClassName=function(o){this._container&&this._container.classList.add(o)},u.prototype.removeClassName=function(o){this._container&&this._container.classList.remove(o)},u.prototype.setOffset=function(o){return this.options.offset=o,this._update(),this},u.prototype.toggleClassName=function(o){if(this._container)return this._container.classList.toggle(o)},u.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=te.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},u.prototype._onMouseUp=function(o){this._update(o.point)},u.prototype._onMouseMove=function(o){this._update(o.point)},u.prototype._onDrag=function(o){this._update(o.point)},u.prototype._update=function(o){var h=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=te.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=te.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(we){return h._container.classList.add(we)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ou(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||o)){var y=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat),b=this.options.anchor,T=function we(Pe){if(Pe){if(typeof Pe=="number"){var He=Math.round(Math.sqrt(.5*Math.pow(Pe,2)));return{center:new d.Point(0,0),top:new d.Point(0,Pe),"top-left":new d.Point(He,He),"top-right":new d.Point(-He,He),bottom:new d.Point(0,-Pe),"bottom-left":new d.Point(He,-He),"bottom-right":new d.Point(-He,-He),left:new d.Point(Pe,0),right:new d.Point(-Pe,0)}}if(Pe instanceof d.Point||Array.isArray(Pe)){var Ge=d.Point.convert(Pe);return{center:Ge,top:Ge,"top-left":Ge,"top-right":Ge,bottom:Ge,"bottom-left":Ge,"bottom-right":Ge,left:Ge,right:Ge}}return{center:d.Point.convert(Pe.center||[0,0]),top:d.Point.convert(Pe.top||[0,0]),"top-left":d.Point.convert(Pe["top-left"]||[0,0]),"top-right":d.Point.convert(Pe["top-right"]||[0,0]),bottom:d.Point.convert(Pe.bottom||[0,0]),"bottom-left":d.Point.convert(Pe["bottom-left"]||[0,0]),"bottom-right":d.Point.convert(Pe["bottom-right"]||[0,0]),left:d.Point.convert(Pe.left||[0,0]),right:d.Point.convert(Pe.right||[0,0])}}return we(new d.Point(0,0))}(this.options.offset);if(!b){var D,V=this._container.offsetWidth,se=this._container.offsetHeight;D=y.y+T.bottom.y<se?["top"]:y.y>this._map.transform.height-se?["bottom"]:[],y.x<V/2?D.push("left"):y.x>this._map.transform.width-V/2&&D.push("right"),b=D.length===0?"bottom":D.join("-")}var Ce=y.add(T[b]).round();te.setTransform(this._container,xs[b]+" translate("+Ce.x+"px,"+Ce.y+"px)"),Gu(this._container,b,"popup")}},u.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var o=this._container.querySelector(nc);o&&o.focus()}},u.prototype._onClose=function(){this.remove()},u}(d.Evented),ul={version:d.version,supported:me,setRTLTextPlugin:d.setRTLTextPlugin,getRTLTextPluginStatus:d.getRTLTextPluginStatus,Map:ef,NavigationControl:Ms,GeolocateControl:sl,AttributionControl:ns,ScaleControl:Hu,FullscreenControl:Fs,Popup:Bl,Marker:Il,Style:As,LngLat:d.LngLat,LngLatBounds:d.LngLatBounds,Point:d.Point,MercatorCoordinate:d.MercatorCoordinate,Evented:d.Evented,config:d.config,prewarm:function(){Kt().acquire(Jt)},clearPrewarmedResources:function(){var i=zn;i&&(i.isPreloaded()&&i.numActive()===1?(i.release(Jt),zn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return d.config.ACCESS_TOKEN},set accessToken(i){d.config.ACCESS_TOKEN=i},get baseApiUrl(){return d.config.API_URL},set baseApiUrl(i){d.config.API_URL=i},get workerCount(){return Nr.workerCount},set workerCount(i){Nr.workerCount=i},get maxParallelImageRequests(){return d.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(i){d.config.MAX_PARALLEL_IMAGE_REQUESTS=i},clearStorage:function(i){d.clearTileCache(i)},workerUrl:""};return ul}),ce})},28660:function(zr,N,S){var ce=S(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var E;(function(d){(function(me){var te=typeof S.g=="object"?S.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ue=oe(d);typeof te.Reflect=="undefined"?te.Reflect=d:ue=oe(te.Reflect,ue),me(ue);function oe(Ne,K){return function(Qe,mt){typeof Ne[Qe]!="function"&&Object.defineProperty(Ne,Qe,{configurable:!0,writable:!0,value:mt}),K&&K(Qe,mt)}}})(function(me){var te=Object.prototype.hasOwnProperty,ue=typeof Symbol=="function",oe=ue&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Ne=ue&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",K=typeof Object.create=="function",Qe={__proto__:[]}instanceof Array,mt=!K&&!Qe,Zt={create:K?function(){return Ir(Object.create(null))}:Qe?function(){return Ir({__proto__:null})}:function(){return Ir({})},has:mt?function(Ye,ut){return te.call(Ye,ut)}:function(Ye,ut){return ut in Ye},get:mt?function(Ye,ut){return te.call(Ye,ut)?Ye[ut]:void 0}:function(Ye,ut){return Ye[ut]}},Cr=Object.getPrototypeOf(Function),Qt=typeof ce=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Xt=!Qt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:$(),rr=!Qt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Gt(),Ut=!Qt&&typeof WeakMap=="function"?WeakMap:Tr(),St=new Ut;function Et(Ye,ut,At,Rt){if(En(At)){if(!dr(Ye))throw new TypeError;if(!lr(ut))throw new TypeError;return sr(Ye,ut)}else{if(!dr(Ye))throw new TypeError;if(!ge(ut))throw new TypeError;if(!ge(Rt)&&!En(Rt)&&!ea(Rt))throw new TypeError;return ea(Rt)&&(Rt=void 0),At=nr(At),j(Ye,ut,At,Rt)}}me("decorate",Et);function yr(Ye,ut){function At(Rt,xr){if(!ge(Rt))throw new TypeError;if(!En(xr)&&!un(xr))throw new TypeError;zt(Ye,ut,Rt,xr)}return At}me("metadata",yr);function q(Ye,ut,At,Rt){if(!ge(At))throw new TypeError;return En(Rt)||(Rt=nr(Rt)),zt(Ye,ut,At,Rt)}me("defineMetadata",q);function hr(Ye,ut,At){if(!ge(ut))throw new TypeError;return En(At)||(At=nr(At)),Re(Ye,ut,At)}me("hasMetadata",hr);function wt(Ye,ut,At){if(!ge(ut))throw new TypeError;return En(At)||(At=nr(At)),ye(Ye,ut,At)}me("hasOwnMetadata",wt);function $e(Ye,ut,At){if(!ge(ut))throw new TypeError;return En(At)||(At=nr(At)),_t(Ye,ut,At)}me("getMetadata",$e);function Ft(Ye,ut,At){if(!ge(ut))throw new TypeError;return En(At)||(At=nr(At)),dt(Ye,ut,At)}me("getOwnMetadata",Ft);function Xe(Ye,ut){if(!ge(Ye))throw new TypeError;return En(ut)||(ut=nr(ut)),Bt(Ye,ut)}me("getMetadataKeys",Xe);function jt(Ye,ut){if(!ge(Ye))throw new TypeError;return En(ut)||(ut=nr(ut)),Ur(Ye,ut)}me("getOwnMetadataKeys",jt);function br(Ye,ut,At){if(!ge(ut))throw new TypeError;En(At)||(At=nr(At));var Rt=ie(ut,At,!1);if(En(Rt)||!Rt.delete(Ye))return!1;if(Rt.size>0)return!0;var xr=St.get(ut);return xr.delete(At),xr.size>0||St.delete(ut),!0}me("deleteMetadata",br);function sr(Ye,ut){for(var At=Ye.length-1;At>=0;--At){var Rt=Ye[At],xr=Rt(ut);if(!En(xr)&&!ea(xr)){if(!lr(xr))throw new TypeError;ut=xr}}return ut}function j(Ye,ut,At,Rt){for(var xr=Ye.length-1;xr>=0;--xr){var Ar=Ye[xr],Ke=Ar(ut,At,Rt);if(!En(Ke)&&!ea(Ke)){if(!ge(Ke))throw new TypeError;Rt=Ke}}return Rt}function ie(Ye,ut,At){var Rt=St.get(Ye);if(En(Rt)){if(!At)return;Rt=new Xt,St.set(Ye,Rt)}var xr=Rt.get(ut);if(En(xr)){if(!At)return;xr=new Xt,Rt.set(ut,xr)}return xr}function Re(Ye,ut,At){var Rt=ye(Ye,ut,At);if(Rt)return!0;var xr=Ct(ut);return ea(xr)?!1:Re(Ye,xr,At)}function ye(Ye,ut,At){var Rt=ie(ut,At,!1);return En(Rt)?!1:Oe(Rt.has(Ye))}function _t(Ye,ut,At){var Rt=ye(Ye,ut,At);if(Rt)return dt(Ye,ut,At);var xr=Ct(ut);if(!ea(xr))return _t(Ye,xr,At)}function dt(Ye,ut,At){var Rt=ie(ut,At,!1);if(!En(Rt))return Rt.get(Ye)}function zt(Ye,ut,At,Rt){var xr=ie(At,Rt,!0);xr.set(Ye,ut)}function Bt(Ye,ut){var At=Ur(Ye,ut),Rt=Ct(Ye);if(Rt===null)return At;var xr=Bt(Rt,ut);if(xr.length<=0)return At;if(At.length<=0)return xr;for(var Ar=new rr,Ke=[],Xr=0,Yr=At;Xr<Yr.length;Xr++){var wn=Yr[Xr],cr=Ar.has(wn);cr||(Ar.add(wn),Ke.push(wn))}for(var Mr=0,gt=xr;Mr<gt.length;Mr++){var wn=gt[Mr],cr=Ar.has(wn);cr||(Ar.add(wn),Ke.push(wn))}return Ke}function Ur(Ye,ut){var At=[],Rt=ie(Ye,ut,!1);if(En(Rt))return At;for(var xr=Rt.keys(),Ar=H(xr),Ke=0;;){var Xr=et(Ar);if(!Xr)return At.length=Ke,At;var Yr=Ue(Xr);try{At[Ke]=Yr}catch(wn){try{st(Ar)}finally{throw wn}}Ke++}}function vn(Ye){if(Ye===null)return 1;switch(typeof Ye){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Ye===null?1:6;default:return 6}}function En(Ye){return Ye===void 0}function ea(Ye){return Ye===null}function ar(Ye){return typeof Ye=="symbol"}function ge(Ye){return typeof Ye=="object"?Ye!==null:typeof Ye=="function"}function Te(Ye,ut){switch(vn(Ye)){case 0:return Ye;case 1:return Ye;case 2:return Ye;case 3:return Ye;case 4:return Ye;case 5:return Ye}var At=ut===3?"string":ut===5?"number":"default",Rt=w(Ye,oe);if(Rt!==void 0){var xr=Rt.call(Ye,At);if(ge(xr))throw new TypeError;return xr}return Ze(Ye,At==="default"?"number":At)}function Ze(Ye,ut){if(ut==="string"){var At=Ye.toString;if(Or(At)){var Rt=At.call(Ye);if(!ge(Rt))return Rt}var xr=Ye.valueOf;if(Or(xr)){var Rt=xr.call(Ye);if(!ge(Rt))return Rt}}else{var xr=Ye.valueOf;if(Or(xr)){var Rt=xr.call(Ye);if(!ge(Rt))return Rt}var Ar=Ye.toString;if(Or(Ar)){var Rt=Ar.call(Ye);if(!ge(Rt))return Rt}}throw new TypeError}function Oe(Ye){return!!Ye}function Lt(Ye){return""+Ye}function nr(Ye){var ut=Te(Ye,3);return ar(ut)?ut:Lt(ut)}function dr(Ye){return Array.isArray?Array.isArray(Ye):Ye instanceof Object?Ye instanceof Array:Object.prototype.toString.call(Ye)==="[object Array]"}function Or(Ye){return typeof Ye=="function"}function lr(Ye){return typeof Ye=="function"}function un(Ye){switch(vn(Ye)){case 3:return!0;case 4:return!0;default:return!1}}function w(Ye,ut){var At=Ye[ut];if(At!=null){if(!Or(At))throw new TypeError;return At}}function H(Ye){var ut=w(Ye,Ne);if(!Or(ut))throw new TypeError;var At=ut.call(Ye);if(!ge(At))throw new TypeError;return At}function Ue(Ye){return Ye.value}function et(Ye){var ut=Ye.next();return ut.done?!1:ut}function st(Ye){var ut=Ye.return;ut&&ut.call(Ye)}function Ct(Ye){var ut=Object.getPrototypeOf(Ye);if(typeof Ye!="function"||Ye===Cr||ut!==Cr)return ut;var At=Ye.prototype,Rt=At&&Object.getPrototypeOf(At);if(Rt==null||Rt===Object.prototype)return ut;var xr=Rt.constructor;return typeof xr!="function"||xr===Ye?ut:xr}function $(){var Ye={},ut=[],At=function(){function Ke(Xr,Yr,wn){this._index=0,this._keys=Xr,this._values=Yr,this._selector=wn}return Ke.prototype["@@iterator"]=function(){return this},Ke.prototype[Ne]=function(){return this},Ke.prototype.next=function(){var Xr=this._index;if(Xr>=0&&Xr<this._keys.length){var Yr=this._selector(this._keys[Xr],this._values[Xr]);return Xr+1>=this._keys.length?(this._index=-1,this._keys=ut,this._values=ut):this._index++,{value:Yr,done:!1}}return{value:void 0,done:!0}},Ke.prototype.throw=function(Xr){throw this._index>=0&&(this._index=-1,this._keys=ut,this._values=ut),Xr},Ke.prototype.return=function(Xr){return this._index>=0&&(this._index=-1,this._keys=ut,this._values=ut),{value:Xr,done:!0}},Ke}();return function(){function Ke(){this._keys=[],this._values=[],this._cacheKey=Ye,this._cacheIndex=-2}return Object.defineProperty(Ke.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Ke.prototype.has=function(Xr){return this._find(Xr,!1)>=0},Ke.prototype.get=function(Xr){var Yr=this._find(Xr,!1);return Yr>=0?this._values[Yr]:void 0},Ke.prototype.set=function(Xr,Yr){var wn=this._find(Xr,!0);return this._values[wn]=Yr,this},Ke.prototype.delete=function(Xr){var Yr=this._find(Xr,!1);if(Yr>=0){for(var wn=this._keys.length,cr=Yr+1;cr<wn;cr++)this._keys[cr-1]=this._keys[cr],this._values[cr-1]=this._values[cr];return this._keys.length--,this._values.length--,Xr===this._cacheKey&&(this._cacheKey=Ye,this._cacheIndex=-2),!0}return!1},Ke.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Ye,this._cacheIndex=-2},Ke.prototype.keys=function(){return new At(this._keys,this._values,Rt)},Ke.prototype.values=function(){return new At(this._keys,this._values,xr)},Ke.prototype.entries=function(){return new At(this._keys,this._values,Ar)},Ke.prototype["@@iterator"]=function(){return this.entries()},Ke.prototype[Ne]=function(){return this.entries()},Ke.prototype._find=function(Xr,Yr){return this._cacheKey!==Xr&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Xr)),this._cacheIndex<0&&Yr&&(this._cacheIndex=this._keys.length,this._keys.push(Xr),this._values.push(void 0)),this._cacheIndex},Ke}();function Rt(Ke,Xr){return Ke}function xr(Ke,Xr){return Xr}function Ar(Ke,Xr){return[Ke,Xr]}}function Gt(){return function(){function Ye(){this._map=new Xt}return Object.defineProperty(Ye.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Ye.prototype.has=function(ut){return this._map.has(ut)},Ye.prototype.add=function(ut){return this._map.set(ut,ut),this},Ye.prototype.delete=function(ut){return this._map.delete(ut)},Ye.prototype.clear=function(){this._map.clear()},Ye.prototype.keys=function(){return this._map.keys()},Ye.prototype.values=function(){return this._map.values()},Ye.prototype.entries=function(){return this._map.entries()},Ye.prototype["@@iterator"]=function(){return this.keys()},Ye.prototype[Ne]=function(){return this.keys()},Ye}()}function Tr(){var Ye=16,ut=Zt.create(),At=Rt();return function(){function Yr(){this._key=Rt()}return Yr.prototype.has=function(wn){var cr=xr(wn,!1);return cr!==void 0?Zt.has(cr,this._key):!1},Yr.prototype.get=function(wn){var cr=xr(wn,!1);return cr!==void 0?Zt.get(cr,this._key):void 0},Yr.prototype.set=function(wn,cr){var Mr=xr(wn,!0);return Mr[this._key]=cr,this},Yr.prototype.delete=function(wn){var cr=xr(wn,!1);return cr!==void 0?delete cr[this._key]:!1},Yr.prototype.clear=function(){this._key=Rt()},Yr}();function Rt(){var Yr;do Yr="@@WeakMap@@"+Xr();while(Zt.has(ut,Yr));return ut[Yr]=!0,Yr}function xr(Yr,wn){if(!te.call(Yr,At)){if(!wn)return;Object.defineProperty(Yr,At,{value:Zt.create()})}return Yr[At]}function Ar(Yr,wn){for(var cr=0;cr<wn;++cr)Yr[cr]=Math.random()*255|0;return Yr}function Ke(Yr){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Yr)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Yr)):Ar(new Uint8Array(Yr),Yr):Ar(new Array(Yr),Yr)}function Xr(){var Yr=Ke(Ye);Yr[6]=Yr[6]&79|64,Yr[8]=Yr[8]&191|128;for(var wn="",cr=0;cr<Ye;++cr){var Mr=Yr[cr];(cr===4||cr===6||cr===8)&&(wn+="-"),Mr<16&&(wn+="0"),wn+=Mr.toString(16).toLowerCase()}return wn}}function Ir(Ye){return Ye.__=void 0,delete Ye.__,Ye}})})(E||(E={}))},69848:function(zr){(function(N,S){zr.exports=S()})(this,function(){"use strict";function N(wt,$e,Ft,Xe,jt,br){if(!(jt-Xe<=Ft)){var sr=Xe+jt>>1;S(wt,$e,sr,Xe,jt,br%2),N(wt,$e,Ft,Xe,sr-1,br+1),N(wt,$e,Ft,sr+1,jt,br+1)}}function S(wt,$e,Ft,Xe,jt,br){for(;jt>Xe;){if(jt-Xe>600){var sr=jt-Xe+1,j=Ft-Xe+1,ie=Math.log(sr),Re=.5*Math.exp(2*ie/3),ye=.5*Math.sqrt(ie*Re*(sr-Re)/sr)*(j-sr/2<0?-1:1),_t=Math.max(Xe,Math.floor(Ft-j*Re/sr+ye)),dt=Math.min(jt,Math.floor(Ft+(sr-j)*Re/sr+ye));S(wt,$e,Ft,_t,dt,br)}var zt=$e[2*Ft+br],Bt=Xe,Ur=jt;for(ce(wt,$e,Xe,Ft),$e[2*jt+br]>zt&&ce(wt,$e,Xe,jt);Bt<Ur;){for(ce(wt,$e,Bt,Ur),Bt++,Ur--;$e[2*Bt+br]<zt;)Bt++;for(;$e[2*Ur+br]>zt;)Ur--}$e[2*Xe+br]===zt?ce(wt,$e,Xe,Ur):(Ur++,ce(wt,$e,Ur,jt)),Ur<=Ft&&(Xe=Ur+1),Ft<=Ur&&(jt=Ur-1)}}function ce(wt,$e,Ft,Xe){E(wt,Ft,Xe),E($e,2*Ft,2*Xe),E($e,2*Ft+1,2*Xe+1)}function E(wt,$e,Ft){var Xe=wt[$e];wt[$e]=wt[Ft],wt[Ft]=Xe}function d(wt,$e,Ft,Xe,jt,br,sr){for(var j=[0,wt.length-1,0],ie=[],Re,ye;j.length;){var _t=j.pop(),dt=j.pop(),zt=j.pop();if(dt-zt<=sr){for(var Bt=zt;Bt<=dt;Bt++)Re=$e[2*Bt],ye=$e[2*Bt+1],Re>=Ft&&Re<=jt&&ye>=Xe&&ye<=br&&ie.push(wt[Bt]);continue}var Ur=Math.floor((zt+dt)/2);Re=$e[2*Ur],ye=$e[2*Ur+1],Re>=Ft&&Re<=jt&&ye>=Xe&&ye<=br&&ie.push(wt[Ur]);var vn=(_t+1)%2;(_t===0?Ft<=Re:Xe<=ye)&&(j.push(zt),j.push(Ur-1),j.push(vn)),(_t===0?jt>=Re:br>=ye)&&(j.push(Ur+1),j.push(dt),j.push(vn))}return ie}function me(wt,$e,Ft,Xe,jt,br){for(var sr=[0,wt.length-1,0],j=[],ie=jt*jt;sr.length;){var Re=sr.pop(),ye=sr.pop(),_t=sr.pop();if(ye-_t<=br){for(var dt=_t;dt<=ye;dt++)te($e[2*dt],$e[2*dt+1],Ft,Xe)<=ie&&j.push(wt[dt]);continue}var zt=Math.floor((_t+ye)/2),Bt=$e[2*zt],Ur=$e[2*zt+1];te(Bt,Ur,Ft,Xe)<=ie&&j.push(wt[zt]);var vn=(Re+1)%2;(Re===0?Ft-jt<=Bt:Xe-jt<=Ur)&&(sr.push(_t),sr.push(zt-1),sr.push(vn)),(Re===0?Ft+jt>=Bt:Xe+jt>=Ur)&&(sr.push(zt+1),sr.push(ye),sr.push(vn))}return j}function te(wt,$e,Ft,Xe){var jt=wt-Ft,br=$e-Xe;return jt*jt+br*br}var ue=function(wt){return wt[0]},oe=function(wt){return wt[1]},Ne=function($e,Ft,Xe,jt,br){Ft===void 0&&(Ft=ue),Xe===void 0&&(Xe=oe),jt===void 0&&(jt=64),br===void 0&&(br=Float64Array),this.nodeSize=jt,this.points=$e;for(var sr=$e.length<65536?Uint16Array:Uint32Array,j=this.ids=new sr($e.length),ie=this.coords=new br($e.length*2),Re=0;Re<$e.length;Re++)j[Re]=Re,ie[2*Re]=Ft($e[Re]),ie[2*Re+1]=Xe($e[Re]);N(j,ie,jt,0,j.length-1,0)};Ne.prototype.range=function($e,Ft,Xe,jt){return d(this.ids,this.coords,$e,Ft,Xe,jt,this.nodeSize)},Ne.prototype.within=function($e,Ft,Xe){return me(this.ids,this.coords,$e,Ft,Xe,this.nodeSize)};var K={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(wt){return wt}},Qe=Math.fround||function(wt){return function($e){return wt[0]=+$e,wt[0]}}(new Float32Array(1)),mt=function($e){this.options=yr(Object.create(K),$e),this.trees=new Array(this.options.maxZoom+1)};mt.prototype.load=function($e){var Ft=this.options,Xe=Ft.log,jt=Ft.minZoom,br=Ft.maxZoom,sr=Ft.nodeSize;Xe&&console.time("total time");var j="prepare "+$e.length+" points";Xe&&console.time(j),this.points=$e;for(var ie=[],Re=0;Re<$e.length;Re++)!$e[Re].geometry||ie.push(Cr($e[Re],Re));this.trees[br+1]=new Ne(ie,q,hr,sr,Float32Array),Xe&&console.timeEnd(j);for(var ye=br;ye>=jt;ye--){var _t=+Date.now();ie=this._cluster(ie,ye),this.trees[ye]=new Ne(ie,q,hr,sr,Float32Array),Xe&&console.log("z%d: %d clusters in %dms",ye,ie.length,+Date.now()-_t)}return Xe&&console.timeEnd("total time"),this},mt.prototype.getClusters=function($e,Ft){var Xe=(($e[0]+180)%360+360)%360-180,jt=Math.max(-90,Math.min(90,$e[1])),br=$e[2]===180?180:(($e[2]+180)%360+360)%360-180,sr=Math.max(-90,Math.min(90,$e[3]));if($e[2]-$e[0]>=360)Xe=-180,br=180;else if(Xe>br){var j=this.getClusters([Xe,jt,180,sr],Ft),ie=this.getClusters([-180,jt,br,sr],Ft);return j.concat(ie)}for(var Re=this.trees[this._limitZoom(Ft)],ye=Re.range(rr(Xe),Ut(sr),rr(br),Ut(jt)),_t=[],dt=0,zt=ye;dt<zt.length;dt+=1){var Bt=zt[dt],Ur=Re.points[Bt];_t.push(Ur.numPoints?Qt(Ur):this.points[Ur.index])}return _t},mt.prototype.getChildren=function($e){var Ft=this._getOriginId($e),Xe=this._getOriginZoom($e),jt="No cluster with the specified id.",br=this.trees[Xe];if(!br)throw new Error(jt);var sr=br.points[Ft];if(!sr)throw new Error(jt);for(var j=this.options.radius/(this.options.extent*Math.pow(2,Xe-1)),ie=br.within(sr.x,sr.y,j),Re=[],ye=0,_t=ie;ye<_t.length;ye+=1){var dt=_t[ye],zt=br.points[dt];zt.parentId===$e&&Re.push(zt.numPoints?Qt(zt):this.points[zt.index])}if(Re.length===0)throw new Error(jt);return Re},mt.prototype.getLeaves=function($e,Ft,Xe){Ft=Ft||10,Xe=Xe||0;var jt=[];return this._appendLeaves(jt,$e,Ft,Xe,0),jt},mt.prototype.getTile=function($e,Ft,Xe){var jt=this.trees[this._limitZoom($e)],br=Math.pow(2,$e),sr=this.options,j=sr.extent,ie=sr.radius,Re=ie/j,ye=(Xe-Re)/br,_t=(Xe+1+Re)/br,dt={features:[]};return this._addTileFeatures(jt.range((Ft-Re)/br,ye,(Ft+1+Re)/br,_t),jt.points,Ft,Xe,br,dt),Ft===0&&this._addTileFeatures(jt.range(1-Re/br,ye,1,_t),jt.points,br,Xe,br,dt),Ft===br-1&&this._addTileFeatures(jt.range(0,ye,Re/br,_t),jt.points,-1,Xe,br,dt),dt.features.length?dt:null},mt.prototype.getClusterExpansionZoom=function($e){for(var Ft=this._getOriginZoom($e)-1;Ft<=this.options.maxZoom;){var Xe=this.getChildren($e);if(Ft++,Xe.length!==1)break;$e=Xe[0].properties.cluster_id}return Ft},mt.prototype._appendLeaves=function($e,Ft,Xe,jt,br){for(var sr=this.getChildren(Ft),j=0,ie=sr;j<ie.length;j+=1){var Re=ie[j],ye=Re.properties;if(ye&&ye.cluster?br+ye.point_count<=jt?br+=ye.point_count:br=this._appendLeaves($e,ye.cluster_id,Xe,jt,br):br<jt?br++:$e.push(Re),$e.length===Xe)break}return br},mt.prototype._addTileFeatures=function($e,Ft,Xe,jt,br,sr){for(var j=0,ie=$e;j<ie.length;j+=1){var Re=ie[j],ye=Ft[Re],_t=ye.numPoints,dt=void 0,zt=void 0,Bt=void 0;if(_t)dt=Xt(ye),zt=ye.x,Bt=ye.y;else{var Ur=this.points[ye.index];dt=Ur.properties,zt=rr(Ur.geometry.coordinates[0]),Bt=Ut(Ur.geometry.coordinates[1])}var vn={type:1,geometry:[[Math.round(this.options.extent*(zt*br-Xe)),Math.round(this.options.extent*(Bt*br-jt))]],tags:dt},En=void 0;_t?En=ye.id:this.options.generateId?En=ye.index:this.points[ye.index].id&&(En=this.points[ye.index].id),En!==void 0&&(vn.id=En),sr.features.push(vn)}},mt.prototype._limitZoom=function($e){return Math.max(this.options.minZoom,Math.min(+$e,this.options.maxZoom+1))},mt.prototype._cluster=function($e,Ft){for(var Xe=[],jt=this.options,br=jt.radius,sr=jt.extent,j=jt.reduce,ie=jt.minPoints,Re=br/(sr*Math.pow(2,Ft)),ye=0;ye<$e.length;ye++){var _t=$e[ye];if(!(_t.zoom<=Ft)){_t.zoom=Ft;for(var dt=this.trees[Ft+1],zt=dt.within(_t.x,_t.y,Re),Bt=_t.numPoints||1,Ur=Bt,vn=0,En=zt;vn<En.length;vn+=1){var ea=En[vn],ar=dt.points[ea];ar.zoom>Ft&&(Ur+=ar.numPoints||1)}if(Ur>Bt&&Ur>=ie){for(var ge=_t.x*Bt,Te=_t.y*Bt,Ze=j&&Bt>1?this._map(_t,!0):null,Oe=(ye<<5)+(Ft+1)+this.points.length,Lt=0,nr=zt;Lt<nr.length;Lt+=1){var dr=nr[Lt],Or=dt.points[dr];if(!(Or.zoom<=Ft)){Or.zoom=Ft;var lr=Or.numPoints||1;ge+=Or.x*lr,Te+=Or.y*lr,Or.parentId=Oe,j&&(Ze||(Ze=this._map(_t,!0)),j(Ze,this._map(Or)))}}_t.parentId=Oe,Xe.push(Zt(ge/Ur,Te/Ur,Oe,Ur,Ze))}else if(Xe.push(_t),Ur>1)for(var un=0,w=zt;un<w.length;un+=1){var H=w[un],Ue=dt.points[H];Ue.zoom<=Ft||(Ue.zoom=Ft,Xe.push(Ue))}}}return Xe},mt.prototype._getOriginId=function($e){return $e-this.points.length>>5},mt.prototype._getOriginZoom=function($e){return($e-this.points.length)%32},mt.prototype._map=function($e,Ft){if($e.numPoints)return Ft?yr({},$e.properties):$e.properties;var Xe=this.points[$e.index].properties,jt=this.options.map(Xe);return Ft&&jt===Xe?yr({},jt):jt};function Zt(wt,$e,Ft,Xe,jt){return{x:Qe(wt),y:Qe($e),zoom:Infinity,id:Ft,parentId:-1,numPoints:Xe,properties:jt}}function Cr(wt,$e){var Ft=wt.geometry.coordinates,Xe=Ft[0],jt=Ft[1];return{x:Qe(rr(Xe)),y:Qe(Ut(jt)),zoom:Infinity,index:$e,parentId:-1}}function Qt(wt){return{type:"Feature",id:wt.id,properties:Xt(wt),geometry:{type:"Point",coordinates:[St(wt.x),Et(wt.y)]}}}function Xt(wt){var $e=wt.numPoints,Ft=$e>=1e4?Math.round($e/1e3)+"k":$e>=1e3?Math.round($e/100)/10+"k":$e;return yr(yr({},wt.properties),{cluster:!0,cluster_id:wt.id,point_count:$e,point_count_abbreviated:Ft})}function rr(wt){return wt/360+.5}function Ut(wt){var $e=Math.sin(wt*Math.PI/180),Ft=.5-.25*Math.log((1+$e)/(1-$e))/Math.PI;return Ft<0?0:Ft>1?1:Ft}function St(wt){return(wt-.5)*360}function Et(wt){var $e=(180-wt*360)*Math.PI/180;return 360*Math.atan(Math.exp($e))/Math.PI-90}function yr(wt,$e){for(var Ft in $e)wt[Ft]=$e[Ft];return wt}function q(wt){return wt.x}function hr(wt){return wt.y}return mt})},75752:function(zr){zr.exports.RADIUS=6378137,zr.exports.FLATTENING=1/298.257223563,zr.exports.POLAR_RADIUS=63567523142e-4}}]);
